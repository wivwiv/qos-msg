import{u as It,_ as ea,a as ta,b as aa,c as na,d as oa,e as sa,f as ra,g as la,S as ia,h as ua}from"./SchemaForm-B5Ct9r7g.js";import{_ as ca,d as $e,o as g,c as ae,a as V,a_ as nt,a2 as ft,j as X,g as Z,q as Ce,m as O,w as a,u as e,y as Se,r as E,b as n,k as Fe,F as Re,t as M,n as qe,M as de,bp as Vt,bq as da,au as Le,a1 as Mt,J as Oe,x as Q,as as pa,e as _e,ab as yt,p as ot,v as ma,a9 as St,E as st,a5 as Ye,av as fa,aX as ya,bn as $t,aI as ga,b7 as D,br as dt,f as Ze,ao as Pe,h as _a,bs as ze,a$ as ba,N as va,bt as Lt,bu as ha,s as At,i as Ot,V as Nt,bo as Je,aW as ka,bv as Dt,C as wa,aZ as qt,l as Ca,aH as Va,b1 as pt,W as Sa,K as $a,ac as Da,aT as Be,a3 as Rt,b2 as Ut,aU as Xe,R as qa,bw as tt,b4 as Ra,bx as Bt,aM as Ba,am as Pa}from"./index-gzDiX6cq.js";import{u as Ue,b as Ta,c as Ea,a as gt,_ as Fa,d as Ia,e as Ma}from"./useBridgeTypeValue-DfFvHZxE.js";import{u as xt,a as La,b as Aa,c as Oa,d as Na}from"./useDataHandler-DIoGjH2Q.js";import{e as Ua,j as xa}from"./useRule-XWlG7MOW.js";import{_ as zt}from"./DetailHeader.vue_vue_type_style_index_0_lang-jMoftCB_.js";import{_ as za,a as et,b as Ha,c as ja,d as Ka}from"./CertFileInput.vue_vue_type_script_setup_true_lang-DHqscjx4.js";import{_ as rt}from"./InfoTooltip-DsMY02kq.js";import{_ as lt}from"./FormItemLabel.vue_vue_type_style_index_0_lang-C2ue8b3P.js";import{l as Ne,_ as Ht}from"./Monaco.vue_vue_type_style_index_0_lang-D8U6C2xl.js";import{a as _t,_ as Ga,u as jt}from"./KeyAndValueEditor.vue_vue_type_style_index_0_lang--Tqi0AAK.js";import{w as Wa}from"./CheckIcon.vue_vue_type_style_index_0_lang-CwdT__iB.js";import{u as it}from"./useFormRules-BXbR-dxB.js";import{u as ut}from"./useHandleActionItem-CLBwxXaF.js";import{_ as Qa}from"./TextEasyCopy.vue_vue_type_style_index_0_lang-WBOKfnFy.js";import{a as Xa}from"./CommonOverflowTooltip.vue_vue_type_style_index_0_lang-Du1TBZn7.js";import{a as Ya}from"./TargetItemStatus.vue_vue_type_style_index_0_lang-Bi-597rW.js";import{a0 as Kt}from"./pie-BnP3p4-0.js";import{u as Ja,a as Za}from"./useSyncPolling-15pkvvIZ.js";import{m as en}from"./more-filled-DdhB6Svi.js";import{c as tn}from"./close-DHQqAhpS.js";import{u as an,a as nn,b as on}from"./useHandleSourceItem-C2NmvGoR.js";import{u as Gt}from"./useActionAndSourceStatus-gzXOZG2c.js";import{u as sn,_ as rn,a as ln}from"./useDeleteBridge-CmOHUvjU.js";import{u as un}from"./usePaginationRemember-n4ryuqdx.js";import{u as cn}from"./useCheckBeforeSaveAsCopy-6rpqkkHP.js";import{u as dn}from"./useOperationConfirm-SEd6OnAP.js";const pn=$e({name:"Share"}),mn={viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},fn=V("path",{fill:"currentColor",d:"m679.872 348.8-301.76 188.608a127.808 127.808 0 0 1 5.12 52.16l279.936 104.96a128 128 0 1 1-22.464 59.904l-279.872-104.96a128 128 0 1 1-16.64-166.272l301.696-188.608a128 128 0 1 1 33.92 54.272z"},null,-1),yn=[fn];function gn(t,f,r,y,o,l){return g(),ae("svg",mn,yn)}var _n=ca(pn,[["render",gn]]);const bn={class:"action-opt-item space-between"},vn={class:"action-name"},hn={class:"action-status vertical-align-center"},kn=$e({__name:"ActionSelect",props:{modelValue:{},type:{},disableList:{},direction:{default:nt.Egress},webhookActionDisabled:{type:Boolean,default:!0}},emits:["update:modelValue","change"],setup(t,{emit:f}){const r=ft(),y=t,o=f,l=X({get(){return y.modelValue?y.modelValue||"":r},set($){$===r?o("update:modelValue",""):o("update:modelValue",$)}}),p=Z([]),{getActionList:s}=an(),{getSourceList:d}=nn();(async()=>{try{y.direction===nt.Ingress?p.value=await d():p.value=await s()}catch{}})();const{judgeIsWebhookAction:h}=xt(),v=$=>{if(!y.disableList&&!y.webhookActionDisabled)return!1;const{id:ee}=$;let U=!1;return y.webhookActionDisabled&&(U=h($)),y.disableList&&(U=U||y.disableList.includes(ee)&&ee!==y.modelValue),U},{getBridgeGeneralType:P}=Ue(),k=X(()=>y.type?p.value.filter($=>P($.type)===y.type):[]),{tl:C}=Ce("RuleEngine"),N=X(()=>y.direction===nt.Egress?C("createAction"):C("createSource")),{getStatusLabel:T,getStatusClass:x}=Gt(),S=$=>{if(!$)return;if($===r){o("change");return}const ee=k.value.find(U=>U.id===$);ee&&o("change",ee)};return($,ee)=>{const U=E("el-option"),j=E("el-select");return g(),O(j,{class:"action-select","popper-class":"action-opt-popper",modelValue:e(l),"onUpdate:modelValue":ee[0]||(ee[0]=A=>Se(l)?l.value=A:null),onChange:S},{default:a(()=>[n(U,{value:e(r),label:e(N)},null,8,["value","label"]),(g(!0),ae(Re,null,Fe(e(k),A=>(g(),O(U,{key:A.id,value:A.id,label:A.name,disabled:v(A)},{default:a(()=>[V("div",bn,[V("p",vn,M(A.name),1),V("div",hn,[V("i",{class:qe(["node-status-dot",`is-${e(x)(A.status)}`])},null,2),V("span",{class:qe(["text-status",e(x)(A.status)])},M(e(T)(A.status)),3)])])]),_:2},1032,["value","label","disabled"]))),128))]),_:1},8,["modelValue"])}}});var Wt=(t=>(t[t.Green=0]="Green",t[t.Blue=1]="Blue",t[t.Red=2]="Red",t[t.Gray=3]="Gray",t[t.Purple=4]="Purple",t[t.Yellow=5]="Yellow",t))(Wt||{});const Qt="#469cf7",bt={0:"#7fd7b8",1:Qt,2:"#fdafa6",3:"#bac1cd",4:"#c5a3e5",5:"#ffd78e"},wn="#c2c8d1",Xt=()=>{const{addListener:t}=Ja();return{initChart:r=>{const y=document.getElementById(r);if(!y)return;const o=Kt(y,null,{renderer:"canvas",useDirtyRect:!1});return t(o),o}}},Cn=()=>{const{initChart:t}=Xt(),f=new Map,r=d=>({tooltip:{trigger:"item"},series:[{type:"pie",top:"-100%",radius:["65%","94%"],center:["50%","100%"],startAngle:180,label:{show:!1},data:d}]}),y=d=>({value:d.reduce((_,h)=>_+h.value,0),itemStyle:{color:"none",decal:{symbol:"none"}},label:{show:!1}}),o=({name:d,value:_})=>({name:d,value:_,itemStyle:{color:wn}}),l=({name:d,value:_,type:h})=>({name:d,value:_,itemStyle:{color:bt[h]}}),p=d=>{if(d.every(({value:_})=>!_)){const _=y(d);return[...d.map(o),...d.map(()=>_)]}return[...d.map(l),y(d)]};return{updatePieData:(d,_)=>{let h=f.get(d);h||(h=t(d),f.set(d,h)),h==null||h.setOption(r(p(_)))}}},Vn="#4af746",Sn=()=>{const{tl:t}=Ce("Base");let f;const r=(p,s)=>{const d=document.createElement("div");return d.className="rate-chart-tooltip",s===void 0?d.innerHTML=`<p class="no-data">${t("noData")}</p>`:d.innerHTML=`
        <p class="x-value">${p}</p>
        <div class="tooltip-body">
          <i class="badge"></i>
          <p class="num">${s}</p>
        </div>`,d},y=(p,s)=>{const d=[...s],_=s[s.length-1];return d[d.length-1]={value:_,itemStyle:{color:Vn}},{color:[Qt],grid:{left:0,top:0,right:0,bottom:0},tooltip:{trigger:"axis",confine:!0,axisPointer:{type:"none"},formatter:h=>{if(!h[0])return"";const{axisValue:v,value:P}=h[0];return r(v,P)}},xAxis:{type:"category",data:p,triggerEvent:!0,axisLine:{show:!1},axisTick:{show:!1},axisLabel:{show:!1}},yAxis:{type:"value",splitLine:{show:!1},axisLine:{show:!1},axisTick:{show:!1},axisLabel:{show:!1}},series:[{type:"bar",data:d,label:{show:!1},barWidth:5}]}},{initChart:o}=Xt();return{updateBarData:(p,s,d)=>{f||(f=o(p)),f==null||f.setOption(y(s,d))}}},$n=()=>{const t=(_,h)=>{var v;return((v=h[_])==null?void 0:v.label)||_},f=(_,h)=>{var v;return((v=h[_])==null?void 0:v.desc)||""},r=(_,h,v)=>h.reduce((P,{type:k,...C})=>{if(!C)return P;const{title:N,contains:T}=C;let x=0;const S=T.reduce(($,ee)=>{const U=de.get(_,ee),j={value:U,label:t(ee,v),desc:f(ee,v)};return x=Vt(x,U),$.push(j),$},[]);return P.push({title:N,count:x,detail:S,type:Number(k)}),P},[]),y=_=>_.reduce((h,{type:v,...P})=>{if(!P)return h;const{title:k}=P;return h.push({title:k,count:void 0,detail:[],type:Number(v)}),h},[]),o=(_,h)=>h.reduce((v,{type:P,...k})=>{if(!k)return v;const{title:C,contains:N}=k,T=N.reduce((x,S)=>Vt(x,de.get(_,S)||0),0);return[...v,{type:Number(P),name:C,value:T}]},[]),l=_=>new Array(_).fill(void 0),p=_=>({x:l(_),y:l(_)}),s=()=>Mt().format("HH:mm:ss");return{generatePieData:o,createEmptyRateData:p,addRateDataItem:(_,h,v)=>(h.x.push(s()),h.y.push(_),h.x.length>=v&&(h.x.shift(),h.y.shift()),h),generateMetricTypeData:r,generateEmptyMetricTypeData:y}},Dn=()=>{const t=p=>da(p,2),f=/^-?\d+(\.\d+)?/,r=p=>{var s;return((s=f.exec(p))==null?void 0:s[0])||"0"},y=p=>p.replace(f,"")||"Bytes";return{getSizeStr:t,getSizeNumPart:r,getSizeUnitPart:y,getSizeNum:p=>Le(r(t(p))),getSizeUnit:p=>y(t(p))}},qn=()=>{const{tl:t}=Ce("BasicConfig"),f="cluster",r={label:t("cluster"),value:f};return{CLUSTER:f,getNodeOpts:o=>[r,...o.map(l=>({value:l,label:l}))]}},Rn=()=>{const{t,tl:f}=Ce("RuleEngine"),r=[{type:0,title:f("success"),contains:["success"]},{type:1,title:f("processing"),contains:["queuing","inflight"]},{type:2,title:t("Base.failed"),contains:["failed"]},{type:3,title:f("dropped"),contains:["dropped.expired","dropped.queue_full","dropped.resource_not_found","dropped.resource_stopped","dropped.other"]}],y=[{type:0,title:f("received"),contains:["received"]}],o={matched:{label:f("matched"),desc:f("bridgeMatchedDesc")},inflight:{label:f("sentInflight"),desc:f("sentInflightDesc")},dropped:{label:f("dropped"),desc:f("droppedDesc")},"dropped.expired":{label:f("droppedExpired"),desc:f("droppedExpiredDesc")},"dropped.queue_full":{label:f("droppedQueueFull"),desc:f("droppedQueueFullDesc")},"dropped.resource_stopped":{label:f("droppedResourceStopped"),desc:f("droppedResourceStoppedDesc")},"dropped.resource_not_found":{label:f("droppedResourceNotFound"),desc:f("droppedResourceNotFoundDesc")},"dropped.other":{label:f("droppedOther"),desc:f("droppedOtherDesc")},queuing:{label:f("queuing"),desc:f("queuingDesc")},retried:{label:f("retried"),desc:f("retriedDesc")},received:{label:f("received"),desc:f("receivedDesc")},rate:{label:t("Base.rateNow"),desc:f("rateBarDesc")},rate_max:{label:t("Base.rateMax")},rate_last5m:{label:t("Base.rateLast5M")}};return{egressTypeMetricsMap:r,ingressTypeMetricsMap:y,textMap:o,rateData:{unitKey:"RuleEngine.rateUnit",current:"rate",right1:"rate_last5m",right2:"rate_max"}}},Bn=()=>{const{getSizeStr:t,getSizeNumPart:f,getSizeUnitPart:r}=Dn(),y=20,o=(k,C,N=y)=>{const T=k.length,x=N-T,S=new Array(x).fill(void 0),$=k[0]||Date.now();return{xData:[...Array.from({length:x},(U,j)=>$-(x-j)*3e3),...k],yData:[...S,...C]}},{tl:l}=Ce("Base"),p=Z();let s;const d=k=>({grid:{containLabel:!0,left:0,top:0,right:0,bottom:0},xAxis:{type:"category",data:k.xData,axisLabel:{show:!1},axisLine:{show:!1},axisTick:{show:!1}},yAxis:{type:"value",minInterval:1,axisLabel:{show:!1},splitLine:{show:!1}},series:[{type:"line",data:k.yData,showSymbol:!1,smooth:!0,step:!1}],tooltip:{trigger:"axis",formatter:C=>{if(!C[0])return"";const{axisValue:N,value:T}=C[0];return de.isUndefined(T)?l("noData"):`${Mt(Number(N)).format("HH:mm:ss")}<br/>${t(T)}`}},color:[bt[1]]}),_=k=>{if(!p.value)return;const C=o(k.xData,k.yData);s||(s=Kt(p.value)),s.setOption(d(C))},h={xData:[],yData:[]};return{getSizeStr:t,getSizeNumPart:f,getSizeUnitPart:r,QueueBytesChartEle:p,updateQueueBytesData:(k,C)=>{h.xData.push(C),h.yData.push(k),h.xData.length>y&&(h.xData.shift(),h.yData.shift()),_(h)},initQueueBytesData:()=>{h.xData=[],h.yData=[],_(h)}}},Gr=()=>{const{t,tl:f}=Ce("RuleEngine"),r=[{type:0,title:f("passed"),contains:["passed"]},{type:2,title:t("Base.failed"),contains:["failed.exception"]},{type:3,title:f("failedNoResult"),contains:["failed.no_result"]}],y=[{type:0,title:f("actionsSuccess"),contains:["actions.success"]},{type:2,title:f("actionsFailed"),contains:["actions.failed"]},{type:3,title:f("actionsDiscarded"),contains:["actions.discarded"]}],o={matched:{label:f("ruleMatched"),desc:f("bridgeMatchedDesc")},passed:{label:f("passed"),desc:f("passedDesc")},"actions.total":{label:f("actionsTotal"),desc:f("actionsTotalDesc")},"failed.exception":{label:f("failedException"),desc:f("failedExceptionDesc")},"failed.no_result":{label:f("failedNoResult"),desc:f("failedNoResultDesc")},"actions.success":{label:f("actionsSuccess"),desc:f("actionsSuccessDesc")},"matched.rate":{label:t("Base.rateNow"),desc:f("ruleRateBarDesc")},"matched.rate.last5m":{label:t("Base.rateLast5M")},"matched.rate.max":{label:t("Base.rateMax")}};return{ruleTypeMetricsMap:r,actionTypeMetricsMap:y,textMap:o,rateData:{unitKey:"RuleEngine.rateUnit",current:"matched.rate",right1:"matched.rate.last5m",right2:"matched.rate.max"}}},Pn={class:"type-metrics"},Tn={class:"metrics-main"},En={class:"metrics-hd"},Fn={class:"metric-name"},In={class:"metrics-body"},Mn={class:"num-container"},Ln={class:"metric-num"},An={key:0,class:"detail-trigger"},On={class:"metrics-details"},Nn={class:"desc-container"},Pt=$e({__name:"TypeMetricsItem",props:{type:{type:Number,default:Wt.Green},data:{type:Object,default:()=>({detail:[]})}},setup(t){pa(p=>({af1e2be4:e(r)}));const f=t,r=X(()=>bt[f.type]),y=X(()=>f.data.detail.length===1),o=X(()=>f.data.detail[0]),l=Z(0);return Oe(()=>f.data,(p,s)=>{(s==null?void 0:s.count)!==void 0&&(p==null?void 0:p.count)!==void 0&&(l.value=p.count-s.count)}),(p,s)=>{const d=E("el-descriptions-item"),_=E("el-descriptions"),h=E("el-scrollbar"),v=E("el-icon"),P=E("el-tooltip");return g(),ae("div",Pn,[V("div",Tn,[V("div",En,[s[0]||(s[0]=V("i",{class:"dot-type"},null,-1)),V("p",Fn,M(t.data.title),1),e(y)&&e(o).desc?(g(),O(rt,{key:0,content:e(o).desc},null,8,["content"])):Q("",!0)]),V("div",In,[V("div",Mn,[V("p",Ln,M(("formatNumber"in p?p.formatNumber:e(Le))(t.data.count)),1),e(l)&&t.data.count!==void 0?(g(),ae("span",{key:0,class:qe(["num-diff",{"is-red":e(l)<0,"need-plus":e(l)>0}])},M(("formatNumber"in p?p.formatNumber:e(Le))(e(l))),3)):Q("",!0)])])]),e(y)?Q("",!0):(g(),ae("div",An,[n(P,{effect:"dark",placement:"bottom",trigger:"click","popper-class":"type-detail-tooltip"},{content:a(()=>[V("div",On,[n(h,null,{default:a(()=>[V("div",Nn,[n(_,{column:2},{default:a(()=>[(g(!0),ae(Re,null,Fe(t.data.detail,({value:k,label:C,desc:N})=>(g(),O(d,{key:C},{label:a(()=>[_e(M(C)+" ",1),N?(g(),O(rt,{key:0,content:N},null,8,["content"])):Q("",!0)]),default:a(()=>[_e(" "+M(k),1)]),_:2},1024))),128)),t.data.detail.length%2===1?(g(),O(d,{key:0})):Q("",!0)]),_:1})])]),_:1})])]),default:a(()=>[n(v,{class:"icon-arrow",size:18},{default:a(()=>[n(e(en))]),_:1})]),_:1})]))])}}}),Un={class:"metric-types"},Tt=$e({__name:"TypeMetrics",props:{data:{},isFlowNode:{type:Boolean},selectedNode:{}},setup(t){const f=r=>!r||!de.isArray(r)||r.length===0?0:24/r.length;return(r,y)=>{const o=E("el-col"),l=E("el-row"),p=E("el-card");return r.isFlowNode?(g(),O(o,{key:1,span:24},{default:a(()=>[V("div",Un,[n(l,{gutter:24},{default:a(()=>[(g(!0),ae(Re,null,Fe(r.data,s=>(g(),O(o,{key:s.type,span:12,class:"flow-node-col"},{default:a(()=>[n(p,{class:"card-type-metrics"},{default:a(()=>[(g(),O(Pt,{data:s,type:s.type,key:r.selectedNode},null,8,["data","type"]))]),_:2},1024)]),_:2},1024))),128))]),_:1})])]),_:1})):(g(),O(o,{key:0,span:16},{default:a(()=>[n(p,{class:"metric-types"},{default:a(()=>[n(l,{gutter:0},{default:a(()=>[(g(!0),ae(Re,null,Fe(r.data,s=>(g(),O(o,{key:s.type,span:f(r.data),class:"col-type-metrics"},{default:a(()=>[(g(),O(Pt,{data:s,type:s.type,key:r.selectedNode},null,8,["data","type"]))]),_:2},1032,["span"]))),128))]),_:1})]),_:1})]),_:1}))}}}),xn={class:"overview-metrics"},zn={class:"metric-block"},Hn={class:"block-hd"},jn={class:"block-title"},Kn={class:"handlers-container"},Gn={class:"metric-name"},Wn={class:"metric-num"},Qn=["id"],Xn={class:"metric-block"},Yn={class:"block-hd"},Jn={class:"block-title"},Zn={class:"metric-bar-hd"},eo={class:"metric-name"},to={class:"metric-num"},ao={class:"num"},no={class:"unit"},oo={class:"metric-bar-bd"},so={class:"bar-desc tip"},ro={key:0,class:"metric-rate-item"},lo={class:"metric-name"},io={class:"metric-num"},uo={class:"num"},co={class:"unit"},po={key:1,class:"metric-rate-item"},mo={class:"metric-name"},fo={class:"metric-num"},yo={class:"num"},go={class:"unit"},_o={key:0,class:"metric-block"},bo={class:"block-hd"},vo={class:"block-title"},ho={class:"metric-name"},ko={class:"metric-num"},wo=["id"],Co={key:1,class:"metric-block"},Vo={class:"block-hd"},So={class:"block-title"},$o={class:"block-bd"},Et=20,Do=$e({__name:"OverviewMetrics",props:{requestMetrics:{type:Function},requestReset:{type:Function},textMap:{},showRate:{type:Boolean},totals:{},typeMetricsMaps:{},rateMetrics:{},title:{},tableData:{},nodeStatusDesc:{},childrenTitle:{}},emits:["metrics-change","node-change"],setup(t,{emit:f}){const r=t,y=f,o=yt("isFlowNode",!1),{t:l,tl:p}=Ce("RuleEngine"),s=Z({metrics:{},node_metrics:[]}),{CLUSTER:d,getNodeOpts:_}=qn(),h=X(()=>{var i;return _((((i=s.value)==null?void 0:i.node_metrics)||[]).map(({node:I})=>I))}),v=Z(d),P=()=>{H=oe(),J(),y("node-change",v.value,v.value===d)};y("node-change",v.value,v.value===d);const k=i=>{var I;return((I=r.textMap[i])==null?void 0:I.label)||i},C=i=>{var I;return((I=r.textMap[i])==null?void 0:I.desc)||""},{generatePieData:N,createEmptyRateData:T,addRateDataItem:x,generateMetricTypeData:S,generateEmptyMetricTypeData:$}=$n(),ee=X(()=>r.typeMetricsMaps.some(i=>i.children)),U=X(()=>{var pe;const{metrics:i,node_metrics:I}=s.value;return v.value===d?i:((pe=I.find(({node:ye})=>ye===v.value))==null?void 0:pe.metrics)||{}}),j=i=>$(i),A=(i,I)=>S(i,I,r.textMap),G=Z([{name:"",stats:[]}]),c=i=>i.map(I=>{const pe=I.children?c(I.children):void 0;return{name:I.name,stats:j(I.data),children:pe}});G.value=c(r.typeMetricsMaps);let b=[];const z=i=>`pie-chart-${i}`,{updatePieData:W}=Cn(),{updateBarData:te}=Sn(),oe=()=>T(Et);let H=oe();const re=i=>{const I=de.get(i,r.rateMetrics.current);return x(I,H,Et)},J=()=>{const i=U.value;if(G.value=[],r.typeMetricsMaps.forEach(I=>{r.totals&&r.totals[I.name]&&(b=N(i,I.data),W(`pie-chart-${I.name}`,b));const pe=I.children?I.children.map(ye=>{const ke=N(i,ye.data);return W(`pie-chart-${ye.name}`,ke),{name:ye.name,stats:A(i,ye.data)}}):null;G.value.push({name:I.name,stats:A(i,I.data),children:pe})}),r.rateMetrics){const{x:I,y:pe}=re(i);te("bar-chart-rate",I,pe)}},ge=async()=>{try{s.value=await r.requestMetrics(),J(),y("metrics-change",s.value)}catch{}},Y=()=>{H=oe(),G.value=c(r.typeMetricsMaps)},K=()=>{Y(),ge()},F=async()=>{await st.confirm(l("RuleEngine.resetMetricsConfirm",{target:r.title})),r.requestReset&&await r.requestReset(),Ye.success(p("resetSuccessfully")),Y(),ge()},{syncPolling:L}=Za();return L(ge,3e3),ge(),(i,I)=>{const pe=E("el-option"),ye=E("el-select"),ke=fa,ne=E("el-tooltip"),ie=E("el-button"),he=E("el-col"),Ve=E("el-row"),ue=E("el-card"),me=rt;return g(),ae("div",xn,[V("div",zn,[V("div",Hn,[V("p",jn,M(e(l)("Base.statistics")),1),V("div",Kn,[n(ye,{modelValue:e(v),"onUpdate:modelValue":I[0]||(I[0]=we=>Se(v)?v.value=we:null),onChange:P},{default:a(()=>[(g(!0),ae(Re,null,Fe(e(h),({value:we,label:be})=>(g(),O(pe,{key:we,label:be,value:we},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),n(ne,{content:i.$t("Base.refresh"),placement:"top"},{default:a(()=>[n(ke,{class:"icon-button","no-text":"",onClick:K})]),_:1},8,["content"]),i.requestReset?(g(),O(ne,{key:0,content:e(p)("resetStatistics"),placement:"top"},{default:a(()=>[n(ie,{class:"icon-button",icon:e(tn),disabled:!i.$hasPermission("put"),onClick:F},null,8,["icon","disabled"])]),_:1},8,["content"])):Q("",!0)])]),(g(!0),ae(Re,null,Fe(e(G),(we,be)=>(g(),O(Ve,{gutter:24,class:qe(["block-bd","stats-numbers",{"flow-node-row":e(o)}]),key:be},{default:a(()=>[i.totals&&i.totals[we.name]?(g(),O(he,{key:0,span:e(o)?24:8},{default:a(()=>[n(ue,{class:"metric-pie"},{default:a(()=>[n(Ve,null,{default:a(()=>[n(he,{span:12,class:"pie-base"},{default:a(()=>[V("div",null,[V("p",Gn,M(k(i.totals[we.name])),1),V("p",Wn,M(("formatNumber"in i?i.formatNumber:e(Le))(("get"in i?i.get:e(de.get))(e(U),i.totals[we.name]))),1)])]),_:2},1024),n(he,{span:12},{default:a(()=>[V("div",{class:"pie-container",id:z(we.name)},null,8,Qn)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["span"])):Q("",!0),n(Tt,{data:we.stats,"is-flow-node":e(o),"selected-node":e(v)},null,8,["data","is-flow-node","selected-node"])]),_:2},1032,["class"]))),128))]),ot(V("div",Xn,[V("div",Yn,[V("p",Jn,M(e(l)("Base.rateIndicators")),1)]),n(Ve,{class:qe(["block-bd",{"flow-node-row":e(o)}]),gutter:24},{default:a(()=>[n(he,{span:e(o)?24:11},{default:a(()=>[n(ue,{class:"metric-bar"},{default:a(()=>[V("div",Zn,[V("p",eo,M(k(i.rateMetrics.current)),1),V("p",to,[V("span",ao,M(("formatNumber"in i?i.formatNumber:e(Le))(("get"in i?i.get:e(de.get))(e(U),i.rateMetrics.current))),1),V("span",no,M(e(l)(i.rateMetrics.unitKey,("get"in i?i.get:e(de.get))(e(U),i.rateMetrics.current))),1)])]),V("div",oo,[I[1]||(I[1]=V("div",{class:"bar-container",id:"bar-chart-rate"},null,-1)),V("p",so,M(C(i.rateMetrics.current)),1)])]),_:1})]),_:1},8,["span"]),n(he,{span:e(o)?24:13},{default:a(()=>[n(ue,{class:"metric-rate"},{default:a(()=>[i.rateMetrics.right1?(g(),ae("div",ro,[V("p",lo,M(k(i.rateMetrics.right1)),1),V("p",io,[V("span",uo,M(("formatNumber"in i?i.formatNumber:e(Le))(("get"in i?i.get:e(de.get))(e(U),i.rateMetrics.right1))),1),V("span",co,M(e(l)(i.rateMetrics.unitKey,("get"in i?i.get:e(de.get))(e(U),i.rateMetrics.right1))),1)])])):Q("",!0),i.rateMetrics.right2?(g(),ae("div",po,[V("p",mo,M(k(i.rateMetrics.right2)),1),V("p",fo,[V("span",yo,M(("formatNumber"in i?i.formatNumber:e(Le))(("get"in i?i.get:e(de.get))(e(U),i.rateMetrics.right2))),1),V("span",go,M(e(l)(i.rateMetrics.unitKey,("get"in i?i.get:e(de.get))(e(U),i.rateMetrics.right2))),1)])])):Q("",!0)]),_:1})]),_:1},8,["span"])]),_:1},8,["class"])],512),[[ma,i.showRate]]),e(ee)?(g(),ae("div",_o,[V("div",bo,[V("p",vo,M(i.childrenTitle??e(p)("action")),1)]),(g(!0),ae(Re,null,Fe(e(G),(we,be)=>(g(),ae("div",{key:be},[(g(!0),ae(Re,null,Fe(we.children,(Te,Ae)=>(g(),O(Ve,{gutter:24,class:qe(["block-bd","stats-numbers",{"flow-node-row":e(o)}]),key:Ae},{default:a(()=>[i.totals&&i.totals[Te.name]?(g(),O(he,{key:0,span:e(o)?24:8},{default:a(()=>[n(ue,{class:"metric-pie"},{default:a(()=>[n(Ve,null,{default:a(()=>[n(he,{span:12,class:"pie-base"},{default:a(()=>[V("div",null,[V("p",ho,M(k(i.totals[Te.name])),1),V("p",ko,M(("formatNumber"in i?i.formatNumber:e(Le))(("get"in i?i.get:e(de.get))(e(U),i.totals[Te.name]))),1)])]),_:2},1024),n(he,{span:12},{default:a(()=>[V("div",{class:"pie-container",id:z(Te.name)},null,8,wo)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["span"])):Q("",!0),n(Tt,{data:Te.stats,"is-flow-node":e(o),"selected-node":e(v)},null,8,["data","is-flow-node","selected-node"])]),_:2},1032,["class"]))),128))]))),128))])):Q("",!0),St(i.$slots,"custom-block",{data:e(U)}),i.$slots.table&&!e(o)?(g(),ae("div",Co,[V("div",Vo,[V("p",So,[_e(M(e(p)("nodeStatus"))+" ",1),i.nodeStatusDesc?(g(),O(me,{key:0,content:i.nodeStatusDesc},null,8,["content"])):Q("",!0)])]),V("div",$o,[St(i.$slots,"table",{data:e(s)})])])):Q("",!0)])}}}),qo={class:"metric-block"},Ro={class:"block-hd"},Bo={class:"block-title"},Po={class:"metric-bar-hd"},To={class:"metric-name"},Eo={class:"num-container"},Fo={class:"metric-num"},Io={class:"num"},Mo={class:"metric-bar-hd"},Lo={class:"metric-name"},Ao={class:"metric-num"},Oo={class:"num"},No={class:"unit"},Uo={class:"metric-bar-bd"},xo={class:"bar-desc tip"},zo=$e({__name:"BridgeItemOverview",props:{bridgeMsg:{type:Object,required:!0},bridgeId:{type:String},isSource:{type:Boolean}},emits:["reconnect"],setup(t,{emit:f}){const r=t,y=f,o=yt("isFlowNode",!1),{t:l,tl:p}=Ce("RuleEngine"),{reconnectActionForNode:s,getActionMetrics:d,resetActionMetrics:_}=ut(),{reconnectSourceForNode:h,getSourceMetrics:v,resetSourceMetrics:P}=on(),k=(ne,ie)=>(he,Ve)=>r.isSource?ne(he,Ve):ie(he,Ve),C=k(h,s),N=k(v,d),T=k(P,_),x=async()=>{try{return r.bridgeId?N(r.bridgeId):void 0}catch{}},S=()=>{if(r.bridgeId)return T(r.bridgeId)},{getStatusLabel:$,getStatusClass:ee}=Gt(),U=X(()=>{var ie;const ne=(ie=r.bridgeMsg)==null?void 0:ie.node_status;return Array.isArray(ne)?ne:[]}),j=({node_metrics:ne})=>ne.map(({node:ie,metrics:he})=>{var ue;const Ve=((ue=U.value.find(me=>me.node===ie))==null?void 0:ue.status)||$t.Disconnected;return{node:ie,metrics:he,status:Ve}}),{ingressTypeMetricsMap:A,egressTypeMetricsMap:G,textMap:c,rateData:b}=Rn(),z=()=>{const ne={name:"ingress",data:A},ie={name:"egress",data:G};return r.isSource?[ne]:[ie]},W=ne=>r.isSource?"-":ne,te=Z({}),oe=()=>{var ne;te.value=(ne=r.bridgeMsg.node_status)==null?void 0:ne.reduce((ie,he)=>({...ie,[he.node]:!1}),{})},H=async({node:ne})=>{try{te.value[ne]=!0,await C(ne,r.bridgeMsg.id),y("reconnect")}catch{}finally{te.value[ne]=!1}};Oe(()=>r.bridgeMsg,oe);const{getSizeStr:re,getSizeNumPart:J,getSizeUnitPart:ge,QueueBytesChartEle:Y,updateQueueBytesData:K,initQueueBytesData:F}=Bn(),L=Z(""),i=Z(!1),I=(ne,ie)=>{L.value=ne,i.value=ie,F()},pe=Z(0),ye=Z(0),ke=ne=>{var me;const ie=Date.now(),he=i.value?ne.metrics:((me=ne.node_metrics.find(we=>we.node===L.value))==null?void 0:me.metrics)||{},Ve=he.queuing_bytes;K(Ve,ie);const ue=he.queuing||0;ye.value=ue-pe.value,pe.value=ue};return(ne,ie)=>{const he=E("el-card"),Ve=E("el-col"),ue=E("el-row"),me=E("el-table-column"),we=ga,be=E("el-table"),Te=Do;return g(),O(Te,{totals:{egress:"matched"},title:("lowerCase"in ne?ne.lowerCase:e(de.lowerCase))(e(p)("action")),"request-metrics":x,"request-reset":S,"type-metrics-maps":z(),"text-map":e(c),"rate-metrics":e(b),"show-rate":!t.isSource,"node-status-desc":e(p)("nodeStatusBridgeDesc"),onNodeChange:I,onMetricsChange:ke},ya({table:a(({data:Ae})=>[n(be,{data:j(Ae)},{default:a(()=>[n(me,{prop:"node",label:e(p)("name")},null,8,["label"]),n(me,{label:e(l)("Base.status"),width:230},{default:a(({row:w})=>[V("span",{class:qe(["text-status",e(ee)(w.status)])},M(e($)(w.status)),3),w.status===e($t).Disconnected?(g(),O(we,{key:0,type:"primary",disabled:!ne.$hasPermission("post"),onClick:m=>H(w),loading:e(te)[w.node]},{default:a(()=>[_e(M(e(p)("reconnect")),1)]),_:2},1032,["disabled","onClick","loading"])):Q("",!0)]),_:1},8,["label"]),n(me,{label:e(p)("matched")},{default:a(({row:w})=>{var m;return[_e(M(W((m=w.metrics)==null?void 0:m.matched)),1)]}),_:1},8,["label"]),t.isSource?(g(),O(me,{key:0,prop:"metrics.received",label:e(p)("received")},null,8,["label"])):Q("",!0),n(me,{label:e(p)("dropped")},{default:a(({row:w})=>{var m;return[_e(M(W((m=w.metrics)==null?void 0:m.dropped)),1)]}),_:1},8,["label"]),n(me,null,{header:a(()=>[V("p",null,M(e(l)("Base.rate")),1),V("p",null,"("+M(e(l)("RuleEngine.rateUnit",0))+")",1)]),default:a(({row:w})=>{var m;return[_e(M(W((m=w.metrics)==null?void 0:m.rate)),1)]}),_:1}),n(me,null,{header:a(()=>[V("p",null,M(e(l)("Base.rateLast5M")),1),V("p",null,"("+M(e(l)("RuleEngine.rateUnit",0))+")",1)]),default:a(({row:w})=>{var m;return[_e(M(W((m=w.metrics)==null?void 0:m.rate_last5m)),1)]}),_:1}),n(me,{label:e(l)("Base.rateMax")},{header:a(()=>[V("p",null,M(e(l)("Base.rateMax")),1),V("p",null,"("+M(e(l)("RuleEngine.rateUnit",0))+")",1)]),default:a(({row:w})=>{var m;return[_e(M(W((m=w.metrics)==null?void 0:m.rate_max)),1)]}),_:1},8,["label"])]),_:2},1032,["data"])]),_:2},[t.isSource?void 0:{name:"custom-block",fn:a(({data:Ae})=>[V("div",qo,[V("div",Ro,[V("p",Bo,M(e(p)("buffer")),1)]),n(ue,{class:qe(["block-bd",{"flow-node-row":e(o)}]),gutter:24},{default:a(()=>[n(Ve,{span:e(o)?24:6},{default:a(()=>[n(he,{class:"metric-bar"},{default:a(()=>[V("div",Po,[V("p",To,M(e(p)("queuedMessages")),1),V("div",Eo,[V("p",Fo,[V("span",Io,M(("formatNumber"in ne?ne.formatNumber:e(Le))(e(pe))),1)]),e(ye)?(g(),ae("span",{key:0,class:qe(["num-diff",{"is-red":e(ye)<0,"need-plus":e(ye)>0}])},M(("formatNumber"in ne?ne.formatNumber:e(Le))(e(ye))),3)):Q("",!0)])])]),_:1})]),_:1},8,["span"]),n(Ve,{span:e(o)?24:12},{default:a(()=>[n(he,{class:"metric-bar"},{default:a(()=>[V("div",Mo,[V("p",Lo,M(e(p)("queueUsage")),1),V("p",Ao,[V("span",Oo,M(e(J)(e(re)(Ae.queuing_bytes))),1),V("span",No,M(e(ge)(e(re)(Ae.queuing_bytes))),1)])]),V("div",Uo,[V("div",{class:"bar-container",ref_key:"QueueBytesChartEle",ref:Y},null,512),V("p",xo,M(e(p)("queueUsageDesc")),1)])]),_:2},1024)]),_:2},1032,["span"])]),_:2},1032,["class"])])]),key:"0"}]),1032,["title","type-metrics-maps","text-map","rate-metrics","show-rate","node-status-desc"])}}}),Ho=["start_timeout","worker_pool_size","request_ttl","health_check_interval","auto_restart_interval","max_buffer_bytes","batch_size","batch_time","query_mode","inflight_window"].map(t=>`resource_opts.${t}`),jo=(t,f)=>{const r=(F,L)=>F.reduce((i,I,pe)=>({...i,[I]:pe+L}),{}),y=F=>`parameters.${F}`,o=F=>F.map(y),l=["pool_type","pool_size","connect_timeout","max_retries","parameters.max_retries",...Ho],p=["name","connector","description"],s=p.length,d={...r(p,0),...r(l,99)},_=["parameters.max_retries"],h=r(["parameters.sql","parameters.prepare_statement"],s),v=o(["max_batch_bytes","required_acks","partition_count_refresh_interval","max_inflight","query_mode","sync_query_timeout","buffer","buffer.mode","buffer.per_partition_limit","buffer.segment_bytes","buffer.memory_overload_protection","max_linger_time","max_linger_bytes"]),P=o(["max_wait_time","max_batch_bytes","offset_commit_interval_seconds"]),k=o(["grpc_flush_timeout","aggregation_pool_size","max_batches","writer_pool_size","batch_size","batch_interval"]),C=o(["max_inflight","send_buffer","batch_size","max_batch_bytes","sync_timeout","buffer.mode","buffer.per_partition_limit","buffer.segment_bytes","buffer.memory_overload_protection"]),N=o(["pool_size","connect_timeout","max_inactive","pipelining","max_retries"]),T={...r(o(["topic","kafka_headers","kafka_header_value_encode_mode","kafka_ext_headers","message","message.key","message.value","message.timestamp","compression","partition_strategy","partitions_limit"]),s),...r(v,70)},x={[D.Webhook]:{...r(o(["path","method","headers","body"]),s),...r(_,70)},[D.MQTT]:r(o(["topic","qos","retain","payload"]),s),[D.MySQL]:r(o(["undefined_vars_as_null","sql"]),s),[D.Redis]:r(["command_template"],s),[D.GCPProducer]:r(o(["pubsub_topic","payload_template","attributes_template","ordering_key_template"]),s),[D.GCPConsumer]:r(["pubsub_topic","consumer.pull_max_messages"],s),[D.MongoDB]:r(["collection","payload_template"],s),[D.PgSQL]:h,[D.TimescaleDB]:h,[D.MatrixDB]:h,[D.ClickHouse]:r(o(["batch_value_separator","undefined_vars_as_null","sql"]),s),[D.DynamoDB]:r(o(["table","hash_key","range_key","undefined_vars_as_null","template"]),s),[D.RocketMQ]:r(o(["topic","template","strategy","refresh_interval","send_buffer","sync_timeout"]),s),[D.IoTDB]:r(["device_id","is_aligned","data"].map(F=>`parameters.${F}`),s),[D.RabbitMQ]:r(o(["exchange","routing_key","delivery_mode","wait_for_publish_confirmations","publish_confirmation_timeout","payload_template","queue","no_ack","wait_for_publish_confirmations"]),s),[D.HStream]:r([...o(["stream","partition_key","record_template"]),...k],s),[D.KafkaProducer]:T,[D.KafkaConsumer]:r([...o(["topic","group_id","key_encoding_mode","value_encoding_mode","offset_reset_policy"]),...P],s),[D.AzureEventHubs]:T,[D.Confluent]:T,[D.AmazonKinesis]:r(o(["stream_name","partition_key","payload_template"]),s),[D.GreptimeDB]:r(o(["write_syntax","precision"]),s),[D.SysKeeperForwarder]:r(o(["target_topic","target_qos","template"]),s),[D.Elasticsearch]:r(["index","id","doc_as_upsert","doc","routing","overwrite","max_retries"],s),[D.TDengine]:r(o(["database","undefined_vars_as_null","sql"]),s),[D.S3]:r(["parameters","bucket","key","acl","content","container","type","column_order","aggregation","max_records","time_interval","headers","min_part_size","max_part_size"],s),[D.AzureBlobStorage]:r(["parameters","container","blob","content","type","column_order","aggregation","max_records","time_interval"],s),[D.Pulsar]:r([...o(["pulsar_topic","strategy","compression","retention_period","message.key","message.value"]),...C],s),[D.Snowflake]:r([...o(["database","schema","stage","pipe","pipe_user","private_key","mode","aggregation"]),"container","type","column_order","max_records","time_interval","parameters.proxy",...C],s),[D.MicrosoftSQLServer]:r(o(["undefined_vars_as_null","sql"]),s),[D.Tablestore]:r(o(["data_source","table_name","measurement","storage_model_type","tags","fields","timestamp","meta_update_model"]),s)},S=X(()=>{let F=d;return t.type&&t.type in x&&(F={...F,...x[t.type]}),F}),$={"parameters.topic":"col-need-row"},ee={"parameters.mode":"col-hidden","parameters.container.type":"col-hidden"},U=F=>{var L;return/direct/i.test((L=F==null?void 0:F.parameters)==null?void 0:L.mode)?{"resource_opts.batch_size":"col-hidden"}:{}},j=F=>{const L=U(F);return{...ee,...L}},A={"parameters.mode":"col-hidden","parameters.aggregation.container.type":"col-hidden"},G=F=>{const L=U(F);return{...A,...L}},c=Z(!1);let b;const{checkIsIoTDBThriftConnector:z}=La(),W=async F=>{if(!b)try{b=z(F),c.value=await b}catch{}finally{window.setTimeout(()=>{b=void 0},300)}},te=F=>{const L=F==null?void 0:F.connector;return L&&W(L),c.value?{"resource_opts.query_mode":"col-hidden"}:{}},oe={[D.MicrosoftSQLServer]:{driver:"dividing-line-below"},[D.KafkaProducer]:$,[D.AzureEventHubs]:$,[D.Confluent]:$,[D.Elasticsearch]:{"parameters.action":"col-hidden"},[D.S3]:j,[D.AzureBlobStorage]:G,[D.IoTDB]:te},H={[D.Webhook]:["parameters.max_retries"],[D.RocketMQ]:o(["strategy","refresh_interval","send_buffer","sync_timeout"]),[D.RabbitMQ]:["parameters.publish_confirmation_timeout"],[D.ClickHouse]:["batch_value_separator"],[D.GreptimeDB]:["precision"],[D.GCPConsumer]:["pipelining"],[D.KafkaProducer]:v,[D.AzureEventHubs]:v,[D.Confluent]:v,[D.KafkaConsumer]:P,[D.HStream]:k,[D.Pulsar]:C,[D.S3]:o(["headers","min_part_size","max_part_size"]),[D.Snowflake]:N},re=X(()=>{const F=t.type?H[t.type]||[]:[];return[...l,...F]}),J="dividing-line-below col-need-row",ge=()=>{let F="",L="",i="";return t.hideName?(F="dividing-line-below",L="col-hidden"):i=J,{nameClass:L,connectorClass:F,descClass:i}},{syncEtcFieldsClassMap:Y}=It(f),K=X(()=>{let F=t.type?oe[t.type]||{}:{};de.isFunction(F)&&(F=F(f.value));const{nameClass:L,connectorClass:i,descClass:I}=ge();return{...Y.value,name:L,connector:i,description:I,direction:"col-hidden",type:"col-hidden",enable:"col-hidden",local_topic:"col-hidden",ssl:"col-ssl col-need-row dividing-line-below",fallback_actions:"col-fallback-actions",...F}});return{propsOrderMap:S,customColClass:K,advancedFields:re}},Ko={key:1,class:"value"},Go=$e({__name:"BridgeResourceOpt",props:{modelValue:{type:Object,required:!0},withStartTimeoutConfig:{type:Boolean,default:!0},withBatchConfig:{type:Boolean,default:!1},withRequestTimeoutConfig:{type:Boolean,default:!0},colSpan:{type:Number,default:12},readonly:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(t,{emit:f}){const r=t,y=f,{tl:o}=Ce("BridgeSchema.common"),l=X({get(){return r.modelValue},set(s){y("update:modelValue",s)}}),p=X(()=>l.value.inflight_window!==void 0);return(s,d)=>{const _=lt,h=za,v=et,P=E("el-col"),k=E("el-input"),C=Ha,N=ja,T=E("el-option"),x=E("el-select"),S=E("el-form-item");return g(),ae(Re,null,[t.withStartTimeoutConfig?(g(),O(P,{key:0,span:t.colSpan},{default:a(()=>[n(v,{prop:"resource_opts.start_timeout",readonly:t.readonly},{label:a(()=>[n(_,{label:e(o)("start_timeout.label"),desc:e(o)("start_timeout.desc")},null,8,["label","desc"])]),default:a(()=>[n(h,{modelValue:e(l).start_timeout,"onUpdate:modelValue":d[0]||(d[0]=$=>e(l).start_timeout=$)},null,8,["modelValue"])]),_:1},8,["readonly"])]),_:1},8,["span"])):Q("",!0),n(P,{span:t.colSpan},{default:a(()=>[n(v,{prop:"resource_opts.worker_pool_size",readonly:t.readonly},{label:a(()=>[n(_,{label:e(o)("worker_pool_size.label"),desc:e(o)("worker_pool_size.desc")},null,8,["label","desc"])]),default:a(()=>[n(k,{modelValue:e(l).worker_pool_size,"onUpdate:modelValue":d[1]||(d[1]=$=>e(l).worker_pool_size=$)},null,8,["modelValue"])]),_:1},8,["readonly"])]),_:1},8,["span"]),t.withRequestTimeoutConfig?(g(),O(P,{key:1,span:t.colSpan},{default:a(()=>[n(v,{prop:"resource_opts.request_ttl",readonly:t.readonly},{label:a(()=>[n(_,{label:e(o)("request_ttl.label"),desc:e(o)("request_ttl.desc"),"desc-marked":""},null,8,["label","desc"])]),default:a(()=>[n(C,{modelValue:e(l).request_ttl,"onUpdate:modelValue":d[2]||(d[2]=$=>e(l).request_ttl=$),items:[{type:"duration"},{symbols:["infinity"],type:"enum"}]},null,8,["modelValue"])]),_:1},8,["readonly"])]),_:1},8,["span"])):Q("",!0),n(P,{span:t.colSpan},{default:a(()=>[n(v,{prop:"resource_opts.health_check_interval",readonly:t.readonly},{label:a(()=>[n(_,{label:e(o)("health_check_interval.label"),desc:e(o)("health_check_interval.desc")},null,8,["label","desc"])]),default:a(()=>[n(h,{modelValue:e(l).health_check_interval,"onUpdate:modelValue":d[3]||(d[3]=$=>e(l).health_check_interval=$)},null,8,["modelValue"])]),_:1},8,["readonly"])]),_:1},8,["span"]),n(P,{span:t.colSpan},{default:a(()=>[n(v,{prop:"resource_opts.max_buffer_bytes",readonly:t.readonly},{label:a(()=>[n(_,{label:e(o)("max_buffer_bytes.label"),desc:e(o)("max_buffer_bytes.desc")},null,8,["label","desc"])]),default:a(()=>[n(N,{units:["MB","GB","KB"],modelValue:e(l).max_buffer_bytes,"onUpdate:modelValue":d[4]||(d[4]=$=>e(l).max_buffer_bytes=$)},null,8,["modelValue"])]),_:1},8,["readonly"])]),_:1},8,["span"]),t.withBatchConfig?(g(),O(P,{key:2,span:t.colSpan},{default:a(()=>[n(v,{prop:"resource_opts.batch_size",readonly:t.readonly},{label:a(()=>[n(_,{label:e(o)("batch_size.label"),desc:e(o)("batch_size.desc")},null,8,["label","desc"])]),default:a(()=>[n(k,{modelValue:e(l).batch_size,"onUpdate:modelValue":d[5]||(d[5]=$=>e(l).batch_size=$)},null,8,["modelValue"])]),_:1},8,["readonly"])]),_:1},8,["span"])):Q("",!0),n(P,{span:t.colSpan},{default:a(()=>[n(S,{prop:"resource_opts.query_mode"},{label:a(()=>[n(_,{label:e(o)("query_mode.label"),desc:e(o)("query_mode.desc")},null,8,["label","desc"])]),default:a(()=>[t.readonly?(g(),ae("p",Ko,M(s.$t(`RuleEngine.${e(l).query_mode}`)),1)):(g(),O(x,{key:0,modelValue:e(l).query_mode,"onUpdate:modelValue":d[6]||(d[6]=$=>e(l).query_mode=$)},{default:a(()=>[(g(),ae(Re,null,Fe(["sync","async"],$=>n(T,{value:$,key:$,label:s.$t(`RuleEngine.${$}`)},null,8,["value","label"])),64))]),_:1},8,["modelValue"]))]),_:1})]),_:1},8,["span"]),e(p)&&e(l).query_mode==="async"?(g(),O(P,{key:3,span:t.colSpan},{default:a(()=>[n(v,{prop:"inflight_window",readonly:t.readonly},{label:a(()=>[n(_,{label:e(o)("inflight_window.label"),desc:e(o)("inflight_window.desc")},null,8,["label","desc"])]),default:a(()=>[n(k,{modelValue:e(l).inflight_window,"onUpdate:modelValue":d[7]||(d[7]=$=>e(l).inflight_window=$)},null,8,["modelValue"])]),_:1},8,["readonly"])]),_:1},8,["span"])):Q("",!0)],64)}}});var He=(t=>(t[t.Float=0]="Float",t[t.Integer=1]="Integer",t[t.UInteger=2]="UInteger",t[t.String=3]="String",t[t.Boolean=4]="Boolean",t[t.Placeholder=5]="Placeholder",t))(He||{});const Wo=/^".*"$/,Qo=/^((t|true)|(f|false))$/i,Xo=/^-?\d+i$/,Yo=/^\d+u$/,vt=/-?\d+(\.\d+)?/,Jo=new RegExp(`${vt.source}e(\\+|-)\\d+`),Zo=new RegExp(`^(${Jo.source}|${vt.source})$`),es=/.*\$\{.+\}.*/,ts=new RegExp(`^(\\d+|${vt.source}|\\$\\{.+\\})(i|u)$`),at={3:Wo,1:Xo,2:Yo,0:Zo,4:Qo,5:es},Yt=()=>{const{tl:t}=Ce("RuleEngine"),f=Object.keys(at).map(d=>Number(d)),r=d=>f.find(h=>at[h].test(d))??void 0,y=[1,2,0,4,5],o=d=>{const _=y.find(h=>at[h].test(d));return y.some(h=>at[h].test(d))?d:_||3},l=d=>{const _=ts.test(d);return _&&(/i/i.test(d.slice(-1))?1:2)},p={1:t("integer"),2:t("uInteger")};return{judgeFieldValueType:r,judgeValueInInput:o,explicitlySpecifyTypeInValue:l,getTypeLabel:d=>p[d]||""}},as=$e({components:{Warning:Wa},emits:["update:modelValue","add"],props:{modelValue:{type:Object},customLabel:{type:Object,default:null},readonly:{type:Boolean},disabled:{type:Boolean},type:{type:String}},setup(t,f){const r=X(()=>t.type===D.Datalayers?dt.Datalayers:dt.InfluxDB),y={key:"",value:""},o=Z([]);let l={};const{t:p,tl:s}=Ce("RuleEngine"),{emit:d}=f,_=Z(100),h=Z(1),v=Z(!1),P=X(()=>{if(!v.value)return o.value;const b=(h.value-1)*_.value,z=b+_.value;return o.value.slice(b,z)}),{judgeFieldValueType:k,judgeValueInInput:C,explicitlySpecifyTypeInValue:N,getTypeLabel:T}=Yt();function x(){const b=t.modelValue;!b||!de.isPlainObject(b)||(l=de.cloneDeep(b),o.value=[],Object.entries(b).forEach(([z,W])=>{k(W)===He.String?o.value.push({key:z,value:W.slice(1,-1)}):o.value.push({key:z,value:W})}),v.value=o.value.length>100)}const S=X(()=>t.customLabel===null?{key:p("components.key"),value:p("components.value")}:t.customLabel);function $(){const b={};o.value.forEach(z=>{const{key:W,value:te}=z,oe=C(te);te!==void 0&&(oe===He.String?b[W]=`"${te}"`:b[W]=te)}),l=de.cloneDeep(b),d("update:modelValue",b)}function ee(b){o.value=o.value.filter(z=>z!==b),$()}function U(){o.value.push({...y}),d("add")}const j=b=>{_.value=b,h.value=1},A=b=>{h.value=b};function G(b){v.value=b.length>100,h.value=1,o.value=b,$()}const c=b=>p("RuleEngine.specifiedTypeTip",{type:T(N(b))});return Oe(()=>t.modelValue,b=>{de.isEqual(b,l)||x()}),x(),{tl:s,tableData:o,FieldValueType:He,explicitlySpecifyTypeInValue:N,getTooltipContent:c,getTypeLabel:T,atInputChange:$,deleteItem:ee,addColumn:U,keyValueLabel:S,dbType:r,handleUploadedData:G,displayData:P,pageSize:_,currentPage:h,shouldPaginate:v,handleSizeChange:j,handleCurrentChange:A}}}),ns={key:1,class:"value"},os={class:"suffix-container"},ss={key:1,class:"value"},rs={class:"header-settings"};function ls(t,f,r,y,o,l){const p=_t,s=E("el-table-column"),d=E("Warning"),_=E("el-icon"),h=E("el-tooltip"),v=ea,P=E("el-button"),k=E("el-table"),C=E("el-pagination");return g(),ae(Re,null,[n(k,{class:"influxdb-fields-editor key-and-value-editor shadow-none",data:t.displayData},{default:a(()=>[n(s,{label:t.keyValueLabel.key},{default:a(({row:N})=>[("readonly"in t?t.readonly:e(Pe))?(g(),ae("p",ns,M(N.key),1)):(g(),O(p,{key:0,modelValue:N.key,"onUpdate:modelValue":T=>N.key=T,class:"key-input",onInput:t.atInputChange},null,8,["modelValue","onUpdate:modelValue","onInput"]))]),_:1},8,["label"]),n(s,{label:t.keyValueLabel.value},{default:a(({row:N})=>[("readonly"in t?t.readonly:e(Pe))?(g(),ae("p",ss,M(N.value),1)):(g(),O(p,{key:0,modelValue:N.value,"onUpdate:modelValue":T=>N.value=T,onInput:t.atInputChange},{suffix:a(()=>[V("div",os,[t.explicitlySpecifyTypeInValue(N.value)?(g(),O(h,{key:0,class:"box-item",effect:"dark",content:t.getTooltipContent(N.value),placement:"top-start"},{default:a(()=>[n(_,null,{default:a(()=>[n(d)]),_:1})]),_:2},1032,["content"])):Q("",!0)])]),_:2},1032,["modelValue","onUpdate:modelValue","onInput"]))]),_:1},8,["label"]),!("readonly"in t?t.readonly:e(Pe))&&!t.disabled?(g(),O(s,{key:0,width:"180"},{header:a(()=>[V("div",rs,[n(v,{type:t.dbType,onUploadedData:t.handleUploadedData},null,8,["type","onUploadedData"]),n(P,{link:"",type:"primary",class:"btn",onClick:t.addColumn},{default:a(()=>[_e(M(t.$t("Base.add")),1)]),_:1},8,["onClick"])])]),default:a(({row:N})=>[n(P,{link:"",type:"primary",class:"btn",onClick:T=>t.deleteItem(N)},{default:a(()=>[_e(M(t.$t("Base.delete")),1)]),_:2},1032,["onClick"])]),_:1})):Q("",!0)]),_:1},8,["data"]),t.shouldPaginate?(g(),O(C,{key:0,class:"fields-editor-pagination",onSizeChange:t.handleSizeChange,onCurrentChange:t.handleCurrentChange,"current-page":t.currentPage,"page-sizes":[100,200,300,400],"page-size":t.pageSize,layout:"total, sizes, prev, pager, next",total:t.tableData.length},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])):Q("",!0)],64)}const is=Ze(as,[["render",ls],["__scopeId","data-v-9af11514"]]),us=()=>{const t=/([^,\s\\]|(\\,)|(\\\s)|(\\\\))+/,f=/([^,\s=\\]|(\\,)|(\\\s)|(\\=)|(\\\\))*/,r=/("([^"\\]|\\"|\\\\|\\)*")|[^"\s,]+/,y=new RegExp(`(?<tagKey>${f.source})=(?<tagValue>${f.source})`),o=new RegExp(`(${y.source},?)+`),l=new RegExp(`(?<fieldKey>${f.source})=(?<fieldValue>${r.source})`),p=new RegExp(`(${l.source},?)+`),s=/.+/,d=new RegExp(`^(?<measurement>${t.source})(,(?<tags>${o.source}))?(\\s(?<fields>${p.source}))(\\s(?<timestamp>${s.source}))?$`),_=A=>{if(!A)return[];const G=A.match(new RegExp(y.source,"g"));return G?G.reduce((c,b)=>{const{groups:z}=b.match(y)||{};return z?[...c,{key:z.tagKey,value:z.tagValue}]:c},[]):[]},h=A=>{if(!A)return[];const G=A.match(new RegExp(l.source,"g"));return G?G.reduce((c,b)=>{const{groups:z}=b.match(l)||{};return z?[...c,{key:z.fieldKey,value:z.fieldValue}]:c},[]):[]},v=A=>{const G=A.match(d);if(G&&G.groups){const{measurement:c,tags:b,fields:z,timestamp:W}=G.groups,te=_(b),oe=h(z);return{measurement:c,tagArr:te,fieldArr:oe,timestamp:W}}},P=A=>A.reduce((G,c)=>({...G,[c.key]:c.value}),{}),k=/,|\s|=|\\/g,C=A=>A.replace(k,G=>`\\${G}`),N=/"|\\/g,T=A=>$(A)===He.String?`${A[0]}${A.slice(1,-1).replace(N,G=>`\\${G}`)}${A.slice(-1)}`:A,x=/\\(=|\s|,|\\)/g,S=A=>A.replace(x,(G,c)=>c),{judgeFieldValueType:$}=Yt(),ee=/\\("|\\)/g;return{parseLine:v,convertArrToMap:P,trimLineProtocol:A=>de.trim(de.trim(A),`
`),escape:C,escapeFieldValue:T,unescape:S,unescapeFieldValue:A=>$(A)===He.String?`${A[0]}${A.slice(1,-1).replace(ee,(G,c)=>c)}${A.slice(-1)}`:A}},cs=$e({name:"InfluxDBLineProtocolForm"}),ds=$e({...cs,props:{modelValue:{type:String},readonly:{type:Boolean},disabled:{type:Boolean},type:{type:String,default:D.InfluxDB}},emits:["update:modelValue"],setup(t,{expose:f,emit:r}){const y=t,o=r,{t:l,tl:p}=Ce("RuleEngine"),s=Z(""),d=Z(void 0),_=Z({}),h=Z({}),v=Z(""),P=Z(""),k=Z(void 0),{parseLine:C,convertArrToMap:N,trimLineProtocol:T,escape:x,escapeFieldValue:S,unescape:$,unescapeFieldValue:ee}=us(),U=K=>K.map(({key:F,value:L})=>({key:$(F),value:$(L)})),j=K=>K.map(({key:F,value:L})=>({key:$(F),value:ee(L)})),A=()=>{if(y.modelValue===k.value||!y.modelValue)return;k.value=T(y.modelValue);const K=C(T(y.modelValue));if(K){const{measurement:F,tagArr:L,fieldArr:i,timestamp:I}=K;s.value=$(F),d.value=I,_.value=N(j(i)),h.value=N(U(L))}},G=()=>{const F=Object.keys(h.value).filter(L=>{const i=h.value[L];return i!==""&&i!==void 0&&L!==""}).reduce((L,i,I)=>{const pe=x(i),ye=x(h.value[i]);return`${L}${I===0?"":","}${pe}=${ye}`},"");return F.length>0?`,${F}`:F},c=()=>Object.keys(_.value).filter(F=>{const L=_.value[F];return L!==""&&L!==void 0&&F!==""}).reduce((F,L,i)=>{const I=x(L),pe=S(_.value[L]);return`${F}${i===0?"":","}${I}=${pe}`},""),b=()=>d.value?` ${d.value}`:"",z=()=>`${x(s.value)}${G()} ${c()}${b()}`,W=()=>{const K=z();k.value=K,o("update:modelValue",K)},te=K=>{_.value=K,W()},oe=K=>{h.value=K,W()},H=K=>{K==="measurement"?v.value=s.value?"":l("Rule.inputFieldRequiredError",{name:"Measurement"}):K==="fields"&&(P.value="",Object.keys(_.value).filter(F=>{const L=_.value[F];return F!==""&&L!==""&&L!==void 0}).length===0&&(P.value=l("Rule.inputFieldRequiredError",{name:"Field set"})))},re=()=>(H("measurement"),H("fields"),v.value||P.value?Promise.reject():Promise.resolve()),J=()=>{v.value="",P.value=""},{getBridgeLabelByTypeValue:ge}=Ue(),Y=X(()=>ge(y.type)??"");return f({validate:re,clearValidate:J}),Oe(()=>y.modelValue,A),A(),(K,F)=>{const L=_t,i=et,I=E("el-col"),pe=lt,ye=E("el-form-item"),ke=Ga,ne=E("el-row");return g(),O(ne,{class:"influx-db-line-protocol-form",gutter:26},{default:a(()=>[n(I,{span:12},{default:a(()=>[n(i,{label:"Measurement",class:"is-required",error:e(v),readonly:t.readonly},{default:a(()=>[n(L,{modelValue:e(s),"onUpdate:modelValue":F[0]||(F[0]=ie=>Se(s)?s.value=ie:null),onChange:W,onBlur:F[1]||(F[1]=ie=>H("measurement"))},null,8,["modelValue"])]),_:1},8,["error","readonly"])]),_:1}),n(I,{span:12},{default:a(()=>[n(i,{readonly:t.readonly},{label:a(()=>[n(pe,{label:"Timestamp",desc:e(p)("timestampDesc",{database:e(Y)}),"desc-marked":""},null,8,["desc"])]),default:a(()=>[n(L,{modelValue:e(d),"onUpdate:modelValue":F[2]||(F[2]=ie=>Se(d)?d.value=ie:null),onChange:W},null,8,["modelValue"])]),_:1},8,["readonly"])]),_:1}),n(I,{span:24},{default:a(()=>[n(ye,{class:"is-required",error:e(P)},{label:a(()=>[n(pe,{label:"Fields",desc:e(p)(t.type===e(D).InfluxDB?"influxdbFieldValueDesc":"datalayersFieldValueDesc"),"desc-marked":""},null,8,["desc"])]),default:a(()=>[n(is,{"model-value":e(_),"onUpdate:modelValue":te,onAdd:F[3]||(F[3]=ie=>P.value=""),readonly:t.readonly,type:t.type},null,8,["model-value","readonly","type"])]),_:1},8,["error"])]),_:1}),n(I,{span:24},{default:a(()=>[n(ye,{label:"Tags"},{default:a(()=>[n(ke,{"model-value":e(h),readonly:t.readonly,disabled:t.disabled,"support-placeholder":["key","value"],"onUpdate:modelValue":oe},null,8,["model-value","readonly","disabled"])]),_:1})]),_:1})]),_:1})}}}),ps=[{groupLabel:"mathFunc",list:[{name:"abs",args:[{name:"Value",type:"number",required:!0}]},{name:"cos",args:[{name:"Value",type:"number",required:!0}]},{name:"cosh",args:[{name:"Value",type:"number",required:!0}]},{name:"acos",args:[{name:"Value",type:"number",required:!0}]},{name:"acosh",args:[{name:"Value",type:"number",required:!0}]},{name:"sin",args:[{name:"Value",type:"number",required:!0}]},{name:"sinh",args:[{name:"Value",type:"number",required:!0}]},{name:"asin",args:[{name:"Value",type:"number",required:!0}]},{name:"asinh",args:[{name:"Value",type:"number",required:!0}]},{name:"tan",args:[{name:"Value",type:"number",required:!0}]},{name:"tanh",args:[{name:"Value",type:"number",required:!0}]},{name:"atan",args:[{name:"Value",type:"number",required:!0}]},{name:"atanh",args:[{name:"Value",type:"number",required:!0}]},{name:"ceil",args:[{name:"Value",type:"number",required:!0}]},{name:"floor",args:[{name:"Value",type:"number",required:!0}]},{name:"round",args:[{name:"Value",type:"number",required:!0}]},{name:"exp",args:[{name:"Value",type:"number",required:!0}]},{name:"power",args:[{name:"Base",type:"number",required:!0},{name:"Exponent",type:"number",required:!0}]},{name:"sqrt",args:[{name:"Value",type:"number",required:!0}]},{name:"fmod",args:[{name:"Numer",type:"number",required:!0},{name:"Denom",type:"number",required:!0}]},{name:"log",args:[{name:"Value",type:"number",required:!0}]},{name:"log10",args:[{name:"Value",type:"number",required:!0}]},{name:"log2",args:[{name:"Value",type:"number",required:!0}]}]},{groupLabel:"dataTypeJudgmentFunc",list:[{name:"is_null",args:[{name:"Value",type:"any",required:!0}]},{name:"is_not_null",args:[{name:"Value",type:"any",required:!0}]},{name:"is_str",args:[{name:"Value",type:"any",required:!0}]},{name:"is_bool",args:[{name:"Value",type:"any",required:!0}]},{name:"is_int",args:[{name:"Value",type:"any",required:!0}]},{name:"is_float",args:[{name:"Value",type:"any",required:!0}]},{name:"is_num",args:[{name:"Value",type:"any",required:!0}]},{name:"is_map",args:[{name:"Value",type:"any",required:!0}]},{name:"is_array",args:[{name:"Value",type:"any",required:!0}]},{name:"is_empty",args:[{name:"Value",type:"any",required:!0}]}]},{groupLabel:"dataTypeConversionFunc",list:[{name:"str",args:[{name:"Value",type:"any",required:!0}]},{name:"str_utf8",args:[{name:"Value",type:"any",required:!0}]},{name:"bool",args:[{name:"Value",type:"any",required:!0}]},{name:"int",args:[{name:"Value",type:"any",required:!0}]},{name:"float",args:[{name:"Value",type:"any",required:!0}]},{name:"float2str",args:[{name:"Value",type:"float",required:!0},{name:"Precision",type:"integer",default:2,range:[0,32],required:!0}]},{name:"map",args:[{name:"Value",type:"any",required:!0}]}]},{groupLabel:"stringFunc",list:[{name:"lower",args:[{name:"String",type:"string",required:!0}]},{name:"upper",args:[{name:"String",type:"string",required:!0}]},{name:"trim",args:[{name:"String",type:"string",required:!0}]},{name:"ltrim",args:[{name:"String",type:"string",required:!0}]},{name:"rtrim",args:[{name:"String",type:"string",required:!0}]},{name:"reverse",args:[{name:"String",type:"string",required:!0}]},{name:"strlen",args:[{name:"String",type:"string",required:!0}]},{name:"substr",args:[{name:"String",type:"string",required:!0},{name:"StartPosition",type:"number",required:!0},{name:"Length",type:"number",required:!1}]},{name:"split",args:[{name:"String",type:"string",required:!0},{name:"Separator",type:"string",required:!0},{name:"Direction",required:!1,type:"enum",optionalValues:["leading","trailing"]}]},{name:"concat",args:[{name:"String1",type:"string",required:!0},{name:"String2",type:"string",required:!0}]},{name:"tokens",args:[{name:"String",type:"string",required:!0},{name:"Separator",type:"string",required:!0},{name:"PreserveCRLF",type:"enum",optionalValues:["nocrlf"],required:!1}]},{name:"sprintf",args:[]},{name:"pad",args:[{name:"String",type:"string",required:!0},{name:"TotalLength",type:"integer",required:!0},{name:"PaddingDirection",type:"enum",optionalValues:["both","leading","trailing"],required:!1},{name:"PaddingString",type:"string",required:!1}]},{name:"replace",args:[{name:"String",type:"string",required:!0},{name:"OldSubStr",type:"string",required:!0},{name:"Replacement",type:"string",required:!0},{name:"ReplaceCount",type:"enum",optionalValues:["all","trailing","leading"],required:!1}]},{name:"regex_match",args:[{name:"String",type:"string",required:!0},{name:"Pattern",type:"string",required:!0}]},{name:"regex_replace",args:[{name:"String",type:"string",required:!0},{name:"Pattern",type:"string",required:!0},{name:"Replacement",type:"string",required:!0}]},{name:"ascii",args:[{name:"Character",type:"string",required:!0}]},{name:"find",args:[{name:"String",type:"string",required:!0},{name:"SubstringToBeFound",type:"string",required:!0},{name:"DirectionToFind",type:"enum",optionalValues:["leading","trailing"],required:!1}]}]},{groupLabel:"mapFunc",list:[{name:"map_get",args:[{name:"Key",type:"string",required:!0},{name:"Map",type:"object",required:!0},{name:"DefaultValue",type:"any",required:!1}]},{name:"map_put",args:[{name:"Key",type:"string",required:!0},{name:"Value",type:"any",required:!0},{name:"Map",type:"object",required:!0}]},{name:"map_size",args:[{name:"Map",type:"object",required:!0}]}]},{groupLabel:"arrFunc",list:[{name:"nth",args:[{name:"Index",type:"integer",range:[1,null],required:!0},{name:"Array",type:"array",required:!0}]},{name:"length",args:[{name:"Array",type:"array",required:!0}]},{name:"sublist",args:[{name:"StartIndex",type:"integer",range:[1,null],required:!1},{name:"Length",type:"integer",required:!0},{name:"Array",type:"array",required:!0}]},{name:"first",args:[{name:"Array",type:"array",required:!0}]},{name:"last",args:[{name:"Array",type:"array",required:!0}]},{name:"contains",args:[{name:"Value",type:"any",required:!0},{name:"Array",type:"array",required:!0}]}]},{groupLabel:"hashFunc",list:[{name:"md5",args:[{name:"Value",type:"string",required:!0}]},{name:"sha",args:[{name:"Value",type:"string",required:!0}]},{name:"sha256",args:[{name:"Value",type:"string",required:!0}]}]},{groupLabel:"compressesAndUncompressesFunc",list:[{name:"gzip",args:[{name:"Value",type:"binary",required:!0}]},{name:"gunzip",args:[{name:"Value",type:"binary",required:!0}]},{name:"zip",args:[{name:"Value",type:"binary",required:!0}]},{name:"unzip",args:[{name:"Value",type:"binary",required:!0}]},{name:"zip_compress",args:[{name:"Value",type:"binary",required:!0}]},{name:"zip_uncompress",args:[{name:"Value",type:"binary",required:!0}]}]},{groupLabel:"bitFunc",list:[{name:"subbits",args:[{name:"BinaryData",type:"binary",required:!0},{name:"BinaryStartIndex",type:"integer",required:!1},{name:"Length",type:"integer",required:!0},{name:"DataType",type:"enum",optionalValues:["integer","float","bits"],required:!1},{name:"Signedness",type:"enum",optionalValues:["unsigned","signed"],required:!1},{name:"Endian",type:"enum",optionalValues:["big","little"],required:!1}]}]},{groupLabel:"decodingAndEncodingFunc",list:[{name:"base64_encode",args:[{name:"Value",type:"binary",required:!0}]},{name:"base64_decode",args:[{name:"Value",type:"string",required:!0}]},{name:"json_encode",args:[{name:"Value",type:"string",required:!0}]},{name:"json_decode",args:[{name:"Value",type:"string",required:!0}]},{name:"bin2hexstr",args:[{name:"Value",type:"binary",required:!0}]},{name:"hexstr2bin",args:[{name:"Value",type:"string",required:!0}]},{name:"str_utf16_le",args:[{name:"Data",type:"string",required:!0}]},{name:"sqlserver_bin2hexstr",args:[{name:"Data",type:"string",required:!0}]}]},{groupLabel:"timeAndDateFunc",list:[{name:"now_timestamp",args:[]},{name:"now_rfc3339",args:[]},{name:"unix_ts_to_rfc3339",args:[{name:"UnixTimestamp",type:"integer",required:!0},{name:"TimeUnit",type:"enum",optionalValues:["second","millisecond","microsecond","nanosecond"],required:!1}]},{name:"rfc3339_to_unix_ts",args:[{name:"RFC3339String",type:"string",required:!0},{name:"TimeUnit",type:"enum",optionalValues:["second","millisecond","microsecond","nanosecond"],required:!1}]},{name:"format_date",args:[{name:"TimeUnit",type:"enum",optionalValues:["second","millisecond","microsecond","nanosecond"],required:!0},{name:"TimeOffset",type:"string",required:!0},{name:"DateFormat",type:"string",required:!0},{name:"Timestamp",type:"number",required:!1}]},{name:"date_to_unix_ts",args:[]}]},{groupLabel:"schemaRegistry",list:[{name:"schema_decode",args:[{name:"SchemaName",type:"string",required:!0},{name:"Data",type:"string",required:!0},{name:"Type",type:"string",required:!1}]},{name:"schema_encode",args:[{name:"SchemaName",type:"string",required:!0},{name:"Data",type:"string",required:!0},{name:"Type",type:"string",required:!1}]},{name:"schema_check",args:[{name:"SchemaName",type:"string",required:!0},{name:"Data",type:"object",required:!0}]}]}],ms=["connection_accepted","unacceptable_protocol_version","client_identifier_not_valid","server_unavaliable","malformed_username_or_password","unauthorized_client","success","unspecified_error","malformed_packet","protocol_error","implementation_specific_error","unsupported_protocol_version","bad_username_or_password","not_authorized","server_unavailable","server_busy","banned","bad_authentication_method","topic_name_invalid","packet_too_large","quota_exceeded","retain_not_supported","qos_not_supported","use_another_server","server_moved","connection_rate_exceeded","is_cache"],fs=ps.reduce((t,{list:f})=>(f==null||f.forEach(({name:r})=>t.push(r)),t),[]),ys={syntaxKeys:["SELECT","FROM","WHERE","FOREACH","DO","INCASE","CASE","WHEN","ELSE","THEN","END","as"],fieldsCanUse:ms,builtInSQLFuncs:fs,jqFunc:["jq"]},gs=()=>{const{state:t}=_a(),{tl:f}=Ce("RuleEngine"),r=["$bridges/mqtt:*"],y=({zh:s,en:d})=>l.value?s:d,o=s=>f(`${de.camelCase(s.slice(8))}Desc`),l=X(()=>t.lang==="zh"),{isMsgPubEvent:p}=Ua();return{eventDoNotNeedShow:r,isMsgPubEvent:p,getEventLabel:y,getEventDesc:o}},{syntaxKeys:_s,fieldsCanUse:bs,builtInSQLFuncs:vs,jqFunc:hs}=ys,Jt=()=>{const t=(r,y)=>r.map(o=>({...o,range:y}));return{createCompletionProvider:r=>({provideCompletionItems:async function(y,o){await va();const{column:l}=o,p=y.getValueInRange({startLineNumber:o.lineNumber,endLineNumber:o.lineNumber,startColumn:l-1,endColumn:l}),s=/\w/.test(p),d=y.getWordUntilPosition(o),_={startLineNumber:o.lineNumber,endLineNumber:o.lineNumber,startColumn:d.startColumn-(s?0:1),endColumn:d.endColumn+1};return{suggestions:t(r,_)}}})}},Wr=()=>{const{tl:t}=Ce("RuleSyntax"),f=Z(void 0),r=Z(void 0);let y=[],o=[],l=[],p=[];const{eventDoNotNeedShow:s,isMsgPubEvent:d,getEventLabel:_,getEventDesc:h}=gs(),v=c=>y.some(({event:b})=>b===c),P=_s.map(c=>{const b={label:c,kind:Ne.CompletionItemKind.Keyword,insertText:c};return b.documentation=t(`${c.toLowerCase()}Desc`),b});let k=[];const C=c=>{k=[...new Set(c.reduce((z,{columns:W})=>(z.push(...W),z),[...bs]))].map(z=>({label:z,kind:Ne.CompletionItemKind.Field,insertText:z}))},N=c=>({value:`<b>${t(`${de.camelCase(c)}Desc`)}</b><br /><br />${t("parameter")}<br />${t(`${de.camelCase(c)}Params`)}<br /><br />${t("returned")}<br />${t(`${de.camelCase(c)}Returns`)}`,supportHtml:!0}),T=c=>({label:c,kind:Ne.CompletionItemKind.Function,documentation:N(c),insertText:`${c}(\${1})`,insertTextRules:Ne.CompletionItemInsertTextRule.InsertAsSnippet}),x=vs.map(c=>T(c)).concat(hs.map(c=>T(c))),S=(c,b,z,W)=>{var ge;const{word:te,startColumn:oe,endColumn:H}=c;let re=te,J="";if(re===ze.slice(1,-1)){const Y=H+2;re=((ge=z.getWordAtPosition({...W,column:Y}))==null?void 0:ge.word)||"",v(ze+re)&&(J=b.slice(oe-2,H+1+re.length-1))}else v(ze+te)&&(J=b.slice(oe-ze.length-1,H-1));if(J&&J.indexOf(ze+re)>-1)return ze+re},$=c=>({supportHtml:!0,value:`<b>${_(c.title)}</b><br />${h(c.event)}`}),ee=()=>{o=y.reduce((c,b)=>[...c,{label:`"${b.event}"`,kind:Ne.CompletionItemKind.Method,documentation:$(b),insertText:`"${b.event}"`}],[])},U=()=>{p=l.map(c=>{const b=`"${ba}${c}"`;return{label:b,kind:Ne.CompletionItemKind.Method,insertText:b}})},{createCompletionProvider:j}=Jt(),A=()=>{f.value={...j([...o,...p,...P,...k,...x]),triggerCharacters:['"',"$"]},r.value={provideHover:function(c,b){const z=c.getWordAtPosition(b),W=c.getLineContent(b.lineNumber);if(!z||!W)return;const te=S(z,W,c,b);if(te){const J=y.find(({event:ge})=>ge===te);return{contents:[{supportHtml:!0,value:`<b>${_(J.title)}</b>`},{value:h(J.event)}]}}const{word:oe}=z,H=P.find(({label:J})=>J===oe);if(H)return{contents:[{value:H.documentation}]};const re=x.find(({label:J})=>J===oe);if(re)return{contents:[re.documentation]}}}};return{completionProvider:f,hoverProvider:r,setExtDepData:({events:c,bridges:b})=>{y=c.filter(({event:z})=>!(s.includes(z)||d(z))),l=b.map(({id:z})=>z),C(c),ee(),U(),A()}}},ht=()=>{const{sql:t,availablePlaceholders:f}=jt(),{createCompletionProvider:r}=Jt(),y=l=>({label:l,kind:Ne.CompletionItemKind.Field,insertText:l}),o=X(()=>{const l=f.value.map(p=>y(p));return{...r(l),triggerCharacters:["$"]}});return{sql:t,completionProvider:o}},ks={class:"influxdb-write-syntax-input"},ws={class:"type-select"},Cs={class:"monaco-container"},Vs=$e({__name:"InfluxdbWriteSyntaxInput",props:{modelValue:{type:String},readonly:{type:Boolean,default:!1},disabled:{type:Boolean},type:{type:String,default:D.InfluxDB}},emits:["update:modelValue"],setup(t,{expose:f,emit:r}){const y=t,o=r,{tl:l,t:p}=Ce("RuleEngine"),s=x=>p(`BridgeSchema.common.${x}.label`),d=x=>p(`BridgeSchema.${y.type}.${x}.desc`),_=Z("JSON"),{getBridgeLabelByTypeValue:h}=Ue(),v=X(()=>h(y.type)??""),{completionProvider:P}=ht(),k=X({get(){return y.modelValue},set(x){o("update:modelValue",x)}}),C=Z();return f({validate:()=>_.value==="JSON"?C.value.validate():Promise.resolve(),clearValidate:()=>C.value.clearValidate()}),(x,S)=>{const $=lt,ee=E("el-radio-button"),U=E("el-radio-group"),j=E("el-form-item"),A=Ht,G=E("el-card");return g(),ae("div",ks,[V("div",ws,[n(j,{label:e(l)("dataFormat")},{label:a(()=>[n($,{label:e(l)("dataFormat"),desc:`${e(l)("dataDefinition")} ${e(l)("dataDefinitionDesc",{database:e(v)})}`,"desc-marked":""},null,8,["label","desc"])]),default:a(()=>[n(U,{modelValue:e(_),"onUpdate:modelValue":S[0]||(S[0]=c=>Se(_)?_.value=c:null)},{default:a(()=>[n(ee,{value:"JSON",border:""},{default:a(()=>S[3]||(S[3]=[_e(" JSON ")])),_:1},8,["value"]),n(ee,{value:"raw",border:""},{default:a(()=>S[4]||(S[4]=[_e(" Line Protocol ")])),_:1},8,["value"])]),_:1},8,["modelValue"])]),_:1},8,["label"])]),e(_)==="raw"?(g(),O(j,{key:0,prop:"parameters.write_syntax"},{label:a(()=>[n($,{label:s("write_syntax"),desc:d("write_syntax"),"desc-marked":""},null,8,["label","desc"])]),default:a(()=>[V("div",Cs,[n(A,{id:("createRandomString"in x?x.createRandomString:e(ft))(),modelValue:e(k),"onUpdate:modelValue":S[1]||(S[1]=c=>Se(k)?k.value=c:null),lang:"sql",disabled:t.readonly||t.disabled,"completion-provider":e(P)},null,8,["id","modelValue","disabled","completion-provider"])])]),_:1})):(g(),O(G,{key:1,class:"app-card json-form-card",shadow:"never"},{default:a(()=>[n(ds,{modelValue:e(k),"onUpdate:modelValue":S[2]||(S[2]=c=>Se(k)?k.value=c:null),ref_key:"protocolFormCom",ref:C,readonly:t.readonly,disabled:t.disabled,type:t.type},null,8,["modelValue","readonly","disabled","type"])]),_:1}))])}}}),Ss=t=>{const f=y=>y.split(".").reduce((l,p)=>l?`${l}.properties.${p}`:p,"");return{getPropItem:y=>de.get(t.value,f(y))||{}}},$s=()=>{const t=()=>({worker_pool_size:4,health_check_interval:"15s",query_mode:"async",max_buffer_bytes:"1GB",request_ttl:"45s",start_timeout:"5s"});return{createDefaultResourceOptsForm:(r={})=>{let y=t();return r.inflight&&(y={...y,inflight_window:100}),r.batch&&(y={...y,batch_size:100}),r.withoutRequestTimeout&&(y=de.omit(y,"request_ttl")),r.withoutStartTimeout&&(y=de.omit(y,"start_timeout")),y}}},Ds=()=>{const{createDefaultResourceOptsForm:t}=$s(),f=()=>({type:D.InfluxDB,name:"",connector:"",parameters:{write_syntax:"",precision:"ms"},resource_opts:t({inflight:!0,batch:!0,withoutRequestTimeout:!1,withoutStartTimeout:!0})});return{createRawInfluxDBForm:f,createRawDataLayersForm:()=>({...f(),type:D.Datalayers})}},qs={key:1,class:"value"},Rs=$e({__name:"BridgeInfluxdbConfig",props:{modelValue:{type:Object},type:{type:String},edit:{type:Boolean},copy:{type:Boolean},readonly:{type:Boolean,default:!1},disabled:{type:Boolean},hideName:{type:Boolean,default:!1},isUsingInFlow:{type:Boolean}},emits:["update:modelValue","init"],setup(t,{expose:f,emit:r}){const y=t,o=r,{tl:l,t:p}=Ce("RuleEngine"),s=c=>p(`BridgeSchema.common.${c}.label`),d=c=>{var b;return p(`BridgeSchema.${((b=y.modelValue)==null?void 0:b.type)??"influxdb"}.${c}.desc`)},{components:_}=ta(Lt("/schemas/actions"),{ref:"#/components/schemas/bridge_influxdb.post_bridge_v2"}),{getPropItem:h}=Ss(_),{createRawInfluxDBForm:v,createRawDataLayersForm:P}=Ds(),k=()=>y.type===D.Datalayers?P():v(),C=Z(k()),N=Z(),T=Z(),{createRequiredRule:x,createCommonIdRule:S}=it(),$={name:[...x(l("name")),...S()],connector:x(p("components.connector"),"select"),"parameters.write_syntax":x(s("write_syntax"))},ee=X(()=>y.isUsingInFlow?24:12),U=async()=>{y.modelValue&&(y.edit||y.copy?(C.value=ha(de.cloneDeep(y.modelValue),k()),o("init",C.value)):C.value={...C.value,...y.modelValue})};Oe(()=>C.value,()=>{o("update:modelValue",C.value)},{deep:!0}),Oe(()=>y.modelValue,c=>{de.isEqual(c,C.value)||U()});const j=()=>(h("parameters.precision").symbols||[]).map(b=>({value:b,label:p(`General.${b==="s"?"sec":b}`)})),A=()=>Promise.all([N.value.validate(),T.value.validate()]),G=()=>{var c,b;(c=N.value)==null||c.clearValidate(),(b=T.value)==null||b.clearValidate()};return U(),f({validate:A,clearValidate:G}),(c,b)=>{const z=E("el-input"),W=et,te=E("el-col"),oe=E("el-row"),H=E("el-divider"),re=rt,J=E("el-option"),ge=E("el-select"),Y=E("el-form-item"),K=Ka,F=E("el-form");return g(),O(F,{ref_key:"formCom",ref:N,"label-position":"top","require-asterisk-position":"right",class:"bridge-influxdb-config bridge-config",rules:$,model:e(C),disabled:t.disabled,"validate-on-rule-change":!1},{default:a(()=>[n(oe,{gutter:26},{default:a(()=>[t.hideName?Q("",!0):(g(),O(te,{key:0,span:e(ee)},{default:a(()=>[n(W,{label:e(l)("name"),prop:"name",readonly:t.readonly},{default:a(()=>[n(z,{modelValue:e(C).name,"onUpdate:modelValue":b[0]||(b[0]=L=>e(C).name=L),disabled:t.edit},null,8,["modelValue","disabled"])]),_:1},8,["label","readonly"])]),_:1},8,["span"])),n(te,{span:e(ee)},{default:a(()=>[n(W,{label:e(p)("components.connector"),prop:"connector",readonly:t.readonly},{default:a(()=>[n(aa,{modelValue:e(C).connector,"onUpdate:modelValue":b[1]||(b[1]=L=>e(C).connector=L),type:e(C).type},null,8,["modelValue","type"])]),_:1},8,["label","readonly"])]),_:1},8,["span"]),n(te,{span:e(ee)},{default:a(()=>[n(W,{label:e(p)("Flow.description"),prop:"description",readonly:t.readonly},{default:a(()=>[n(z,{modelValue:e(C).description,"onUpdate:modelValue":b[2]||(b[2]=L=>e(C).description=L)},null,8,["modelValue"])]),_:1},8,["label","readonly"])]),_:1},8,["span"])]),_:1}),n(H),n(oe,{gutter:26},{default:a(()=>[n(te,{span:e(ee)},{default:a(()=>[n(Y,{prop:"parameters.precision"},{label:a(()=>[V("span",null,M(s("precision")),1),n(re,{content:d("precision")},null,8,["content"])]),default:a(()=>[t.readonly?(g(),ae("p",qs,M(e(p)(`General.${e(C).parameters.precision==="s"?"sec":e(C).parameters.precision}`)),1)):(g(),O(ge,{key:0,modelValue:e(C).parameters.precision,"onUpdate:modelValue":b[3]||(b[3]=L=>e(C).parameters.precision=L)},{default:a(()=>[(g(!0),ae(Re,null,Fe(j(),({value:L,label:i})=>(g(),O(J,{value:L,key:L,label:i},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]))]),_:1})]),_:1},8,["span"]),n(te,{span:24},{default:a(()=>[n(H)]),_:1}),n(te,{span:24},{default:a(()=>[n(Y,{"label-width":"0px"},{default:a(()=>[n(Vs,{modelValue:e(C).parameters.write_syntax,"onUpdate:modelValue":b[4]||(b[4]=L=>e(C).parameters.write_syntax=L),ref_key:"writeSyntaxInputCom",ref:T,readonly:t.readonly,disabled:t.disabled,type:e(C).type},null,8,["modelValue","readonly","disabled","type"])]),_:1})]),_:1})]),_:1}),n(K,null,{default:a(()=>[n(oe,{gutter:26},{default:a(()=>[n(Go,{modelValue:e(C).resource_opts,"onUpdate:modelValue":b[5]||(b[5]=L=>e(C).resource_opts=L),"with-batch-config":"","with-start-timeout-config":!1,readonly:t.readonly,colSpan:e(ee)},null,8,["modelValue","readonly","colSpan"])]),_:1})]),_:1})]),_:1},8,["model","disabled"])}}}),Ft=Ze(Rs,[["__scopeId","data-v-10de939a"]]),Bs={key:1,class:"data-bridge-create"},Ps=["src","alt"],Ts={class:"target-type-item-bd"},Es={class:"title"},Fs={class:"target-type-desc"},Is={key:1},Ms={key:2},Ls=$e({__name:"BridgeCreate",props:{type:{},inDrawer:{type:Boolean}},setup(t,{expose:f}){const r=t,{t:y,tl:o}=Ce("RuleEngine"),l=()=>({}),p=At(),s=Ot(),{bridgeTypeOptions:d,searchQuery:_,getFilterBridgeOptions:h}=Ta(),{getBridgeGeneralType:v,getBridgeLabelByTypeValue:P}=Ea(),k=Z(!1),C=Z(l()),{getBridgeIcon:N}=gt(),T=Z(),x=X(()=>!!(s.query.action==="copy"&&s.query.target)),S=Z(r.inDrawer?r.type:d[0].value),{step:$,activeGuidesIndex:ee,guideDescList:U,handleNext:j,handleBack:A}=na(),{handleBridgeDataForCopy:G}=Aa(),{handleActionDataBeforeSubmit:c}=Oa(),b=()=>{C.value=l()},z=()=>{C.value=l(),U.value.pop(),A()},W=()=>{$.value===0&&(b(),U.value.push(P(S.value)||"")),j()},te=()=>p.push({name:"actions"}),{getDetail:oe,addAction:H,isTesting:re,testConnectivity:J}=ut(),ge=Z(!1),Y=async()=>{var i,I,pe;if(!(!/action/i.test(((i=s.name)==null?void 0:i.toString())||"")||!x.value))try{const ye=(pe=s.query.target)==null?void 0:pe.slice(0,(I=s.query.target)==null?void 0:I.indexOf(":"));ye&&v(ye)&&(S.value=v(ye)),$.value=1,ge.value=!0;const ke=await oe(s.query.target);ke&&(C.value={...G(ke),name:ka(ke.name)},S.value=v(ke.type))}catch{}finally{ge.value=!1}},K=()=>{let i={};return Je.includes(S.value)?i={type:S.value,...de.cloneDeep(C.value)}:i=de.cloneDeep(T.value.getFormRecord()),c(i)},F=async()=>{try{await T.value.validate()}catch(i){return Dt(),Promise.reject(i)}try{re.value=!0;const i=await K();return await J(i),Ye.success(o("connectionSuccessful")),re.value=!1,Promise.resolve()}catch{return re.value=!1,Promise.reject()}},L=async()=>{try{await T.value.validate()}catch(I){return Dt(),Promise.reject(I)}k.value=!0;let i;try{const I=await K();i=await H(I);const pe=i==null?void 0:i.id;return r.inDrawer||st.confirm(o("useConnectorCreateRule"),y("Base.createSuccess"),{confirmButtonText:o("createRule"),cancelButtonText:o("backBridgeList"),type:"success"}).then(()=>{p.push({name:"rule-create",query:{actionId:pe}})}).catch(()=>{p.push({name:"actions"})}),k.value=!1,Promise.resolve(pe)}catch(I){return console.error(I),k.value=!1,Promise.reject(I)}};return f({testConnection:F,submitCreateBridge:L,bridgeData:C}),Y(),(i,I)=>{const pe=zt,ye=oa,ke=E("el-col"),ne=E("el-row"),ie=E("el-input"),he=E("el-radio"),Ve=E("el-radio-group"),ue=E("el-button"),me=E("el-card"),we=Nt("loading");return g(),ae("div",{class:qe([i.inDrawer?"":"app-wrapper","action-create"])},[i.inDrawer?Q("",!0):(g(),O(pe,{key:0,item:{name:e(o)("createAction"),routeName:"actions"}},null,8,["item"])),i.inDrawer?(g(),ae("div",Ms,[[e(D).InfluxDB,e(D).Datalayers].includes(e(S))?(g(),O(Ft,{key:0,modelValue:e(C),"onUpdate:modelValue":I[4]||(I[4]=be=>Se(C)?C.value=be:null),ref_key:"formCom",ref:T,type:e(S)},null,8,["modelValue","type"])):e(S)&&!("BRIDGE_TYPES_NOT_USE_SCHEMA"in i?i.BRIDGE_TYPES_NOT_USE_SCHEMA:e(Je)).includes(e(S))?(g(),O(mt,{key:1,type:e(S),modelValue:e(C),"onUpdate:modelValue":I[5]||(I[5]=be=>Se(C)?C.value=be:null),ref_key:"formCom",ref:T},null,8,["type","modelValue"])):Q("",!0)])):(g(),ae("div",Bs,[n(me,{class:"app-card"},{default:a(()=>[n(ne,null,{default:a(()=>[n(ke,{span:12},{default:a(()=>[n(ye,{"guide-list":[e(o)("actionType"),e(o)("configuration")],"active-guide-index-list":e(ee),"desc-list":e(U)},null,8,["guide-list","active-guide-index-list","desc-list"])]),_:1})]),_:1}),e($)===0?(g(),O(ne,{key:0},{default:a(()=>[n(ke,{span:8},{default:a(()=>[n(ie,{modelValue:e(_),"onUpdate:modelValue":I[0]||(I[0]=be=>Se(_)?_.value=be:null),placeholder:e(o)("typeSearch"),clearable:""},null,8,["modelValue","placeholder"])]),_:1})]),_:1})):Q("",!0),n(ne,{class:"config-body"},{default:a(()=>[e($)===0?(g(),O(Ve,{key:0,class:"target-type-select",modelValue:e(S),"onUpdate:modelValue":I[1]||(I[1]=be=>Se(S)?S.value=be:null)},{default:a(()=>[n(ne,{gutter:28},{default:a(()=>[(g(!0),ae(Re,null,Fe(e(h)(),be=>(g(),O(ke,{key:be.label,span:8},{default:a(()=>[n(he,{class:"target-type-item",value:be.value,border:""},{default:a(()=>[V("img",{class:"target-type-item-img",height:"64",width:"64",src:e(N)(be.value),alt:be.label},null,8,Ps),V("div",Ts,[V("div",Es,M(be.label),1),V("span",Fs,M(be.desc),1)])]),_:2},1032,["value"])]),_:2},1024))),128))]),_:1})]),_:1},8,["modelValue"])):Q("",!0),e($)===1?ot((g(),ae("div",Is,[e(S)===e(D).InfluxDB?(g(),O(Ft,{key:0,modelValue:e(C),"onUpdate:modelValue":I[2]||(I[2]=be=>Se(C)?C.value=be:null),ref_key:"formCom",ref:T,copy:e(x)},null,8,["modelValue","copy"])):e(S)&&!("BRIDGE_TYPES_NOT_USE_SCHEMA"in i?i.BRIDGE_TYPES_NOT_USE_SCHEMA:e(Je)).includes(e(S))?(g(),O(mt,{key:1,modelValue:e(C),"onUpdate:modelValue":I[3]||(I[3]=be=>Se(C)?C.value=be:null),type:e(S),ref_key:"formCom",ref:T,copy:e(x)},null,8,["modelValue","type","copy"])):Q("",!0)])),[[we,e(ge)]]):Q("",!0)]),_:1}),n(ne,{class:"config-btn"},{default:a(()=>[e($)===0?(g(),O(ue,{key:0,onClick:te},{default:a(()=>[_e(M(i.$t("Base.cancel")),1)]),_:1})):Q("",!0),e($)>0?(g(),O(ue,{key:1,onClick:z,disabled:e(k)},{default:a(()=>[_e(M(i.$t("Base.backStep")),1)]),_:1},8,["disabled"])):Q("",!0),e($)<1?(g(),O(ue,{key:2,type:"primary",onClick:W,disabled:e(k)||e(h)().length===0},{default:a(()=>[_e(M(i.$t("Base.nextStep")),1)]),_:1},8,["disabled"])):Q("",!0),e($)===1?(g(),O(ue,{key:3,type:"primary",plain:"",disabled:!i.$hasPermission("post"),loading:e(re),onClick:F},{default:a(()=>[_e(M(e(o)("testTheConnection")),1)]),_:1},8,["disabled","loading"])):Q("",!0),e($)===1?(g(),O(ue,{key:4,type:"primary",disabled:!i.$hasPermission("post"),loading:e(k),onClick:L},{default:a(()=>[_e(M(i.$t("Base.create")),1)]),_:1},8,["disabled","loading"])):Q("",!0)]),_:1}),I[6]||(I[6]=V("div",null,null,-1))]),_:1})]))],2)}}}),As=Ze(Ls,[["__scopeId","data-v-b5f29b59"]]),Os={class:"bridge-detail"},Ns={class:"detail-top"},Us={class:"vertical-align-center"},xs=["src"],zs={class:"vertical-align-center block-title"},Hs={key:1,class:"btn-area"},js=$e({__name:"BridgeDetail",props:{bridgeId:{type:String,default:""},disabled:{type:Boolean,default:!1},hideName:{type:Boolean,default:!1},inDrawer:{type:Boolean,default:!1}},setup(t,{expose:f}){const r=Ot(),y=At(),{getBackRoute:o}=un("actions"),l=X(()=>o({name:"actions"}));let p;const s=Z({}),d=Z(!1),_=Z(!1),h=Z("overview"),v=t,P=Z(),k=X(()=>r.query.tab);k.value&&(h.value=k.value);const{getBridgeGeneralType:C,getGeneralTypeLabel:N}=Ue(),{getBridgeIcon:T}=gt(),{tl:x,t:S}=Ce("RuleEngine");v.inDrawer&&v.bridgeId&&(h.value="settings");const $=X(()=>v.inDrawer?v.bridgeId:r.params.id);Oe($,ue=>{ue&&v.inDrawer&&H()});const ee=X(()=>{const ue=$.value.slice(0,$.value.indexOf(":"));return C(ue)}),U=X(()=>d.value&&Je.includes(ee.value)),{getDetail:j,updateAction:A,toggleActionEnable:G,isTesting:c,testConnectivity:b}=ut(),{judgeIsWebhookAction:z}=xt(),W=X(()=>z(s.value)),te=X(()=>W.value?{disabled:!0}:{}),oe=X(()=>({})),H=async()=>{d.value=!0;try{s.value=await j($.value),p=de.cloneDeep(s.value)}catch(ue){console.error(ue)}finally{d.value=!1}},re=()=>{Je.includes(s.value.type)||(s.value=P.value.getFormRecord())},J=()=>(re(),s.value),{pwdErrorWhenCoping:ge}=cn(),Y=async()=>{try{await qt(P.value),c.value=!0;const ue=await J();await b(de.omit(ue,"id")),Ye.success(x("connectionSuccessful"))}catch{}finally{c.value=!1}},K=async()=>{try{if(await qt(P.value),re(),v.inDrawer&&de.isEqual(s.value,p))return Promise.resolve(s.value.id);await st.confirm(x("updateActionTip",{operation:x("updateActionConf")}),{confirmButtonText:S("Base.confirm"),cancelButtonText:S("Base.cancel"),type:"warning"}),_.value=!0;const ue=await J(),me=await A(ue);return v.inDrawer||(Ye.success(S("Base.updateSuccess")),y.push({name:"actions"})),_.value=!1,Promise.resolve(me.id)}catch(ue){return _.value=!1,Promise.reject(ue)}},F=async()=>{d.value=!0;const{enable:ue}=s.value,me=ue?"Base.enableSuccess":"Base.disabledSuccess";try{await G(s.value.id,ue),Ye.success(S(me)),H()}catch(we){console.error(we)}finally{d.value=!1}},L=()=>{st.confirm(x("useActionCreateRule"),{confirmButtonText:S("Base.confirm"),cancelButtonText:S("Base.cancel"),type:"success"}).then(()=>{y.push({name:"rule-create",query:{actionId:s.value.id}})}).catch(()=>({}))},i=()=>{y.push({name:"actions"})},{showSecondConfirm:I,usingBridgeRules:pe,currentDeleteBridgeId:ye,showFallbackConfirm:ke,usingAsFallbackAction:ne,handleDeleteSuc:ie,handleDeleteBridge:he}=sn(i),Ve=async()=>{$.value&&he(s.value)};return wa(()=>{H()}),f({updateBridgeInfo:K,testConnection:Y}),(ue,me)=>{const we=Xa,be=Qa,Te=E("el-tooltip"),Ae=E("el-tag"),w=E("el-switch"),m=E("el-button"),q=zt,u=E("el-tab-pane"),B=E("el-alert"),R=E("router-link"),se=E("i18n-t"),le=E("el-card"),ce=E("el-tabs"),ve=Nt("loading");return g(),ae("div",Os,[V("div",Ns,[t.inDrawer?Q("",!0):(g(),O(q,{key:0,item:{name:e(s).name,route:e(l)}},{content:a(()=>[V("div",Us,[V("img",{src:e(T)(e(s).type)},null,8,xs),n(Te,{content:e(s).name},{default:a(()=>[V("p",zs,[n(be,{content:e(s).name},{default:a(()=>[n(we,null,{default:a(()=>[_e(M(e(s).name),1)]),_:1})]),_:1},8,["content"])])]),_:1},8,["content"]),n(Ya,{type:"action",target:e(s),"is-tag":""},null,8,["target"]),n(Ae,{type:"info",class:"section-status"},{default:a(()=>[_e(M(e(N)(e(s).type)),1)]),_:1})])]),extra:a(()=>[n(Te,{content:e(s).enable?ue.$t("Base.disable"):ue.$t("Base.enable"),placement:"top"},{default:a(()=>[n(w,{class:"enable-btn",modelValue:e(s).enable,"onUpdate:modelValue":me[0]||(me[0]=fe=>e(s).enable=fe),disabled:e(W),onChange:F},null,8,["modelValue","disabled"])]),_:1},8,["content"]),n(Te,{content:e(x)("createRule"),placement:"top"},{default:a(()=>[n(m,{class:"icon-button",type:"primary",icon:e(_n),disabled:e(W),plain:"",onClick:L},null,8,["icon","disabled"])]),_:1},8,["content"]),n(Te,{content:ue.$t("Base.delete"),placement:"top"},{default:a(()=>[n(m,{class:"icon-button",type:"danger",icon:e(Fa),disabled:e(W),onClick:Ve,plain:""},null,8,["icon","disabled"])]),_:1},8,["content"])]),_:1},8,["item"]))]),n(ce,{class:qe(["detail-tabs",{"hide-tabs":t.inDrawer}]),modelValue:e(h),"onUpdate:modelValue":me[3]||(me[3]=fe=>Se(h)?h.value=fe:null)},{default:a(()=>[V("div",{class:qe({"app-wrapper":!t.inDrawer,"detail-main":!0})},[t.inDrawer?Q("",!0):(g(),O(u,{key:0,label:e(x)("overview"),name:"overview",lazy:""},{default:a(()=>[ot((g(),ae("div",{class:qe(["overview-container",{"is-loading":e(d)}])},[e(d)?Q("",!0):(g(),O(zo,{key:0,"bridge-id":e($),"bridge-msg":e(s),onReconnect:H},null,8,["bridge-id","bridge-msg"]))],2)),[[ve,e(d)]])]),_:1},8,["label","name"])),n(u,{label:e(S)("Base.setting"),name:"settings"},{default:a(()=>[e(ge)?(g(),O(B,{key:0,title:e(ge),type:"error"},null,8,["title"])):Q("",!0),ot((g(),O(le,{class:qe(["app-card",t.inDrawer&&"app-inline-card"]),shadow:t.inDrawer?"never":void 0},{default:a(()=>[e(W)?(g(),O(B,{key:0,class:"webhook-tip-alert","show-icon":"",type:"info",closable:!1},{default:a(()=>[n(se,{keypath:"RuleEngine.handleWebhookAssociatedTip",tag:"p"},{target:a(()=>[V("span",null,M(e(S)("RuleEngine.action")),1)]),operation:a(()=>[V("span",null,M(("lowerCase"in ue?ue.lowerCase:e(de.lowerCase))(e(S)("Base.edit"))),1)]),page:a(()=>[n(R,{to:e(oe)},{default:a(()=>[_e("Webhook "+M(e(S)("RuleEngine.page")),1)]),_:1},8,["to"])]),_:1})]),_:1})):Q("",!0),V("div",{class:"setting-area",style:Ca({width:t.inDrawer?"100%":"75%"})},[n(mt,{ref_key:"formCom",ref:P,modelValue:e(s),"onUpdate:modelValue":me[1]||(me[1]=fe=>Se(s)?s.value=fe:null),edit:"",type:e(ee),disabled:t.disabled,"hide-name":t.hideName,"form-props":e(te)},null,8,["modelValue","type","disabled","hide-name","form-props"])],4),t.inDrawer?Q("",!0):(g(),ae("div",Hs,[e(s).type?(g(),O(m,{key:0,type:"primary",plain:"",loading:e(c),onClick:Y},{default:a(()=>[_e(M(e(x)("testTheConnection")),1)]),_:1},8,["loading"])):Q("",!0),e(s).type?(g(),O(m,{key:1,type:"primary",loading:e(_),disabled:e(W),onClick:me[2]||(me[2]=fe=>K())},{default:a(()=>[_e(M(ue.$t("Base.update")),1)]),_:1},8,["loading","disabled"])):Q("",!0)]))]),_:1},8,["class","shadow"])),[[ve,e(U)]])]),_:1},8,["label","name"])],2)]),_:1},8,["class","modelValue"]),n(rn,{modelValue:e(I),"onUpdate:modelValue":me[4]||(me[4]=fe=>Se(I)?I.value=fe:null),"rule-list":e(pe),id:e(ye),onSubmitted:e(ie)},null,8,["modelValue","rule-list","id","onSubmitted"]),n(ln,{modelValue:e(ke),"onUpdate:modelValue":me[5]||(me[5]=fe=>Se(ke)?ke.value=fe:null),"action-list":e(ne)},null,8,["modelValue","action-list"])])}}}),Zt=Ze(js,[["__scopeId","data-v-6f34f95e"]]),Qr=Object.freeze(Object.defineProperty({__proto__:null,default:Zt},Symbol.toStringTag,{value:"Module"})),Ks={class:"option-description"},Gs={class:"option-description"},Ws=$e({__name:"PubProps",props:{modelValue:{},span:{},readonly:{type:Boolean},path:{},isRepub:{type:Boolean}},emits:["update:modelValue"],setup(t,{emit:f}){const r=t,y=f,o=X({get(){return r.modelValue},set(s){y("update:modelValue",s)}}),{tl:l}=Ce("RuleEngine"),p=s=>r.path?`${r.path}.${s}`:s;return(s,d)=>{const _=E("el-option"),h=E("el-select"),v=E("el-switch"),P=et,k=E("el-col"),C=E("el-input"),N=E("el-row");return g(),O(N,{gutter:26,class:"pub-props"},{default:a(()=>[n(k,{span:s.span},{default:a(()=>[n(P,{label:e(l)("payloadFormatIndicator"),prop:p("Payload-Format-Indicator"),readonly:"readonly"in s?s.readonly:e(Pe)},{default:a(()=>[s.isRepub?(g(),O(h,{key:0,modelValue:e(o)["Payload-Format-Indicator"],"onUpdate:modelValue":d[0]||(d[0]=T=>e(o)["Payload-Format-Indicator"]=T),placeholder:e(l)("selectOrInput"),filterable:"","allow-create":"",clearable:""},{default:a(()=>[n(_,{label:"true",value:"true"},{default:a(()=>[d[8]||(d[8]=V("span",{class:"option-label"},"true",-1)),V("span",Ks,M(e(l)("utf8EncodedCharacterData")),1)]),_:1}),n(_,{label:"false",value:"false"},{default:a(()=>[d[9]||(d[9]=V("span",{class:"option-label"},"false",-1)),V("span",Gs,M(e(l)("unspecifiedByteStream")),1)]),_:1})]),_:1},8,["modelValue","placeholder"])):(g(),O(v,{key:1,"active-value":"true","inactive-value":"false",modelValue:e(o)["Payload-Format-Indicator"],"onUpdate:modelValue":d[1]||(d[1]=T=>e(o)["Payload-Format-Indicator"]=T)},null,8,["modelValue"]))]),_:1},8,["label","prop","readonly"])]),_:1},8,["span"]),n(k,{span:s.span},{default:a(()=>[n(P,{label:e(l)("messageExpiryInterval"),prop:p("Message-Expiry-Interval"),readonly:"readonly"in s?s.readonly:e(Pe)},{default:a(()=>[n(C,{modelValue:e(o)["Message-Expiry-Interval"],"onUpdate:modelValue":d[2]||(d[2]=T=>e(o)["Message-Expiry-Interval"]=T)},null,8,["modelValue"])]),_:1},8,["label","prop","readonly"])]),_:1},8,["span"]),s.isRepub?Q("",!0):(g(),O(k,{key:0,span:s.span},{default:a(()=>[n(P,{label:e(l)("topicAlias"),prop:p("Topic-Alias"),readonly:"readonly"in s?s.readonly:e(Pe)},{default:a(()=>[n(C,{modelValue:e(o)["Topic-Alias"],"onUpdate:modelValue":d[3]||(d[3]=T=>e(o)["Topic-Alias"]=T)},null,8,["modelValue"])]),_:1},8,["label","prop","readonly"])]),_:1},8,["span"])),n(k,{span:s.span},{default:a(()=>[n(P,{label:e(l)("contentType"),prop:p("Content-Type"),readonly:"readonly"in s?s.readonly:e(Pe)},{default:a(()=>[n(C,{modelValue:e(o)["Content-Type"],"onUpdate:modelValue":d[4]||(d[4]=T=>e(o)["Content-Type"]=T)},null,8,["modelValue"])]),_:1},8,["label","prop","readonly"])]),_:1},8,["span"]),n(k,{span:s.span},{default:a(()=>[n(P,{label:e(l)("responseTopic"),prop:p("Response-Topic"),readonly:"readonly"in s?s.readonly:e(Pe)},{default:a(()=>[n(C,{modelValue:e(o)["Response-Topic"],"onUpdate:modelValue":d[5]||(d[5]=T=>e(o)["Response-Topic"]=T)},null,8,["modelValue"])]),_:1},8,["label","prop","readonly"])]),_:1},8,["span"]),n(k,{span:s.span},{default:a(()=>[n(P,{label:e(l)("correlationData"),prop:p("Correlation-Data"),readonly:"readonly"in s?s.readonly:e(Pe)},{default:a(()=>[n(C,{modelValue:e(o)["Correlation-Data"],"onUpdate:modelValue":d[6]||(d[6]=T=>e(o)["Correlation-Data"]=T)},null,8,["modelValue"])]),_:1},8,["label","prop","readonly"])]),_:1},8,["span"]),s.isRepub?Q("",!0):(g(),O(k,{key:1,span:s.span},{default:a(()=>[n(P,{label:e(l)("subIdentifier"),prop:p("Subscription-Identifier"),readonly:"readonly"in s?s.readonly:e(Pe)},{default:a(()=>[n(C,{modelValue:e(o)["Subscription-Identifier"],"onUpdate:modelValue":d[7]||(d[7]=T=>e(o)["Subscription-Identifier"]=T)},null,8,["modelValue"])]),_:1},8,["label","prop","readonly"])]),_:1},8,["span"]))]),_:1})}}}),Qs={class:"payload-desc"},Xs={class:"monaco-container"},Ys=$e({__name:"RePubForm",props:{modelValue:{type:Object,default:()=>({})},readonly:{type:Boolean,default:!1},isUsingInFlow:{type:Boolean,default:!1}},emits:["update:modelValue","save"],setup(t,{expose:f,emit:r}){const y=Z(),o=t,l=r,{tl:p}=Ce("RuleEngine"),d=Z((U=>{const{mqtt_properties:j,user_properties:A}=U.args;return!!A||j&&Object.entries(j).some(([,G])=>!!G)})(o.modelValue)),_=U=>{if(U===!1){const{mqtt_properties:j}=k.value.args;k.value.args.user_properties="",typeof j=="object"&&Object.keys(j).forEach(A=>j[A]="")}},{completionProvider:h}=ht(),v=[...Va,"${qos}"],P=[!0,!1,"${flags.retain}"],k=X({get(){return{mqtt_properties:{},...o.modelValue}},set(U){l("update:modelValue",U)}}),{createRequiredRule:C,createMqttPublishTopicRule:N}=it(),T={"args.topic":[...C("Topic"),...N()]},x=()=>{l("save",k.value)},S=X(()=>o.isUsingInFlow?{labelWidth:"120px",labelPosition:"right",hideRequiredAsterisk:!0}:{labelPosition:"top"}),$=U=>o.isUsingInFlow?24:U||12;return f({validate:()=>y.value.validate()}),(U,j)=>{const A=E("el-input"),G=et,c=E("el-col"),b=_t,z=lt,W=Ht,te=E("el-switch"),oe=E("el-row"),H=E("el-collapse-transition"),re=E("el-form");return g(),O(re,Sa({ref_key:"FormCom",ref:y,class:["message-form",{"label-align-right":t.isUsingInFlow}],rules:T,model:e(k),"validate-on-rule-change":!1},e(S),{onKeyup:j[8]||(j[8]=$a(J=>x(),["enter"]))}),{default:a(()=>[n(oe,{gutter:26},{default:a(()=>[n(c,{span:$(10)},{default:a(()=>[n(G,{label:U.$t("Base.topic"),required:"",prop:"args.topic",readonly:t.readonly},{default:a(()=>[n(A,{modelValue:e(k).args.topic,"onUpdate:modelValue":j[0]||(j[0]=J=>e(k).args.topic=J)},null,8,["modelValue"])]),_:1},8,["label","readonly"])]),_:1},8,["span"]),n(c,{span:$(6)},{default:a(()=>[n(G,{label:"QoS",readonly:t.readonly},{default:a(()=>[n(b,{modelValue:e(k).args.qos,"onUpdate:modelValue":j[1]||(j[1]=J=>e(k).args.qos=J),options:v},null,8,["modelValue"])]),_:1},8,["readonly"])]),_:1},8,["span"]),n(c,{span:$(6)},{default:a(()=>[n(G,{label:"Retain",readonly:t.readonly},{default:a(()=>[n(b,{modelValue:e(k).args.retain,"onUpdate:modelValue":j[2]||(j[2]=J=>e(k).args.retain=J),options:P},null,8,["modelValue"])]),_:1},8,["readonly"])]),_:1},8,["span"]),n(c,{span:24},{default:a(()=>[n(G,{label:"Payload"},{label:a(()=>[t.isUsingInFlow?(g(),O(z,{key:0,label:"Payload",desc:`${e(p)("payloadDesc")} ${e(p)("payloadExample")}`},null,8,["desc"])):(g(),ae(Re,{key:1},[n(z,{label:"Payload",desc:`${e(p)("payloadDesc")}`},null,8,["desc"]),V("p",Qs,M(e(p)("payloadDesc")),1)],64))]),default:a(()=>[V("div",Xs,[n(W,{modelValue:e(k).args.payload,"onUpdate:modelValue":j[3]||(j[3]=J=>e(k).args.payload=J),lang:"json","json-without-validate":"",disabled:t.readonly,id:("createRandomString"in U?U.createRandomString:e(ft))(),"completion-provider":e(h),onKeyup:j[4]||(j[4]=pt(()=>{},["stop"]))},null,8,["modelValue","disabled","id","completion-provider"])])]),_:1})]),_:1}),n(c,{span:$(24)},{default:a(()=>[n(G,{label:e(p)("pubProp")},{default:a(()=>[n(te,{modelValue:e(d),"onUpdate:modelValue":j[5]||(j[5]=J=>Se(d)?d.value=J:null),onChange:_,disabled:t.readonly},null,8,["modelValue","disabled"])]),_:1},8,["label"])]),_:1},8,["span"])]),_:1}),n(H,null,{default:a(()=>[e(d)?(g(),O(Ws,{key:0,modelValue:e(k).args.mqtt_properties,"onUpdate:modelValue":j[6]||(j[6]=J=>e(k).args.mqtt_properties=J),path:"record.args.mqtt_properties",span:$(),readonly:t.readonly,"is-repub":""},null,8,["modelValue","span","readonly"])):Q("",!0)]),_:1}),n(oe,{gutter:26},{default:a(()=>[n(c,{span:$(24)},{default:a(()=>[n(G,null,{label:a(()=>[n(z,{label:e(p)("directDispatch"),desc:e(p)("directDispatchDesc"),"desc-marked":""},null,8,["label","desc"])]),default:a(()=>[n(te,{modelValue:e(k).args.direct_dispatch,"onUpdate:modelValue":j[7]||(j[7]=J=>e(k).args.direct_dispatch=J),disabled:t.readonly},null,8,["modelValue","disabled"])]),_:1})]),_:1},8,["span"])]),_:1})]),_:1},16,["model","class"])}}}),Js={key:0,class:"output-content"},Zs={key:1,class:"output-content"},er={key:0,class:"output-content"},tr={class:"detail-title"},ar=$e({name:"RuleOutputsDrawer"}),nr=$e({...ar,props:{modelValue:{type:Boolean},output:{type:[Object,String],required:!1},outputDisableList:{type:Array,required:!0},edit:{type:Boolean,default:!1},isFallback:{type:Boolean,default:!1},actionKey:{type:String}},emits:["update:modelValue","submit"],setup(t,{emit:f}){const{tl:r,t:y}=Ce("RuleEngine"),o=Z(),l=t;Da("isFallback",l.isFallback);const p=f,s=()=>({type:"",args:{topic:"",qos:0,payload:"",retain:!1,mqtt_properties:{},user_properties:"",direct_dispatch:!1}}),d=Z(),_=Z(),h=Z(!1),v=Z(s()),P=Z({}),{createRequiredRule:k}=it(),C={type:k(y("RuleEngine.action",1).toLowerCase(),"select")},N=X({get(){return l.modelValue},set(Y){p("update:modelValue",Y)}}),T=X(()=>!!l.output&&l.edit),x=X(()=>l.isFallback?T.value?r("editFallbackAction"):r("addFallbackAction"):T.value?r("editAction"):r("addAction")),{egressBridgeTypeList:S}=Ue(),$=[{value:Be.Republish,label:r("republish")},...l.isFallback?[]:[{value:Be.Console,label:r("consoleOutput")}],...S],ee=[Be.Republish,Be.Console],U=X(()=>v.value.type&&!ee.includes(v.value.type)),j=X(()=>!P.value.id),A=Z(),G=()=>{P.value.id=""},c=Y=>{var K,F;switch(Y){case Be.Republish:{const L=typeof l.output=="object"&&Be.Republish!==((K=l.output)==null?void 0:K.function);return l.outputDisableList.includes(Be.Republish)&&!L}case Be.Console:{const L=typeof l.output=="object"&&Be.Console!==((F=l.output)==null?void 0:F.function);return l.outputDisableList.includes(Be.Console)&&!L}default:return!1}},b=X(()=>l.isFallback?[...l.outputDisableList||[],...l.actionKey?[l.actionKey]:[]]:l.outputDisableList),{getBridgeGeneralType:z}=Ue(),W=async()=>{const{output:Y}=l;if(Y)if(typeof Y=="string"){const{type:K}=Ut(Y);v.value.type=z(K),P.value.id=Y}else typeof Y=="object"&&(v.value.type=Y.function||"",Y.function===Be.Republish&&Y.args&&(v.value.args=Y.args));await Rt(),d.value.clearValidate()},te=Z(!1),oe=async()=>{var Y;te.value=!0;try{const K=j.value?A.value:o.value;await((Y=K==null?void 0:K.testConnection)==null?void 0:Y.call(K))}catch{}finally{te.value=!1}},H=async()=>{try{const Y=await A.value.submitCreateBridge();return Promise.resolve(Y)}catch(Y){return Promise.reject(Y)}},re=async()=>{var Y,K,F;try{await((Y=d.value)==null?void 0:Y.validate()),h.value=!0;let L;const{type:i}=v.value;if(U.value){if(j.value)L=await H();else if(L=T.value?await((F=o.value)==null?void 0:F.updateBridgeInfo()):P.value.id,!L)return}else if(i===Be.Console)L={function:i};else if(i===Be.Republish)await((K=_.value)==null?void 0:K.validate()),L={function:i,args:{...v.value.args}};else throw new Error("can not handle output form");p("submit",L,T.value),N.value=!1}catch(L){console.error(L)}finally{h.value=!1}},J=()=>{N.value=!1};Oe(N,Y=>{Y?W():(v.value=s(),P.value={})});const{handleConnDirection:ge}=ut();return ge(async(Y,K,F)=>{l.isFallback||Y===nt.Ingress||setTimeout(async()=>{N.value=!0,F&&(v.value.type=F),K&&(await Rt(),A.value.bridgeData.connector=K)},800)}),(Y,K)=>{const F=E("el-option"),L=E("el-select"),i=E("el-form-item"),I=E("el-col"),pe=E("el-row"),ye=E("el-form"),ke=E("el-button"),ne=E("el-drawer");return g(),O(ne,{title:e(x),modelValue:e(N),"onUpdate:modelValue":K[3]||(K[3]=ie=>Se(N)?N.value=ie:null),"lock-scroll":!1,size:"60%","destroy-on-close":"","append-to-body":"",class:qe({"is-fallback":t.isFallback})},{footer:a(()=>[e(U)?(g(),O(ke,{key:0,plain:"",type:"primary",loading:e(te),onClick:oe},{default:a(()=>[_e(M(e(r)("testTheConnection")),1)]),_:1},8,["loading"])):Q("",!0),n(ke,{class:"btn-cancel",onClick:J},{default:a(()=>[_e(M(Y.$t("Base.cancel")),1)]),_:1}),e(U)&&e(j)?(g(),O(ke,{key:1,type:"primary",loading:e(h),disabled:!Y.$hasPermission("post"),onClick:re},{default:a(()=>[_e(M(e(r)("create")),1)]),_:1},8,["loading","disabled"])):(g(),O(ke,{key:2,type:"primary",loading:e(h),disabled:!Y.$hasPermission("post"),onClick:re},{default:a(()=>[_e(M(e(T)?Y.$t("Base.update"):Y.$t("Base.add")),1)]),_:1},8,["loading","disabled"]))]),default:a(()=>[n(ye,{"label-position":"top","require-asterisk-position":"right",model:e(v),rules:C,ref_key:"formCom",ref:d},{default:a(()=>[n(pe,{gutter:26},{default:a(()=>[n(I,{span:12},{default:a(()=>[n(i,{label:e(r)("actionType"),prop:"type"},{default:a(()=>[n(L,{modelValue:e(v).type,"onUpdate:modelValue":K[0]||(K[0]=ie=>e(v).type=ie),filterable:"",onChange:G},{default:a(()=>[(g(),ae(Re,null,Fe($,({value:ie,label:he})=>n(F,{key:ie,value:ie,disabled:c(ie),label:he},null,8,["value","disabled","label"])),64))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1}),e(U)?(g(),O(I,{key:0,span:12},{default:a(()=>[n(i,{label:e(r)("action")},{default:a(()=>[n(kn,{modelValue:e(P).id,"onUpdate:modelValue":K[1]||(K[1]=ie=>e(P).id=ie),type:e(v).type,"disable-list":e(b)},null,8,["modelValue","type","disable-list"])]),_:1},8,["label"])]),_:1})):Q("",!0)]),_:1})]),_:1},8,["model"]),e(v).type===e(Be).Republish?(g(),ae("div",Js,[n(Ys,{ref_key:"RePubFormCom",ref:_,modelValue:e(v),"onUpdate:modelValue":K[2]||(K[2]=ie=>Se(v)?v.value=ie:null)},null,8,["modelValue"])])):e(v).type===e(Be).Console?(g(),ae("div",Zs,M(e(r)("console")),1)):e(U)?(g(),ae(Re,{key:2},[e(j)?(g(),O(As,{ref_key:"BridgeCreateRef",ref:A,class:"output-content",key:e(v).type,type:e(v).type,"in-drawer":""},null,8,["type"])):(g(),ae("div",er,[V("p",tr,M(e(r)("confPreview")),1),n(Zt,{ref_key:"BridgeDetailRef",ref:o,"bridge-id":e(P).id,disabled:!e(T),"hide-name":"","in-drawer":""},null,8,["bridge-id","disabled"])]))],64)):Q("",!0)]),_:1},8,["title","modelValue","class"])}}}),or=Ze(nr,[["__scopeId","data-v-3f6e1640"]]),sr={class:"editor-hd"},rr={key:0,class:"action-list-hd"},lr={class:"vertical-align-center"},ir=["src"],ur={class:"action-item-info"},cr={key:0,class:"action-item-name"},dr={class:"action-item-type"},pr={key:0,class:"action-item-op"},mr={key:1,class:"tip"},fr={key:1,class:"action-list"},yr={class:"tip"},gr="republish",_r=$e({__name:"FallbackActionsEditor",props:{modelValue:{},inRuleOutputs:{type:Boolean},actionKey:{},readonly:{type:Boolean},isFallback:{type:Boolean}},emits:["update:modelValue"],setup(t,{emit:f}){const r=t,y=f,o=X({get(){return[...r.modelValue??[]]},set(c){y("update:modelValue",c)}}),{t:l,tl:p}=Ce("RuleEngine"),s=c=>c.kind===tt.Reference,d=c=>c.kind===tt.Republish,_=c=>d(c)?`${c.kind}:${c.args.topic}`:`${c.kind}:${Xe(c)}`,{getBridgeIconKey:h}=gt(),v=c=>{const b=`img/${d(c)?gr:h(c.type)}.png`;return Ra(b)},{getGeneralTypeLabel:P}=Ue(),k=c=>d(c)?p("republish"):P(c.type),C=Z(!1),N=Z(-1),T=X(()=>N.value>-1?o.value[N.value]:null),{convertFallbackActionToRuleOutput:x}=xa(),S=X(()=>{if(T.value)return x(T.value)}),$=X(()=>{var c;return((c=o.value)==null?void 0:c.reduce((b,z)=>(s(z)&&b.push(Xe(z)),b),[]))??[]}),ee=async c=>{N.value=c,r.inRuleOutputs&&T.value&&d(T.value)&&await U(p("updateActionTip",{operation:Bt(p("editFallbackRepublish"))})),C.value=!0},{operationWarning:U}=dn(),j=async c=>{try{r.inRuleOutputs&&await U(p("updateActionTip",{operation:p("deleteFallback")})),o.value=o.value.toSpliced(c,1)}catch{}},A=async()=>{try{r.inRuleOutputs&&await U(p("updateActionTip",{operation:Bt(p("addFallbackAction"))})),N.value=-1,C.value=!0}catch{}},G=c=>{let b;const z=typeof c=="object"&&!!c.function&&!!c.args,W=typeof c=="string";if(z)b={kind:tt.Republish,args:c.args};else if(W){const{type:te,name:oe}=Ut(c);b={kind:tt.Reference,type:te,name:oe}}if(T.value){if(W&&s(T.value)&&Xe(T.value)===c)return;const te=o.value.toSpliced(N.value,1,b);o.value=te,N.value=-1}else b&&(o.value=[...o.value,b])};return(c,b)=>{const z=Ba,W=E("el-button"),te=E("el-card");return g(),ae("div",{class:qe(["fallback-actions-editor",{"no-padding":!e(o).length}])},[V("div",sr,[!c.inRuleOutputs&&!("readonly"in c?c.readonly:e(Pe))&&!c.isFallback?(g(),O(z,{key:0,class:"btn-add-fallback",link:"",onClick:A,size:"small"},{default:a(()=>[_e(M(e(p)("addFallbackAction")),1)]),_:1})):Q("",!0)]),c.isFallback?Q("",!0):(g(),ae("ul",{key:0,class:qe(["action-list",{"empty-readonly":!!("readonly"in c?c.readonly:e(Pe))&&!e(o).length&&!c.inRuleOutputs}])},[c.inRuleOutputs?(g(),ae("div",rr,[n(z,{disabled:("readonly"in c?c.readonly:e(Pe))||!c.$hasPermission("post"),class:"btn-add-fallback",link:"",onClick:A,size:"small"},{default:a(()=>[_e(M(e(p)("addFallbackAction")),1)]),_:1},8,["disabled"])])):Q("",!0),(g(!0),ae(Re,null,Fe(e(o),(oe,H)=>(g(),ae("li",{class:qe(["action-item",{"in-rule-outputs":c.inRuleOutputs}]),key:_(oe)},[(g(),O(qa(s(oe)?"router-link":"div"),{class:"space-between",to:s(oe)?{name:"action-detail",params:{id:("getBridgeKey"in c?c.getBridgeKey:e(Xe))(oe)}}:void 0,target:"_blank"},{default:a(()=>[n(te,{class:"action-item-card",shadow:"never"},{default:a(()=>[V("div",lr,[V("img",{src:v(oe)},null,8,ir),V("div",ur,[s(oe)?(g(),ae("p",cr,M(oe.name),1)):Q("",!0),V("span",dr,M(k(oe)),1)])]),("readonly"in c?c.readonly:e(Pe))?Q("",!0):(g(),ae("div",pr,[n(W,{size:"small",onClick:pt(re=>ee(H),["prevent"])},{default:a(()=>[_e(M(e(l)("Base.edit")),1)]),_:2},1032,["onClick"]),n(W,{size:"small",plain:"",onClick:pt(re=>j(H),["prevent"])},{default:a(()=>[_e(M(e(l)("Base.delete")),1)]),_:2},1032,["onClick"])]))]),_:2},1024)]),_:2},1032,["to"]))],2))),128)),e(o).length?Q("",!0):(g(),ae("p",mr,M(e(l)("Base.none")),1))],2)),c.isFallback?(g(),ae("div",fr,[V("p",yr,M(e(p)("reFallbackTip")),1)])):Q("",!0),n(or,{modelValue:e(C),"onUpdate:modelValue":b[0]||(b[0]=oe=>Se(C)?C.value=oe:null),"is-fallback":"",edit:!!e(T),"action-key":c.actionKey,output:e(S),"output-disable-list":e($),onSubmit:G},null,8,["modelValue","edit","action-key","output","output-disable-list"])],2)}}}),br=t=>{const f=yt("isFallback",!1),{t:r,tl:y,te:o}=Ce("RuleEngine"),{getI18nPrefix:l,setLabelAndDesc:p}=ra(r,o),{ruleWhenEditing:s}=sa(t),{createCommonIdRule:d}=it(),{initRecordByComponents:_}=la(),h=w=>(w.password||(w.password=[]),Array.isArray(w.password)&&w.password.push(...s),w.name||(w.name=[]),Array.isArray(w.name)&&w.name.push(...d()),w),v=w=>w?w.reduce((m,q)=>(q.type==="enum"&&q.symbols&&m.push(...q.symbols),m),[]):[],P=(w,m)=>{w.componentProps=Object.assign(w.componentProps||{},m)},k=(w,m)=>{Object.entries(w).forEach(([q,u])=>{m[q]||(m[q]=[]),Array.isArray(u)&&m[q].push(...u)})},{completionProvider:C}=ht(),{availableFields:N}=jt(),T=w=>{const m=q=>{var u,B;q.properties?Object.values(q.properties).forEach(R=>m(R)):q.type==="array"&&((u=q.items)!=null&&u.properties)?Object.values(q.items.properties).forEach(R=>m(R)):q.type==="oneof"?(B=q.oneOf)==null||B.forEach(R=>m(R)):["string","sql"].includes(q.type)&&q.format==="sql"&&q.is_template?P(q,{completionProvider:C}):q.type==="object"&&!q.properties&&q.is_template&&P(q,{supportPlaceholder:["key","value"]})};return m(w),w},x=X(()=>!t.edit||!t.modelValue?void 0:Xe(t.modelValue)),S=({components:w,rules:m})=>{var R,se,le,ce;const q=w;(se=(R=q.resource_opts)==null?void 0:R.properties)!=null&&se.start_after_created&&Reflect.deleteProperty(q.resource_opts.properties,"start_after_created"),(ce=(le=q.resource_opts)==null?void 0:le.properties)!=null&&ce.batch_time&&Reflect.deleteProperty(q.resource_opts.properties,"batch_time"),q.local_topic&&Reflect.deleteProperty(q,"local_topic"),q.tags&&Reflect.deleteProperty(q,"tags"),q.fallback_actions&&(q.fallback_actions.customComponent=Pa(_r),q.fallback_actions.componentProps={actionKey:x,readonly:!!t.readonly,isFallback:f});const u=w==null?void 0:w.parameters;u&&T(u);const B=h(m);return{components:q,rules:B}},$=w=>{var le;const{components:m,rules:q}=S(w),{qos:u,retain:B,payload:R,topic:se}=((le=m==null?void 0:m.parameters)==null?void 0:le.properties)||{};return(u==null?void 0:u.type)==="oneof"&&(u.type="enum",u.symbols=[...v(u.oneOf)||[],"${qos}"]),(B==null?void 0:B.type)==="oneof"&&(B.type="enum",B.symbols=[!0,!1,"${flags.retain}"]),se&&!R&&(se.labelKey="source_topic"),!R&&(u==null?void 0:u.type)==="enum"&&u.symbols&&(u.symbols=u.symbols.filter(ce=>ce!==2)),(R==null?void 0:R.type)==="string"&&(R.format="sql"),{components:m,rules:q}},ee=w=>{var R;const{components:m,rules:q}=S(w),{body:u,headers:B}=((R=m==null?void 0:m.parameters)==null?void 0:R.properties)||{};return(u==null?void 0:u.type)==="string"&&(u.format="sql"),B!=null&&B.default&&(B.default=de.pick(B.default,"content-type")),{components:m,rules:q}},{commandReg:U}=Na(),j=w=>{var B,R;const{components:m,rules:q}=S(w),{command_template:u}=((B=m==null?void 0:m.parameters)==null?void 0:B.properties)||{};return(u==null?void 0:u.type)==="array"&&((R=u==null?void 0:u.items)==null?void 0:R.type)==="string"&&(u.type="string",u.format="sql",u.default="",u.is_template=!0),q!=null&&q["parameters.command_template"]&&Array.isArray(q["parameters.command_template"])&&q["parameters.command_template"].push({validator(se,le,ce){U.test(le.replace(/\n/g," ").trim())||ce(new Error(y("redisCommandError"))),ce()},trigger:"blur"}),{components:m,rules:q}},A=w=>{var B;const{components:m,rules:q}=S(w),{parameters:u}=m;return(B=u==null?void 0:u.properties)!=null&&B.payload_template&&(u.properties.payload_template.format="sql"),{components:m,rules:q}},G=w=>{var B,R,se,le;const{components:m,rules:q}=S(w),{parameters:u}=m;if(((R=(B=u==null?void 0:u.properties)==null?void 0:B.payload_template)==null?void 0:R.type)==="string"&&(u.properties.payload_template.format="sql"),(se=u==null?void 0:u.properties)!=null&&se.attributes_template){const ce=u.properties.attributes_template,ve="components.",{key:fe,value:De}=((le=ce==null?void 0:ce.items)==null?void 0:le.properties)||{};Object.entries({key:fe,value:De}).forEach(([Ie,Me])=>Me.label=r(`${ve}${Ie}`))}return{components:m,rules:q}},c=w=>{var u,B,R;const{components:m,rules:q}=S(w);return((R=(B=(u=m==null?void 0:m.parameters)==null?void 0:u.properties)==null?void 0:B.template)==null?void 0:R.type)==="string"&&(m.parameters.properties.template.format="sql"),{components:m,rules:q}},b=w=>{var u,B,R;const{components:m,rules:q}=S(w);return((R=(B=(u=m==null?void 0:m.parameters)==null?void 0:u.properties)==null?void 0:B.template)==null?void 0:R.type)==="string"&&(m.parameters.properties.template.format="sql"),{components:m,rules:q}},z=w=>{var u,B,R;const{components:m,rules:q}=S(w);return((R=(B=(u=m==null?void 0:m.parameters)==null?void 0:u.properties)==null?void 0:B.payload_template)==null?void 0:R.type)==="string"&&(m.parameters.properties.payload_template.format="sql"),{components:m,rules:q}},W=w=>{var u,B,R,se,le;const{components:m,rules:q}=S(w);return((R=(B=(u=m==null?void 0:m.parameters)==null?void 0:u.properties)==null?void 0:B.record_template)==null?void 0:R.type)==="string"&&(m.parameters.properties.record_template.format="sql"),(le=(se=m==null?void 0:m.parameters)==null?void 0:se.properties)!=null&&le.batch_size&&(m.parameters.properties.batch_size.labelKey="hstream_batch_size"),{components:m,rules:q}},te=w=>{var ve,fe,De,Ee,Ie,Me;const{components:m,rules:q}=S(w),{parameters:u}=m;(ve=u==null?void 0:u.properties)!=null&&ve.partitions_limit&&(u.properties.partitions_limit.componentProps={disabledLabel:r("SchemaSymbolLabel.all_partitions")});const{kafka_ext_header_key:B,kafka_ext_header_value:R}=((Ee=(De=(fe=u==null?void 0:u.properties)==null?void 0:fe.kafka_ext_headers)==null?void 0:De.items)==null?void 0:Ee.properties)||{},se=l(D.AzureEventHubs);B&&p(B,`${se}kafka_ext_header_key`),R&&p(R,`${se}kafka_ext_header_value`);const{key:le,value:ce}=((Me=(Ie=u==null?void 0:u.properties)==null?void 0:Ie.message)==null?void 0:Me.properties)||{};return(le==null?void 0:le.type)==="string"&&(le.componentProps={type:"textarea",rows:3}),(ce==null?void 0:ce.type)==="string"&&(ce.componentProps={type:"textarea",rows:3}),{components:m,rules:q}},oe=w=>{const{rules:m}=S(w);return k({"parameters.group_id":[{pattern:/^[a-zA-Z0-9._-]*$/,message:y("invalidGroupId")}]},m),{...w,rules:m}},H=w=>{var u,B,R;const{components:m,rules:q}=S(w);return((R=(B=(u=m==null?void 0:m.parameters)==null?void 0:u.properties)==null?void 0:B.payload_template)==null?void 0:R.type)==="string"&&(m.parameters.properties.payload_template.format="sql"),{components:m,rules:q}},re=w=>{var B,R;const{components:m,rules:q}=S(w),{parameters:u}=m;return(B=u==null?void 0:u.properties)!=null&&B.template&&(u.properties.template.format="sql"),(R=u==null?void 0:u.properties)!=null&&R.target_qos&&u.properties.target_qos.type==="number"&&(u.properties.target_qos.type="enum",u.properties.target_qos.symbols=[0,1,2],u.properties.target_qos.default=""),{components:m,rules:q}},J=w=>{var B,R,se,le;const{components:m,rules:q}=S(w),u=(le=(se=(R=(B=m==null?void 0:m.parameters)==null?void 0:B.properties)==null?void 0:R.data)==null?void 0:se.items)==null?void 0:le.properties;if(u){const{data_type:ce,timestamp:ve}=u;ce&&ce.type==="oneof"&&(ce.type="enum",ce.symbols=v(ce.oneOf),ce.default??(ce.default="")),ve&&ve.type==="oneof"&&(ve.type="enum",ve.symbols=v(ve.oneOf),ve.default??(ve.default=""));const fe=l(D.IoTDB);Object.entries(u).forEach(([De,Ee])=>p(Ee,`${fe}${De}`))}return{components:m,rules:q}},ge=[/create/i,/update/i,/delete/i],Y=w=>ge.findIndex(m=>m.test(w)),K=w=>{const{components:m,rules:q}=S(w),{parameters:u}=m||{},B=u==null?void 0:u.oneOf;if(B){B.sort((se,le)=>Y(se.$ref||"")-Y(le.$ref||"")),B.forEach(se=>{se.properties&&(Reflect.deleteProperty(se.properties,"require_alias"),u.path&&(se.default=de.get(_(se.properties),u.path)),se.properties.doc&&se.properties.doc.type==="string"&&(se.properties.doc.format="sql"))});const R=B.find(se=>se.$ref&&/create/.test(se.$ref));R&&(u.default=R.default)}return{components:m,rules:q}},F=w=>{var se,le,ce;const{components:m,rules:q}=S(w),{parameters:u}=m,B=((ce=(le=(se=u==null?void 0:u.properties)==null?void 0:se.data)==null?void 0:le.items)==null?void 0:ce.properties)||{},R=l(D.OpenTSDB);return Object.entries(B).forEach(([ve,fe])=>{p(fe,`${R}${ve}`),ve==="value"&&fe.type==="oneof"?(fe.type="string",fe.is_template=!0):ve==="tags"&&fe.type==="oneof"&&(fe.type="object",fe.componentProps={type:"input",supportPlaceholder:["key","value"]},fe.default={})}),{components:m,rules:q}};let L;(w=>{w.Action="${action}",w.Node="${node}",w.DataTime="${datetime.{format}}",w.DateTimeUntil="${datetime_until.{format}}",w.Sequence="${sequence}"})(L||(L={}));const I=["${action}","${node}","${datetime.{format}}","${sequence}"].map(w=>w==="${datetime.{format}}"?new RegExp(de.escapeRegExp(w).replace("\\{format\\}","\\w+")):new RegExp(de.escapeRegExp(w))),pe=["rfc3339utc","rfc3339","unix"],ye=["${action}","${node}",...pe.map(w=>"${datetime.{format}}".replace("{format}",w)),...pe.map(w=>"${datetime_until.{format}}".replace("{format}",w)),"${sequence}"],ke="${action}/${node}/${datetime.rfc3339utc}_N${sequence}.csv",ne={validator(w,m,q){q(I.every(u=>u.test(m))?void 0:new Error(y("somePlaceholderRequired")))},trigger:"blur"},ie=w=>{var ve,fe,De,Ee,Ie,Me,je,Ke,Ge,We,Qe;const{components:m,rules:q}=S(w),{parameters:u}=m,B=(ve=u==null?void 0:u.oneOf)==null?void 0:ve.find(xe=>/direct/i.test(xe.$ref||""));u&&B&&(u.default=de.cloneDeep(B.default),u.useNewCom=!0,P(u,{type:"radio"}),((De=(fe=B==null?void 0:B.properties)==null?void 0:fe.content)==null?void 0:De.type)==="string"&&(B.properties.content.format="sql"));const R=(Ee=u==null?void 0:u.oneOf)==null?void 0:Ee.find(xe=>/aggregated/i.test(xe.$ref||"")),se=(je=(Me=(Ie=R==null?void 0:R.properties)==null?void 0:Ie.container)==null?void 0:Me.properties)==null?void 0:je.type,le=(Ke=R==null?void 0:R.properties)==null?void 0:Ke.key,ce=(Qe=(We=(Ge=R==null?void 0:R.properties)==null?void 0:Ge.container)==null?void 0:We.properties)==null?void 0:Qe.column_order;return ce&&(ce.componentProps||(ce.componentProps={}),ce.componentProps.default=N.value),se&&(se.title=y("aggregationSettings")),le&&(le.labelKey="aggregated_key",P(le,{customPlaceholders:ye}),le.default=ke),R!=null&&R.rules&&k({"parameters.key":[ne]},R.rules),{components:m,rules:q}},he=w=>{var ve,fe,De,Ee,Ie,Me,je,Ke,Ge,We,Qe,xe,kt,wt,Ct;const{components:m,rules:q}=S(w),{parameters:u}=m,B=(ve=u==null?void 0:u.oneOf)==null?void 0:ve.find(ct=>/direct/i.test(ct.$ref||""));u&&B&&(u.default=de.cloneDeep(B.default),u.useNewCom=!0,P(u,{type:"radio"}),((De=(fe=B==null?void 0:B.properties)==null?void 0:fe.content)==null?void 0:De.type)==="string"&&(B.properties.content.format="sql"));const R=(Ee=u==null?void 0:u.oneOf)==null?void 0:Ee.find(ct=>/aggre/i.test(ct.$ref||"")),se=(Ge=(Ke=(je=(Me=(Ie=R==null?void 0:R.properties)==null?void 0:Ie.aggregation)==null?void 0:Me.properties)==null?void 0:je.container)==null?void 0:Ke.properties)==null?void 0:Ge.type,le=(We=R==null?void 0:R.properties)==null?void 0:We.blob,ce=(Ct=(wt=(kt=(xe=(Qe=R==null?void 0:R.properties)==null?void 0:Qe.aggregation)==null?void 0:xe.properties)==null?void 0:kt.container)==null?void 0:wt.properties)==null?void 0:Ct.column_order;return ce&&(ce.componentProps||(ce.componentProps={}),ce.componentProps.default=N.value),se&&(se.title=y("aggregationSettings")),le&&(le.labelKey="aggregated_blob",P(le,{customPlaceholders:ye}),le.default=ke),R!=null&&R.rules&&k({"parameters.blob":[ne]},R.rules),{components:m,rules:q}},Ve=w=>{var se,le;const{components:m,rules:q}=S(w),{parameters:u}=m,{key:B,value:R}=((le=(se=u==null?void 0:u.properties)==null?void 0:se.message)==null?void 0:le.properties)||{};return(B==null?void 0:B.type)==="string"&&(B.componentProps={type:"textarea",rows:3}),(R==null?void 0:R.type)==="string"&&(R.componentProps={type:"textarea",rows:3}),{components:m,rules:q}},ue=w=>{var B;const{components:m,rules:q}=S(w),{parameters:u}=m;return(B=u==null?void 0:u.properties)!=null&&B.sql&&(u.properties.sql.format="sql"),{components:m,rules:q}},me=w=>{var B;const{components:m,rules:q}=S(w),{private_key:u}=((B=m==null?void 0:m.parameters)==null?void 0:B.properties)||{};return(u==null?void 0:u.type)==="string"&&(u.componentProps={type:"textarea",rows:3}),{components:m,rules:q}},we=w=>{var B,R,se,le,ce;const{components:m,rules:q}=S(w),u=(le=(se=(R=(B=m==null?void 0:m.parameters)==null?void 0:B.properties)==null?void 0:R.fields)==null?void 0:se.items)==null?void 0:le.properties;if(u){const{value:ve}=u;ve.type==="oneof"&&((ce=ve.oneOf)!=null&&ce.every(De=>["number","boolean","string"].includes(De.type)))&&(ve.type="string");const fe=l(D.Tablestore);Object.entries(u).forEach(([De,Ee])=>De==="value"?p(Ee,`${l("common")}${De}`):p(Ee,`${fe}${De}`))}return{components:m,rules:q}},be=w=>{var B;const{components:m,rules:q}=S(w),{template:u}=((B=m==null?void 0:m.parameters)==null?void 0:B.properties)||{};return(u==null?void 0:u.type)==="string"&&(u.format="sql"),{components:m,rules:q}},Te={[D.MQTT]:$,[D.Webhook]:ee,[D.Redis]:j,[D.GCPProducer]:G,[D.MongoDB]:A,[D.DynamoDB]:c,[D.RocketMQ]:b,[D.RabbitMQ]:z,[D.HStream]:W,[D.KafkaProducer]:te,[D.KafkaConsumer]:oe,[D.AzureEventHubs]:te,[D.Confluent]:te,[D.AmazonKinesis]:H,[D.SysKeeperForwarder]:re,[D.IoTDB]:J,[D.Elasticsearch]:K,[D.OpenTSDB]:F,[D.S3]:ie,[D.AzureBlobStorage]:he,[D.Pulsar]:Ve,[D.Couchbase]:ue,[D.Snowflake]:me,[D.Tablestore]:we,[D.DiskLog]:be};return{getComponentsHandler:()=>{const w=t.type&&Te[t.type];return w?m=>{const q=w(m);return S(q)}:S}}},vr={class:"schema-form-integration bridge-config"},mt=$e({__name:"UsingSchemaBridgeConfig",props:{modelValue:{default:void 0},type:{},edit:{type:Boolean},copy:{type:Boolean},isLoading:{type:Boolean},readonly:{type:Boolean},disabled:{type:Boolean},hideName:{type:Boolean},formProps:{default:()=>({})},hiddenFields:{},isUsingInFlow:{type:Boolean},isSource:{type:Boolean}},emits:["update:modelValue","init"],setup(t,{expose:f,emit:r}){const{getSchemaRefByType:y}=Ia(),{getSchemaRefByType:o}=Ma(),l=t,p=r,s=X(()=>Lt("/schemas/actions")),d=X(()=>l.isSource?"source":"action"),_=X({get(){return l.modelValue||{}},set(H){p("update:modelValue",H)}}),h=X(()=>l.isUsingInFlow?24:12),{handleSyncEtcFormData:v}=It(_),P=Z(!1),k=Z(),C=X(()=>({labelWidth:void 0,labelPosition:"top",requireAsteriskPosition:"right",disabled:l.disabled,class:"",...l.formProps})),{propsOrderMap:N,customColClass:T,advancedFields:x}=jo(l,_),S=X(()=>{const H=T.value;return l.hiddenFields&&l.hiddenFields.forEach(re=>H[re]="col-hidden"),H}),$=X(()=>{const H=[];return l.edit&&H.push("name"),H}),ee=X(()=>{if(l.type)return l.isSource?o(l.type):y(l.type)}),U=["tdengine","iotdb"],j={tdengine:"TDengine",iotdb:"IoTDB"},A=X(()=>{if(!ee.value)return;const H=U.find(re=>{var J;return(J=ee.value)==null?void 0:J.includes(re)});if(H){const re=j[H];return{dbType:dt[re]}}}),{getComponentsHandler:G}=br(l),{fillNewRecord:c}=ua(),b=({newVal:H,oldVal:re})=>{var J,ge;l.edit||((J=H.record)==null?void 0:J.type)===((ge=re.record)==null?void 0:ge.type)||(_.value={...c(H,re),type:H.record.type})},z=H=>{Object.keys(H).length>0&&(_.value=H)},W=H=>{p("init",H)};return f({getFormRecord:()=>v(de.cloneDeep(k.value.configForm)),validate:()=>{var H;return(H=k.value)!=null&&H.validate?k.value.validate():Promise.resolve()}}),(H,re)=>{const J=ia;return g(),ae("div",vr,[e(ee)?(g(),O(J,{key:0,ref_key:"formCom",ref:k,type:e(d),"need-rules":"","schema-file-path":e(s),"need-footer":!1,"need-record":!H.edit&&!H.copy,form:e(_),"according-to":{ref:`#/components/schemas/${e(ee)}`},readonly:"readonly"in H?H.readonly:e(Pe),"btn-loading":e(P),"record-loading":H.isLoading,"form-item-span":e(h),"use-tooltip-show-desc":!0,"props-order-map":e(N),"custom-col-class":e(S),"props-disabled":e($),"data-handler":e(G)(),"form-props":e(C),"advanced-fields":e(x),"batch-setting-configs":e(A),onUpdate:z,onComponentChange:b,onInit:W},null,8,["type","schema-file-path","need-record","form","according-to","readonly","btn-loading","record-loading","form-item-span","props-order-map","custom-col-class","props-disabled","data-handler","form-props","advanced-fields","batch-setting-configs"])):Q("",!0)])}}});export{Qr as B,or as R,Do as _,gs as a,kn as b,_r as c,Wr as d,mt as e,zo as f,_n as s,Gr as u};
