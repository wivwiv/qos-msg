import{_ as Je}from"./Monaco.vue_vue_type_style_index_0_lang-C5FqW0sc.js";import{_ as Xe}from"./InfoTooltip-CtXDYqOe.js";import{_ as Qe,d as te,o as v,c as K,a as p,q as be,j as J,g as O,m as H,W as ct,u as e,y as ie,R as De,aY as nt,a5 as Ke,M as W,f as ke,r as R,w as a,k as he,F as de,J as ce,aZ as Ge,N as Oe,a3 as Pe,e as Y,t as k,x as ee,b as o,a_ as ut,h as dt,a$ as Re,aL as pt,b0 as xe,b1 as He,b2 as qt,aS as fe,E as mt,b3 as Pt,aT as _t,z as Ze,b4 as xt,b5 as at,a2 as Ie,aX as ae,K as Nt,b6 as Ne,b7 as le,b8 as ft,Q as et,a1 as Ut,b9 as Qt,ba as jt,bb as zt,n as qe,au as Kt,bc as Gt,l as Ht,bd as vt,be as Le,bf as Yt,bg as Wt,bh as Ye,bi as We,C as Jt,i as Xt,ac as lt,bj as Zt}from"./index-Dp_94g6t.js";import{d as Be,h as gt,R as _e,e as Me,u as eo,i as to,t as oo}from"./useRule-DGtnoBQH.js";import{a as yt,b as so,R as no,c as ao,d as lo}from"./UsingSchemaBridgeConfig.vue_vue_type_script_setup_true_lang-l4E03JUu.js";import{u as ro,S as io}from"./SourceDetail-CNWN3-U7.js";import{b as co,a as uo}from"./useHandleSourceItem-BuhTrh1O.js";import{u as bt}from"./useFormRules-Dd-VLxGD.js";import{u as Ue}from"./useHandleActionItem-CKafnUW3.js";import{u as tt,a as po}from"./useBridgeTypeValue-BhHkY53V.js";import{u as ht}from"./useOperationConfirm-DftZFsPf.js";import{_ as Tt}from"./CodeView.vue_vue_type_style_index_0_lang-COVY_D_l.js";import{d as mo,a as _o,g as fo,b as vo}from"./diagnose-CTW0WGD4.js";import{a as go}from"./useSyncPolling-EuuWKCYU.js";import{c as yo}from"./circle-close-filled-D3EWRYs9.js";import{w as bo}from"./useActionAndSourceStatus-D5aIU2c4.js";import{u as ho}from"./useDataNotSaveConfirm-CX0RqJFS.js";import{u as To}from"./useCopy-xLykWTHO.js";import{c as So}from"./copy-document-DOc9hYqD.js";import{u as wo}from"./useDocLink-Ksjh4w9I.js";const Lo=te({name:"CaretRight"}),$o={viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},Co=p("path",{fill:"currentColor",d:"M384 192v640l384-320.064z"},null,-1),Vo=[Co];function Eo(t,q,r,E,h,c){return v(),K("svg",$o,Vo)}var je=Qe(Lo,[["render",Eo]]);const Ro=te({name:"CircleCheckFilled"}),ko={viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},Do=p("path",{fill:"currentColor",d:"M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896zm-55.808 536.384-99.52-99.584a38.4 38.4 0 1 0-54.336 54.336l126.72 126.72a38.272 38.272 0 0 0 54.336 0l262.4-262.464a38.4 38.4 0 1 0-54.272-54.336L456.192 600.384z"},null,-1),Io=[Do];function Bo(t,q,r,E,h,c){return v(),K("svg",ko,Io)}var Mo=Qe(Ro,[["render",Bo]]);const Ao=te({name:"Loading"}),Fo={viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},Oo=p("path",{fill:"currentColor",d:"M512 64a32 32 0 0 1 32 32v192a32 32 0 0 1-64 0V96a32 32 0 0 1 32-32zm0 640a32 32 0 0 1 32 32v192a32 32 0 1 1-64 0V736a32 32 0 0 1 32-32zm448-192a32 32 0 0 1-32 32H736a32 32 0 1 1 0-64h192a32 32 0 0 1 32 32zm-640 0a32 32 0 0 1-32 32H96a32 32 0 0 1 0-64h192a32 32 0 0 1 32 32zM195.2 195.2a32 32 0 0 1 45.248 0L376.32 331.008a32 32 0 0 1-45.248 45.248L195.2 240.448a32 32 0 0 1 0-45.248zm452.544 452.544a32 32 0 0 1 45.248 0L828.8 783.552a32 32 0 0 1-45.248 45.248L647.744 692.992a32 32 0 0 1 0-45.248zM828.8 195.264a32 32 0 0 1 0 45.184L692.992 376.32a32 32 0 0 1-45.248-45.248l135.808-135.808a32 32 0 0 1 45.248 0zm-452.544 452.48a32 32 0 0 1 0 45.248L240.448 828.8a32 32 0 0 1-45.248-45.248l135.808-135.808a32 32 0 0 1 45.248 0z"},null,-1),qo=[Oo];function Po(t,q,r,E,h,c){return v(),K("svg",Fo,qo)}var rt=Qe(Ao,[["render",Po]]);const xo=te({name:"More"}),No={viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},Uo=p("path",{fill:"currentColor",d:"M176 416a112 112 0 1 0 0 224 112 112 0 0 0 0-224m0 64a48 48 0 1 1 0 96 48 48 0 0 1 0-96zm336-64a112 112 0 1 1 0 224 112 112 0 0 1 0-224zm0 64a48 48 0 1 0 0 96 48 48 0 0 0 0-96zm336-64a112 112 0 1 1 0 224 112 112 0 0 1 0-224zm0 64a48 48 0 1 0 0 96 48 48 0 0 0 0-96z"},null,-1),Qo=[Uo];function jo(t,q,r,E,h,c){return v(),K("svg",No,Qo)}var zo=Qe(xo,[["render",jo]]);const Ko=te({__name:"SourceCreate",props:{type:{}},setup(t,{expose:q}){const r=t,{tl:E}=be("RuleEngine"),h=J(()=>r.type||""),{formCom:c,formComProps:L}=ro(h),D=O(),m=O({}),{addSource:I,isTesting:d,testConnectivity:S}=co(),w=()=>({type:r.type,...W.cloneDeep(m.value)});return q({testConnection:async()=>{try{await nt(D.value),d.value=!0;const N=await w();return await S(N),Ke.success(E("connectionSuccessful")),d.value=!1,Promise.resolve()}catch{return d.value=!1,Promise.reject()}},submitNewSource:async()=>{try{await nt(D.value);const{id:N}=await I(w());return Promise.resolve(N)}catch(N){return console.error(N),Promise.reject(N)}},sourceRecord:m}),(N,s)=>(v(),H(De(e(c)),ct({ref_key:"FormComEl",ref:D,type:e(h),modelValue:e(m),"onUpdate:modelValue":s[0]||(s[0]=V=>ie(m)?m.value=V:null)},e(L)),null,16,["type","modelValue"]))}}),Go=ke(Ko,[["__scopeId","data-v-58d1a2bc"]]),Ho=te({__name:"RuleInputEventSelect",props:{modelValue:{},isEventDisabled:{type:Function}},emits:["update:modelValue"],setup(t,{emit:q}){const r=t,E=q,h=J({get(){return r.modelValue},set(w){E("update:modelValue",w)}}),c=O([]),{getEventList:L}=Be(),{eventDoNotNeedShow:D,isMsgPubEvent:m,getEventLabel:I}=yt();(async()=>{try{const w=await L();c.value=w.reduce((A,U)=>D.includes(U.event)||m(U.event)?A:[...A,W.pick(U,["description","event","sql_example","title"])],[])}catch{}})();const S=w=>!r.isEventDisabled||!W.isFunction(r.isEventDisabled)?!1:r.isEventDisabled(w)&&w!==r.modelValue;return(w,A)=>{const U=R("el-option"),N=R("el-select");return v(),H(N,{modelValue:e(h),"onUpdate:modelValue":A[0]||(A[0]=s=>ie(h)?h.value=s:null)},{default:a(()=>[(v(!0),K(de,null,he(e(c),s=>(v(),H(U,{key:s.event,value:s.event,label:("startCase"in w?w.startCase:e(W.startCase))(e(I)(s.title)),disabled:S(s.event)},null,8,["value","label","disabled"]))),128))]),_:1},8,["modelValue"])}}}),Yo={class:"type-opt-content vertical-align-center"},Wo=["src"],Jo={key:0,class:"source-content"},Xo={class:"detail-title"},Zo=te({__name:"RuleInputsDrawer",props:{modelValue:{type:Boolean},input:{},addedList:{}},emits:["update:modelValue","submit"],setup(t,{emit:q}){const r=t,E=q,h=J({get(){return r.modelValue},set(_){E("update:modelValue",_)}}),{t:c,tl:L}=be("RuleEngine"),{getBridgeIdFromInput:D,detectInputType:m,sourceOptList:I,getRuleSourceIcon:d}=gt(),S=J(()=>!!r.input),w=()=>{s.value={type:s.value.type,event:"",sourceId:"",topic:""}},A=()=>{w(),s.value.type=_e.Message},U=()=>{const{input:_}=r;if(!_)return;const f=m(_);s.value.type=f,f===_e.Event?s.value.event=_:f===_e.Message?s.value.topic=_:s.value.sourceId=D(_)};ce(h,_=>{_?U():A()});const N=I.map(({label:_,value:f})=>({value:f,label:_,icon:d(f)})),s=O({type:"",event:"",topic:"",sourceId:""}),{createRequiredRule:V}=bt(),$={type:V(L("inputType"),"select"),event:V(L("event"),"select"),topic:[...V(c("Base.topic")),{validator(_,f){var G;return(G=r.addedList)!=null&&G.includes(f)&&f!==r.input?[new Error(c("Flow.topicExistedError"))]:[]}}]},n=w,T=J(()=>r.addedList.reduce((_,f)=>{const G=m(f);return G===_e.Message||G===_e.Event?_:[..._,D(f)]},[])),l=_=>Array.isArray(r.addedList)&&r.addedList.includes(_),i=[_e.Message,_e.Event],g=J(()=>{const{type:_}=s.value;return _&&!i.includes(_)}),Q=J(()=>!s.value.sourceId),{handleConnDirection:z}=Ue();z(async(_,f,G)=>{_!==Ge.Egress&&(await Oe(800),h.value=!0,G&&(s.value.type=G),f&&(await Pe(),C.value.sourceRecord.connector=f))});const u=O(),C=O(),F=()=>{h.value=!1},y=O(!1),P=async()=>{var _;y.value=!0;try{const f=Q.value?C.value:u.value;await((_=f==null?void 0:f.testConnection)==null?void 0:_.call(f))}catch{}finally{y.value=!1}},B=J(()=>g.value&&Q.value?L("create"):S.value?c("Base.update"):c("Base.add")),X=O(),oe=O(!1),ve=async()=>{var _;try{const f=await((_=C.value)==null?void 0:_.submitNewSource());return Promise.resolve(f)}catch(f){return Promise.reject(f)}},x=async()=>{var _;try{const f=await((_=u.value)==null?void 0:_.updateSourceInfo());return Promise.resolve(f)}catch(f){return Promise.reject(f)}},b=async()=>{var _,f;try{await((f=(_=X.value)==null?void 0:_.validate)==null?void 0:f.call(_)),oe.value=!0;const{type:G,event:me,sourceId:se,topic:ge}=s.value;if(G===_e.Message)E("submit",ge);else if(G===_e.Event)E("submit",me);else{let ye=se;Q.value?ye=await ve():ye=await x();const $e=`${ut}${ye}`;E("submit",$e)}h.value=!1}catch{}finally{oe.value=!1}};return(_,f)=>{const G=R("el-option"),me=R("el-select"),se=R("el-form-item"),ge=R("el-col"),ye=R("el-input"),$e=R("el-row"),Ee=R("el-form"),Te=R("el-button"),re=R("el-drawer");return v(),H(re,{title:e(S)?e(L)("editInput"):e(L)("addInput"),modelValue:e(h),"onUpdate:modelValue":f[4]||(f[4]=Z=>ie(h)?h.value=Z:null),"lock-scroll":!1,size:"60%","destroy-on-close":""},{footer:a(()=>[e(g)?(v(),H(Te,{key:0,plain:"",type:"primary",loading:e(y),onClick:P},{default:a(()=>[Y(k(e(L)("testTheConnection")),1)]),_:1},8,["loading"])):ee("",!0),o(Te,{class:"btn-cancel",onClick:F},{default:a(()=>[Y(k(_.$t("Base.cancel")),1)]),_:1}),o(Te,{type:"primary",onClick:b,loading:e(oe)},{default:a(()=>[Y(k(e(B)),1)]),_:1},8,["loading"])]),default:a(()=>[o(Ee,{"label-position":"top","require-asterisk-position":"right",model:e(s),rules:$,ref_key:"FormCom",ref:X},{default:a(()=>[o($e,{gutter:26},{default:a(()=>[o(ge,{span:12},{default:a(()=>[o(se,{label:e(L)("inputType"),prop:"type"},{default:a(()=>[o(me,{modelValue:e(s).type,"onUpdate:modelValue":f[0]||(f[0]=Z=>e(s).type=Z),filterable:"",onChange:e(n)},{default:a(()=>[(v(!0),K(de,null,he(e(N),({value:Z,label:Se,icon:Ce})=>(v(),H(G,{key:Z,value:Z,label:Se},{default:a(()=>[p("div",Yo,[p("img",{class:"img-type-opt",width:"20",src:Ce},null,8,Wo),p("span",null,k(Se),1)])]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1},8,["label"])]),_:1}),o(ge,{span:12},{default:a(()=>[e(s).type===("RuleSourceType"in _?_.RuleSourceType:e(_e)).Event?(v(),H(se,{key:0,label:e(L)("event"),prop:"event"},{default:a(()=>[o(Ho,{modelValue:e(s).event,"onUpdate:modelValue":f[1]||(f[1]=Z=>e(s).event=Z),"is-event-disabled":l},null,8,["modelValue"])]),_:1},8,["label"])):e(s).type===("RuleSourceType"in _?_.RuleSourceType:e(_e)).Message?(v(),H(se,{key:1,label:e(c)("Base.topic"),prop:"topic"},{default:a(()=>[o(ye,{modelValue:e(s).topic,"onUpdate:modelValue":f[2]||(f[2]=Z=>e(s).topic=Z)},null,8,["modelValue"])]),_:1},8,["label"])):ee("",!0),e(g)?(v(),H(se,{key:2,label:"Source"},{default:a(()=>[o(so,{modelValue:e(s).sourceId,"onUpdate:modelValue":f[3]||(f[3]=Z=>e(s).sourceId=Z),type:e(s).type,"disable-list":e(T),direction:e(Ge).Ingress},null,8,["modelValue","type","disable-list","direction"])]),_:1})):ee("",!0)]),_:1})]),_:1})]),_:1},8,["model"]),e(g)?(v(),K("div",Jo,[e(Q)?(v(),H(Go,{key:1,ref_key:"SourceCreateRef",ref:C,type:e(s).type},null,8,["type"])):(v(),K(de,{key:0},[p("p",Xo,k(e(L)("confPreview")),1),o(io,{ref_key:"SourceDetailRef",ref:u,"source-id":e(s).sourceId,disabled:!e(S),"hide-name":""},null,8,["source-id","disabled"])],64))])):ee("",!0)]),_:1},8,["title","modelValue"])}}}),es=ke(Zo,[["__scopeId","data-v-2fd6827c"]]),ts={class:"rule-inputs rule-io"},os={class:"sub-block-desc"},ss={class:"io-item-main"},ns=["src"],as={class:"io-item-bd"},ls={class:"io-desc"},rs={class:"io-op"},is=te({__name:"RuleInputs",props:{modelValue:{},sourceList:{},disabled:{type:Boolean}},emits:["update:modelValue"],setup(t,{emit:q}){const r=t,E=q,{t:h,tl:c}=be("RuleEngine"),{state:L}=dt(),D=J(()=>L.lang==="zh"?"zh":"en"),m=J(()=>Re(r.modelValue));let I="";const d=O([]),S=J(()=>d.value.map(({value:x})=>x)),w=O([]),{getEventList:A}=Be();(async()=>{w.value=await A()})();const N=x=>{const b=w.value.find(_=>_.event===x);return W.startCase(b==null?void 0:b.title[D.value])},{getBridgeIdFromInput:s,detectInputType:V,getRuleSourceIcon:$,isBridgeType:n}=gt(),{getGeneralTypeLabel:T}=tt(),l=x=>{const b=V(x);let _="",f="";switch(b){case _e.Message:{_=c("message"),f=`${h("Base.topic")}: ${x}`;break}case _e.Event:{_=c("event");const G=N(x);f=G?`${h("RuleEngine.event")}: ${G}`:"";break}default:{const{name:G,type:me}=He(s(x));_=T(me),f=`${h("Base.name")}: ${G}`;break}}return{value:x,type:b,title:_,info:f,icon:$(b)}},{transFromStrToFromArr:i,transFromDataArrToStr:g,replaceTargetPartInSQL:Q}=Me(),z=()=>{I=r.modelValue;const{fromStr:x}=m.value;d.value=x?i(x).filter(Boolean).map(l):[]},u=x=>{const b=x.map(({value:G})=>G),_=g(b),f=Q(r.modelValue,qt.From,_);I=f,E("update:modelValue",f)},C=O(!1),F=O(-1),y=J(()=>{var x;return F.value<0||(x=d.value[F.value])==null?void 0:x.value}),P=x=>{F.value=x,C.value=!0},{confirmDel:B}=ht(),X=x=>{B(()=>(d.value.splice(x,1),u(d.value),Promise.resolve()),void 0,void 0)},oe=()=>{F.value=-1,C.value=!0},ve=x=>{F.value<0?d.value.push(l(x)):d.value[F.value]=l(x),u(d.value)};return ce(()=>r.modelValue,x=>{x!==I&&z()}),z(),(x,b)=>{const _=R("el-button"),f=pt,G=R("el-col"),me=R("el-row");return v(),K(de,null,[p("div",ts,[p("div",os,[p("span",null,k(e(c)("dataInputDesc")),1)]),o(me,null,{default:a(()=>[o(G,{span:24},{default:a(()=>[(v(!0),K(de,null,he(e(d),(se,ge)=>(v(),H(De(e(n)(se.type)?"router-link":"div"),{key:se,class:"io-item",to:{name:"source-detail",params:{id:e(s)(se.value)}},target:"_blank"},{default:a(()=>[p("div",ss,[p("img",{class:"img-io-item",src:se.icon},null,8,ns),p("div",as,[p("div",null,k(se.title),1),p("div",ls,k(se.info),1)]),p("span",rs,[o(_,{size:"small",disabled:x.disabled,onClick:xe(ye=>P(ge),["prevent"])},{default:a(()=>[Y(k(x.$t("Base.edit")),1)]),_:2},1032,["disabled","onClick"]),o(_,{size:"small",plain:"",disabled:!x.$hasPermission("put")||x.disabled,onClick:xe(ye=>X(ge),["prevent"])},{default:a(()=>[Y(k(x.$t("Base.delete")),1)]),_:2},1032,["disabled","onClick"])])])]),_:2},1032,["to"]))),128)),o(f,{class:"btn-add",disabled:!x.$hasPermission("post")||x.disabled,onClick:b[0]||(b[0]=se=>oe())},{default:a(()=>[Y(k(e(c)("addInput")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),o(es,{modelValue:e(C),"onUpdate:modelValue":b[1]||(b[1]=se=>ie(C)?C.value=se:null),input:e(y),"added-list":e(S),onSubmit:ve},null,8,["modelValue","input","added-list"])],64)}}}),cs=ke(is,[["__scopeId","data-v-5e49d1ed"]]),us={class:"rule-outputs rule-io"},ds={class:"sub-block-desc"},ps=["src"],ms={class:"io-item-bd"},_s={key:0},fs={class:"io-desc"},vs={class:"io-op"},gs={class:"fallback-container"},ys={class:"editor-label"},bs=te({name:"RuleOutputs"}),hs=te({...bs,props:{modelValue:{type:Object,required:!0},disabled:{type:Boolean}},emits:["update:modelValue"],setup(t,{emit:q}){const r=":",E=t,h=q,c=J({get(){return E.modelValue},set(y){h("update:modelValue",y)}});ce(()=>{var y,P;return(P=(y=E.modelValue)==null?void 0:y.actions)==null?void 0:P.length},()=>{z()});const{tl:L,t:D}=be("RuleEngine"),m=O(!1),I=O([]),d=O(!1),S=O(void 0),w=O(void 0),{getBridgeIconKey:A}=po(),{getGeneralTypeLabel:U}=tt(),N=()=>{var y;I.value=[],Array.isArray(c.value.actions)&&((y=c.value.actions)==null||y.forEach(P=>{if(typeof P=="string")I.value.push(P);else if(typeof P=="object"){if(P.function===fe.Republish)return;P.function&&I.value.push(P.function)}}))},s=async(y=!1,P)=>{var X;m.value=!0;let B;S.value=P,P!==void 0&&Array.isArray(c.value.actions)&&(B=(X=c.value.actions)==null?void 0:X[P]),y?(d.value=y,w.value=B):(d.value=!1,w.value=void 0),N()},V=async y=>{var P;try{await mt.confirm(D("Base.confirmDelete"),{confirmButtonText:D("Base.confirm"),cancelButtonText:D("Base.cancel"),confirmButtonClass:"confirm-danger",type:"warning"}),y!==void 0&&Array.isArray(c.value.actions)&&((P=c.value.actions)==null||P.splice(y,1),N())}catch{}},$=(y,P)=>{const B=c.value.actions||[];Array.isArray(B)&&(!w.value||!P?B.push(y):S.value!==void 0&&B.splice(S.value,1,y)),z(),N()},{judgeOutputType:n}=eo(),T=y=>n(y)===fe.DataBridge,l=y=>{if(!y)return"";const P=n(y);let B="";switch(P){case fe.DataBridge:B=A(y.split(r)[0]);break;case fe.Console:B=y.function;break;case fe.Republish:B=y.function;break}try{return Pt(`img/${B}.png`)}catch(X){console.log("ImgErr:",X)}},i=y=>{if(!y)return"";switch(n(y)){case fe.DataBridge:return U(y.split(r)[0]);case fe.Console:return L("consoleOutput");case fe.Republish:return L("republish")}},g=O(new Map),{getDetail:Q}=Ue(),z=async()=>{var y;(y=E.modelValue.actions)==null||y.forEach(async P=>{if(n(P)===fe.DataBridge&&!g.value.has(P)){const B=await Q(P,{errorsHandleCustom:[404]});g.value.set(P,B)}})};z();const u=y=>{var P;return((P=g.value.get(y))==null?void 0:P.fallback_actions)??[]},{updateAction:C}=Ue(),F=async(y,P)=>{try{const B=g.value.get(y),X=await C({...B,fallback_actions:P});g.value.set(_t(X),X)}catch{}};return(y,P)=>{const B=R("el-button"),X=R("el-divider"),oe=pt,ve=R("el-col"),x=R("el-row");return v(),K(de,null,[p("div",us,[p("div",ds,[p("span",null,k(e(L)("actionDesc")),1)]),o(x,null,{default:a(()=>[o(ve,{span:24},{default:a(()=>[(v(!0),K(de,null,he(e(c).actions,(b,_)=>(v(),K("div",{key:b,class:"io-item"},[(v(),H(De(T(b)?"router-link":"div"),{class:"io-item-main",to:{name:"action-detail",params:{id:b}},target:"_blank"},{default:a(()=>[p("img",{src:l(b)},null,8,ps),p("div",ms,[T(b)?(v(),K("div",_s,k(b.split(r)[1]),1)):ee("",!0),p("div",fs,k(i(b)),1)]),p("span",vs,[o(B,{size:"small",disabled:t.disabled,onClick:xe(f=>s(!0,_),["prevent"])},{default:a(()=>[Y(k(y.$t("Base.edit")),1)]),_:2},1032,["disabled","onClick"]),o(B,{size:"small",plain:"",disabled:!y.$hasPermission("put")||t.disabled,onClick:xe(f=>V(_),["prevent"])},{default:a(()=>[Y(k(y.$t("Base.delete")),1)]),_:2},1032,["disabled","onClick"])])]),_:2},1032,["to"])),T(b)?(v(),K(de,{key:0},[o(X),p("div",gs,[p("label",ys,k(e(L)("fallbackActions")),1),o(ao,{"model-value":u(b),"action-key":b,readonly:t.disabled,"in-rule-outputs":"","onUpdate:modelValue":f=>F(b,f)},null,8,["model-value","action-key","readonly","onUpdate:modelValue"])])],64)):ee("",!0)]))),128)),o(oe,{class:"btn-add",disabled:!y.$hasPermission("post")||t.disabled,onClick:P[0]||(P[0]=b=>s(!1))},{default:a(()=>[Y(k(e(L)("addAction")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),o(no,{modelValue:e(m),"onUpdate:modelValue":P[1]||(P[1]=b=>ie(m)?m.value=b:null),output:e(w),"output-disable-list":e(I),edit:e(d),onSubmit:$},null,8,["modelValue","output","output-disable-list","edit"])],64)}}}),Ts=ke(hs,[["__scopeId","data-v-f583c5c3"]]),Ss={class:"sub-block-hd"},ws={class:"hd-title"},Ls={class:"input-container"},$s={class:"sub-block-hd"},Cs={class:"hd-title"},Vs={class:"usage-desc"},Es={class:"sub-block-hd"},Rs={class:"hd-title"},ks={class:"input-container"},Ds={class:"sub-block-hd"},Is={class:"hd-title"},Bs={class:"input-container"},Ms=te({__name:"SQLTemplateDrawer",props:{modelValue:{type:Boolean}},emits:["update:modelValue","use-sql","test-sql"],setup(t,{emit:q}){const{t:r,locale:E}=Ze(),h=(S,w="RuleEngine")=>r(`${w}.${S}`),c=O([]),L=t,D=q,m=J({get(){return L.modelValue},set(S){D("update:modelValue",S)}}),I=()=>{c.value=xt.map(S=>{const{title:w,scene:A,input:U,outputs:N,sql:s}=S,V=E.value==="zh"?"zh":"en";return{sql:s,title:w[V],scene:A[V],input:at(U,2),outputs:at(N,2)}})},d=S=>{D("use-sql",S),m.value=!1};return I(),(S,w)=>{const A=R("el-button"),U=Tt,N=R("el-collapse-item"),s=R("el-collapse"),V=R("el-drawer");return v(),H(V,{modelValue:e(m),"onUpdate:modelValue":w[0]||(w[0]=$=>ie(m)?m.value=$:null),title:h("commonSQLTemplates"),class:"SQL-template-drawer",size:660},{default:a(()=>[o(s,{class:"collapse-border"},{default:a(()=>[(v(!0),K(de,null,he(e(c),$=>(v(),H(N,{key:$.title,title:$.title,name:$.title},{default:a(()=>[p("section",null,[p("div",Ss,[p("p",ws,k(h("SQL")),1),p("div",null,[o(A,{size:"small",disabled:!S.$hasPermission("put"),onClick:n=>d($.sql)},{default:a(()=>[Y(k(h("useSQL")),1)]),_:2},1032,["disabled","onClick"])])]),p("div",Ls,[o(U,{code:$.sql,lang:"sql"},null,8,["code"])])]),p("section",null,[p("div",$s,[p("p",Cs,k(h("usageScenarios")),1)]),p("p",Vs,k($.scene),1)]),p("section",null,[p("div",Es,[p("p",Rs,k(h("exampleOfInput")),1)]),p("div",ks,[o(U,{code:$.input,lang:"json"},null,8,["code"])])]),p("section",null,[p("div",Ds,[p("p",Is,k(h("processedResults")),1)]),p("div",Bs,[o(U,{code:$.outputs,lang:"json"},null,8,["code"])])])]),_:2},1032,["title","name"]))),128))]),_:1})]),_:1},8,["modelValue","title"])}}}),As={class:"option-content"},Fs={class:"item-id"},Os=te({name:"FromSelect"}),qs=te({...Os,props:{modelValue:{type:String,required:!0},ingressBridgeList:{type:Array},eventList:{type:Array},forTest:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(t,{emit:q}){const r=t,E=q,h=Ze().locale,{tl:c}=be("RuleEngine"),L=O(),D=O(!1),m=Ie(),{getEventForShow:I}=Me(),d=J({get(){return N.value===m?c("customTopic"):r.modelValue},set(u){if(u===m){E("update:modelValue",""),N.value=m;return}N.value="",E("update:modelValue",u)}}),S=O(""),w=O(!1),A=/^\$bridges\//,U=J(()=>{var u;return(u=r.eventList)==null?void 0:u.filter(({event:C})=>!A.test(C)).filter(({title:C,event:F})=>C[h.value].indexOf(S.value)>-1||F.lastIndexOf(S.value)>-1)}),N=O(""),s=J(()=>D.value?d.value:m),V=J(()=>D.value?d.value:c("customTopic")),$=O(!1),n=O(ae.Topic);ce(()=>r.modelValue,u=>{N.value!==m&&z()}),ce(()=>r.ingressBridgeList,()=>{z()}),ce(()=>r.eventList,()=>{z()});const T=u=>{S.value=u},l=async()=>{await Pe(),$.value=!0,L.value.blur(),await Pe(),L.value.focus()},i=u=>{const{ingressBridgeList:C=[],eventList:F=[]}=r,y=F.find(({title:B})=>B[h.value]===u);if(y)return{type:ae.Event,target:y};const P=C.find(({name:B})=>B===u);return P?{type:ae.Bridge,target:P}:{type:ae.Topic,target:u}},g=async()=>{await Oe(200);const u=w.value;u&&await Oe();let{value:C}=L.value.$el.querySelector("input");const{type:F,target:y}=i(C);F===ae.Topic&&u||(F===ae.Topic?d.value=C:($.value=!1,d.value=F===ae.Event?y.event:y.idForRuleFrom,C=d.value),L.value.blur(),E("change",{value:C,type:F}),window.setTimeout(()=>{$.value=!1},100),S.value="")},Q=async u=>{w.value=!0,D.value=u===ae.Topic,D.value&&l(),n.value=u,await Oe(600),w.value=!1},z=()=>{const{ingressBridgeList:u,eventList:C,modelValue:F}=r;if(D.value=!1,!!F){if(u!=null&&u.some(({idForRuleFrom:y})=>y===F)){n.value=ae.Bridge;return}if(C!=null&&C.some(({event:y})=>y===F)){n.value=ae.Event;return}D.value=!0}};return z(),(u,C)=>{const F=R("el-option"),y=R("el-option-group"),P=R("el-select");return v(),H(P,{ref_key:"selectCom",ref:L,class:"from-select",modelValue:e(d),"onUpdate:modelValue":C[2]||(C[2]=B=>ie(d)?d.value=B:null),filterable:"",onKeyup:Nt(g,["enter"]),onBlur:g,"popper-class":`from-select-popper ${e($)?"is-hidden":""}`,"filter-method":T},{default:a(()=>[t.forTest?ee("",!0):(v(),H(y,{key:e(m),label:e(c)("customTopic")},{default:a(()=>[(v(),H(F,{key:e(s),label:e(V),value:e(s),onClick:C[0]||(C[0]=B=>Q(e(ae).Topic))},{default:a(()=>[Y(k(e(c)("customTopic")),1)]),_:1},8,["label","value"]))]),_:1},8,["label"])),e(U)&&e(U).length?(v(),H(y,{key:e(c)("clientEvent"),label:e(c)("clientEvent")},{default:a(()=>[(v(!0),K(de,null,he(e(U),B=>(v(),H(F,{key:B.event,value:B.event,label:B.title[e(h)],onClick:C[1]||(C[1]=X=>Q(e(ae).Event))},{default:a(()=>[p("div",As,[p("p",null,k(B.title[e(h)]),1),p("span",Fs,k(e(I)(B.event)),1)])]),_:2},1032,["value","label"]))),128))]),_:1},8,["label"])):ee("",!0)]),_:1},8,["modelValue","popper-class"])}}}),St=ke(qs,[["__scopeId","data-v-8f64c752"]]),Ps=""+new URL("log-placeholder-B8v1o9tN.png",import.meta.url).href,xs=["call_action_function","republish_message","publish_to","bridge_action","http_connector_received","async_send_msg_to_remote_node"],Ns=["out_of_service","recursive_republish_detected"],it=["rule_activated","SELECT_clause_exception","WHERE_clause_exception","FOREACH_clause_exception","INCASE_clause_exception","apply_rule_failed","SQL_yielded_result","SQL_yielded_no_result"],ue={Rule:"rule",Console:fe.Console,Republish:fe.Republish,Action:fe.DataBridge},Us=t=>t.meta.reason?t.msg==="action_stopped_after_template_rendering":!Ns.includes(t.msg),Qs=t=>{for(const q of t){if(q.msg==="SQL_yielded_no_result")return le.NoResult;if(q.meta.reason)return le.Error}return le.OK},js=t=>t.length===0||t.every(({meta:q,msg:r})=>!q.result&&!q.reason&&r!=="out_of_service")?le.Pending:t.every(Us)?le.OK:le.Error,wt=new Map([["rule_activated","meta.input"],["SQL_yielded_result","meta.result"],["SELECT_clause_exception","meta"],["WHERE_clause_exception","meta"],["FOREACH_clause_exception","meta"],["INCASE_clause_exception","meta"],["apply_rule_failed","meta"]]),zs=()=>{const t=n=>n.split(`
`).filter(Boolean).map(T=>JSON.parse(T)),q=n=>{var l;const T=n.find(i=>i.msg==="rule_activated");if(T){const{event:i,topic:g}=((l=T.meta)==null?void 0:l.input)||{};return{event:i,topic:g}}return{}},r=n=>{var T;if(n.meta.action_info&&!it.includes(n.msg)){const{type:l,name:i,func:g,args:Q}=n.meta.action_info;return l&&i?{target:_t({type:l,name:i}),type:ue.Action,targetInfo:{type:l,name:i}}:g===fe.Republish&&Q.topic?{target:`${g}:${Q.topic}`,type:ue.Republish,targetInfo:{topic:Q.topic,func:g}}:{target:g,type:ue.Console,targetInfo:{func:g}}}return{target:n.meta.rule_id||((T=n.meta.rule_ids)==null?void 0:T[0]),type:ue.Rule}},E=new Map([["rule_activated",99]]),h=n=>Object.keys(n).sort((T,l)=>(E.get(T)||0)-(E.get(l)||0)).reduce((T,l)=>{const i=n[l],{logContent:g}=i,Q=wt.get(g.msg);return Q&&(i.logContent=W.get(g,Q)),T[l]=i,T},{}),c=n=>n,L=n=>n,D=n=>n,m=n=>(Object.values(n).forEach(T=>{const{logContent:l}=T;["action_success","action_template_rendered"].includes(l.msg)&&(T.logContent=l.meta.result)}),n),I=new Map([[Ne.MQTT,D],[Ne.Webhook,m]]),d=n=>{const{targetInfo:T}=n,{type:l}=T||{};if(l){const i=I.get(l);i&&(n.info=i(n.info))}return n},S=n=>{const{type:T,info:l}=n;T===ue.Rule?n.info=h(l):T===ue.Console?n.info=c(l):T===ue.Republish?n.info=L(l):T===ue.Action&&d(n)},w=[le.Error,le.Pending,le.NoResult],A=n=>{for(const T of w)if(n.includes(T))return T;return le.OK},U=n=>{const T=[];return n.forEach(l=>{const{rule_trigger_ts:i}=l.meta;i.forEach(g=>{T.push({...l,meta:{...l.meta,_timestamp:g}})})}),T},N=({meta:n})=>n._timestamp,s=(n,T)=>n.filter(({meta:l})=>{l.rule_trigger_ts=l.rule_trigger_ts.filter(g=>g>=T);const{rule_trigger_ts:i}=l;return i.length&&i.some(g=>g>=T)}),V=n=>{let T=!1;return xs.includes(n.msg)&&(T=!0),(/connector/i.test(n.msg)||n.meta.connector||/msg =>/.test(n.msg)||!it.includes(n.msg))&&!n.meta.action_info&&(console.warn(n),T=!0),T};return{convertLogStrToLogArr:t,filterExpiredLog:s,detectTotalLogResult:A,formatLog:n=>{const T={},l=W.groupBy(U(n),N);return Object.entries(l).forEach(([i,g])=>{const Q=g.reduce((z,u)=>{const{target:C,type:F,targetInfo:y={}}=r(u);return z[C]||(z[C]={result:le.OK,type:F,target:C,targetInfo:y,info:{},rawLogArr:[]}),V(u)||(z[C].info[u.msg]={time:u.time,logContent:u},z[C].rawLogArr.push(u)),z},{});Object.entries(Q).forEach(([z,u])=>{const{type:C,rawLogArr:F}=u;Q[z].result=(C===ue.Rule?Qs:js)(F),S(u)}),T[i]={result:A(Object.values(Q).map(({result:z})=>z)),trigger:q(g),info:Q}}),T}}},Ks=()=>{const{tl:t}=be("RuleEngine"),q=new Map([["action_template_rendered",t("requestParameter")],["action_success",t("actionExecutionLog")],["out_of_service",t("actionOutOfService")],["action_failed",t("actionFailed")],["request_expired",t("requestExpired")]]),r=new Map([["rule_activated",t("eventData")]]),E=V=>{const $=r.get(V);return $||t("executionResult")},h=new Map([["action_template_rendered",t("requestParameter")],["recursive_republish_detected",t("recursiveRepublishDetected")]]),c=V=>{let $=h.get(V);if(!$){const n=q.get(V);n&&($=n)}return $||W.startCase(V)},L=new Map([["action_template_rendered",t("consoleActionTemplateRendered")],["action_success",t("actionExecutionLog")]]),D=V=>{const $=L.get(V);return $||W.startCase(V)},m=new Map([["action_success",t("responseResult")],["action_stopped_after_template_rendering",t("responseResult")]]),I=new Map([[Ne.Webhook,m]]),d=(V,$)=>{const{type:n}=V.targetInfo||{};let T;if(n){const l=I.get(n);if(l){const i=l.get($);i&&(T=i)}}if(!T){const l=q.get($);l&&(T=l)}return T||W.startCase($)},S=(V,$)=>{const{type:n}=V;return n===ue.Rule?E($):n===ue.Republish?c($):n===ue.Console?D($):n===ue.Action?d(V,$):W.startCase($)},w=(V,$)=>{if(V==="SQL_yielded_no_result")return`SQL ${t("failedNoResult")}`;const n=wt.get(V);if(n==="meta"&&$.reason||!n&&$.meta.reason)return`SQL ${t("failedException")}
${$.reason||$.meta.reason}`},A=(V,$)=>{if($==="action_stopped_after_template_rendering")return t("stoppedRendering")},U=new Map([[Ne.Webhook,A]]),N=(V,$)=>{const{type:n}=V.targetInfo||{};let T="";if(n){const l=U.get(n);l&&(T=l(V,$))}return T};return{getLogItemTitle:S,getLogItemContent:(V,$,n)=>{let T;const{type:l}=V;return l===ue.Rule?T=w($,n):l===ue.Action&&(T=N(V,$)),T||ft(W.omit(n,["_timestamp","meta._timestamp"]),2)}}},Gs=Math.pow(2,30),Hs=()=>{let t="",q;const r=O({}),E=()=>{r.value={}},h=async()=>{try{t&&(await mo(t),t="",q=void 0,window.removeEventListener("beforeunload",h))}catch{}},c=async i=>{try{h();const g=new Date().getTime(),Q=g+24*60*60*1e3,z={name:`DEBUG_RULE_${i}_${Ut().format("YYYYMMDD_HHmmssSSS")}`,type:"ruleid",ruleid:i,payload_encode:Qt.Text,start_at:new Date().toISOString(),end_at:new Date(Q).toISOString(),formatter:jt.JSON},{name:u}=await _o(z);return E(),t=u,q=g,window.addEventListener("beforeunload",h),Promise.resolve()}catch(g){return Promise.reject(g)}},L=i=>W.startCase(i.msg),{convertLogStrToLogArr:D,filterExpiredLog:m,formatLog:I,detectTotalLogResult:d}=zs(),S=(i,g)=>{if(W.isArray(i)&&W.isArray(g))return i.concat(g)},w=(i,g)=>{const Q=W.mergeWith(i,g,S);return Object.values(Q).forEach(z=>{z.result=d(Object.values(z.info).map(({result:u})=>u))}),Q},A=new Map,U=async()=>{try{if(!t)return Promise.reject();const i=await vo(t),g=i.map(({node:Q})=>Q);A.forEach((Q,z)=>{g.includes(z)||A.delete(z)}),i.forEach(({node:Q})=>{A.has(Q)||A.set(Q,0)})}catch{}},N=async()=>{try{return await U(),s.value?(A.forEach(async(i,g)=>{const{items:Q,meta:z}=await fo(t,{node:g,bytes:Gs,position:i}),u=D(Q),C=q?m(u,q):u,F=I(C);r.value=w(r.value,F),A.set(g,z.position)}),Promise.resolve()):void 0}catch{return Promise.reject()}},{needPolling:s,syncPolling:V}=go();s.value=!1;const $=()=>{V(N,1500)},n=(i,g)=>to(i,g),T=async i=>{try{await c(i),s.value||(s.value=!0,$())}catch{}},l=()=>{s.value=!1,A.clear(),h()};return et(()=>{s.value&&(s.value=!1),h()}),{logData:r,emptyLogArr:E,handleStopTest:l,getLogItemTitle:L,submitMockDataForTestRule:n,startTest:T}},ze=t=>{const{state:q,commit:r,getters:E}=dt(),h=J({get(){return q.isTesting},set(w){r("SET_IS_TESTING",w)}}),c=J({get(){return q.savedAfterDataChange},set(w){r("SET_SAVED_AFTER_DATA_CHANGE",w)}}),L=J({get(){return q.testRuleTarget},set(w){r("SET_TEST_RULE_TARGET",w)}}),D=J(()=>E.isDataSaveButtonDisabled),m=O(t&&t.value||void 0),I=w=>{c.value=W.isEqual(w,t==null?void 0:t.value),m.value=W.cloneDeep(w)},d=()=>{c.value=W.isEqual(m.value,t==null?void 0:t.value)},S=W.debounce(d,300);return t&&ce(t,S),{isTesting:h,savedAfterDataChange:c,testTarget:L,isDataSaveButtonDisabled:D,updateSavedData:I}},Lt=t=>{const{tl:q,t:r}=be("RuleEngine"),E=O([]),h=J(()=>{var u;return((u=t.ruleData)==null?void 0:u.sql)||""}),c=O({context:{}}),L=O(null),D=J(()=>L.value?!W.isEqual(c.value,L.value):!1),m=O(""),I=O(!1),{getEventList:d}=Be(),S=async()=>{try{E.value=await d()}catch(u){console.error(u)}},{TOPIC_EVENT:w,findInputTypeNTarget:A,getTestColumns:U,transFromStrToFromArr:N}=Me(),s=u=>A(u,E.value,t.ingressBridgeList),V=()=>{mt.confirm(q("confirmReset"),{confirmButtonText:r("Base.confirm"),cancelButtonText:r("Base.cancel"),type:"warning"}).then(()=>{T({value:m.value})}).catch(()=>{})},$=u=>{c.value.context=u,L.value=W.cloneDeep(c.value)},n=(u,C,F)=>{const P=N(F).map(X=>{const{type:oe}=s(X);return oe===ae.Topic?w:X});let B="";switch(u){case ae.Topic:B=C;break;case ae.Event:B=C.event;break;case ae.Bridge:B=C.idForRuleFrom;break}return P.includes(B)},T=({value:u})=>{const{type:C,target:F}=s(u),{fromStr:y}=Re(h.value);I.value=!n(C,F,y);const{context:P}=U(C,u,E.value||[]);$(P)},l=u=>{const{type:C,target:F}=s(m.value),{fromStr:y}=Re(u);I.value=!n(C,F,y)},i=()=>{var F,y;const{type:u,target:C}=s(m.value);return u===ae.Event?(F=m.value.match(/\w+$/))==null?void 0:F[0]:u===ae.Bridge?`$bridges/${C.type}:*`:(y=w.match(/(\$events\/)([\w]+)/))==null?void 0:y[2]},g=()=>({...c.value.context,event_type:i()}),Q=(u,C)=>{u===ae.Topic?m.value=w:u===ae.Bridge?m.value=zt.MessagePublish:m.value=C},z=()=>{const{fromStr:u}=Re(h.value),[C=""]=N(u),{type:F}=s(C),{context:y}=U(F,C,E.value);Q(F,C),c.value={context:y}};return ce(()=>E.value,()=>{T({value:m.value})}),ce(h,u=>{l(u)}),ce(m,u=>{T({value:u})}),S(),{ruleSql:h,dataType:m,testParams:c,isDataTypeNoMatchSQL:I,eventList:E,isFormModified:D,resetContext:V,getMockContext:g,setDataTypeNContext:z}},Ys={key:0,class:"log-data-left"},Ws={class:"execution-list"},Js=["onClick"],Xs={class:"execution-item-base vertical-align-center"},Zs={class:"base-info event"},en={key:0,class:"base-info topic"},tn={class:"topic-container"},on={class:"execution-item-time"},sn={class:"info-wrap"},nn={key:0,class:"loading-container"},an={class:"space-between target-info-hd"},ln={key:1,class:"log-item-title"},rn={class:"info-content"},cn={key:2,class:"empty-placeholder"},un={class:"img-container"},dn={class:"tip"},pn={class:"btn-wrap"},mn=te({__name:"LogDataDisplay",props:{logData:{},isTestStarted:{type:Boolean},isFlow:{type:Boolean}},emits:["input-simulated-data","start-test"],setup(t,{emit:q}){const r=t,E=q,{t:h,tl:c}=be("RuleEngine"),L=J(()=>I.value?r.isTestStarted?c("tipForTesting"):c("noLogDataTip"):c("pleaseSaveFirst")),{getGeneralTypeLabel:D}=tt(),{getEventList:m}=Be(),{savedAfterDataChange:I}=ze();let d=new Map;const S=/^\$events\/([^._]+)_/,w=b=>b.replace(S,(_,f)=>`${f}.`);(async()=>d=(await m()).reduce((_,f)=>{const G=w(f.event);return _.set(G,f),_},new Map))();const A=new RegExp(`^${W.escapeRegExp(ut)}`),{getEventLabel:U}=yt(),N=b=>{if(A.test(b)){const f=b.replace(A,""),{type:G}=He(f);return D(G)}const _=d.get(b);return _?U(_.title):b},s=new Map([[ue.Rule,c("ruleExec")],[ue.Console,c("consoleOutput")],[ue.Republish,c("republish")]]),V=({type:b,target:_})=>{const f=s.get(b);if(f)return f;try{const{type:G}=He(_);return D(G)}catch{return _}},$=new Map([[le.OK,Mo],[le.Pending,rt],[le.Error,yo],[le.NoResult,bo]]),n=b=>$.get(b),T=new Map([[le.OK,"icon-suc"],[le.Pending,"icon-pending"],[le.Error,"icon-fail"],[le.NoResult,"icon-no-result"]]),l=b=>T.get(b),i=b=>b&&typeof b=="object"&&Object.keys(b).length>1,g=b=>b.result===le.Pending&&Object.keys(b.info).length===0,Q=O({}),z=(b,_)=>`${b}.${_}`,u=b=>{if(!B.value||!oe.value)return;const _=B.value,f=Object.keys(oe.value[b].info),G=W.get(Q.value,z(_,b));if(G)return G;{const me=f[0];return F(b,me),me}},C=b=>{var G;if(!oe.value)return;const _=u(b),f=oe.value[b]||{};return P(f,_,(G=f.info[_])==null?void 0:G.logContent)},F=(b,_)=>{const f=B.value;f&&W.set(Q.value,z(f,b),_)},{getLogItemTitle:y,getLogItemContent:P}=Ks(),B=O(null),X=J(()=>B.value?r.logData[B.value]:null),oe=J(()=>X.value?X.value.info:null),ve=b=>{B.value=b.toString()},x=()=>{E("start-test")};return ce(()=>typeof r.logData=="object"?Object.keys(r.logData).length:0,b=>{b>0&&!B.value?B.value=Object.keys(r.logData)[0]:b===0&&B.value&&(B.value=null)}),(b,_)=>{const f=R("el-icon"),G=R("el-tooltip"),me=R("el-radio-button"),se=R("el-radio-group"),ge=Tt,ye=R("el-collapse-item"),$e=R("el-collapse"),Ee=R("el-card"),Te=R("el-button");return v(),H(Ee,{class:"log-data-display"},{default:a(()=>[Object.keys(b.logData).length?(v(),K("div",Ys,[p("ul",Ws,[(v(!0),K(de,null,he(b.logData,(re,Z)=>(v(),K("li",{class:qe(["execution-item space-between",{"is-selected":Z===e(B)}]),key:Z,onClick:Se=>ve(Z)},[p("div",Xs,[o(f,{class:"icon-status",size:16},{default:a(()=>[(v(),H(De(n(re.result)),{class:qe(l(re.result))},null,8,["class"]))]),_:2},1024),p("div",Zs,[p("p",null,k(N(re.trigger.event||"")),1)]),re.trigger.topic?(v(),K("div",en,[o(G,{class:"box-item",content:`${e(h)("Base.topic")}: ${re.trigger.topic}`},{default:a(()=>[p("p",tn,k(e(h)("Base.topic"))+": "+k(re.trigger.topic),1)]),_:2},1032,["content"])])):ee("",!0)]),p("div",on,k(("dateFormat"in b?b.dateFormat:e(Kt))(Number(Z))),1)],10,Js))),128))])])):ee("",!0),Object.keys(b.logData).length&&e(oe)?(v(),H(Ee,{class:"log-data-right",key:e(B)},{default:a(()=>[o($e,{class:"execution-log-content"},{default:a(()=>[(v(!0),K(de,null,he(e(oe),(re,Z)=>(v(),H(ye,{key:Z,name:Z},{title:a(()=>[o(f,{class:"icon-status"},{default:a(()=>[(v(),H(De(n(re.result)),{class:qe(l(re.result))},null,8,["class"]))]),_:2},1024),Y(" "+k(V(re)),1)]),default:a(()=>[p("div",sn,[g(re)?(v(),K("div",nn,[o(f,null,{default:a(()=>[o(e(rt),{class:"icon-pending"})]),_:1})])):(v(),K(de,{key:1},[p("div",an,[i(re.info)?(v(),H(se,{key:0,modelValue:u(Z),size:"small","onUpdate:modelValue":Se=>F(Z,Se)},{default:a(()=>[(v(!0),K(de,null,he(re.info,(Se,Ce)=>(v(),H(me,{key:Ce,value:Ce},{default:a(()=>[Y(k(e(y)(re,Ce)),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):(v(),K("p",ln,k(e(y)(re,u(Z))),1))]),p("div",rn,[o(ge,{code:C(Z)},null,8,["code"])])],64))])]),_:2},1032,["name"]))),128))]),_:1})]),_:1})):ee("",!0),Object.keys(b.logData).length?ee("",!0):(v(),K("div",cn,[p("div",un,[_[0]||(_[0]=p("img",{class:"img-placeholder",width:"520",src:Ps,alt:"empty_placeholder"},null,-1)),p("p",dn,k(e(L)),1)]),p("div",pn,[!b.isTestStarted&&!b.isFlow?(v(),H(Te,{key:0,type:"primary",plain:"",icon:e(je),disabled:!e(I),onClick:x},{default:a(()=>[Y(k(e(c)("startTest")),1)]),_:1},8,["icon","disabled"])):ee("",!0)])]))]),_:1})}}}),_n={key:1,class:"handler"},fn=te({__name:"Resizer",props:{modelValue:{},min:{default:40},max:{},isForward:{type:Boolean},forMonaco:{type:Boolean}},emits:["update:modelValue","resize"],setup(t,{emit:q}){const r=t,E=q,h=O();let c=0;function L(d){E("update:modelValue",d)}const D=d=>{const S=r.max||Number.MAX_SAFE_INTEGER,w=Math.floor(d.pageY)-c;let A=r.modelValue+(r.isForward?w:-w);A<=r.min?A=r.min:A>=S&&(A=S),L(A),c=Math.floor(d.pageY)},m=()=>{window.removeEventListener("mousemove",D),window.removeEventListener("mouseup",m),E("resize",r.modelValue)},I=d=>{c=Math.floor(d.pageY),window.addEventListener("mousemove",D),window.addEventListener("mouseup",m),d.preventDefault()};return et(()=>{window.removeEventListener("mousemove",D)}),(d,S)=>{const w=R("el-icon");return v(),K("div",{ref_key:"ResizerRef",ref:h,class:qe(["resizer",{"monaco-resizer":d.forMonaco}]),onMousedown:I},[d.forMonaco?(v(),H(w,{key:0},{default:a(()=>[o(e(zo))]),_:1})):(v(),K("div",_n))],34)}}}),vn={class:"test-sql-context-form"},gn={class:"payload-type"},yn=te({name:"TestSQLContextForm"}),bn=te({...yn,props:{modelValue:{type:Object,required:!0}},emits:["update:modelValue"],setup(t,{emit:q}){let r;(d=>{d.JSON="json",d.Plaintext="plaintext"})(r||(r={}));const E=t,h=q,c=O("json"),L=O(200),D=d=>typeof d!="object"?d:Object.entries(d).reduce((S,[w,A])=>(S[w]=typeof A=="object"?ft(A):A,S),{}),m=O(D(E.modelValue));let I;return ce(()=>E.modelValue,d=>{W.isEqual(I,d)||d&&(m.value=D(d))}),ce(m,d=>{const S={...d};S.details&&Gt(S.details)&&(S.details=JSON.parse(S.details)),I={...S},h("update:modelValue",S)},{deep:!0}),(d,S)=>{const w=R("el-input"),A=Je,U=R("el-radio"),N=R("el-radio-group"),s=fn,V=R("el-form-item"),$=R("el-col"),n=R("el-row"),T=R("el-form");return v(),K("div",vn,[o(T,{"label-position":"top"},{default:a(()=>[Object.keys(e(m)).length>0?(v(),H(n,{key:0,gutter:26},{default:a(()=>[(v(!0),K(de,null,he(Object.keys(e(m)),l=>(v(),H($,{key:l,span:l!=="payload"?12:24},{default:a(()=>[o(V,ct({class:{"code-sql":l==="payload",payload:l==="payload"},ref_for:!0},{label:d.$t(`Clients.${l}`),prop:`${l}`}),{default:a(()=>[l!=="payload"?(v(),H(w,{key:0,modelValue:e(m)[l],"onUpdate:modelValue":i=>e(m)[l]=i},null,8,["modelValue","onUpdate:modelValue"])):(v(),K(de,{key:1},[p("div",{class:"monaco-container",style:Ht({height:`${e(L)}px`})},[o(A,{id:("createRandomString"in d?d.createRandomString:e(Ie))(),modelValue:e(m).payload,"onUpdate:modelValue":S[0]||(S[0]=i=>e(m).payload=i),class:"payload",lang:e(c)},null,8,["id","modelValue","lang"])],4),p("div",gn,[o(N,{modelValue:e(c),"onUpdate:modelValue":S[1]||(S[1]=i=>ie(c)?c.value=i:null)},{default:a(()=>[o(U,{value:"json"},{default:a(()=>S[3]||(S[3]=[Y("JSON")])),_:1},8,["value"]),o(U,{value:"plaintext"},{default:a(()=>S[4]||(S[4]=[Y("Plaintext")])),_:1},8,["value"])]),_:1},8,["modelValue"])]),o(s,{modelValue:e(L),"onUpdate:modelValue":S[2]||(S[2]=i=>ie(L)?L.value=i:null),class:"payload","for-monaco":"","is-forward":""},null,8,["modelValue"])],64))]),_:2},1040,["class"])]),_:2},1032,["span"]))),128))]),_:1})):ee("",!0)]),_:1})])}}}),$t=ke(bn,[["__scopeId","data-v-48260b8c"]]),hn={class:"form-item-source"},Tn={class:"test-label"},Sn={class:"no-match-tip"},wn={class:"test-label"},Ln=te({__name:"MockDataDrawer",props:{modelValue:{type:Boolean},ingressBridgeList:{type:Array,required:!0},ruleData:{type:Object,required:!0},isSubmitting:{type:Boolean,default:!1}},emits:["update:modelValue","submit"],setup(t,{emit:q}){const r=t,E=q,h=J({get(){return r.modelValue},set(s){E("update:modelValue",s)}}),{t:c,tl:L}=be("RuleEngine"),{dataType:D,testParams:m,isDataTypeNoMatchSQL:I,eventList:d,isFormModified:S,resetContext:w,getMockContext:A,setDataTypeNContext:U}=Lt(r);ce(h,s=>{s&&U()});const N=()=>{const s=A();E("submit",s)};return(s,V)=>{const $=Xe,n=R("el-col"),T=R("el-row"),l=R("el-button"),i=R("el-drawer");return v(),H(i,{modelValue:e(h),"onUpdate:modelValue":V[3]||(V[3]=g=>ie(h)?h.value=g:null),"destroy-on-close":"",class:"mock-data-drawer",size:660,title:e(L)("mockData")},{footer:a(()=>[e(S)?(v(),H(l,{key:0,plain:"",icon:e(vt),onClick:e(w)},{default:a(()=>[Y(k(e(c)("Base.reset")),1)]),_:1},8,["icon","onClick"])):ee("",!0),o(l,{onClick:V[2]||(V[2]=g=>h.value=!1),disabled:t.isSubmitting},{default:a(()=>[Y(k(s.$t("Base.cancel")),1)]),_:1},8,["disabled"]),o(l,{type:"primary",plain:"",icon:e(je),loading:t.isSubmitting,onClick:N},{default:a(()=>[Y(k(e(L)("submitTest")),1)]),_:1},8,["icon","loading"])]),default:a(()=>[p("div",hn,[p("label",Tn,[Y(k(e(L)("dataSource"))+" ",1),o($,{content:e(L)("dataSourceDesc")},null,8,["content"])]),o(T,{gutter:26},{default:a(()=>[o(n,{span:12},{default:a(()=>[o(St,{modelValue:e(D),"onUpdate:modelValue":V[0]||(V[0]=g=>ie(D)?D.value=g:null),"ingress-bridge-list":t.ingressBridgeList,"event-list":e(d),"for-test":""},null,8,["modelValue","ingress-bridge-list","event-list"])]),_:1}),e(I)?(v(),H(n,{key:0,span:12},{default:a(()=>[p("p",Sn,k(e(L)("dataTypeSQLNoMatch")),1)]),_:1})):ee("",!0)]),_:1})]),p("div",null,[p("label",wn,[Y(k(e(L)("testData"))+" ",1),o($,{content:e(L)("testDataDesc")},null,8,["content"])]),o($t,{modelValue:e(m).context,"onUpdate:modelValue":V[1]||(V[1]=g=>e(m).context=g)},null,8,["modelValue"])])]),_:1},8,["modelValue","title"])}}}),$n={class:"rule-test"},Cn={class:"buttons-bar"},Vn={key:0,class:"btn-start-container"},En={key:0,class:"tip"},Rn={key:1,class:"btn-testing-container"},kn={key:0,class:"tip"},Dn=te({__name:"RuleTest",props:{ruleData:{type:Object,required:!0},ingressBridgeList:{type:Array,required:!0},isFlow:{type:Boolean}},emits:["close","testing-status-change"],setup(t,{expose:q,emit:r}){const E=t,h=r,{tl:c}=be("RuleEngine"),{savedAfterDataChange:L}=ze(),D=O(!1),m=O(!1),{logData:I,handleStopTest:d,submitMockDataForTestRule:S,startTest:w}=Hs(),A=J(()=>Object.keys(I.value).length===0&&!E.isFlow),U=O(!1),N=async()=>{U.value=!0;try{await w(E.ruleData.id)}catch{}},s=()=>h("close"),V=()=>{D.value=!0},$=async l=>{try{m.value=!0,await S(E.ruleData.id,l),D.value=!1}catch{}finally{m.value=!1}},n=()=>{d(),U.value=!1};return ho(()=>U.value,"RuleEngine.debugLeaveConfirm"),ce(()=>E.ruleData,n),ce(U,l=>{h("testing-status-change",l)}),q({handleStartTest:N,stopTest:n}),(l,i)=>{const g=R("el-button");return v(),K("div",$n,[o(mn,{"is-flow":t.isFlow,"log-data":e(I),"is-test-started":e(U),onStartTest:N,onInputSimulatedData:V},null,8,["is-flow","log-data","is-test-started"]),p("div",Cn,[!e(U)&&!e(A)?(v(),K("div",Vn,[t.isFlow?(v(),H(g,{key:1,plain:"",onClick:s},{default:a(()=>[Y(k(e(c)("closeTest")),1)]),_:1})):(v(),K(de,{key:0},[o(g,{type:"primary",plain:"",onClick:N,icon:e(je),disabled:!e(L)},{default:a(()=>[Y(k(e(c)("startTest")),1)]),_:1},8,["icon","disabled"]),e(L)?ee("",!0):(v(),K("p",En,k(e(c)("pleaseSaveFirst")),1))],64))])):ee("",!0),e(U)?(v(),K("div",Rn,[o(g,{type:"primary",plain:"",onClick:V},{default:a(()=>[Y(k(e(c)("inputSimulatedData")),1)]),_:1}),o(g,{plain:"",onClick:n},{default:a(()=>[Y(k(e(c)("stopTest")),1)]),_:1}),e(A)?ee("",!0):(v(),K("p",kn,k(e(c)("tipForTesting")),1))])):ee("",!0)]),o(Ln,{modelValue:e(D),"onUpdate:modelValue":i[0]||(i[0]=Q=>ie(D)?D.value=Q:null),"rule-data":t.ruleData,"ingress-bridge-list":t.ingressBridgeList,"is-submitting":e(m),onSubmit:$},null,8,["modelValue","rule-data","ingress-bridge-list","is-submitting"])])}}}),In={class:"sql-test"},Bn={class:"test-header"},Mn={class:"bold"},An={class:"sub-block-desc"},Fn={key:0},On={class:"bold"},qn={key:0},Pn={class:"test-header"},xn={class:"test-label"},Nn={key:0,class:"no-match-tip"},Un={class:"test-label"},Qn={class:"test-label",shadow:"none"},jn={class:"result-hd"},zn={class:"monaco-container"},Kn={class:"buttons-bar"},Gn=te({__name:"SQLTest",props:{ingressBridgeList:{type:Array,required:!0},ruleData:{type:Object,required:!0}},setup(t,{expose:q}){const{tl:r,t:E}=be("RuleEngine"),h=t,{isTesting:c,testTarget:L}=ze();L.value=Le.SQL;const D=O(!1),m=O(""),{ruleSql:I,dataType:d,testParams:S,isDataTypeNoMatchSQL:w,eventList:A,resetContext:U,getMockContext:N,setDataTypeNContext:s}=Lt(h),{copyText:V}=To(),$=async()=>{D.value=!0;let l;try{l=await oo({context:N(),sql:I.value}),l&&(m.value=Yt(Wt(l)),Ke.success(r("testPassed")))}catch(i){const g=i;(!g.name||!/AxiosError/i.test(g.name))&&Ke.error(g.toString())}finally{D.value=!1}},n=O(),T=()=>{var l,i;(i=(l=n.value)==null?void 0:l.stopTest)==null||i.call(l)};return et(()=>{c.value=!1,L.value=Le.SQL}),ce(()=>c.value,async l=>{l&&s()}),s(),q({stopTest:T}),(l,i)=>{const g=R("el-switch"),Q=Xe,z=R("el-card"),u=R("el-col"),C=R("el-icon"),F=R("el-button"),y=R("el-tooltip"),P=Je,B=R("el-row"),X=R("el-tab-pane"),oe=R("el-tabs"),ve=R("el-collapse-transition");return v(),K("div",In,[p("div",Bn,[p("label",Mn,k(e(r)("test")),1),p("p",An,k(e(r)("testTip")),1),o(g,{modelValue:e(c),"onUpdate:modelValue":i[0]||(i[0]=x=>ie(c)?c.value=x:null),disabled:!l.$hasPermission("post")},null,8,["modelValue","disabled"])]),o(ve,null,{default:a(()=>[e(c)?(v(),K("div",Fn,[p("p",On,k(e(r)("testTarget")),1),o(oe,{class:"target-tabs",modelValue:e(L),"onUpdate:modelValue":i[5]||(i[5]=x=>ie(L)?L.value=x:null),lazy:""},{default:a(()=>[(v(),H(X,{label:"SQL",name:e(Le).SQL,key:e(Le).SQL},{default:a(()=>[e(L)===e(Le).SQL?(v(),K("div",qn,[p("div",Pn,[p("label",xn,[Y(k(e(r)("dataSource"))+" ",1),o(Q,{content:e(r)("dataSourceDesc")},null,8,["content"])]),e(w)?(v(),K("p",Nn,k(e(r)("dataTypeSQLNoMatch")),1)):ee("",!0),o(St,{modelValue:e(d),"onUpdate:modelValue":i[1]||(i[1]=x=>ie(d)?d.value=x:null),"ingress-bridge-list":t.ingressBridgeList,"event-list":e(A),"for-test":""},null,8,["modelValue","ingress-bridge-list","event-list"])]),o(B,{class:"input-output-row",gutter:26},{default:a(()=>[o(u,{span:12},{default:a(()=>[p("label",Un,[Y(k(e(r)("testData"))+" ",1),o(Q,{content:e(r)("testDataDesc")},null,8,["content"])]),o(z,{shadow:"never",class:"test-card with-border"},{default:a(()=>[o($t,{modelValue:e(S).context,"onUpdate:modelValue":i[2]||(i[2]=x=>e(S).context=x)},null,8,["modelValue"])]),_:1})]),_:1}),o(u,{span:12},{default:a(()=>[p("label",Qn,[Y(k(e(r)("outputResult"))+" ",1),o(Q,{content:e(r)("outputResultDesc")},null,8,["content"])]),o(z,{class:"test-result"},{default:a(()=>[p("div",jn,[o(y,{effect:"dark",placement:"top",content:e(E)("Base.copy")},{default:a(()=>[o(F,{type:"primary",class:"btn-copy",link:""},{default:a(()=>[o(C,{class:"icon-copy",size:18,onClick:i[3]||(i[3]=x=>e(V)(e(m)))},{default:a(()=>[o(e(So))]),_:1})]),_:1})]),_:1},8,["content"])]),p("div",zn,[o(P,{id:("createRandomString"in l?l.createRandomString:e(Ie))(),modelValue:e(m),"onUpdate:modelValue":i[4]||(i[4]=x=>ie(m)?m.value=x:null),class:"payload",lang:"json"},null,8,["id","modelValue"])])]),_:1})]),_:1})]),_:1}),p("div",Kn,[o(F,{type:"primary",loading:e(D),plain:"",icon:e(je),disabled:!l.$hasPermission("post"),onClick:$},{default:a(()=>[Y(k(e(r)("testsql")),1)]),_:1},8,["loading","icon","disabled"]),o(F,{plain:"",icon:e(vt),onClick:e(U)},{default:a(()=>[Y(k(e(E)("Base.reset")),1)]),_:1},8,["icon","onClick"])])])):ee("",!0)]),_:1},8,["name"])),(v(),H(X,{label:("startCase"in l?l.startCase:e(W.startCase))(e(r)("rule")),key:e(Le).SQL,name:e(Le).Rule,lazy:""},{default:a(()=>[o(Dn,{ref_key:"RuleTestRef",ref:n,"rule-data":t.ruleData,"ingress-bridge-list":t.ingressBridgeList},null,8,["rule-data","ingress-bridge-list"])]),_:1},8,["label","name"]))]),_:1},8,["modelValue"])])):ee("",!0)]),_:1})])}}}),Hn={class:"rule-form"},Yn={class:"sub-block-desc"},Wn=["href"],Jn={class:"monaco-container sql"},Xn=te({name:"rule-form"}),ba=te({...Xn,props:{modelValue:{type:Object,required:!1,default:()=>({})},submitLoading:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1},nameDisabled:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","save","save-as-copy"],setup(t,{expose:q,emit:r}){const E=t,h=r,{t:c}=Ze(),L=Xt(),{transFromStrToFromArr:D,transSQLFormDataToSQL:m}=Me(),I=(M,j="RuleEngine")=>c(`${j}.${M}`),d=O([]),S=O([]),w=O(!1),A=O(),U={id:"",sql:m(Ye,[We]),actions:[],description:"",enable:!0};let N="";const s=O({...W.cloneDeep(U),...W.cloneDeep(E.modelValue)}),{isTesting:V,testTarget:$,savedAfterDataChange:n,isDataSaveButtonDisabled:T}=ze(),l=J(()=>s.value.sql);lt("sql",l),lt("eventList",S);const i=O({from:[We],select:Ye,where:""}),g=O({from:"",select:""}),Q={from:I("dataSource"),select:I("select")},z=O(""),u=O(!1);let C;(M=>{M[M.Sources=0]="Sources",M[M.Actions=1]="Actions"})(C||(C={}));const F=O(1),{createRequiredRule:y,createCommonIdRule:P}=bt(),B=O(),X={id:[...y("ID"),...P()],sql:y(I("SQL"))},{docMap:oe}=wo(),{completionProvider:ve,hoverProvider:x,setExtDepData:b}=lo();ce(()=>JSON.stringify(s.value)+JSON.stringify(i.value),()=>{re()}),ce(()=>E.modelValue,M=>{JSON.stringify(M)!==N&&_()});const _=()=>{s.value={...W.cloneDeep(U),...W.cloneDeep(E.modelValue)},w.value&&Te()},f=M=>{const{fieldStr:j,whereStr:ne}=Re(s.value.sql);s.value.sql=m(j,D(M),ne)},G=M=>{var j;Array.isArray(s.value.actions)&&((j=s.value.actions)==null||j.push(M))},{handleConnDirection:me}=Ue(),se=G,ge=async M=>{f(`$bridges/${M}`),await Pe(),F.value=0},ye=async(M,j,ne)=>{!j||!ne||M===Ge.Ingress&&(F.value=0)},$e=async()=>{var ne,we;const M=(ne=L.query.actionId)==null?void 0:ne.toString(),j=(we=L.query.sourceId)==null?void 0:we.toString();M?se(M):j?ge(j):await me(ye)},Ee=()=>{const M=Z();return z.value=M,s.value.sql=M,M},Te=()=>{const{sql:M=""}=s.value,{fieldStr:j,fromStr:ne,whereStr:we}=Re(M);i.value={from:D(ne),select:j,where:we}},re=()=>{let M=s.value.sql;w.value?M=Ee():(Te(),z.value=M);const j={...s.value,sql:M};N=JSON.stringify(j),h("update:modelValue",j)},Z=()=>{const{select:M,from:j,where:ne}=i.value;return m(M,j,ne)},{getSourceList:Se}=uo(),Ce=async()=>{d.value=await Se()},Ct=M=>{s.value.sql=M,Te()},Vt=()=>{u.value=!0},{getEventList:Et}=Be(),Rt=async()=>{try{S.value=await Et()}catch(M){console.error(M)}},{operationWarning:kt}=ht(),Dt=async()=>{var M,j;try{V.value&&$.value===Le.Rule&&(await kt(I("saveRuleStopTestingTip")),(j=(M=A.value)==null?void 0:M.stopTest)==null||j.call(M)),h("save-as-copy")}catch{}},It=()=>{if(!w.value)return Promise.resolve();const M=Object.keys(g.value);return M.forEach(ne=>Bt(ne)),M.every(ne=>!g.value[ne])?Promise.resolve():Promise.reject()},Bt=M=>{const j=i.value[M],ne=!(typeof j=="string"&&!j||Array.isArray(j)&&!Zt(j));g.value[M]=ne?"":c("Rule.inputFieldRequiredError",{name:Q[M]})},ot=()=>{var M;return Promise.all([It(),(M=B.value)==null?void 0:M.validate()])};return Jt(async()=>{Ce(),_(),await Rt(),b({events:S.value,bridges:d.value}),$e()}),q({validate:ot}),(M,j)=>{const ne=R("el-input"),we=R("el-form-item"),Ve=R("el-col"),Mt=Xe,At=Je,Ae=R("el-button"),Fe=R("el-row"),Ft=R("el-form"),st=R("el-tab-pane"),Ot=R("el-tabs");return v(),K(de,null,[p("div",Hn,[o(Fe,{class:"editor-row"},{default:a(()=>[o(Ve,{span:15,class:"sql-col"},{default:a(()=>[o(Ft,{ref_key:"formCom",ref:B,model:e(s),rules:X,disabled:t.disabled,"label-position":"top","hide-required-asterisk":""},{default:a(()=>[o(Fe,{gutter:20},{default:a(()=>[o(Ve,{span:12},{default:a(()=>[o(we,{required:"",prop:"id"},{default:a(()=>[o(ne,{modelValue:e(s).id,"onUpdate:modelValue":j[0]||(j[0]=pe=>e(s).id=pe),placeholder:"ID",disabled:t.isEdit||t.nameDisabled},null,8,["modelValue","disabled"])]),_:1})]),_:1}),o(Ve,{span:12},{default:a(()=>[o(we,{prop:"description"},{default:a(()=>[o(ne,{modelValue:e(s).description,"onUpdate:modelValue":j[1]||(j[1]=pe=>e(s).description=pe),placeholder:I("note")},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),o(Ve,{span:24},{default:a(()=>[o(we,{required:"",prop:"sql",class:"self-required"},{label:a(()=>[p("span",null,k(I("sqlEditor")),1),o(Mt,{content:I("ruleSQLDesc")},null,8,["content"]),p("p",Yn,[p("span",null,k(I("sqlEdit")),1),p("a",{href:e(oe).sqlGrammar,target:"_blank"},k(I("sqlSyntaxAndTem")),9,Wn)])]),default:a(()=>[p("div",Jn,[o(At,{id:("createRandomString"in M?M.createRandomString:e(Ie))(),"completion-provider":e(ve),"hover-provider":e(x),disabled:t.disabled,modelValue:e(s).sql,"onUpdate:modelValue":j[2]||(j[2]=pe=>e(s).sql=pe),lang:"rulesql",onChange:ot},null,8,["id","completion-provider","hover-provider","disabled","modelValue"])])]),_:1})]),_:1}),o(Ve,{span:24},{default:a(()=>[o(Ae,{onClick:Vt,type:"primary",plain:""},{default:a(()=>[Y(k(I("SQLTemplates")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model","disabled"])]),_:1}),o(Ve,{span:9,class:"action-col"},{default:a(()=>[o(Ot,{class:"io-tabs",modelValue:e(F),"onUpdate:modelValue":j[5]||(j[5]=pe=>ie(F)?F.value=pe:null)},{default:a(()=>[o(st,{class:"io-tab-pane",label:I("dataInput"),name:0},{default:a(()=>[o(cs,{modelValue:e(s).sql,"onUpdate:modelValue":j[3]||(j[3]=pe=>e(s).sql=pe),disabled:t.disabled,"source-list":e(d)},null,8,["modelValue","disabled","source-list"])]),_:1},8,["label","name"]),o(st,{class:"io-tab-pane",label:I("actionOutputs"),name:1},{default:a(()=>[o(Ts,{modelValue:e(s),"onUpdate:modelValue":j[4]||(j[4]=pe=>ie(s)?s.value=pe:null),disabled:t.disabled},null,8,["modelValue","disabled"])]),_:1},8,["label","name"])]),_:1},8,["modelValue"])]),_:1})]),_:1}),o(Fe,{class:"test-row"},{default:a(()=>[o(Gn,{ref_key:"testSQLRef",ref:A,"rule-data":t.modelValue,"ingress-bridge-list":e(d)},null,8,["rule-data","ingress-bridge-list"])]),_:1}),o(Fe,{class:"oper-row"},{default:a(()=>[o(Ve,{span:24},{default:a(()=>[o(Ae,{onClick:j[6]||(j[6]=pe=>M.$router.push({name:"rule"}))},{default:a(()=>[Y(k(e(n)?I("backToRuleList"):M.$t("Base.cancel")),1)]),_:1}),t.isEdit?(v(),H(Ae,{key:0,type:"primary",plain:"",disabled:!M.$hasPermission("post")||t.disabled,onClick:Dt},{default:a(()=>[Y(k(I("saveAsCopy")),1)]),_:1},8,["disabled"])):ee("",!0),o(Ae,{type:"primary",disabled:!M.$hasPermission("post")||t.disabled||e(T),loading:t.submitLoading,onClick:j[7]||(j[7]=pe=>M.$emit("save"))},{default:a(()=>[Y(k(t.isEdit?M.$t("Base.update"):M.$t("Base.save")),1)]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),o(Ms,{modelValue:e(u),"onUpdate:modelValue":j[8]||(j[8]=pe=>ie(u)?u.value=pe:null),onUseSql:Ct},null,8,["modelValue"])],64)}}}),ha=()=>{const t=()=>`rule_${Ie(4)}`,{transSQLFormDataToSQL:q}=Me();return{createRawRuleForm:(h=We)=>({id:t(),sql:q(Ye,[h]),actions:[],description:"",enable:!0}),getRuleDataForUpdate:({id:h,sql:c,enable:L,description:D,actions:m})=>({id:h,sql:c,enable:L,description:D,actions:m})}};export{ba as _,ze as a,ha as u};
