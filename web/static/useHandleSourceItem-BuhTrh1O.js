import{g as $}from"./useHandleActionItem-CKafnUW3.js";import"./http-DdqGSA6b.js";import{aD as c,aT as S,a_ as v,g as m,q as D,a5 as I,M as R,E as w}from"./index-Dp_94g6t.js";import{c as C}from"./useDataHandler-URbL20R0.js";const K=()=>({getActionList:async()=>{try{const e=await $();return Promise.resolve(e)}catch(e){return Promise.reject(e)}}}),B=async()=>{try{const r=await c.get("/sources_summary");return Promise.resolve(r.map(e=>{const s=S(e);return{id:s,idForRuleFrom:`${v}${s}`,...e}}))}catch(r){return Promise.reject(r)}},U=async r=>{try{const e=await c.post("/sources",r);return Promise.resolve({...e,id:S(e)})}catch(e){return Promise.reject(e)}},j=async(r,e)=>{if(!r)return Promise.reject();try{const s=await c.put(`/sources/${encodeURIComponent(r)}`,e);return Promise.resolve({...s,id:S(s)})}catch(s){return Promise.reject(s)}},E=(r,e=!1)=>c.delete(`/sources/${encodeURIComponent(r)}`,{params:{also_delete_dep_actions:e},errorsHandleCustom:[400]}),L=async r=>{if(!r)return Promise.reject();try{const e=await c.get(`/sources/${encodeURIComponent(r)}`);return Promise.resolve({...e,id:S(e)})}catch(e){return Promise.reject(e)}},M=r=>c.get(`/sources/${encodeURIComponent(r)}/metrics`),T=r=>c.put(`/sources/${encodeURIComponent(r)}/metrics/reset`),b=(r,e)=>c.put(`/sources/${encodeURIComponent(r)}/enable/${e}`),A=r=>c.post("/sources_probe",r),F=(r,e)=>c.post(`/nodes/${encodeURIComponent(r)}/sources/${encodeURIComponent(e)}/start`),_=r=>c.post(`/sources/${encodeURIComponent(r)}/start`),X=()=>({getSourceList:async()=>{try{const e=await B();return Promise.resolve(e)}catch(e){return Promise.reject(e)}}}),h=()=>{const{handleActionDataBeforeUpdate:r,handleActionDataBeforeSubmit:e}=C(),s=t=>t,a=async t=>{try{const o=await L(t);return s(o)}catch(o){return Promise.reject(o)}},u=async t=>U(t),i=async t=>{try{const{id:o}=t,P=await r(t);return Reflect.deleteProperty(P,"id"),j(o,P)}catch(o){return console.error(o),Promise.reject(o)}},p=async(t,o=!1)=>E(t,o),y=async t=>M(t),g=async t=>T(t),n=(t,o)=>b(t,o),l=async t=>_(t),f=async(t,o)=>F(t,o),d=m(!1);return{getSourceDetail:a,handleDataAfterLoaded:s,addSource:u,updateSource:i,deleteSource:p,getSourceMetrics:y,resetSourceMetrics:g,toggleSourceEnable:n,reconnectSource:l,reconnectSourceForNode:f,isTesting:d,testConnectivity:async t=>{try{d.value=!0;const o=await e(t);return await A(o),d.value=!1,Promise.resolve()}catch(o){return d.value=!1,Promise.reject(o)}}}},Y=h,z=r=>{const{t:e}=D("RuleEngine"),s=m(!1),a=m([]),u=m(""),i=()=>{I.success(e("Base.deleteSuccess")),r&&R.isFunction(r)&&r()},p=async n=>{a.value=n,s.value=!0},{deleteSource:y}=h();return{showSecondConfirm:s,usingBridgeRules:a,currentDeleteBridgeId:u,handleDeleteSuc:i,handleDeleteSource:async n=>{var l;if((l=n.rules)!=null&&l.length){u.value=n.id,p(n.rules);return}await w.confirm(e("Base.confirmDelete"),{confirmButtonText:e("Base.confirm"),cancelButtonText:e("Base.cancel"),confirmButtonClass:"confirm-danger",type:"warning"});try{await y(n.id),i()}catch{}}}};export{X as a,Y as b,z as c,K as u};
