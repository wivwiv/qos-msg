import{ab as Y,g as D,j as g,M as v,br as ee,a_ as le,bT as te,bU as J,bV as ae,aX as q,bW as ne,bX as oe,d as Z,J as H,r as T,o as s,m as y,aW as ue,w as f,a9 as M,u as m,y as G,K as se,bI as X,bY as de,z as re,b as I,c as _,F as W,t as N,e as z,x as ce,a as ie,k as pe,bD as me,bZ as fe}from"./index-Dp_94g6t.js";import{e as ye}from"./useRule-DGtnoBQH.js";import{_ as ve}from"./useBridgeTypeValue-BhHkY53V.js";const Ve=[{columns:["payload","event","metadata","timestamp","node"],event:"$bridges/rabbitmq:*"},{columns:["headers","key","offset","topic","ts","ts_type","value"],event:"$bridges/kafka_consumer:*"},{columns:["attributes","message_id","ordering_key","publishing_time","topic","value"],event:"$bridges/gcp_pubsub_consumer:*"}],ke=()=>{const o=Y("sql",D("")),O=Y("eventList",D([])),n=g(()=>o?te(o.value):{}),{transFromStrToFromArr:S,getTestTargetEvent:L}=ye(),d=g(()=>v.isUndefined(n.value.fieldStr)?[]:J(n.value.fieldStr).map(e=>ae(e))),h=g(()=>S(n.value.fromStr||"")),E=new RegExp(`^${v.escapeRegExp(ee)}`),c=new RegExp(`^${v.escapeRegExp(le)}`),x=e=>c.test(e),C=e=>!c.test(e)&&!E.test(e),j=new RegExp(/^[^.]+/),A=e=>{const t=j.exec(e);return t?t[0]:e},B=g(()=>[...O.value,...Ve]),U=g(()=>{if(d.value.length===0)return[];let e=new Set;if(d.value.length===1&&/^\*$/.test(d.value[0])){if(!O)return[];e=h.value.reduce((t,u)=>{const i=x(u)?q.Bridge:C(u)?q.Topic:q.Event,l=i===q.Bridge?u.replace(c,""):u,r=L(i,l,B.value);return r&&r.columns.forEach(p=>t.add(p)),t},new Set)}else e=d.value.reduce((t,u)=>{const i=oe(u),l=ne(u);if(!i||!v.isUndefined(l)){const r=v.isUndefined(l)?u:l;t.add(A(r))}return t},new Set);return[...e]}),V=g(()=>U.value.map(e=>`\${${e}}`));return{sql:o,availableFields:U,availablePlaceholders:V}},w=Z({__name:"InputWithPlaceholderSelect",props:{modelValue:{type:[String,Number,Boolean]},customPlaceholders:{},options:{},oneOf:{}},emits:["update:modelValue","input"],setup(o,{emit:O}){const n=o,S=O,L=e=>{if(!n.oneOf||n.oneOf.length===0)return e;const t=n.oneOf.find(({type:i})=>i===X.Boolean),u=n.oneOf.find(({type:i})=>[X.Integer,X.Number].includes(i));return t&&/^(true|false)$/i.test(e)?/^true/i.test(e):u&&de.test(e)?Number(e):e},d=g({get:()=>{var e;return((e=n.modelValue)==null?void 0:e.toString())||""},set:e=>{S("update:modelValue",L(e))}}),h=/\$(\{[^\s\n}]*)?$/,E=()=>{var t;const e=(t=n.modelValue)==null?void 0:t.toString().match(h);return e&&e[0]},{availablePlaceholders:c}=ke(),x=e=>e.map(t=>({value:t.toString()})),C=g(()=>n.customPlaceholders||c.value),j=()=>{const e=E();let t=[];if(e){const u=new RegExp(v.escapeRegExp(e),"i");t=C.value.reduce((i,l)=>(u.test(l)&&i.push(l),i),[])}return t},A=(e,t)=>{const u=[...j(),...n.options??[]];t(x(u))},B=({value:e})=>{var u;E()&&(d.value=((u=n.modelValue)==null?void 0:u.replace(h,e))||"")},U=D(),V=e=>{U.value.highlightedIndex>-1&&U.value.popperRef.visible&&e.preventDefault()};return H(d,e=>{S("input",e)}),(e,t)=>{const u=T("el-autocomplete");return s(),y(u,{ref_key:"AutocompleteRef",ref:U,modelValue:m(d),"onUpdate:modelValue":t[0]||(t[0]=i=>G(d)?d.value=i:null),"fetch-suggestions":A,onSelect:t[1]||(t[1]=i=>B(i)),onKeydown:se(V,["enter"])},ue({_:2},[e.$slots.prefix?{name:"prefix",fn:f(()=>[M(e.$slots,"prefix")]),key:"0"}:void 0,e.$slots.suffix?{name:"suffix",fn:f(()=>[M(e.$slots,"suffix")]),key:"1"}:void 0,e.$slots.prepend?{name:"prepend",fn:f(()=>[M(e.$slots,"prepend")]),key:"2"}:void 0,e.$slots.append?{name:"append",fn:f(()=>[M(e.$slots,"append")]),key:"3"}:void 0]),1032,["modelValue"])}}}),he={key:1,class:"value"},be={key:1,class:"value"},ge={key:1,class:"key-and-value-editor"},Se={class:"key-value-list"},Re=Z({__name:"KeyAndValueEditor",props:{modelValue:{type:Object},customLabel:{type:Object,default:null},disabled:{type:Boolean,default:!1},fixedKeys:{type:Boolean,default:!1},type:{type:String,default:"table"},readonly:{type:Boolean},supportPlaceholder:{type:Array}},emits:["update:modelValue"],setup(o,{emit:O}){const n=o,S=O,L={key:"",value:"",state:0},d=D([]);let h={};const{t:E}=re(),c=D(""),x=l=>{const r=Object.entries(l);return Object.entries(l).reduce((p,[b,P],F)=>{const K=F<r.length-1?", ":"";return p+=`${b}=${P}${K}`},"")},C=()=>{n.modelValue?typeof n.modelValue=="string"?c.value=n.modelValue:c.value=x(n.modelValue):c.value=""},j=l=>{const r=J(l),p={};return r.forEach(b=>{const[P,F]=fe(b,"=").map(K=>K.trim());p[P]=F}),p},A=/(.+=.+,)*(.+=.+)/,B=()=>{if(A.test(c.value)){const l=j(c.value);h=v.cloneDeep(l),S("update:modelValue",l)}else typeof n.modelValue=="string"&&S("update:modelValue",c.value)};function U(){const l=n.modelValue;!l||!v.isPlainObject(l)||(d.value=[],h=v.cloneDeep(l),Object.entries(l).forEach(([r,p])=>{d.value.push({key:r,value:p,state:0})}))}const V=g(()=>n.customLabel===null?{key:E("components.key"),value:E("components.value")}:n.customLabel);function e(){const l={};d.value.forEach(r=>{const{key:p,value:b}=r;l[p]=b}),h=v.cloneDeep(l),S("update:modelValue",l)}function t(l){d.value=d.value.filter(r=>r!==l),e()}function u(){d.value.push({...L})}const i=()=>{n.type!=="input"?U():C()};return i(),H(()=>n.modelValue,l=>{v.isEqual(l,h)||i()}),(l,r)=>{const p=T("el-input"),b=T("el-table-column"),P=T("el-button"),F=T("el-table"),K=T("el-icon");return o.type==="table"?(s(),y(F,{key:0,class:"key-and-value-editor shadow-none",data:m(d)},{default:f(()=>[I(b,{label:m(V).key},{default:f(({row:a})=>{var R;return[o.readonly?(s(),_("p",he,N(a.key),1)):(s(),_(W,{key:0},[(R=o.supportPlaceholder)!=null&&R.includes("key")?(s(),y(w,{key:0,modelValue:a.key,"onUpdate:modelValue":k=>a.key=k,class:"key-input",onInput:e,readonly:o.fixedKeys},null,8,["modelValue","onUpdate:modelValue","readonly"])):(s(),y(p,{key:1,modelValue:a.key,"onUpdate:modelValue":k=>a.key=k,class:"key-input",onInput:e,readonly:o.fixedKeys},null,8,["modelValue","onUpdate:modelValue","readonly"]))],64))]}),_:1},8,["label"]),I(b,{label:m(V).value},{default:f(({row:a})=>{var R;return[o.readonly?(s(),_("p",be,N(a.value),1)):(s(),_(W,{key:0},[(R=o.supportPlaceholder)!=null&&R.includes("value")?(s(),y(w,{key:0,modelValue:a.value,"onUpdate:modelValue":k=>a.value=k,onInput:e},null,8,["modelValue","onUpdate:modelValue"])):(s(),y(p,{key:1,modelValue:a.value,"onUpdate:modelValue":k=>a.value=k,onInput:e},null,8,["modelValue","onUpdate:modelValue"]))],64))]}),_:1},8,["label"]),!o.disabled&&!o.fixedKeys&&!o.readonly?(s(),y(b,{key:0,width:"100"},{header:f(()=>[I(P,{link:"",type:"primary",onClick:u},{default:f(()=>[z(N(l.$t("Base.add")),1)]),_:1})]),default:f(({row:a})=>[I(P,{link:"",type:"primary",onClick:R=>t(a)},{default:f(()=>[z(N(l.$t("Base.delete")),1)]),_:2},1032,["onClick"])]),_:1})):ce("",!0)]),_:1},8,["data"])):o.type==="list"?(s(),_("div",ge,[ie("ul",Se,[(s(!0),_(W,null,pe(m(d),(a,R)=>{var k,Q;return s(),_("li",{class:"key-value-item",key:R},[(k=o.supportPlaceholder)!=null&&k.includes("key")?(s(),y(w,{key:0,modelValue:a.key,"onUpdate:modelValue":$=>a.key=$,onInput:e,placeholder:m(V).key},null,8,["modelValue","onUpdate:modelValue","placeholder"])):(s(),y(p,{key:1,placeholder:m(V).key,modelValue:a.key,"onUpdate:modelValue":$=>a.key=$,onInput:e},null,8,["placeholder","modelValue","onUpdate:modelValue"])),(Q=o.supportPlaceholder)!=null&&Q.includes("value")?(s(),y(w,{key:2,modelValue:a.value,"onUpdate:modelValue":$=>a.value=$,placeholder:m(V).value,onInput:e},null,8,["modelValue","onUpdate:modelValue","placeholder"])):(s(),y(p,{key:3,placeholder:m(V).value,modelValue:a.value,"onUpdate:modelValue":$=>a.value=$,onInput:e},null,8,["placeholder","modelValue","onUpdate:modelValue"])),I(P,{class:"btn-del",link:"",onClick:$=>t(a)},{default:f(()=>[I(K,{size:16},{default:f(()=>[I(m(ve))]),_:1})]),_:2},1032,["onClick"])])}),128))]),I(P,{link:"",type:"primary",icon:m(me),onClick:u},{default:f(()=>[z(N(m(E)("Base.add")),1)]),_:1},8,["icon"])])):(s(),_(W,{key:2},[!o.supportPlaceholder||o.supportPlaceholder.length===0?(s(),y(p,{key:0,class:"key-and-value-input",modelValue:m(c),"onUpdate:modelValue":r[0]||(r[0]=a=>G(c)?c.value=a:null),onBlur:B},null,8,["modelValue"])):(s(),y(w,{key:1,class:"key-and-value-input",modelValue:m(c),"onUpdate:modelValue":r[1]||(r[1]=a=>G(c)?c.value=a:null),onBlur:B},null,8,["modelValue"]))],64))}}});export{Re as _,w as a,ke as u};
