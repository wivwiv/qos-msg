import{_ as ne}from"./MarkdownContent.vue_vue_type_style_index_0_lang-oyE4YyGM.js";import{j as ce,e as ie}from"./common-7tZUksOK.js";import{d as de,e as pe,u as ue,M as K}from"./useDroppedDetail-ChQoeErR.js";import{d as me,g as i,j as u,q as ve,c as N,b as l,w as y,u as t,y as I,a as s,t as f,m as L,r as d,o as b,F as _e,k as he,n as T,M as ye}from"./index-Dp_94g6t.js";import"./http-DdqGSA6b.js";import"./pie-Bag65DYr.js";const ge={class:"dropped-analysis app-wrapper with-padding-top"},fe={class:"dropped-desc"},be={class:"block-charts"},De={class:"charts-hd space-between"},Ce={class:"block-title"},Me={class:"charts-hd block-title"},B="cluster",Oe=me({__name:"DroppedAnalysis",setup(we){const m=i(0),c=u(()=>m.value===0),{t:D,tl:p}=ve("Dashboard"),A=i([]),v=i(B);(async()=>{try{const a=await ce();A.value=a.map(({node:e})=>e)}catch{}})();const _=i({}),U=u(()=>c.value?K.MessagesDropped:K.DeliveryDropped),C=u(()=>_.value[U.value]),{metricsKeyReg:j,itemStyle:q,messageDroppedDesc:$}=de(C),{metricsKeyReg:x,itemStyle:F,deliveryDroppedDesc:z}=pe(C),{filterMetrics:G,initChart:V,getBarChartOptions:H,getPieChartOptions:J}=ue(),E=u(()=>G(_.value,c.value?j:x)),S=u(()=>c.value?q.value:F.value),O=i(),Q=()=>H(E.value,S.value);let o;const W=()=>{o||(o=V(O.value)),o.setOption(Q())},P=i(),X=()=>J(E.value,S.value);let r;const Y=()=>{r||(r=V(P.value)),r.setOption(X())},M=i(!1),Z=async()=>{try{M.value=!0;const a=v.value===B?void 0:v.value,e=await ie(a);return Array.isArray(e)&&e.length===1?_.value=e[0]:Array.isArray(e)||(_.value=e),M.value=!1,Promise.resolve()}catch{return M.value=!1,Promise.reject()}},ee=()=>{var a,e;(a=o==null?void 0:o.dispose)==null||a.call(o),o=void 0,(e=r==null?void 0:r.dispose)==null||e.call(r),r=void 0},w=async()=>{try{await Z(),W(),Y()}catch{}};w();const te=async()=>{ee(),w()},ae=u(()=>(c.value?$:z).reduce((e,h)=>{const k=ye.get(_.value,h.key);return e.push({value:k,...h}),e},[]));return(a,e)=>{const h=d("el-radio-button"),k=d("el-radio-group"),R=d("el-option"),le=d("el-select"),se=d("el-card"),g=d("el-table-column"),oe=ne,re=d("el-table");return b(),N("div",ge,[l(k,{modelValue:t(m),"onUpdate:modelValue":e[0]||(e[0]=n=>I(m)?m.value=n:null),onChange:te},{default:y(()=>[l(h,{value:0,label:t(p)("messagesDroppedAtReception")},null,8,["value","label"]),l(h,{value:1,label:t(p)("messagesDroppedAtDelivery")},null,8,["value","label"])]),_:1},8,["modelValue"]),s("div",fe,f(t(p)(t(c)?"messageDroppedDesc":"deliveryDroppedDesc")),1),s("div",be,[s("div",De,[s("div",Ce,[s("label",null,f(t(p)("totalDroppedMessages"))+": ",1),s("span",null,f(t(C)),1)]),l(le,{class:"node-select",modelValue:t(v),"onUpdate:modelValue":e[1]||(e[1]=n=>I(v)?v.value=n:null),placeholder:a.$t("Clients.node"),onChange:w},{default:y(()=>[l(R,{label:a.$t("BasicConfig.cluster"),value:B},null,8,["label"]),(b(!0),N(_e,null,he(t(A),n=>(b(),L(R,{key:n,label:n,value:n},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),(b(),L(se,{class:"charts-card",key:t(m)},{default:y(()=>[s("div",{class:T(["chart",{"is-higher":!t(c)}]),ref_key:"BarChartEle",ref:O},null,2),s("div",{class:T(["chart",{"is-higher":!t(c)}]),ref_key:"PieChartEle",ref:P},null,2)]),_:1}))]),s("div",null,[s("div",Me,f(t(p)("detailedMetrics")),1),l(re,{data:t(ae)},{default:y(()=>[l(g,{prop:"name",label:t(D)("Clients.reason"),"min-width":120},null,8,["label"]),l(g,{prop:"value",sortable:"",label:t(D)("components.value"),"min-width":80},null,8,["label"]),l(g,{prop:"key",label:t(D)("components.field"),"min-width":160},null,8,["label"]),l(g,{prop:"impact",label:t(p)("causeAnalysis"),"min-width":240},{default:y(({row:n})=>[l(oe,{content:n.impact},null,8,["content"])]),_:1},8,["label"])]),_:1},8,["data"])])])}}});export{Oe as default};
