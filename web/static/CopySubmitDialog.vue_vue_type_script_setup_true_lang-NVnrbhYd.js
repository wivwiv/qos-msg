import{c as z}from"./useRule-XWlG7MOW.js";import{_ as H}from"./CreateRuleWithConnector.vue_vue_type_style_index_0_lang-DzkuCXLT.js";import{d as L,q as J,j as V,J as P,g as i,c as G,b as s,w as c,u as a,y as B,F as K,r as m,s as Q,o as W,a as X,e as j,t as w,a5 as Y,E as Z,bz as x}from"./index-gzDiX6cq.js";import{u as ee}from"./useHandleActionItem-CLBwxXaF.js";import{e as te}from"./useDataHandler-DIoGjH2Q.js";const oe={class:"dialog-footer"},ue=L({__name:"CopySubmitDialog",props:{modelValue:{type:Boolean,required:!0},target:{type:Object,required:!0}},emits:["update:modelValue"],setup(k,{emit:E}){const o=k,I=E,{t:r,tl:d}=J("RuleEngine"),p=Q(),b=V(()=>o.target.type==="rule"),l=V({get:()=>o.modelValue,set:t=>{I("update:modelValue",t)}});P(l,t=>{if(!t)f.value="";else{const e=b.value?o.target.obj.id:o.target.obj.name;n.value=`${e}_copy`}});const n=i(""),f=i(""),v=i(!1),C=V(()=>b.value?"ID":r("Base.name")),q=()=>n.value?(f.value="",!0):(f.value=r("Rule.inputFieldRequiredError",{name:C.value}),!1),F=async()=>{const{sql:t,enable:e,description:_,actions:y}=o.target.obj;return z({sql:t,enable:e,description:_,actions:y,id:n.value})},{addAction:D}=ee(),N=()=>D({...x(o.target.obj),name:n.value}),{addConnector:S}=te(),A=()=>S({...x(o.target.obj),name:n.value}),g=i(!1),R=i(void 0),M=t=>{t?(l.value=!1,Z.confirm(d("useConnectorCreateRule"),r("Base.createSuccess"),{confirmButtonText:d("createRule"),cancelButtonText:d("backBridgeList"),type:"success"}).then(()=>{p.push({name:"rule-create",query:{actionId:t}})}).catch(()=>{p.push({name:"actions"})})):p.push({name:"actions"})},T=new Map([["rule",F],["bridge",N],["connector",A]]),$=async()=>{if(q())try{v.value=!0;const t=T.get(o.target.type);if(!t){console.error("can not find func to submit");return}const e=await t();Y.success(r("Base.createSuccess")),b.value?p.push({name:"rule"}):o.target.type==="bridge"?M(e.id):o.target.type==="connector"&&(R.value=e,l.value=!1,g.value=!0)}catch{}finally{v.value=!1}};return(t,e)=>{const _=m("el-input"),y=m("el-form-item"),O=m("el-form"),h=m("el-button"),U=m("el-dialog");return W(),G(K,null,[s(U,{modelValue:a(l),"onUpdate:modelValue":e[2]||(e[2]=u=>B(l)?l.value=u:null),width:"400px",title:a(d)("saveAsCopy"),"z-index":2e3},{footer:c(()=>[X("span",oe,[s(h,{onClick:e[1]||(e[1]=u=>l.value=!1)},{default:c(()=>[j(w(a(r)("Base.cancel")),1)]),_:1}),s(h,{type:"primary",disabled:!t.$hasPermission("post"),onClick:$,loading:a(v)},{default:c(()=>[j(w(a(r)("Base.create")),1)]),_:1},8,["disabled","loading"])])]),default:c(()=>[s(O,{"label-position":"top"},{default:c(()=>[s(y,{label:a(C),error:a(f)},{default:c(()=>[s(_,{modelValue:a(n),"onUpdate:modelValue":e[0]||(e[0]=u=>B(n)?n.value=u:null)},null,8,["modelValue"])]),_:1},8,["label","error"])]),_:1})]),_:1},8,["modelValue","title"]),s(H,{modelValue:a(g),"onUpdate:modelValue":e[3]||(e[3]=u=>B(g)?g.value=u:null),connector:a(R)},null,8,["modelValue","connector"])],64)}}});export{ue as _};
