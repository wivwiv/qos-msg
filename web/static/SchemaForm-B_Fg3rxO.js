import{d as he,j as X,r as _,o as O,m as te,w as B,b as a,u,e as Se,t as ue,x as be,c as ne,a as _e,y as Ce,W as Q,F as fe,k as ke,n as ct,q as $e,M as G,b7 as v,bA as Yt,bB as bt,bC as Jt,g as se,bt as Pt,ao as Xt,aW as Zt,i as en,s as tn,R as nn,bD as gt,aZ as _t,a5 as Ke,bE as Dt,a3 as It,z as it,br as Te,bF as on,bG as sn,bH as an,a2 as qe,bI as Ft,bJ as Fe,J as Le,C as ln,bK as rn,bL as ze,bM as cn,aP as Lt,bN as Qe,h as un,aD as dn,bO as pn,bP as ge,N as mn,bQ as fn,bR as yn,p as bn,V as gn,aJ as _n,bS as ht}from"./index-F6_Zcexc.js";import{e as Et,_ as Rt,c as At,b as xt,f as He,a as Ue,g as vt,T as Ct,d as St,h as Vt}from"./CertFileInput.vue_vue_type_script_setup_true_lang-Ca-vV8wZ.js";import{_ as Ze}from"./InfoTooltip-CPsvXzu1.js";import{_ as et}from"./MarkdownContent.vue_vue_type_style_index_0_lang-D3IVIbCc.js";import{_ as tt}from"./Monaco.vue_vue_type_style_index_0_lang-m8fKnWUe.js";import{h as hn,e as vn,u as Cn,g as Sn}from"./useDataHandler-Dj1fwDX7.js";import{c as Vn}from"./check-R5MM5VH5.js";import{_ as wn}from"./DetailHeader.vue_vue_type_style_index_0_lang-MGYnd5rE.js";import{_ as Tn}from"./CreateRuleWithConnector.vue_vue_type_style_index_0_lang-D89utF8r.js";import{f as nt,a as kn,g as ut,_ as $n,d as Bn,e as On}from"./useBridgeTypeValue-CwFoz3CA.js";import{_ as Pn}from"./CommonOverflowTooltip.vue_vue_type_style_index_0_lang-Bl9D7zI6.js";import{a as Re,_ as ot}from"./KeyAndValueEditor.vue_vue_type_style_index_0_lang-D3W6EXAW.js";import{u as Dn}from"./useDocLink-ffxcUtfC.js";import{_ as wt}from"./FormItemLabel.vue_vue_type_style_index_0_lang-Ck9-NCDQ.js";import{u as jt}from"./useFormRules-BfOwVzOl.js";import{s as In}from"./setting-C_yJtbRY.js";import{c as Fn}from"./compareVersions-DqEOhma6.js";const Ln=(e,m,t)=>{En(t);const d=Fn(e,m);return Mt[t].includes(d)},Mt={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1],"!=":[-1,1]},Tt=Object.keys(Mt),En=e=>{if(typeof e!="string")throw new TypeError(`Invalid operator type, expected string but got ${typeof e}`);if(Tt.indexOf(e)===-1)throw new Error(`Invalid operator, expected one of ${Tt.join("|")}`)},kt=he({__name:"ArrayEditorTable",props:{modelValue:{type:Array},disabled:{type:Boolean}},emits:["update:modelValue"],setup(e,{emit:m}){const t=e,d=m,l=X({get(){return t.modelValue||[]},set(b){d("update:modelValue",b)}}),s=()=>{l.value.push("")},f=b=>{l.value.splice(b,1)};return(b,p)=>{const I=_("el-input"),V=_("el-table-column"),T=_("el-button"),N=_("el-table");return O(),te(N,{class:"key-and-value-editor shadow-none",data:u(l)},{default:B(()=>[a(V,null,{default:B(({$index:P})=>[a(I,{modelValue:u(l)[P],"onUpdate:modelValue":A=>u(l)[P]=A},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e.disabled?be("",!0):(O(),te(V,{key:0,width:"100"},{header:B(()=>[a(T,{link:"",type:"primary",onClick:s},{default:B(()=>[Se(ue(b.$t("Base.add")),1)]),_:1})]),default:B(({$index:P})=>[a(T,{link:"",type:"primary",onClick:A=>f(P)},{default:B(()=>[Se(ue(b.$t("Base.delete")),1)]),_:2},1032,["onClick"])]),_:1}))]),_:1},8,["data"])}}}),Rn={class:"TLS-base-config"},An=he({name:"TLSBaseConfig"}),xn=he({...An,props:{modelValue:{type:Object,default:()=>({})},readonly:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:m}){const t=e,d=m,l=X({get(){return t.modelValue},set(s){d("update:modelValue",s)}});return(s,f)=>{const b=_("el-switch"),p=_("el-form-item");return O(),ne("div",Rn,[_e("div",null,[a(p,{label:s.$t("Base.enableTLS")},{default:B(()=>[a(b,{modelValue:u(l).enable,"onUpdate:modelValue":f[0]||(f[0]=I=>u(l).enable=I),disabled:e.readonly||e.disabled},null,8,["modelValue","disabled"])]),_:1},8,["label"])])])}}}),jn={class:"common-tls-config"},Mn=he({name:"CommonTLSConfig"}),st=he({...Mn,props:{modelValue:{type:Object,default:()=>({})},isEdit:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},disabledBaseConfig:{type:Boolean,default:!1},disabledVerify:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:m}){const t=e,d=m,l=X({get(){return t.modelValue},set(s){d("update:modelValue",s)}});return(s,f)=>{const b=_("el-collapse-transition");return O(),ne("div",jn,[a(xn,{modelValue:u(l),"onUpdate:modelValue":f[0]||(f[0]=p=>Ce(l)?l.value=p:null),readonly:e.readonly,disabled:e.disabledBaseConfig},null,8,["modelValue","readonly","disabled"]),a(b,null,{default:B(()=>[u(l).enable?(O(),te(Et,Q({key:0,modelValue:u(l),"onUpdate:modelValue":f[1]||(f[1]=p=>Ce(l)?l.value=p:null),"is-edit":e.isEdit},s.$attrs,{readonly:e.readonly,disabledVerify:e.disabledVerify}),null,16,["modelValue","is-edit","readonly","disabledVerify"])):be("",!0)]),_:1})])}}}),Un={class:"guide-bar"},Nn={key:1,class:"icon-number"},Kn={class:"guide-title"},qn={key:2,class:"guide-desc"},Hn=he({__name:"GuideBar",props:{guideList:{type:Array,required:!0},descList:{type:Array,default:()=>[]},activeGuideIndexList:{type:Array,default:()=>[]}},setup(e){return(m,t)=>{const d=_("el-icon");return O(),ne("div",Un,[(O(!0),ne(fe,null,ke(e.guideList,(l,s)=>(O(),ne("div",{key:l,class:ct(["guide-item",{active:e.activeGuideIndexList.includes(s)}])},[e.activeGuideIndexList.includes(s)?(O(),te(d,{key:0,class:"el-icon-check"},{default:B(()=>[a(u(Vn))]),_:1})):(O(),ne("span",Nn,ue(s+1),1)),_e("span",Kn,ue(l),1),e.descList[s]?(O(),ne("span",qn,"("+ue(e.descList[s])+")",1)):be("",!0)],2))),128))])}}}),zn=["src","alt"],Gn={class:"target-type-item-bd"},Wn={class:"title"},Qn=he({__name:"TypeSelect",props:{modelValue:{}},emits:["update:modelValue"],setup(e,{emit:m}){const t=e,d=m,{tl:l}=$e("RuleEngine"),s=X({get(){return t.modelValue},set(I){d("update:modelValue",I)}}),{searchQuery:f,filteredConnectorTypeList:b}=nt(),{getBridgeIcon:p}=kn();return(I,V)=>{const T=_("el-input"),N=_("el-col"),P=_("el-row"),A=_("el-radio"),D=_("el-radio-group");return O(),ne(fe,null,[a(P,{class:"type-filter-bar"},{default:B(()=>[a(N,{span:8},{default:B(()=>[a(T,{modelValue:u(f),"onUpdate:modelValue":V[0]||(V[0]=g=>Ce(f)?f.value=g:null),placeholder:u(l)("typeSearch"),clearable:""},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),a(D,{class:"target-type-select is-connector",modelValue:u(s),"onUpdate:modelValue":V[1]||(V[1]=g=>Ce(s)?s.value=g:null)},{default:B(()=>[a(P,{gutter:28},{default:B(()=>[(O(!0),ne(fe,null,ke(u(b),g=>(O(),te(N,{key:g.label,span:8},{default:B(()=>[a(A,{class:"target-type-item",value:g.value,border:""},{default:B(()=>[_e("img",{class:"target-type-item-img",height:"64",width:"64",src:u(p)(g.value),alt:g.label},null,8,zn),_e("div",Gn,[_e("div",Wn,ue(g.label),1)])]),_:2},1032,["value"])]),_:2},1024))),128))]),_:1})]),_:1},8,["modelValue"])],64)}}}),Ut=e=>{const m=s=>{var f;return G.isString((f=s.resource_opts)==null?void 0:f.query_mode)&&s.resource_opts.query_mode.indexOf("async")>-1},t=X(()=>m(e.value)?{}:{"resource_opts.inflight_window":"col-hidden"});return{syncEtcFieldsClassMap:X(()=>t.value),handleSyncEtcFormData:s=>{let f=s;return m(s)||(f=G.omit(f,"resource_opts.inflight_window")),f}}},Yn=["start_timeout","worker_pool_size","request_ttl","health_check_interval","auto_restart_interval","max_buffer_bytes","batch_size","batch_time","query_mode","inflight_window"].map(e=>`resource_opts.${e}`),Jn=(e,m)=>{const t=(y,M)=>y.reduce((Y,oe,ae)=>({...Y,[oe]:ae+M}),{}),d=["pipelining","pool_type","pool_size","connect_timeout","max_inactive","max_retries",...Yn],l=["name","description"],s=l.length,f={...t(l,0),...t(d,99)},b=["pool_type","pool_size","connect_timeout","enable_pipelining"],p=["health_check_topic","min_metadata_refresh_interval","metadata_request_timeout","socket_opts.sndbuf","socket_opts.recbuf","socket_opts.tcp_keepalive","socket_opts.nodelay"],I=["recv_timeout","enable_pipelining"],V=["transport_options.headers","transport_options.request_timeout","transport_options.pool_type","transport_options.pool_size","transport_options.connect_timeout","transport_options.enable_pipelining","transport_options.max_retries","transport_options.ipv6_probe"],T={...t(["bootstrap_hosts","authentication","authentication.password","ssl","health_check_topic"],s),...G.omit(t(p,150),"health_check_topic")},N=t(["server","database","username","password","ssl","disable_prepared_statements"],s),P=t(["driver","server","base_url","authentication.username","authentication.password","username","password","protocol_version","iotdb_version","zoneId","ssl","recv_timeout","enable_pipelining"],s),A=["max_overflow","overflow_ttl","overflow_check_period","local_threshold_ms","connect_timeout_ms","socket_timeout_ms","server_selection_timeout_ms","wait_queue_timeout_ms","heartbeat_frequency_ms","min_heartbeat_frequency_ms"].map(y=>`topology.${y}`),D={[v.MQTT]:t(["server","clientid_prefix","username","password","keepalive","proto_ver","static_clientids","clean_start","ssl","retry_interval","bridge_mode","max_inflight"],s),[v.Webhook]:{...t(["url","headers"],s),...t(b,70)},[v.AzureEventHubs]:T,[v.KafkaProducer]:T,[v.KafkaConsumer]:T,[v.PgSQL]:N,[v.TimescaleDB]:N,[v.MatrixDB]:N,[v.MySQL]:t(["server","database","username","password","ssl"],s),[v.GCPProducer]:t(["pipelining"],s),[v.GCPConsumer]:t(["pipelining","service_account_json"],s),[v.MongoDB]:{...t(["parameters","mongo_type","server","servers","replica_set_name","w_mode","r_mode","database","username","password","auth_source","use_legacy_protocol","srv_record","ssl",...A],s),...t(b,70)},[v.Redis]:t(["parameters","servers","server","username","password","database","sentinel","pool_size","ssl"],s),[v.SysKeeperProxy]:t(["listen","acceptors","handshake_timeout"],s),[v.SysKeeperForwarder]:t(["server","ack_mode","ack_timeout"],s),[v.InfluxDB]:t(["server","parameters","token","org","bucket","database","username","password","ssl"],s),[v.IoTDB]:P,[v.Elasticsearch]:P,[v.AmazonKinesis]:t(["endpoint","aws_access_key_id","aws_secret_access_key"],s),[v.GreptimeDB]:t(["server","dbname","username","password","ssl"],s),[v.TDengine]:t(["server","username","password","token"],s),[v.OracleDatabase]:t(["server","service_name","sid","username","password"],s),[v.OpenTSDB]:t(["server","summary","details"],s),[v.Cassandra]:t(["servers","keyspace","username","password","ssl"],s),[v.RabbitMQ]:t(["server","port","username","password","virtual_host","heartbeat","timeout","ssl"],s),[v.RocketMQ]:t(["servers","namespace","access_key","secret_key","security_token"],s),[v.ClickHouse]:t(["url","database","username","password"],s),[v.S3]:t(["host","port","access_key_id","secret_access_key","access_method","transport_options.ssl",...V],s),[v.HStream]:t(["url","grpc_timeout","ssl"],s),[v.DynamoDB]:t(["region","url","aws_access_key_id","aws_secret_access_key"],s),[v.Pulsar]:t(["servers","authentication","ssl"],s),[v.MicrosoftSQLServer]:t(["server","database","username","password","driver"],s),[v.Couchbase]:t(["server","username","password"],s),[v.Datalayers]:t(["server","parameters.driver_type","parameters.database","parameters.username","parameters.password"],s),[v.Snowflake]:t(["server","dsn","account","username","password","proxy","ssl"],s),[v.Tablestore]:t(["endpoint","instance_name","access_key_id","access_key_secret","storage_model_type"],s)},g=X(()=>{let y=f;return e.type&&e.type in D&&(y={...y,...D[e.type]}),y}),$={service_account_json:"custom-col-24"},x={[v.GCPProducer]:$,[v.GCPConsumer]:$,[v.MongoDB]:{"parameters.mongo_type":"col-hidden"},[v.Redis]:{"parameters.redis_type":"col-hidden"},[v.InfluxDB]:{"parameters.influxdb_type":"col-hidden"},[v.S3]:{"transport_options.ssl":"col-ssl"}},E=["disable_prepared_statements"],h={[v.MQTT]:["retry_interval","bridge_mode","max_inflight"],[v.Webhook]:b,[v.AzureEventHubs]:p,[v.KafkaProducer]:p,[v.KafkaConsumer]:p,[v.Confluent]:p,[v.MongoDB]:["w_mode",/topology/],[v.SysKeeperForwarder]:["ack_mode","ack_timeout"],[v.IoTDB]:I,[v.Elasticsearch]:I,[v.RabbitMQ]:["heartbeat","timeout"],[v.S3]:V,[v.PgSQL]:E,[v.TimescaleDB]:E,[v.MatrixDB]:E},c=X(()=>{const y=e.type?h[e.type]||[]:[];return[...d,...y]}),{syncEtcFieldsClassMap:r}=Ut(m),i=X(()=>{let y=e.type?x[e.type]||{}:{};return G.isFunction(y)&&(y=y(m.value)),{...r.value,name:"dividing-line-below",type:"col-hidden",enable:"col-hidden",ssl:"col-ssl col-need-row",...y}});return{propsOrderMap:g,customColClass:i,advancedFields:c}},Xn=["restapi","thrift"],Ee="driver",Zn=e=>{const m=Ee,{typeWithMultipleRefKeyMap:t}=ut(),d=t.get(v.IoTDB)||[],l={restapi:d.find(b=>new RegExp("restapi").test(b))??"",thrift:d.find(b=>new RegExp("thrift").test(b))??""},s=X(()=>{var b;return(b=e.value)==null?void 0:b[m]});return{currentRef:X(()=>s.value===void 0?l.restapi:l[s.value]),keyField:m}},eo=(e,m)=>({getI18nPrefix:t=>`BridgeSchema.${t}.`,setLabelAndDesc:(t,d)=>{t&&(t.label=e(`${d}.label`),m(`${d}.desc`)&&(t.description=e(`${d}.desc`)))}}),to=e=>{const{tl:m}=$e("RuleEngine");return{ruleWhenEditing:[{validator:(d,l,s)=>{e.edit&&!Yt.test(l)&&(/^\*{1,5}$/.test(l)||/^\*{6}.+$/.test(l))&&s(new Error(m("changePwdTip"))),s()}}]}},no=e=>(e.format="password",e),oo=e=>{const{t:m,tl:t,te:d}=$e("RuleEngine"),{getI18nPrefix:l,setLabelAndDesc:s}=eo(m,d),{ruleWhenEditing:f}=to(e),{createCommonIdRule:b}=jt(),p=w=>(w.password||(w.password=[]),Array.isArray(w.password)&&w.password.push(...f),w.name||(w.name=[]),Array.isArray(w.name)&&w.name.push(...b()),w),{createSSLForm:I}=hn(),V=Object.keys(I()),T="ssl",N=w=>{const C=o=>(Object.entries(o).forEach(([H,F])=>{F.properties&&(F.key===T?(F.properties=G.pick(F.properties,V),F.properties.verify&&(F.properties.verify.default=Jt)):C(F.properties))}),o);return C(w)},P=({components:w,rules:C})=>{var Z,L,K,ie;const o=w;o.enable&&Reflect.deleteProperty(o,"enable"),e.edit&&o.name&&(o.name.componentProps={disabled:!0}),(L=(Z=o.resource_opts)==null?void 0:Z.properties)!=null&&L.batch_time&&Reflect.deleteProperty(o.resource_opts.properties,"batch_time"),(ie=(K=o.resource_opts)==null?void 0:K.properties)!=null&&ie.start_after_created&&Reflect.deleteProperty(o.resource_opts.properties,"start_after_created"),o.tags&&Reflect.deleteProperty(o,"tags");const H=N(o),F=p(C);return{components:H,rules:F}},A=({components:w,rules:C})=>{var F,Z,L,K;const o=w;o!=null&&o.server&&(o.server.componentProps={placeholder:"broker.emqx.io:1883"}),((F=o==null?void 0:o.retry_interval)==null?void 0:F.type)==="string"&&(o.retry_interval.type="duration"),((Z=o==null?void 0:o.keepalive)==null?void 0:Z.type)==="string"&&(o.keepalive.type="duration");const H=l(v.MQTT);if((K=(L=o==null?void 0:o.static_clientids)==null?void 0:L.items)!=null&&K.properties){const ie=o.static_clientids.items.properties;ie.ids&&s(ie.ids,`${H}ids`),ie.node&&s(ie.node,`${H}node`)}return{components:o,rules:C}},D=({components:w,rules:C})=>{var H,F,Z;const o=w;return o.url&&!o.url.default&&(o.url.default="http://"),(H=o==null?void 0:o.headers)!=null&&H.default&&(o.headers.default=G.pick(o.headers.default,"content-type")),(Z=(F=o==null?void 0:o.ssl)==null?void 0:F.properties)!=null&&Z.verify&&(o.ssl.properties.verify.default=bt.get(!1)),{components:o,rules:C}},g=({components:w,rules:C})=>{var H,F,Z;const o=(H=w.authentication)==null?void 0:H.oneOf;if(o){w.authentication.oneOf=o.reverse();const L=(Z=(F=o.find(({properties:K})=>K==null?void 0:K.password))==null?void 0:F.properties)==null?void 0:Z.password;L&&no(L)}return{components:w,rules:C}},$=["enable","verify","server_name_indication","cacertfile","certfile","keyfile"],x=({components:w,rules:C})=>{var Z;const{authentication:o,ssl:H}=w,{password:F}=(o==null?void 0:o.properties)||{};return(F==null?void 0:F.type)==="string"&&(F.format="password",F.labelKey="connection_string"),H&&((Z=H==null?void 0:H.properties)!=null&&Z.verify&&(H.properties.verify.default=bt.get(!1)),H.properties=G.pick(H.properties,$)),{components:w,rules:C}},E=w=>{const{components:C,rules:o}=P(w);return C!=null&&C.ssl&&(C.ssl.properties=G.pick(C.ssl.properties,$),C.ssl.componentProps={hideVerify:!0}),{components:C,rules:o}},h=({components:w,rules:C})=>{const{service_account_json:o}=w;return(o==null?void 0:o.type)==="string"&&(o.format="file",o.componentProps={accept:".json",tip:m("Base.uploadTip",{format:"JSON"})}),C&&!C.service_account_json&&(C.service_account_json=[]),C.service_account_json&&Array.isArray(C.service_account_json)&&C.service_account_json.push({validator(H,F){return new Promise((Z,L)=>{try{JSON.parse(F),Z(!0)}catch{L(t("accountJSONError"))}})},trigger:"blur"}),{components:w,rules:C}},c=["single","rs","sharded"],r=w=>c.findIndex(C=>w.includes(C)),i=({components:w,rules:C})=>{var H;const{parameters:o}=w;if(o){(H=o.oneOf)==null||H.sort((de,re)=>r(de.$ref||"")-r(re.$ref||""));const F=o.oneOf||[],Z=F==null?void 0:F.find(de=>{var re;return(re=de.$ref)==null?void 0:re.includes("single")});Z&&(o.default=G.cloneDeep(Z.default));const L=F==null?void 0:F.find(de=>{var re;return(re=de.$ref)==null?void 0:re.includes("rs")}),{servers:K}=(L==null?void 0:L.properties)||{};K&&(K.componentProps={type:"textarea",rows:3});const ie=F==null?void 0:F.find(de=>{var re;return(re=de.$ref)==null?void 0:re.includes("sharded")}),{servers:Ve}=(ie==null?void 0:ie.properties)||{};Ve&&(Ve.componentProps={type:"textarea",rows:3})}return{components:w,rules:C}},y=["single","sentinel","cluster"],M=w=>y.findIndex(C=>w.includes(C)),Y=({components:w,rules:C})=>{var H;const{parameters:o}=w;if(o){(H=o.oneOf)==null||H.sort((de,re)=>M(de.$ref||"")-M(re.$ref||""));const F=o.oneOf||[],Z=F==null?void 0:F.find(de=>{var re;return(re=de.$ref)==null?void 0:re.includes("single")});Z&&(o.default=G.cloneDeep(Z.default));const L=F==null?void 0:F.find(de=>{var re;return(re=de.$ref)==null?void 0:re.includes("sentinel")}),{servers:K}=(L==null?void 0:L.properties)||{};K&&(K.componentProps={type:"textarea",rows:3});const ie=F==null?void 0:F.find(de=>{var re;return(re=de.$ref)==null?void 0:re.includes("cluster")}),{servers:Ve}=(ie==null?void 0:ie.properties)||{};Ve&&(Ve.componentProps={type:"textarea",rows:3})}return{components:w,rules:C}},oe=({components:w,rules:C})=>{const{parameters:o}=w;if(o){const H=o.oneOf||[],F=H==null?void 0:H.find(Z=>{var L;return(L=Z.$ref)==null?void 0:L.includes("influxdb_api_v2")});F&&(o.default=G.cloneDeep(F.default))}return{components:w,rules:C}},ae=w=>{var H;const{components:C,rules:o}=P(w);return((H=C==null?void 0:C.aws_secret_access_key)==null?void 0:H.type)==="string"&&(C.aws_secret_access_key.format="password"),{components:C,rules:o}},ee=w=>{const{components:C,rules:o}=P(w);return Reflect.deleteProperty(C,"ssl"),Reflect.deleteProperty(o,"ssl"),{components:C,rules:o}},U=({components:w,rules:C})=>{var H;const o=(H=w.authentication)==null?void 0:H.oneOf;return o&&(w.authentication.oneOf=o.reverse()),{components:w,rules:C}},R=w=>{var o,H;const{components:C={}}=w;return C[Ee]&&(((o=C[Ee].symbols)==null?void 0:o.length)===1&&(C[Ee].default=(H=C[Ee].symbols)==null?void 0:H[0]),C[Ee].symbols=Xn),C.iotdb_version.symbols&&(C.iotdb_version.symbols=C.iotdb_version.symbols.filter(F=>typeof F!="string"?!0:Ln(F.replace("v",""),"1.3.0",">="))),{...w,components:C}},J=new Map([[v.MQTT,A],[v.Webhook,D],[v.KafkaProducer,g],[v.KafkaConsumer,g],[v.AzureEventHubs,x],[v.Confluent,E],[v.Confluent,E],[v.GCPProducer,h],[v.GCPConsumer,h],[v.MongoDB,i],[v.Redis,Y],[v.InfluxDB,oe],[v.AmazonKinesis,ae],[v.GreptimeDB,ee],[v.Pulsar,U],[v.IoTDB,R]]);return{getComponentsHandler:()=>{const w=e.type&&J.get(e.type);return w?C=>{const o=P(C);return w(o)}:P}}},so=()=>{const e=t=>t.reduce((d,l)=>`${d}${d.length?".":""}${l}.properties`,"");return{fillNewRecord:({components:t,record:d},{components:l,record:s})=>{let f=G.cloneDeep(s);const b=[],p=[],I=(V,T=[],N)=>{const P=Object.keys(V),A=N==="new"?l:t;P.forEach(D=>{const g=e(T),$=`${g}${g.length?".":""}${D}`,x=T.length>0?`${T.join(".")}.${D}`:D;if(V[D].properties){if(D==="ssl")return;const E=[...T,D];N==="old"&&G.get(A,$)===void 0?b.push(x):I(V[D].properties,E,N)}else G.get(A,$)===void 0&&(N==="new"?p.push(x):b.push(x))})};return I(t,[],"new"),I(l,[],"old"),f=G.omit(f,b),p.forEach(V=>{G.set(f,V,G.get(d,V))}),f}}},ao={class:"schema-form-integration connector-config"},lo=he({__name:"ConnectorSchemaForm",props:{modelValue:{default:void 0},type:{},edit:{type:Boolean},copy:{type:Boolean},isLoading:{type:Boolean},readonly:{type:Boolean},formProps:{default:()=>({})},hiddenFields:{},isUsingInFlow:{type:Boolean}},emits:["update:modelValue","init"],setup(e,{expose:m,emit:t}){const{getTypeRefKey:d}=ut(),l=e,s=t,f=X({get(){return l.modelValue||{}},set(U){s("update:modelValue",U)}}),b=X(()=>l.isUsingInFlow?24:12),{handleSyncEtcFormData:p}=Ut(f),I=se(!1),V=se(),T=X(()=>({labelWidth:void 0,labelPosition:"top",requireAsteriskPosition:"right",class:"",...l.formProps})),{propsOrderMap:N,customColClass:P,advancedFields:A}=Jn(l,f),D=X(()=>{const U=P.value;return l.hiddenFields&&l.hiddenFields.forEach(R=>U[R]="col-hidden"),U}),{currentRef:g,keyField:$}=Zn(f),x=new Map([[v.IoTDB,g]]),E=new Map([[v.IoTDB,$]]),h=X(()=>{if(!l.type)return;const U=x.get(l.type);return U?U.value:d(l.type)}),{getComponentsHandler:c}=oo(l),{fillNewRecord:r}=so(),i=(U,R)=>{var C,o;const J=E.get(l.type??"");if(!J)return!1;const ce=(C=R[J])==null?void 0:C.default;return((o=U[J])==null?void 0:o.default)!==ce},y=(U,R)=>{const J=E.get(l.type??"");return J?!R[J]&&U[J]:!1},M=({newVal:U,oldVal:R})=>{const{record:J}=U,{record:ce}=R;i(U.components,R.components)&&!y(J,ce)&&(f.value={...r(U,R),type:U.record.type})},Y=U=>{Object.keys(U).length>0&&(f.value=U)},oe=U=>{s("init",U)};return m({getFormRecord:()=>p(G.cloneDeep(V.value.configForm)),validate:()=>{var U;return(U=V.value)!=null&&U.validate?V.value.validate():Promise.resolve()}}),(U,R)=>{const J=No;return O(),ne("div",ao,[u(h)?(O(),te(J,{key:0,ref_key:"formCom",ref:V,type:"connector","need-rules":"","schema-file-path":("getAPIPath"in U?U.getAPIPath:u(Pt))("/schemas/connectors"),"need-footer":!1,"need-record":!U.edit&&!U.copy,form:u(f),"according-to":{ref:`#/components/schemas/${u(h)}`},readonly:"readonly"in U?U.readonly:u(Xt),"btn-loading":u(I),"record-loading":U.isLoading,"form-item-span":u(b),"use-tooltip-show-desc":!0,"props-order-map":u(N),"custom-col-class":u(D),"form-props":u(T),"advanced-fields":u(A),"data-handler":u(c)(),onUpdate:Y,onComponentChange:M,onInit:oe},null,8,["schema-file-path","need-record","form","according-to","readonly","btn-loading","record-loading","form-item-span","props-order-map","custom-col-class","form-props","advanced-fields","data-handler"])):be("",!0)])}}}),ro=e=>{const m=new Map([]);return{formCom:X(()=>e.value?m.get(e.value)||lo:null)}};function co(e){const m=se([0]),t=se(0),d=se([]);return{activeGuidesIndex:m,step:t,guideDescList:d,handleNext:function(){t.value+=1,m.value.push(t.value)},handleBack:function(){t.value-=1,m.value.pop(),d.value.pop()}}}const io={key:1,class:"type-select-container"},uo={key:2,class:"form-container bridge-config"},po={class:"form-ft"},mo=he({__name:"ConnectorCreate",props:{type:{}},emits:["submitted","cancel"],setup(e,{emit:m}){const t=e,d=m,l=en(),s=tn(),{t:f,tl:b}=$e("RuleEngine"),p=X(()=>l.name==="connector-create"),{connectorTypeList:I}=nt(),V=se(I[0].value),T=se(),N=se({}),{formCom:P}=ro(V),A=()=>{N.value={}},{step:D,activeGuidesIndex:g,guideDescList:$,handleNext:x,handleBack:E}=co(),h=()=>{$.value.pop(),E(),gt()},{getTypeStr:c}=nt(),r=()=>{D.value===0&&(A(),$.value.push(c(V.value)||""),gt()),x()},i=X(()=>V.value===v.SysKeeperProxy),y=()=>{p.value?s.push({name:"connector"}):d("cancel")},M=se(!1),{getConnectorDetail:Y,addConnector:oe,handleDataForCopy:ae,isTesting:ee,testConnectivity:U}=vn(),R=se(!1),J=se(void 0),ce=async()=>{try{await _t(T.value),M.value=!0;const L=await oe(N.value);if(p.value){if(i.value){s.push({name:"connector"});return}J.value=L,R.value=!0}else d("submitted",L.name)}catch{}finally{M.value=!1}},w=async()=>{try{await _t(T.value),await U(N.value),Ke.success(b("connectionSuccessful"))}catch{}},C=L=>{V.value=L,D.value=1},o=X(()=>!!(l.query.action==="copy"&&l.query.target)),H=se(!1);return(async()=>{var L,K,ie;if(!(!o.value||!p.value))try{const Ve=((ie=(K=l.query.target)==null?void 0:K.slice(0,(L=l.query.target)==null?void 0:L.indexOf(":")))==null?void 0:ie.toString())||"";if(!Ve)return;C(Ve),H.value=!0;const de=await Y(l.query.target);de&&(N.value={...ae(de),name:Zt(de.name)})}catch{}finally{H.value=!1}})(),(()=>{!p.value&&t.type&&C(t.type)})(),(L,K)=>{const ie=wn,Ve=Hn,de=_("el-alert"),re=_("el-button"),Ne=_("el-card");return O(),ne(fe,null,[_e("div",{class:ct(["connector-create",[u(p)?"app-wrapper":"","action-create"]])},[u(p)?(O(),te(ie,{key:0,item:{name:u(b)("createConnector"),routeName:"connector"}},null,8,["item"])):be("",!0),a(Ne,{class:"app-card"},{default:B(()=>[u(p)?(O(),te(Ve,{key:0,"guide-list":[u(b)("connectorType"),u(b)("configuration")],"active-guide-index-list":u(g),"desc-list":u($)},null,8,["guide-list","active-guide-index-list","desc-list"])):be("",!0),u(D)===0?(O(),ne("div",io,[a(Qn,{modelValue:u(V),"onUpdate:modelValue":K[0]||(K[0]=De=>Ce(V)?V.value=De:null)},null,8,["modelValue"])])):u(D)===1?(O(),ne("div",uo,[u(i)?(O(),te(de,{key:0,"show-icon":"",type:"info",closable:!1,title:u(b)("sysKeeperProxyDesc")},null,8,["title"])):be("",!0),(O(),te(nn(u(P)),{ref_key:"FormCom",ref:T,modelValue:u(N),"onUpdate:modelValue":K[1]||(K[1]=De=>Ce(N)?N.value=De:null),type:u(V),copy:u(o)},null,8,["modelValue","type","copy"]))])):be("",!0),_e("div",po,[u(p)&&u(D)===0||!u(p)?(O(),te(re,{key:0,onClick:y},{default:B(()=>[Se(ue(L.$t("Base.cancel")),1)]),_:1})):be("",!0),u(D)===0?(O(),te(re,{key:1,type:"primary",disabled:u(M),onClick:r},{default:B(()=>[Se(ue(L.$t("Base.nextStep")),1)]),_:1},8,["disabled"])):u(D)===1?(O(),ne(fe,{key:2},[u(p)?(O(),te(re,{key:0,disabled:u(M),onClick:h},{default:B(()=>[Se(ue(L.$t("Base.backStep")),1)]),_:1},8,["disabled"])):be("",!0),a(re,{type:"primary",plain:"",loading:u(ee),disabled:!L.$hasPermission("post"),onClick:w},{default:B(()=>[Se(ue(u(b)("testTheConnection")),1)]),_:1},8,["loading","disabled"]),a(re,{type:"primary",loading:u(M),disabled:!L.$hasPermission("post"),onClick:ce},{default:B(()=>[Se(ue(L.$t("Base.create")),1)]),_:1},8,["loading","disabled"])],64)):be("",!0)])]),_:1})],2),a(Tn,{modelValue:u(R),"onUpdate:modelValue":K[2]||(K[2]=De=>Ce(R)?R.value=De:null),connector:u(J),title:u(f)("Base.createSuccess"),"confirm-text":u(b)("createRule"),"cancel-text":u(b)("backConnectorList"),"cancel-callback":()=>u(s).push({name:"connector"})},null,8,["modelValue","connector","title","confirm-text","cancel-text","cancel-callback"])],64)}}}),fo=he({__name:"ConnectorCreateDrawer",props:{modelValue:{type:Boolean},type:{}},emits:["update:modelValue","submitted"],setup(e,{emit:m}){const t=e,d=m,l=X({get(){return t.modelValue},set(p){d("update:modelValue",p)}}),{tl:s}=$e("RuleEngine"),f=p=>{l.value=!1,d("submitted",p)},b=()=>l.value=!1;return(p,I)=>{const V=_("el-drawer");return O(),te(V,{title:u(s)("createConnector"),modelValue:u(l),"onUpdate:modelValue":I[0]||(I[0]=T=>Ce(l)?l.value=T:null),"lock-scroll":!1,class:"connector-create-drawer",size:"60%","destroy-on-close":"","append-to-body":""},{default:B(()=>[a(mo,{type:p.type,onSubmitted:f,onCancel:b},null,8,["type"])]),_:1},8,["title","modelValue"])}}}),yo={class:"connector-select"},bo=he({__name:"ConnectorSelect",props:{modelValue:{},type:{},webhookConnectorDisabled:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(e,{emit:m}){const t=e,d=m,l=X({get(){return t.modelValue||""},set(A){d("update:modelValue",A)}}),s=se([]),f=async()=>{try{s.value=await Sn()}catch{}};f();const b=X(()=>t.type?s.value.filter(A=>A.type===t.type):[]),{judgeIsWebhookConnector:p}=Cn(),I=A=>t.webhookConnectorDisabled?p(A):!1,{tl:V}=$e("RuleEngine"),T=se(!1),N=()=>T.value=!0,P=A=>{l.value=A,f()};return(A,D)=>{const g=_("el-option"),$=_("el-select"),x=_("el-button"),E=_("el-tooltip");return O(),ne("div",yo,[a($,{modelValue:u(l),"onUpdate:modelValue":D[0]||(D[0]=h=>Ce(l)?l.value=h:null)},{default:B(()=>[(O(!0),ne(fe,null,ke(u(b),h=>(O(),te(g,{label:h.name,value:h.name,key:h.name,disabled:I(h)},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"]),a(E,{content:u(V)("createConnector"),placement:"top"},{default:B(()=>[a(x,{class:"btn-add",icon:u(Dt),disabled:!A.$hasPermission("post"),onClick:N},null,8,["icon","disabled"])]),_:1},8,["content"]),a(fo,{modelValue:u(T),"onUpdate:modelValue":D[1]||(D[1]=h=>Ce(T)?T.value=h:null),type:A.type,onSubmitted:P},null,8,["modelValue","type"])])}}}),go={key:0,class:"value"},at=he({__name:"ArrayEditor",props:{modelValue:{type:Array},default:{default:()=>[]},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},allowDuplicates:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:m}){const t=e,d=m,l=X({get(){return t.modelValue||[]},set(b){d("update:modelValue",b)}}),{tl:s}=$e("Base"),f=async b=>{if(t.allowDuplicates)return;l.value.some(I=>I===b)&&(Ke({type:"info",message:s("duplicatedInput"),duration:1e3}),await It(),l.value=l.value.slice(0,-1))};return(b,p)=>{const I=_("el-input-tag");return e.readonly?(O(),ne("p",go,ue(Array.isArray(e.modelValue)?e.modelValue.join(", "):e.modelValue),1)):(O(),te(I,{key:1,class:"array-editor",modelValue:u(l),"onUpdate:modelValue":p[0]||(p[0]=V=>Ce(l)?l.value=V:null),disabled:e.disabled,placeholder:b.$t("Base.enterToCreate"),onAddTag:f},{tag:B(({value:V})=>[a(Pn,{content:V},null,8,["content"])]),_:1},8,["modelValue","disabled","placeholder"]))}}}),_o={class:"batch-settings"},ho=["href"],lt=he({__name:"BatchSettings",props:{type:{}},emits:["uploadedData"],setup(e,{emit:m}){const t=e,d=m,{locale:l}=it(),{tl:s}=$e("General"),f=se(null),b=se(!1),p=se([]),I=se(!1),{docMap:V}=Dn(),T={[Te.InfluxDB]:V.influxDbBatchSettings,[Te.TDengine]:V.tdengineBatchSettings,[Te.IoTDB]:V.iotDbBatchSettings,[Te.Datalayers]:V.datalayersBatchSettings},N={[Te.InfluxDB]:"InfluxDB",[Te.TDengine]:"TDengine",[Te.IoTDB]:"IoTDB",[Te.Datalayers]:"Datalayers"},{processTDengineData:P,processIoTDBData:A,processInfluxDBData:D,readFileAndParse:g,handleDownloadTemp:$,templateContentMap:x}=on(l.value==="zh"?"zh":"en");function E(){const r=x[t.type];$(r,`EMQX_${N[t.type]}_Template.csv`)}async function h(r){return g(r,an)}async function c(){var r;I.value=!0;try{if(p.value.length>0){const i=p.value[0].raw,y=await h(i);let M;[Te.Datalayers,Te.InfluxDB].includes(t.type)?M=await D(y):t.type===Te.TDengine?M=await P(y):t.type===Te.IoTDB&&(M=await A(y)),d("uploadedData",M),p.value=[],(r=f.value)==null||r.clearFiles(),b.value=!1}else Ke.warning(s("pleaseUploadFile"))}catch(i){i instanceof Error&&Ke.error(i.message)}finally{I.value=!1}}return(r,i)=>{const y=_("el-button"),M=_("i18n-t"),Y=_("el-step"),oe=_("el-steps"),ae=_("el-dialog");return O(),ne("div",_o,[a(y,{link:"",type:"primary",class:"btn",onClick:i[0]||(i[0]=ee=>b.value=!0)},{default:B(()=>[Se(ue(r.$t("Base.batchSetting")),1)]),_:1}),a(ae,{title:r.$t("Base.importBatchSetting"),modelValue:u(b),"onUpdate:modelValue":i[3]||(i[3]=ee=>Ce(b)?b.value=ee:null),"modal-class":"batch-settings-dialog","destroy-on-close":"","append-to-body":"","close-on-click-modal":!1},{footer:B(()=>[a(y,{onClick:i[2]||(i[2]=ee=>b.value=!1)},{default:B(()=>[Se(ue(r.$t("Base.cancel")),1)]),_:1}),a(y,{type:"primary",onClick:c,loading:u(I)},{default:B(()=>[Se(ue(r.$t("Base.import")),1)]),_:1},8,["loading"])]),default:B(()=>[a(oe,{direction:"vertical"},{default:B(()=>[a(Y,null,{title:B(()=>[_e("div",null,ue(r.$t("Base.downloadTemplatePrompt")),1),_e("ul",null,[_e("li",null,ue(r.$t("Base.batchSettingDownloadFirst")),1),a(M,{keypath:"Base.moreImportInstructions",tag:"li"},{link:B(()=>[_e("a",{href:T[r.type],target:"_blank"},ue(r.$t("Base.helpDocs")),9,ho)]),_:1})])]),description:B(()=>[a(y,{type:"primary",plain:"",onClick:E},{default:B(()=>[Se(ue(r.$t("Base.downloadTemplate")),1)]),_:1})]),_:1}),a(Y,null,{title:B(()=>[_e("div",null,ue(r.$t("Base.uploadFile")),1),_e("ul",null,[_e("li",null,ue(r.$t("Base.csvFileLimit")),1)])]),description:B(()=>[a(u(sn),{ref_key:"UploadRef",ref:f,"auto-upload":!1,"file-list":u(p),"onUpdate:fileList":i[1]||(i[1]=ee=>Ce(p)?p.value=ee:null),limit:1,accept:".csv"},{default:B(()=>[a(y,{type:"primary",plain:""},{default:B(()=>[Se(ue(r.$t("Base.uploadFile")),1)]),_:1})]),_:1},8,["file-list"])]),_:1})]),_:1})]),_:1},8,["title","modelValue"])])}}}),rt=he({components:{TimeInputWithUnitSelect:Rt,InputWithUnit:At,ArrayEditor:at,OneOf:xt,CommonTLSConfig:st,Monaco:tt,CustomInputNumber:He,InputWithPlaceholderSelect:Re},props:{modelValue:{type:[String,Number,Boolean,Array,Object]},type:{type:String},placeholder:{type:String},disabled:{type:Boolean},format:{type:String},symbols:{type:Array,default:()=>[]},defaultValue:{type:[Array,String,Boolean,Number]},oneOf:{type:Array,default:()=>[]},isEdit:{type:Boolean},customProps:{type:Object},property:{type:Object}},setup(e,m){const t=X({get(){return e.modelValue},set(l){m.emit("update:modelValue",l)}}),d=()=>{var A,D,g,$,x,E;const l=e.format,s=e.disabled,f=(A=e.property)==null?void 0:A.rows,b=(D=e.property)==null?void 0:D.placeholder,p=l==="password"?"password":l==="textarea"?"textarea":"text",I=p==="password"?"one-time-code":"",V=p==="password",T=e.customProps||{},N=!!((g=e.property)!=null&&g.is_template),P=a(_("el-input"),Q({disabled:s,placeholder:b,modelValue:t.value,"onUpdate:modelValue":h=>t.value=h,type:p,rows:f,autocomplete:I,showPassword:V},T,{clearable:!0}),null);switch(e.type){case"string":return e.format==="sql"?a("div",{class:"monaco-container"},[a(_("monaco"),Q({id:qe(),modelValue:t.value,"onUpdate:modelValue":h=>t.value=h,lang:"sql",disabled:s},T),null)]):N?a(Re,Q({modelValue:t.value,"onUpdate:modelValue":h=>t.value=h,disabled:s,type:p,clearable:!0,oneOf:($=e.property)==null?void 0:$.oneOf},T),null):e.format==="password"?a(Ft,Q({disabled:s,placeholder:b,modelValue:t.value,"onUpdate:modelValue":h=>t.value=h,clearable:!0},T),null):P;case"number":return a(He,Q({disabled:s,modelValue:t.value,"onUpdate:modelValue":h=>t.value=h,placeholder:b,min:0},T),null);case"enum":return N?a(Re,Q({modelValue:t.value,"onUpdate:modelValue":h=>t.value=h,disabled:s,type:p,clearable:!0},T,{options:e.symbols,oneOf:(x=e.property)==null?void 0:x.oneOf}),null):a(_("el-select"),Q({disabled:s,placeholder:b,modelValue:t.value,"onUpdate:modelValue":h=>t.value=h,clearable:!0},T),{default:()=>{var h;return[(h=e.symbols)==null?void 0:h.map(c=>a(_("el-option"),{value:c,label:c},null))]}});case"boolean":return a(_("el-switch"),{disabled:s,modelValue:t.value,"onUpdate:modelValue":h=>t.value=h},null);case"array":{const h=(E=e.property)==null?void 0:E.items;return["number","string"].includes(h==null?void 0:h.type)?a(_("array-editor"),{modelValue:t.value,"onUpdate:modelValue":c=>t.value=c,disabled:s,type:h==null?void 0:h.type,default:e.defaultValue},null):a("div",null,null)}case"duration":return a(_("time-input-with-unit-select"),{disabled:s,modelValue:t.value,"onUpdate:modelValue":h=>t.value=h},null);case"byteSize":return a(_("input-with-unit"),{disabled:s,modelValue:t.value,"onUpdate:modelValue":h=>t.value=h,units:["MB","GB","KB","B"]},null);case"percent":return a(_("input-with-unit"),{disabled:s,modelValue:t.value,"onUpdate:modelValue":h=>t.value=h,units:["%"]},null);case"comma_separated_string":return P;case"oneof":return a(_("one-of"),{items:e.oneOf,disabled:s,modelValue:t.value,"onUpdate:modelValue":h=>t.value=h},null);case"ssl":return a(_("common-tls-config"),{modelValue:t.value,"onUpdate:modelValue":h=>t.value=h,isEdit:!!e.isEdit},null);case"sql":return a("div",{class:"monaco-container"},[a(_("monaco"),{id:qe(),modelValue:t.value,"onUpdate:modelValue":h=>t.value=h,lang:"sql",disabled:s},null)]);case"object":return a(ot,Q({modelValue:t.value,"onUpdate:modelValue":h=>t.value=h},T),null);default:return P}};return()=>d()}}),dt=()=>{const e=t=>{const{type:d,default:l}=t;if(l!==void 0)return l;switch(d){case Fe.Array:return[];case Fe.Enum:return Array.isArray(t.symbols)&&t.symbols.length>0?t.symbols[0]:"";case Fe.Boolean:return!1;case Fe.Number:return;case Fe.Object:return{};default:return""}};return{createInitValueByType:e,initRecordByComponents:t=>{const d={},l=s=>{Object.keys(s).forEach(f=>{const b=s[f],{path:p,properties:I}=b;if(p)if(typeof I=="object")G.set(d,p,{}),l(I);else{const V=e(b);G.set(d,p,V)}})};return l(t),d}}},vo={key:0,class:"object-array-editor"},Co={class:"header-settings"},So={key:1,class:"object-array-editor"},Vo={key:0,class:"obj-list"},wo={class:"obj-item-bd"},To=he({__name:"ObjectArrayEditor",props:{modelValue:{type:Array,default:()=>[]},properties:{type:Object,default:()=>({})},propKey:{type:String,required:!0},readonly:{type:Boolean,default:!1},disabled:{type:Boolean},editMode:{type:String,default:"table"},rules:{type:Object},inPlugins:{type:Boolean,default:!1},columnsProps:{type:Object},dbType:{type:String}},emits:["update:modelValue","add-item","delete-item"],setup(e,{emit:m}){const t=e,d=m,l=se(1),s=se(50),f=se(!1),{tl:b}=$e("Base");Le(()=>t.modelValue,r=>{f.value=r.length>50&&t.editMode==="table"&&t.dbType!==void 0},{deep:!0});const p=X({get(){return t.modelValue},set(r){d("update:modelValue",r)}}),I=X(()=>{if(f.value){const r=(l.value-1)*s.value,i=r+s.value;return p.value.slice(r,i)}else return p.value}),V=se(),{initRecordByComponents:T}=dt(),N=r=>Object.keys(r).map(i=>({[i]:""})).reduce((i,y)=>({...i,...y}),{}),P=X(()=>Array.from({length:p.value.length},()=>qe())),A=r=>{const{key:i,type:y}=r;return i&&t.columnsProps&&t.columnsProps[i]!==void 0?t.columnsProps[i]:y==="object"?{width:300}:{}},D=()=>{let r;t.inPlugins?r=N(t.properties):r=G.get(T(t.properties),t.propKey);const i=G.cloneDeep(r);p.value=[...p.value,i],d("add-item")},g=r=>{p.value=[...p.value.slice(0,r),...p.value.slice(r+1)],d("delete-item")},$=(r,i)=>`${t.propKey}.${r}.${i}`,x=r=>{if(!t.rules)return;const i=`${t.propKey}.${r}`;return t.rules[i]},E=r=>{p.value=r},h=r=>{s.value=r,l.value=1},c=r=>{l.value=r};return ln(async()=>{var r;await It(),G.isFunction((r=V.value)==null?void 0:r.doLayout)&&V.value.doLayout()}),(r,i)=>{const y=_("el-scrollbar"),M=_("el-table-column"),Y=lt,oe=_("el-button"),ae=_("el-table"),ee=_("el-pagination"),U=_("el-icon");return e.editMode!=="list"?(O(),ne("div",vo,[a(ae,{class:"key-and-value-editor shadow-none",ref_key:"TableCom",ref:V,data:u(I)},{default:B(()=>[(O(!0),ne(fe,null,ke(e.properties,(R,J)=>(O(),te(M,Q({key:J,ref_for:!0},A(R)),{header:B(()=>[_e("label",{class:ct(x(J)&&"is-required")},ue(R.label),3),R.description?(O(),te(Ze,{key:0},{content:B(()=>[a(y,{"max-height":"350px"},{default:B(()=>[a(et,{content:R.description,"in-tooltip":""},null,8,["content"])]),_:2},1024)]),_:2},1024)):be("",!0)]),default:B(({$index:ce})=>[u(I)[ce]!==void 0?(O(),te(Ue,{key:0,prop:$(ce,J),rules:x(J)},{default:B(()=>[a(u(rt),{modelValue:u(I)[ce][J],"onUpdate:modelValue":w=>u(I)[ce][J]=w,type:R.type,format:R.format,symbols:R.symbols,placeholder:R.placeholder,"custom-props":R.componentProps,property:R},null,8,["modelValue","onUpdate:modelValue","type","format","symbols","placeholder","custom-props","property"])]),_:2},1032,["prop","rules"])):be("",!0)]),_:2},1040))),128)),e.disabled?be("",!0):(O(),te(M,{key:0,width:e.dbType?"170px":"100px"},{header:B(()=>[_e("div",Co,[e.dbType?(O(),te(Y,{key:0,type:e.dbType,onUploadedData:E},null,8,["type"])):be("",!0),a(oe,{link:"",type:"primary",onClick:D},{default:B(()=>[Se(ue(r.$t("Base.add")),1)]),_:1})])]),default:B(({$index:R})=>[a(oe,{link:"",type:"primary",onClick:J=>g(R)},{default:B(()=>[Se(ue(r.$t("Base.delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["width"]))]),_:1},8,["data"]),u(f)?(O(),te(ee,{key:0,onSizeChange:h,onCurrentChange:c,"current-page":u(l),"page-size":u(s),layout:"total, sizes, prev, pager, next, jumper","page-sizes":[50,100,200,400],total:u(p).length},null,8,["current-page","page-size","total"])):be("",!0)])):(O(),ne("div",So,[u(p)&&u(p).length?(O(),ne("ul",Vo,[(O(!0),ne(fe,null,ke(u(p),(R,J)=>(O(),ne("li",{class:"obj-item",key:u(P)[J]},[_e("div",wo,[(O(!0),ne(fe,null,ke(e.properties,(ce,w)=>(O(),te(Ue,{key:w,readonly:e.readonly,label:ce.label,prop:$(J,w),rules:x(w),"label-width":"118px"},{default:B(()=>[a(u(rt),{modelValue:R[w],"onUpdate:modelValue":C=>R[w]=C,type:ce.type,format:ce.format,symbols:ce.symbols,placeholder:ce.placeholder,"custom-props":ce.componentProps,property:ce},null,8,["modelValue","onUpdate:modelValue","type","format","symbols","placeholder","custom-props","property"])]),_:2},1032,["readonly","label","prop","rules"]))),128))]),!e.readonly&&!e.disabled?(O(),te(oe,{key:0,link:"",class:"btn-del",onClick:ce=>g(J)},{default:B(()=>[a(U,{size:16,class:"icon-del"},{default:B(()=>[a(u($n))]),_:1})]),_:2},1032,["onClick"])):be("",!0)]))),128))])):be("",!0),!e.readonly&&!e.disabled?(O(),te(oe,{key:1,link:"",type:"primary",icon:u(Dt),onClick:D},{default:B(()=>[Se(ue(u(b)("add")),1)]),_:1},8,["icon"])):be("",!0)]))}}}),ko=/_\d/g,$o=e=>G.snakeCase(e).replace(ko,m=>m.replace("_","")),Bo="common",Oo=Object.keys(rn.en.common),Po=new Map([[v.MatrixDB,"pgsql"],[v.TimescaleDB,"pgsql"]]),Nt=()=>{const{t:e,te:m}=it();return{getOptLabel:d=>{const l=`SchemaSymbolLabel.${d}`;return m(l)?e(l):d==null?void 0:d.toString()}}},Do=/ssl|tls/i,Io=cn,Fo=e=>{const m="ConfigSchema.",{t,te:d}=it(),l=c=>d(`${m}${c}.label`),s=ze,f=({key:c,path:r})=>r&&Do.test(r)&&c&&Io.includes(c)?`ssl_opts_${c}`:!1,b=c=>{const{key:r,path:i}=c,y=f(c);if(y)return y;const M=`${e.type}_${$o(i)}`;return l(`${M}`)?`${M}`:r},p=c=>b(c),{getTypeByConnectorSchemaRef:I}=ut(),{getTypeByActionSchemaRef:V}=Bn(),{getTypeBySourceSchemaRef:T}=On(),N=()=>{const{ref:c}=e.accordingTo;return e.type==="action"?V(c):e.type==="source"?T(c):I(c)},P=c=>{const r=m+p(c),i=`${r}.desc`;return r?{label:t(`${r}.label`),desc:d(i)?t(i):""}:{label:""}},A=c=>c.key&&(c.labelKey||c.key),D=(c,r)=>{var ae;if(!((ae=e.accordingTo)!=null&&ae.ref))return"";const i=A(c);let y=N();const M=Po.get(y);M&&(y=M);const Y=`BridgeSchema.${y}.${i}.${r}`,oe=`BridgeSchema.${y}.${G.snakeCase(c.path)}.${r}`;return c.key&&Oo.includes(c.key)&&!c.labelKey&&!d(Y)?`BridgeSchema.${Bo}.${i}.${r}`:!c.labelKey&&d(oe)?oe:Y},g=c=>({labelPath:D(c,"label"),descPath:D(c,"desc")}),$=c=>{if(s.includes(e.type))switch(c.path){case"name":return e.type==="connector"?{label:t("RuleEngine.connectorName")}:{label:t("RuleEngine.name")};case"connector":return{label:t("components.connector")};case"enable":return{label:t("Base.enable")};case"type":return{label:t("RuleEngine.actionType")};case"redis_type":return{label:t("Auth.redisType")};case"mongo_type":return{label:t("Auth.mongoType")}}},x=c=>{const r=$(c);if(r)return r;const{labelPath:i,descPath:y}=g(c);return i?{label:t(i),desc:d(y)?t(y):""}:{label:""}};return{getText:c=>s.includes(e.type)?x(c):P(c),getOptLabel:c=>{const r=`SchemaSymbolLabel.${c}`;return d(r)?t(r):c==null?void 0:c.toString()}}},$t=he({__name:"OneofRefs",props:{modelValue:{type:[String,Number,Object]},property:{type:Object,required:!0},items:{type:Array,required:!0,default:()=>[]},disabled:{type:Boolean,default:!1},colSpan:{type:Number,default:12},readonly:{type:Boolean},getText:{type:Function},customColClass:{type:Object}},emits:["update:modelValue"],setup(e,{emit:m}){const t=e,d=m,l=c=>Array.isArray(c.symbols)&&c.symbols.length===1,s=se(void 0),f=X(()=>t.property.path||""),b=/^.*\.([^.]+)$/,{getOptLabel:p}=Nt(),I=c=>{var i,y;let r="";return l(c)?r=c.symbols[0]:typeof c.$ref=="string"?r=((i=c.$ref.match(b))==null?void 0:i[1])||c.$ref:r=p((y=c==null?void 0:c.toString)==null?void 0:y.call(c)),G.snakeCase(`${f.value||""}${f.value&&"_"}${r}`)},V=X(()=>t.items.map((c,r)=>({value:r,label:p(I(c))}))),T=c=>{const r=t.items[c];r.$ref?P.value=G.cloneDeep(r.default):l(r)&&(P.value=r.symbols[0])},N=c=>`${f.value}${f.value?".":""}${c}`,P=se(""),A=(c,r)=>{if(!c)return 0;const i=r.findIndex(y=>typeof c!="object"?y.$ref?!1:l(y)&&y.symbols[0]===c:!y.$ref||!y.properties?!1:Object.entries(c).every(([Y,oe])=>{var ee;if(!y.properties||!(Y in y.properties))return!1;const ae=y.properties[Y];return l(ae)?oe===void 0||oe===""||oe===((ee=ae.symbols)==null?void 0:ee[0]):ae}));return i<-1?0:i},D=()=>{t.modelValue&&(P.value=t.modelValue,s.value=A(t.modelValue,t.items))},g=(c,r)=>{const{key:i}=c;if(G.isFunction(t.getText)){const y=t.getText(c),M=r==="label"?i:"";return y&&y[r]||M}return i},$=c=>g(c,"label"),x=c=>g(c,"desc"),E=({path:c})=>!t.customColClass||!c||!(c in t.customColClass)?"":t.customColClass[c],h=c=>{const r=s.value!==void 0&&t.items[s.value];if(r&&r.rules)return r.rules[c]};return Le(()=>t.modelValue,(c,r)=>{G.isEqual(c,r)||D()}),Le(()=>P.value,c=>{d("update:modelValue",c)}),D(),(c,r)=>{const i=_("el-option"),y=_("el-select"),M=_("el-col");return O(),ne(fe,null,[a(M,Q({span:e.colSpan},c.$attrs),{default:B(()=>[a(Ue,{readonly:e.readonly,value:("getLabelFromValueInOptionList"in c?c.getLabelFromValueInOptionList:u(Lt))(u(s),u(V))},{label:B(()=>[a(wt,{label:$(e.property),desc:x(e.property),"desc-marked":""},null,8,["label","desc"])]),default:B(()=>[a(y,{modelValue:u(s),"onUpdate:modelValue":r[0]||(r[0]=Y=>Ce(s)?s.value=Y:null),onChange:T},{default:B(()=>[(O(!0),ne(fe,null,ke(u(V),({value:Y,label:oe})=>(O(),te(i,{key:Y,value:Y,label:oe},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["readonly","value"])]),_:1},16,["span"]),(O(!0),ne(fe,null,ke(e.items,(Y,oe)=>(O(),ne(fe,{key:oe},[Y.$ref&&u(s)===oe?(O(!0),ne(fe,{key:0},ke(Y.properties,(ae,ee)=>(O(),te(M,Q({span:ae.format==="sql"?24:e.colSpan,key:ee,ref_for:!0},c.$attrs,{class:E(ae)}),{default:B(()=>[a(Ue,{prop:N(ee),readonly:e.readonly,rules:h(N(ee))},{label:B(()=>[a(wt,{label:$(ae),desc:x(ae),"desc-marked":""},null,8,["label","desc"])]),default:B(()=>[a(u(rt),{modelValue:u(P)[ee],"onUpdate:modelValue":U=>u(P)[ee]=U,type:ae.type,symbols:ae.symbols,format:ae.format,customProps:ae.componentProps,property:ae},null,8,["modelValue","onUpdate:modelValue","type","symbols","format","customProps","property"])]),_:2},1032,["prop","readonly","rules"])]),_:2},1040,["span","class"]))),128)):be("",!0)],64))),128))],64)}}}),Ye=he({__name:"OneofRefsSelect",props:{fieldValue:{type:[String,Number,Object]},property:{type:Object,required:!0},items:{type:Array,required:!0,default:()=>[]},disabled:{type:Boolean,default:!1},colSpan:{type:Number,default:12},readonly:{type:Boolean},getText:{type:Function},type:{type:String,default:"select"}},emits:["change"],setup(e,{emit:m}){const t=e,d=m,l=g=>Array.isArray(g.symbols)&&g.symbols.length===1,s=se(void 0),f=X(()=>t.property.path||""),b=/^.*\.([^.]+)$/,{getOptLabel:p}=Nt(),I=g=>{var x,E;let $="";return l(g)?$=g.symbols[0]:typeof g.$ref=="string"?$=((x=g.$ref.match(b))==null?void 0:x[1])||g.$ref:$=p((E=g==null?void 0:g.toString)==null?void 0:E.call(g)),G.snakeCase(`${f.value||""}${f.value&&"_"}${$}`)},V=X(()=>t.items.map((g,$)=>({value:$,label:p(I(g))}))),T=g=>{const $=t.items[g];d("change",$)},N=(g,$)=>{if(!g)return 0;const x=$.findIndex(E=>typeof g!="object"?E.$ref?!1:l(E)&&E.symbols[0]===g:!E.$ref||!E.properties?!1:Object.entries(g).every(([c,r])=>{var y;if(!E.properties||!(c in E.properties))return!1;const i=E.properties[c];return l(i)?r===void 0||r===""||r===((y=i.symbols)==null?void 0:y[0]):i}));return x<-1?0:x},P=()=>{t.fieldValue&&(s.value=N(t.fieldValue,t.items),T(s.value))},A=(g,$)=>{const{key:x}=g;if(G.isFunction(t.getText)){const E=t.getText(g);return E&&E[$]||x}return x},D=g=>A(g,"label");return Le(()=>t.fieldValue,(g,$)=>{G.isEqual(g,$)||P()}),P(),(g,$)=>{const x=_("el-option"),E=_("el-select"),h=_("el-radio"),c=_("el-radio-group"),r=_("el-col");return O(),te(r,Q({span:e.colSpan},g.$attrs),{default:B(()=>[a(Ue,{label:D(e.property),readonly:e.readonly,value:("getLabelFromValueInOptionList"in g?g.getLabelFromValueInOptionList:u(Lt))(u(s),u(V))},{default:B(()=>[e.type==="select"?(O(),te(E,{key:0,modelValue:u(s),"onUpdate:modelValue":$[0]||($[0]=i=>Ce(s)?s.value=i:null),onChange:T},{default:B(()=>[(O(!0),ne(fe,null,ke(u(V),({value:i,label:y})=>(O(),te(x,{key:i,value:i,label:y},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):(O(),te(c,{key:1,modelValue:u(s),"onUpdate:modelValue":$[1]||($[1]=i=>Ce(s)?s.value=i:null),onChange:T},{default:B(()=>[(O(!0),ne(fe,null,ke(u(V),({value:i,label:y})=>(O(),te(h,{key:i,value:i,border:""},{default:B(()=>[_e("span",null,ue(y),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]))]),_:1},8,["label","readonly","value"])]),_:1},16,["span"])}}}),Lo=()=>{const{tl:e}=$e("Rule"),m=se({}),{createRequiredRule:t,createNumRangeRule:d}=jt(),l=(b,p)=>{const I=b===Fe.Enum?"select":"input";return t(p,I)},s=(b,p,I)=>{const{required:V=[],properties:T}=b,N=P=>I?`${I}.${P}`:P;return V.forEach(P=>{const A=N(P),D=T[P],{type:g,label:$}=D;p[A]=l(g,$)}),Object.keys(T).forEach(P=>{const A=N(P),D=T[P],{type:g,minimum:$,maximum:x}=D;if((g==="number"||g==="integer")&&($!==void 0&&G.isNumber($)||x!==void 0&&G.isNumber(x))){const E=p[A],h=d($,x);E&&Array.isArray(E)?E.push(...h):E||(p[A]=h)}else g==="duration"&&($!==void 0||x!==void 0)&&(p[A]=[{validator:(E,h,c)=>{if(!G.isUndefined(h)){const r=Qe(h),i=$?Qe($):void 0,y=x?Qe(x):void 0;if(typeof r=="number"){if(!G.isUndefined(i)&&!G.isString(i)&&r<i)return c(new Error(e("durationMinimumError",{min:$})));if(!G.isUndefined(y)&&!G.isString(y)&&r>y)return c(new Error(e("durationMaximumError",{max:x})))}}c()}}])}),p};return{rules:m,countRules:s,setToRules:(b,p)=>{m.value=s(b,m.value,p)}}},Eo="connector",Ro=["label","description","summary"],Kt=e=>{for(const m in e){const t=e[m];t&&typeof t=="object"?Kt(t):Ro.includes(m)&&typeof t=="string"&&(m==="label"||m==="description"||m==="summary")&&delete e[m]}return e};function Ao(e,m,t=!1){const{getters:d,commit:l}=un(),s=dn.create({baseURL:""});let f={};const{rules:b,setToRules:p,countRules:I}=Lo(),{initRecordByComponents:V}=dt();let T=m;const N=se({}),P=async()=>{try{const i=e,y=d.getSchema(i);if(y)f=y;else{const M=await s.get(i);M.data&&(f=Kt(M.data),l("SET_SCHEMA_DATA",{key:i,data:G.cloneDeep(f)}))}return f&&h(),Promise.resolve()}catch{}},A=i=>Array.isArray(i)?i:i.replace("#/","").split("/"),D=(i,y)=>G.get(i,A(y),{}),g=i=>i?i.some(y=>y.is_template):!1,$=i=>(i.oneOf&&!i.type?i.type="oneof":i.type==="string"?i.format==="sql"?i.type="sql":i.format==="file"?i.type="file":i.path===Eo&&(i.type="connector"):i.type==="integer"&&(i.type="number"),i),x=["string","number","boolean","integer"],E=i=>{let y="";const M=(ee,U,R=t)=>{const J={},{properties:ce,type:w}=ee;return w==="object"&&ce&&(R&&p(ee,U),Object.keys(ce).forEach(C=>{let o=G.cloneDeep(ce[C]);if(o.deprecated)return;if(typeof o.label=="string"&&/token/i.test(o.label)&&o.format,o.path=U?`${U}.${C}`:C,o.key=C,o.oneOf&&o.oneOf.length===1){const L=o.oneOf[0];o={...o,...L},delete o.oneOf}const{$ref:H,label:F,oneOf:Z}=o;if(H){const L=D(f,H);o.properties=M(L,o.path,R)}else if(o.properties&&o.type==="object"){y=F;const L={properties:o.properties,type:o.type};o.properties=M(L,o.path,R)}else if(o.type==="array"&&o.items){if(o.items.oneOf)o.items.oneOf.forEach(L=>{if(L.$ref){const K=D(f,L.$ref);L.path=o.path,L.key=C,L.properties=M(K,L.path,R)}});else if(o.items.$ref){const L=D(f,o.items.$ref);o.items.path=o.path,o.items.properties=M(L,o.items.path,R)}}else if(Z&&(o.oneOf=Z.map(K=>{if(K.$ref){const ie=D(f,K.$ref);K.properties=M(ie,o.path,!1),K.rules=I(ie,{},o.path),o.path&&(K.default=G.get(V(K.properties),o.path,R))}else{if(K.type==="object"&&K.properties)return M(K,o.path,R);$(K)}return K}),o.is_template=o.is_template??g(o.oneOf),Z.every(({type:K})=>x.includes(K))&&o.is_template)){const K=Z.length===2&&Z.every(({type:ie})=>[Fe.Boolean,Fe.String].includes(ie));o.type=K?"enum":"string",o.symbols=K?[!0,!1]:void 0,o.default=o.default??(K?"":void 0)}F||(o.label=y),J[C]=$(o)})),J};let Y="";if(i.ref)Y=i.ref;else if(i.path){const{$ref:ee,type:U,properties:R}=f.paths[i.path].get;if(ee)Y=ee;else if(U==="object"){const J=Object.keys(R).find(ce=>/\$\w+/g.test(ce));J&&R[J]&&R[J].$ref&&(Y=R[J].$ref)}}const oe=D(f,Y);return M(oe)},h=()=>{t&&(b.value={}),N.value=E(T)},c=i=>{T=i,h()},r=P();return{rules:b,components:N,schemaLoadPromise:r,getComponents:E,setTypeForProperty:$,resetObjForGetComponent:c}}const xo=".btn-col",jo=()=>{const e=new IntersectionObserver(([d])=>{d.target.classList.toggle("is-pinned",d.intersectionRatio<1)},{threshold:[1]});let m;return{addObserverToFooter:(d=xo)=>{try{const l=document.querySelector(d);m&&m!==l&&e.unobserve(m),l&&IntersectionObserver&&(m=l,e.observe(l))}catch(l){console.error(l)}}}};function Je(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!_n(e)}const Bt=ze,Xe=[...ze,"file_trans"],Mo=ze,Ot=/^(.+\.)?ssl$/i,Uo=/cacertfile|certfile|keyfile/,No=he({name:"SchemaForm",components:{TimeInputWithUnitSelect:Rt,InputWithUnit:At,ArrayEditor:at,ArrayEditorInput:vt,ArrayEditorTable:kt,Oneof:xt,OneofRefsSelect:Ye,Setting:In,CommonTLSConfig:st,InfoTooltip:Ze,Monaco:tt,TextareaWithUploader:Ct,MarkdownContent:et,CustomInputNumber:He,AdvancedSettingContainer:St,CertFileInput:Vt,InputWithPlaceholderSelect:Re,BatchSettings:lt},props:{accordingTo:{type:Object,required:!0},form:{type:Object,required:!1},recordLoading:{type:Boolean,default:!1},needRecord:{type:Boolean,default:!1},btnLoading:{type:Boolean,default:!1},canRemoveConfig:{type:Boolean,default:!1},type:{type:String,required:!1,default:""},schemaFilePath:{type:String},needFooter:{type:Boolean,default:!0},formItemSpan:{type:Number,default:21},propsDisabled:{type:Array},propsOrderMap:{type:Object},customColClass:{type:Object},needRules:{type:Boolean,default:!0},dataHandler:{type:Function},readonly:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},formProps:{type:Object,default:()=>({})},advancedFields:{type:Array},defaultTab:{type:String},batchSettingConfigs:{type:Object,default:()=>({dbType:""})}},setup(e,m){const{hasPermission:t}=pn(),d=se({}),l=e.schemaFilePath||Pt("/schemas/hotconf"),{components:s,rules:f,setTypeForProperty:b,resetObjForGetComponent:p}=Ao(l,e.accordingTo,e.needRules),{initRecordByComponents:I}=dt();let V=null;const T=se(),{t:N,tl:P}=$e("BasicConfig"),A={mqtt:["mqtt"],session:["mqtt"],sysmon:["vm","os"]},D=X(()=>{let n=[];if(Xe.includes(e.type))return n;if(Object.keys(A).includes(e.type))return A[e.type];const S=ge.cloneDeep(s.value);let j=!1;return Object.keys(S).forEach(q=>{S[q].properties?n.push(q):j=!0}),j&&(n=[P("basic"),...n]),n}),g=se(D.value[0]||P("basic")),$=()=>{g.value=e.defaultTab||D.value[0]||P("basic")},x=()=>{var n;return(n=T.value)!=null&&n.validate?T.value.validate():Promise.resolve()},E=()=>{var n,S;return(S=(n=T.value)==null?void 0:n.clearValidate)==null?void 0:S.call(n)},h=n=>{var S;return(S=T.value)!=null&&S.validateField?T.value.validateField(n):Promise.resolve()},c=n=>{let S=n;return/\$\w+/g.test(S)&&(S=S.replace(/\$\w+/g,"default")),S},r=n=>{const S=n;return j=>{ge.set(d.value,S,j)}},i=n=>{const{readOnly:S,path:j}=n,{propsDisabled:q}=e;return S||q&&j&&q.includes(j)},y=n=>{var S;return(S=n==null?void 0:n.properties)!=null&&S.enable?st:Et},M=n=>{var S,j;(j=(S=T==null?void 0:T.value)==null?void 0:S.validateField)==null||j.call(S,n.path)},Y=n=>{var S,j;return n.type==="oneof"&&((S=n.oneOf)==null?void 0:S.length)&&((j=n.oneOf)==null?void 0:j.some(({$ref:q})=>q))},oe=(n,S)=>{const j=ge.isUndefined(n.selectedOneof);n.selectedOneof=S.properties,n.default=S.default;const q=n.path&&ge.get(d.value,n.path);if(q&&Object.keys(q).forEach(k=>{var z;if(!((z=S.properties)!=null&&z[k])){Reflect.deleteProperty(q,k);const W=`${n.path}.${k}`;Reflect.deleteProperty(f.value,W)}}),(!j||e.needRecord)&&S.properties&&n.path){const k=I(S.properties);ge.set(d.value,n.path,ge.get(k,n.path))}f.value={...f.value,...S.rules}},ae=n=>Array.isArray(n)?n.map(S=>{if(!S.properties||typeof S.properties!="object")return S;const j=de(Object.keys(S.properties));return S.properties=j.reduce((q,k)=>(S.properties&&(q[k]=S.properties[k]),q),{}),S}):n,{getText:ee,getOptLabel:U}=Fo(e),R=n=>{var ve,Oe,Ae,xe,je,Me,Pe;if(!n.path)return;n.path=c(n.path);const{path:S,format:j,clearable:q}=n,k=i(n),z=ge.get(d.value,S),W={"onUpdate:modelValue":r(S)},we=j==="password"?"password":"text",Be=typeof q=="boolean"?q:!0,le=n.componentProps||{},pe=!!n.is_template,Ie=a(_("el-input"),Q({disabled:k,placeholder:(ve=n.default)==null?void 0:ve.toString(),modelValue:z,type:we},W,{clearable:!0},le),null);if(n.customComponent){const me=n.customComponent;return a(me,Q({is:n.customComponent,modelValue:z},W,le),null)}switch(n.type){case"string":return n.key&&Uo.test(n.key)?a(Vt,Q({modelValue:z,isEdit:!0},W,le),null):pe?a(Re,Q({disabled:k,placeholder:(Oe=n.default)==null?void 0:Oe.toString(),modelValue:z,type:we,oneOf:n.oneOf},W,{clearable:!0},le),null):j==="password"?a(Ft,Q({disabled:k,placeholder:(Ae=n.default)==null?void 0:Ae.toString(),modelValue:z},W,{clearable:!0},le),null):Ie;case"connector":return a(bo,Q({modelValue:z,type:d.value.type},W,le),null);case"number":{const{minimum:me=0,maximum:ye=Number.POSITIVE_INFINITY}=n,We={min:me,max:ye};return a(He,Q({disabled:k,modelValue:z},W,{placeholder:(xe=n.default)==null?void 0:xe.toString()},We,le),null)}case"enum":return pe?a(Re,Q({disabled:k,placeholder:(je=n.default)==null?void 0:je.toString(),modelValue:z,oneOf:n.oneOf},W,{clearable:Be,options:n.symbols},le),null):a(_("el-select"),Q({disabled:k,placeholder:(Me=n.default)==null?void 0:Me.toString(),modelValue:z},W,{clearable:Be},le),{default:()=>{var me;return[(me=n.symbols)==null?void 0:me.map(ye=>a(_("el-option"),{value:ye,label:U(ye.toString())},null))]}});case"boolean":return a(_("el-switch"),Q({disabled:k,modelValue:z},W,le),null);case"array":if(["number","string"].includes(n.items.type))return n.items.component==="input"?a(vt,Q({modelValue:z},W,{disabled:k},le),null):n.items.component==="table"?a(kt,Q({modelValue:z},W,{disabled:k},le),null):a(at,Q({modelValue:z},W,{disabled:k||e.disabled,type:n.items.type,default:n.default},le),null);if(n.items.type==="enum")return a(_("el-select"),Q({disabled:k,modelValue:z,clearable:Be},W,le,{multiple:!0}),{default:()=>{var me;return[(me=n.symbols)==null?void 0:me.map(ye=>a(_("el-option"),{value:ye,label:U(ye.toString())},null))]}});if(n.items.path&&n.items.properties){const me=((Pe=e.formProps)==null?void 0:Pe.labelPosition)==="right"?"list":"table";return a(To,Q({modelValue:z},W,{properties:n.items.properties,propKey:n.items.path,editMode:me},le,{disabled:e.disabled,rules:f.value,onAddItem:()=>M(n),onDeleteItem:()=>M(n),dbType:e.batchSettingConfigs.dbType}),null)}return a("div",null,null);case"duration":return a(_("time-input-with-unit-select"),Q({disabled:k,modelValue:z},W,le),null);case"byteSize":return a(_("input-with-unit"),Q({disabled:k,modelValue:z},W,{units:["MB","GB","KB","B"]},le),null);case"percent":return a(_("input-with-unit"),Q({disabled:k,modelValue:z},W,{units:["%"]},le),null);case"comma_separated_string":return Ie;case"oneof":{const me={modelValue:z,...W,items:n.oneOf,disabled:k,...le};if(Y(n)){const ye=ge.cloneDeep(n);return Y(n)&&(ye.oneOf=ae(ye.oneOf),me.items=ye.oneOf),n.useNewCom?a(Ye,Q(me,{key:n.path,fieldValue:z,property:ye,colSpan:o(n),getText:ee,customColClass:e.customColClass,onChange:We=>oe(n,We)}),null):a($t,Q(me,{property:ye,colSpan:o(n),getText:ee,customColClass:e.customColClass}),null)}return a(_("oneof"),me,null)}case"ssl":{const me=y(n);return e.recordLoading?Ie:a(me,Q({modelValue:z,isEdit:!!e.form},W,le),null)}case"sql":{const me=k||e.disabled,ye=e.batchSettingConfigs.dbType===Te.TDengine&&!me;return a("div",{class:"monaco-container"},[a(tt,Q({id:qe(),modelValue:z},W,{lang:"sql",disabled:k||e.disabled},le),null),ye&&a(lt,{type:e.batchSettingConfigs.dbType,onUploadedData:r(S)},null)])}case"file":return a(Ct,Q({modelValue:z},W,le),null);case"object":return a(ot,Q({modelValue:z},W,le),null);default:return Ie}},J=["string","number","duration","byteSize","percent","comma_separated_string","file"],ce=n=>{if(!n.path)return;n.path=c(n.path);const{path:S,type:j}=n,q=ge.get(d.value,S);if(J.includes(j))return a("p",{class:"value"},[q]);switch(j){case"enum":return a("p",{class:"value"},[U(q)]);case"boolean":return R({...n,readOnly:!0});case"sql":return R({...n,readOnly:!0});case"array":{const k=R({...n});return k!=null&&k.props&&(k.props.readonly=!0),k}case"oneof":{if(Y(n)){const k={modelValue:q,property:n,getText:ee,items:n.oneOf,readonly:!0,colSpan:o(n)};return n.useNewCom?a(Ye,Q(k,{key:n.path,fieldValue:q,onChange:z=>oe(n,z)}),null):a($t,k,null)}return a("p",{class:"value"},[q])}case"ssl":{const k=R({...n,readOnly:!0});return k!=null&&k.props&&(k.props.readonly=!0),k}case"object":return a(ot,{modelValue:q,readonly:!0},null);default:return a("p",{class:"value"},[q])}},w=n=>{if(!n.type)return;const S=b(n);return e.readonly?ce(S):R(S)},C=n=>{const{label:S,desc:j}=ee(n),q=`${n.format==="sql"?"is-wider":""} height-fixed`,k={label:()=>a(fe,null,[a("span",null,[S]),j?a(Ze,{popperClass:q},z):null])},z={content:()=>a(_("el-scrollbar"),{"max-height":"158px"},{default:()=>[a(et,{content:j,gutter:0,inTooltip:!0},null)]})};return k},o=({path:n,format:S,type:j,items:q})=>n&&Ot.test(n)||S==="sql"||j==="array"&&q.type!=="string"||j==="object"?24:e.formItemSpan,H=({path:n})=>!e.customColClass||!n||!(n in e.customColClass)?"":e.customColClass[n],F=(n,{levelName:S}={})=>{const j=C(n),q=o(n),k=H(n),z={label:n.label,prop:n.path},W=w(n),we=Y(n),Be=n.title?a(_("el-col"),{span:24},{default:()=>[" ",a("p",{class:"part-header"},[n.title])," "]}):null,le=we?W||a("div",null,null):a(_("el-col"),{span:q,class:k,key:n.path},{default:()=>[n.readOnly?a(_("el-tooltip"),{"popper-class":"read-only-tooltip",content:P("readOnlyTip"),placement:"right",effect:"dark"},{default:()=>[a(_("el-form-item"),z,{default:()=>[W],...j})]}):a(_("el-form-item"),z,{default:()=>[W],...j})]}),pe=a(fe,null,[Be,le]);return e.type==="cluster"&&n.path==="discovery_strategy"&&d.value[n.path]==="manual"?a(fe,null,[pe,a(_("el-col"),{span:q},{default:()=>{var ve,Oe;return[(Oe=(ve=m.slots)["invite-node"])==null?void 0:Oe.call(ve)]}})]):S?a(fe,null,[a(_("el-col"),{span:23},{default:()=>[a(_("el-divider"),null,null)]}),pe]):pe},Z=()=>{m.emit("save",d.value)},L={class:"configuration-form",labelPosition:"right"},K=()=>({...L,disabled:e.disabled,"hide-required-asterisk":e.readonly?!0:void 0,...e.formProps||{}}),ie=X(()=>e.formItemSpan<=12?24:0),Ve=n=>{let S,j=null,q=null;return Xe.includes(e.type)||D.value.length===1||(j=D.value.map(k=>a(_("el-tab-pane"),{label:P(k),name:k},null)),q=a(_("el-tabs"),{modelValue:g.value,"onUpdate:modelValue":k=>g.value=k,class:"group-tabs"},Je(j)?j:{default:()=>[j]})),a(fe,null,[q,a(_("el-form"),Q({ref:T},K(),{rules:f.value,model:d.value,"validate-on-rule-change":!1}),{default:()=>[a(_("el-row"),{gutter:ie.value},{default:()=>[n,e.needFooter?a(_("el-col"),{span:24,class:"btn-col"},{default:()=>[a(_("el-button"),{type:"primary",disabled:!t("put"),loading:e.btnLoading,onClick:Z},Je(S=N("Base.saveChanges"))?S:{default:()=>[S]})]}):""]})]})])},de=n=>{if(!e.propsOrderMap)return n;const S=n,{propsOrderMap:j}=e,q=Object.entries(j).sort((k,z)=>k[1]-z[1]);for(let k=0;k<q.length;k++){const[z,W]=q[k],we=n.findIndex(Be=>Be===z);we>-1&&(S.splice(we,1),S.splice(W,0,z))}return S.sort((k,z)=>{const W=j[k]??999,we=j[z]??999;return W-we}),S},re=n=>Object.keys(n).reduce((S,j)=>{const q=n[j],k=q.path;return{...S,[k]:q}},{}),Ne=n=>Ot.test(n)&&Mo.includes(e.type),De=n=>(n.type="ssl",n),qt=n=>a(_("el-col"),{span:24},{default:()=>[a(St,null,{default:()=>[a(_("el-row"),{gutter:ie.value},Je(n)?n:{default:()=>[n]})]})]}),Ht=(n,S={})=>{let[j,q]=[S.levelName||"",""];const k=[],z=[];let W={};for(const le in n){const pe=n[le];if(pe.properties)if(g.value===pe.path){W=pe==null?void 0:pe.properties;break}else Xe.includes(e.type)&&(Ne((pe==null?void 0:pe.path)||"")?(De(pe),W[pe.path]=pe):pe.properties&&(W={...W,...re(pe.properties)}));pe.properties||(W[pe.path]=pe)}const we=le=>(de(Object.keys(le)).forEach(Ie=>{var Me;const ve=le[Ie],Oe=ve.key,Ae=ve.path,xe=Ne(Oe);if(xe&&De(ve),e.type==="mqtt"&&ht.includes(Oe)||e.type==="session"&&!ht.includes(Oe))return;const je=Y(ve);if(ve.properties&&!xe&&!je){const{label:Pe,properties:me}=ve;j=Pe,we(me)}else{let Pe=a(fe,null,null);j!==q?(q=j,Pe=F(ve,{levelName:j})):j===q&&(Pe=F(ve)),((Me=e.advancedFields)==null?void 0:Me.some(ye=>typeof ye=="string"&&ye===Ae||ge.isRegExp(ye)&&ye.test(Ae)))?z.push(Pe):k.push(Pe),je&&ve.selectedOneof&&we(ve.selectedOneof)}}),k),Be=we(W);return z.length&&Be.push(qt(z)),Be},{addObserverToFooter:zt}=jo(),Gt=n=>(Object.keys(n).length===0?V=null:(V=Ve(Ht(n)),m.emit("schema-loaded"),Ge.value=!1,e.needFooter&&window.setTimeout(zt,400)),V),Wt=async()=>{if(e.dataHandler&&ge.isFunction(e.dataHandler)){const n=await e.dataHandler({components:s.value,rules:f.value});s.value=n.components,f.value=n.rules}},pt=()=>I(s.value),mt=async()=>{await Wt(),$(),e.needRecord&&(d.value={...pt(),...ge.isObject(e.form)?e.form:{}},m.emit("init",d.value))};Le(()=>e.form,n=>{n&&!ge.isEqual(n,d.value)&&(d.value=ge.cloneDeep(n))}),Le(s,mt),Le(()=>e.accordingTo,async(n,S)=>{if(!ge.isEqual(n,S)){const j=ge.cloneDeep(s.value),q=ge.cloneDeep(d.value);p(n),await mn();const k=I(s.value);m.emit("component-change",{oldVal:{components:j,record:q},newVal:{components:s.value,record:k}})}}),fn(()=>{m.emit("update",d.value)});const Ge=se(!0),ft=X(()=>(Ge.value||e.recordLoading)&&!Bt.includes(e.type)),yt=X(()=>(Ge.value||e.recordLoading)&&Bt.includes(e.type)),Qt=X(()=>`schema-form ${ft.value||yt.value?"is-loading":""}`);return e.form&&ge.isObject(e.form)&&!yn(e.form)&&(d.value=ge.cloneDeep(e.form)),mt(),m.expose({configForm:d,validate:x,clearValidate:E,validateField:h,getInitRecord:pt}),()=>bn(a("div",{class:Qt.value},[ft.value?a(_("el-skeleton"),{rows:12,animated:!0},null):null,Gt(s.value)]),[[gn("loading"),yt.value]])}});export{No as S,lt as _,Ao as a,bo as b,co as c,Hn as d,to as e,eo as f,dt as g,so as h,mo as i,ro as j,Ut as u};
