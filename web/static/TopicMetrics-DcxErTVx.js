import{f as G,d as H,z as J,g as v,A as X,j as Y,C as Z,aw as x,c as O,a as r,b as a,w as l,p as U,m as ee,i as te,s as se,a5 as I,E as z,aM as oe,r as u,V as ae,o as A,e as c,t as i,n as P,b1 as le,N as j,aI as ne}from"./index-gzDiX6cq.js";import{_ as ie}from"./CommonOverflowTooltip.vue_vue_type_style_index_0_lang-Du1TBZn7.js";import{c as W,e as ce,f as re,r as de}from"./diagnose-DSIpHM3s.js";import"./http-BlFWNHJL.js";const Q="all",ue=H({name:"TopicMetrics",data:function(){return{topicRules:{topic:[{required:!0,message:this.$t("Clients.topicRequired"),trigger:"blur"}]}}},setup(){const e="btn-view",{t:o}=J(),N=te(),L=se(),y=v(!1),C=X({topic:""}),T=v(null),d=v([]),$=v(!1),B=v(null),f=v(!1),m=Y(()=>d.value.filter(({_expand:s})=>s).map(({topic:s})=>s)),V=function(s,n="Tools"){return o(n+"."+s)},g=s=>`is-${s}`,R=()=>{var s;y.value=!0,(s=T.value)==null||s.resetFields(),f.value=!1},S=async function(){$.value=!0;try{const s=await W(),n=Array.prototype.map.call(s,p=>Object.assign(p,{_loading:!1,topicQoS:Q}));d.value=n}catch{}finally{$.value=!1}},E=async s=>{I({message:V("topicExistedTip"),type:"info",duration:5e3}),await j(1024);const n=document.querySelector(`tr.${g(s)}`),p=n?n.querySelector(`.${e}`):null;if(p){p.click(),await j(200);const w=document.querySelector(`.topic-detail.${g(s)}`);w==null||w.scrollIntoView({behavior:"smooth",block:"center"})}},D=()=>{const{topic:s=""}=N.query||{};if(s){const n=d.value.findIndex(({topic:p})=>p===s);n>-1?E(n):(C.topic=s,y.value=!0)}L.replace({name:"topic-metrics"})},h=async function(){var s;try{await((s=T.value)==null?void 0:s.validate()),f.value=!0;const{topic:n}=C;await ce(n),I.success(o("Base.createSuccess")),y.value=!1,S()}catch{}finally{f.value=!1}},q=async function({topic:s}){try{await z.confirm(o("Base.confirmDelete"),{confirmButtonText:o("Base.confirm"),cancelButtonText:o("Base.cancel"),confirmButtonClass:"confirm-danger",type:"warning"}),await re(s),I.success(o("Base.deleteSuccess")),S()}catch{}},k=async function(s,n){try{await z.confirm(o("General.confirmReset"),{confirmButtonText:o("Base.confirm"),cancelButtonText:o("Base.cancel"),type:"warning"}),await de(s.topic),I.success(o("Base.resetSuccess")),t(s,n,!1)}catch{}},t=async function(s,n,p=!0){const{topic:w,_expand:F}=s,M=p?!(F??!1):F;if(p&&(B.value.toggleRowExpansion(s,M),!M&&d.value[n]._expand)){d.value[n]._expand=M;return}try{s._loading=!0;const K=await W(w);d.value.splice(n,1,{...K,_expand:M,_loading:!1,topicQoS:Q})}catch{s._loading=!1}},b=s=>s===Q?"":`${s}.`,_=(s,n)=>`messages.${b(s)}${n}`;return Z(async()=>{await S(),D()}),{BTN_VIEW_CLASS:e,df:x,tl:V,DEFAULT_QOS:Q,addVisible:y,openAdd:R,record:T,topicInput:C,addTopic:h,topicMetricsTb:d,tbLoading:$,deleteTopic:q,resetTopic:k,tbRef:B,tableExpandRowKeys:m,loadMetricsFromTopic:t,addLoading:f,getStrForConcat:b,getKey:_,getTopicClassName:g}}}),pe={class:"topicMetrics app-wrapper"},me={class:"section-header"},fe={class:"message-card in"},ge={class:"message-rate"},be={class:"message-card--body"},_e={class:"message-card out"},ve={class:"message-rate"},ye={class:"message-card--body"},Te={class:"message-card drop"},$e={class:"message-rate"},Be={class:"message-card--body"},Se={class:"dialog-align-footer"};function we(e,o,N,L,y,C){const T=oe,d=u("el-radio-button"),$=u("el-radio-group"),B=u("el-row"),f=u("el-col"),m=u("el-table-column"),V=ie,g=ne,R=u("el-table"),S=u("el-input"),E=u("el-form-item"),D=u("el-form"),h=u("el-button"),q=u("el-dialog"),k=ae("loading");return A(),O("div",pe,[r("div",me,[o[6]||(o[6]=r("div",null,null,-1)),a(T,{onClick:o[0]||(o[0]=t=>e.openAdd())},{default:l(()=>[c(i(e.tl("addTopic")),1)]),_:1})]),U((A(),ee(R,{data:e.topicMetricsTb,ref:"tbRef","row-key":"topic","expand-row-keys":e.tableExpandRowKeys,"row-class-name":({rowIndex:t})=>e.getTopicClassName(t)},{default:l(()=>[a(m,{type:"expand",width:"1"},{default:l(({row:t,$index:b})=>[U((A(),O("div",{class:P(["topic-detail",e.getTopicClassName(b)])},[a(B,{class:"topic-detail-header"},{default:l(()=>[r("div",null,i(e.$t("Base.detail")),1),a($,{modelValue:t.topicQoS,"onUpdate:modelValue":_=>t.topicQoS=_,size:"small"},{default:l(()=>[a(d,{value:e.DEFAULT_QOS},{default:l(()=>[c(i(e.$t("Base.all")),1)]),_:1},8,["value"]),a(d,{value:"qos0"},{default:l(()=>o[7]||(o[7]=[c("QoS 0")])),_:1}),a(d,{value:"qos1"},{default:l(()=>o[8]||(o[8]=[c("QoS 1")])),_:1}),a(d,{value:"qos2"},{default:l(()=>o[9]||(o[9]=[c("QoS 2")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(B,{gutter:20},{default:l(()=>[a(f,{span:8},{default:l(()=>[r("div",fe,[r("div",null,[c(i(e.tl("msgIn"))+" ",1),r("span",ge,i(`${t.metrics[e.getKey(t.topicQoS,"in.rate")]} ${e.tl("rate")}`),1)]),r("div",be,i(t.metrics[e.getKey(t.topicQoS,"in.count")]),1)])]),_:2},1024),a(f,{span:8},{default:l(()=>[r("div",_e,[r("div",null,[c(i(e.tl("msgOut"))+" ",1),r("span",ve,i(`${t.metrics[e.getKey(t.topicQoS,"out.rate")]} ${e.tl("rate")}`),1)]),r("div",ye,i(t.metrics[e.getKey(t.topicQoS,"out.count")]),1)])]),_:2},1024),a(f,{span:8},{default:l(()=>[r("div",Te,[r("div",null,[c(i(e.tl("msgDrop"))+" ",1),r("span",$e,i(`${t.metrics["messages.dropped.rate"]} ${e.tl("rate")}`),1)]),r("div",Be,i(t.metrics["messages.dropped.count"]),1)])]),_:2},1024)]),_:2},1024)],2)),[[k,t._loading]])]),_:1}),a(m,{label:e.$t("Base.topic"),prop:"topic","min-width":120},{default:l(({row:t})=>[a(V,{content:t.topic},null,8,["content"])]),_:1},8,["label"]),a(m,{label:e.tl("msgIn"),sortable:"","sort-by":({metrics:t})=>t["messages.in.count"],"min-width":184},{default:l(({row:t})=>[c(i(t.metrics["messages.in.count"]),1)]),_:1},8,["label","sort-by"]),a(m,{label:e.tl("msgOut"),sortable:"","sort-by":({metrics:t})=>t["messages.out.count"],"min-width":184},{default:l(({row:t})=>[c(i(t.metrics["messages.out.count"]),1)]),_:1},8,["label","sort-by"]),a(m,{label:e.tl("msgDrop"),sortable:"","sort-by":({metrics:t})=>t["messages.dropped.count"],"min-width":180},{default:l(({row:t})=>[c(i(t.metrics["messages.dropped.count"]),1)]),_:1},8,["label","sort-by"]),a(m,{label:e.tl("startTime"),sortable:"","sort-by":({create_time:t})=>new Date(t).getTime(),"min-width":164},{default:l(({row:t})=>[c(i(t.reset_at&&e.df(t.reset_at)||t.create_time&&e.df(t.create_time)),1)]),_:1},8,["label","sort-by"]),a(m,{label:e.$t("Base.operation"),"min-width":220},{default:l(({row:t,$index:b})=>[a(g,{class:P(e.BTN_VIEW_CLASS),onClick:_=>e.loadMetricsFromTopic(t,b)},{default:l(()=>[c(i(e.$t("Base.view")),1)]),_:2},1032,["class","onClick"]),a(g,{disabled:!e.$hasPermission("put"),onClick:_=>e.resetTopic(t,b)},{default:l(()=>[c(i(e.$t("Base.reset")),1)]),_:2},1032,["disabled","onClick"]),a(g,{disabled:!e.$hasPermission("delete"),onClick:_=>e.deleteTopic(t)},{default:l(()=>[c(i(e.$t("Base.delete")),1)]),_:2},1032,["disabled","onClick"])]),_:1},8,["label"])]),_:1},8,["data","expand-row-keys","row-class-name"])),[[k,e.tbLoading]]),a(q,{title:e.tl("addTopic"),modelValue:e.addVisible,"onUpdate:modelValue":o[5]||(o[5]=t=>e.addVisible=t),width:"400px"},{footer:l(()=>[r("div",Se,[a(h,{onClick:o[3]||(o[3]=t=>e.addVisible=!1)},{default:l(()=>[c(i(e.$t("Base.cancel")),1)]),_:1}),a(h,{type:"primary",disabled:!e.$hasPermission("post"),onClick:o[4]||(o[4]=t=>e.addTopic()),loading:e.addLoading},{default:l(()=>[c(i(e.$t("Base.add")),1)]),_:1},8,["disabled","loading"])])]),default:l(()=>[a(D,{ref:"record",model:e.topicInput,"label-position":"top","require-asterisk-position":"right",rules:e.topicRules,onSubmit:o[2]||(o[2]=le(t=>e.addTopic(),["prevent"]))},{default:l(()=>[a(E,{prop:"topic",label:e.$t("Base.topic")},{default:l(()=>[a(S,{modelValue:e.topicInput.topic,"onUpdate:modelValue":o[1]||(o[1]=t=>e.topicInput.topic=t)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}const Me=G(ue,[["render",we],["__scopeId","data-v-8715c925"]]);export{Me as default};
