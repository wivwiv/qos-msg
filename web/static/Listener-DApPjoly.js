import{f as _sfc_main$6,g as _sfc_main$7,b as _sfc_main$9,_ as __unplugin_components_3,e as _sfc_main$a,h as _sfc_main$c,c as _sfc_main$d,d as __unplugin_components_9}from"./CertFileInput.vue_vue_type_script_setup_true_lang-DHqscjx4.js";import{d as defineComponent,j as computed,r as resolveComponent,o as openBlock,m as createBlock,w as withCtx,b as createVNode,u as unref,y as isRef,c as createElementBlock,k as renderList,F as Fragment,c7 as commonjsGlobal,bm as getDefaultExportFromCjs,q as useI18nTl,c8 as ListenerTypeForGateway,c9 as ListenerType,M as lodashExports,bR as bf,bB as SSL_VERIFY_VALUE_MAP,ca as unexposedConfigs,g as ref,J as watch,a as createBaseVNode,t as toDisplayString,K as withKeys,x as createCommentVNode,aD as axios,E as ElMessageBox,bz as checkNOmitFromObj,a5 as ElMessage,cb as GATEWAY_DISABLED_LISTENER_TYPE_MAP,aL as GatewayName,bv as jumpToErrorFormItem,cc as emptyObject,a3 as nextTick,cd as Of,V as resolveDirective,e as createTextVNode,p as withDirectives,ce as INFINITY_VALUE,bI as _sfc_main$b,aM as _sfc_main$e,at as calcPercentage,cf as ListenerAction}from"./index-gzDiX6cq.js";import{_ as _sfc_main$8}from"./FormItemLabel.vue_vue_type_style_index_0_lang-C2ue8b3P.js";import{u as useFormRules}from"./useFormRules-BXbR-dxB.js";import{c as updateGatewayListener,e as addGatewayListener}from"./gateway-BiGjpYvp.js";import"./http-BlFWNHJL.js";import"./InfoTooltip-DsMY02kq.js";import"./arrow-right-K2qPT6rh.js";import"./useCopy-zlCfhwDY.js";import"./MarkdownContent.vue_vue_type_style_index_0_lang-CvIt_HhB.js";const _sfc_main$5=defineComponent({__name:"BooleanSelect",props:{modelValue:{type:Boolean},trueLabel:{type:String,default:"true"},falseLabel:{type:String,default:"false"}},emits:["update:modelValue","change"],setup(a,{emit:i}){const g=a,N=i,s=computed({get(){return g.modelValue===void 0?void 0:g.modelValue},set(r){N("update:modelValue",r),N("change",r)}});return(r,p)=>{const C=resolveComponent("el-option"),T=resolveComponent("el-select");return openBlock(),createBlock(T,{modelValue:unref(s),"onUpdate:modelValue":p[0]||(p[0]=x=>isRef(s)?s.value=x:null)},{default:withCtx(()=>[createVNode(C,{label:a.trueLabel,value:!0},null,8,["label"]),createVNode(C,{label:a.falseLabel,value:!1},null,8,["label"])]),_:1},8,["modelValue"])}}}),__default__$1=defineComponent({name:"DTLSVersionSelect"}),_sfc_main$4=defineComponent({...__default__$1,props:{modelValue:{type:Array}},emits:["update:modelValue"],setup(a,{emit:i}){const g=a,N=i,s=["dtlsv1.2","dtlsv1"],r=computed({get(){return g.modelValue||[]},set(p){N("update:modelValue",p)}});return(p,C)=>{const T=resolveComponent("el-option"),x=resolveComponent("el-select");return openBlock(),createBlock(x,{class:"DTLS-version-select",modelValue:unref(r),"onUpdate:modelValue":C[0]||(C[0]=e=>isRef(r)?r.value=e:null),multiple:""},{default:withCtx(()=>[(openBlock(),createElementBlock(Fragment,null,renderList(s,e=>createVNode(T,{key:e,value:e,label:e},null,8,["value","label"])),64))]),_:1},8,["modelValue"])}}}),__default__=defineComponent({name:"SSLVersionSelect"}),_sfc_main$3=defineComponent({...__default__,props:{modelValue:{type:Array}},emits:["update:modelValue"],setup(a,{emit:i}){const g=a,N=i,s=["tlsv1.3","tlsv1.2","tlsv1.1","tlsv1"],r=computed({get(){return g.modelValue||[]},set(p){N("update:modelValue",p)}});return(p,C)=>{const T=resolveComponent("el-option"),x=resolveComponent("el-select");return openBlock(),createBlock(x,{class:"SSL-version-select",modelValue:unref(r),"onUpdate:modelValue":C[0]||(C[0]=e=>isRef(r)?r.value=e:null),multiple:""},{default:withCtx(()=>[(openBlock(),createElementBlock(Fragment,null,renderList(s,e=>createVNode(T,{key:e,value:e,label:e},null,8,["value","label"])),64))]),_:1},8,["modelValue"])}}});var hoconParser={exports:{}};(function(module){(function(a,i){module.exports?module.exports=i():a.parseHocon=i()})(commonjsGlobal,function(){function parseHocon(text){var index=0,result=readHocon(text);return handleSubtitutions(result);function readHocon(a){for(var i=!1,g="",N=!1,s=!1,r=!1,p=!1,C=!1,T=!1,x=!1,e=!1,h="",V="",A={};index<a.length;){var v=a[index];if(index++,T&&!e){(v==="\r"||v===`
`)&&(T=!1);continue}if(!N&&v==='"'&&index+1<a.length&&a[index]==='"'&&a[index+1]==='"'){if(e){L(),e=!1,i=!1,p=!1,index+=2;continue}e=!0,i=!0,p=!0,index+=2;continue}if(!N&&!e&&(v==="'"||v==='"')){if(i&&g===v){p?L():p=!0,i=!1;continue}i=!0,g=v;continue}if(e&&k(v)){V+=v;continue}if(i&&v==="\\"){N=!0;continue}if(N=!1,!i)switch(v){case" ":{if(h!==""&&!p){h+=v;continue}if(V==="")continue;if(r&&p){V+=v;continue}}case"	":case"\r":case`
`:{if(r&&p){if(V==="")continue;L();continue}if(!h)continue;if(!p){p=!0;continue}if(p&&V){L();continue}continue}case"{":{if(s||r||h){index--,h=h.trim(),V=readHocon(a),L();continue}s=!0;continue}case"}":{if(!s)throw"What";if(V)L();else if(h)return h;return A}case":":case"=":{if(C)throw"Already met seperator";p=!0,C=!0,h=h.trim();continue}case",":{p&&V&&L();continue}case"[":{if(s||r||h){index--,V=readHocon(a),L();continue}p=!0,r=!0,A=[];continue}case"]":{if(!r)throw"not in an array";return V&&(V=V.trim(),L()),A}case"$":{if(!V){V="${"+readHocon(a)+"}",L();continue}break}case"#":{T=!0;continue}case"/":{if(x){T=!0,x=!1;continue}x=!0;continue}}p?V+=v:h+=v}if(s)throw"Expected closing curly bracket";if(r)throw"Expected closing square bracket";return p&&L(),A;function k(G){return['"',"\\"].indexOf(G)!==-1}function L($,E){var $=$||h,E=E||A,y=$.indexOf(".");if(!r&&y>0){var b=$.substring(0,y);E[b]=E[b]||{},L($.substring(y+1),E[b]);return}!i&&typeof V=="string"&&(/^\d+$/.test(V)?V=parseInt(V):/^\d+\.\d+$/.test(V)?V=parseFloat(V):V==="true"?V=!0:V==="false"?V=!1:V==="null"&&(V=null)),r?E.push(V):(typeof E[$]=="object"&&typeof V=="object"?extend(E[$],V):E[$]=V,p=!1),C=!1,h="",V=""}}function handleSubtitutions(mainObj,intermidiateObj,loops){if(loops=loops||0,loops>8)return null;if(intermidiateObj=typeof intermidiateObj>"u"?mainObj:intermidiateObj,intermidiateObj==null)return intermidiateObj;if(Array.isArray(intermidiateObj))intermidiateObj.forEach(function(a,i){intermidiateObj[i]=handleSubtitutions(mainObj,a)});else if(typeof intermidiateObj=="string"){var match=/^\$\{(.+?)\}$/.exec(intermidiateObj);if(match&&match.length==2){var val=eval("mainObj."+match[1]);return typeof val>"u"?null:handleSubtitutions(mainObj,val,loops+1)}}else typeof intermidiateObj=="object"&&Object.keys(intermidiateObj).forEach(function(a,i){intermidiateObj[a]=handleSubtitutions(mainObj,intermidiateObj[a])});return intermidiateObj}function extend(){for(var a=1;a<arguments.length;a++)for(var i in arguments[a])arguments[a].hasOwnProperty(i)&&(typeof arguments[0][i]=="object"&&typeof arguments[a][i]=="object"?extend(arguments[0][i],arguments[a][i]):arguments[0][i]=arguments[a][i]);return arguments[0]}}return parseHocon})})(hoconParser);var hoconParserExports=hoconParser.exports;const parseHoconToObject=getDefaultExportFromCjs(hoconParserExports),useLimiter=()=>{const{tl:a}=useI18nTl("BasicConfig"),i=/^((\d+(\/\d*[smhd])?)|(infinity))$/i,g=/^((\d+(kb|mb|gb)?(\/\d*[smhd])?)|(infinity))$/i;return{limiterRules:{max_conn_rate:[{pattern:i,message:a("rateMatchError"),trigger:"blur"}],messages_rate:[{pattern:i,message:a("rateMatchError"),trigger:"blur"}],bytes_rate:[{pattern:g,message:a("rateMatchError"),trigger:"blur"}]},limiterPlaceholderMap:{max_conn_rate:"1000/s",messages_rate:"1000/s",bytes_rate:"100MB/s"}}},useListenerUtils=a=>{const i=":",g=[ListenerTypeForGateway.TCP,ListenerTypeForGateway.SSL,ListenerTypeForGateway.UDP,ListenerTypeForGateway.DTLS,ListenerTypeForGateway.WS,ListenerTypeForGateway.WSS],N=[ListenerType.TCP,ListenerType.SSL,ListenerType.WS,ListenerType.WSS,ListenerType.QUIC],s=[ListenerTypeForGateway.SSL,ListenerTypeForGateway.TCP,ListenerType.TCP,ListenerType.SSL,ListenerType.WS,ListenerType.WSS],r=[ListenerTypeForGateway.SSL,ListenerTypeForGateway.TCP,ListenerType.TCP,ListenerType.SSL,ListenerType.WS,ListenerType.WSS],p=[ListenerTypeForGateway.DTLS,ListenerTypeForGateway.UDP],C=[ListenerTypeForGateway.DTLS,ListenerTypeForGateway.SSL,ListenerType.SSL,ListenerType.WSS,ListenerType.QUIC],T=[ListenerType.WS,ListenerType.WSS],{t:x,tl:e}=useI18nTl("Gateway"),{createRequiredRule:h,createIntFieldRule:V,createCommonIdRule:A,createLimiterRule:v}=useFormRules(),k=V(1),{limiterRules:L}=useLimiter(),G={max_conn_rate:k},M={"dtls_options.certfile":h("TLS Cert"),"dtls_options.keyfile":h("TLS Key"),"ssl_options.certfile":h("TLS Cert"),"ssl_options.keyfile":h("TLS Key")},$={name:[...h(x("Base.name")),...A()],type:h(e("lType"),"select"),bind:h(e("lAddress")),acceptors:k,max_connections:[{validator(n,u){return typeof u=="number"&&Number(u)<1?[new Error(x("Rule.minimumError",{min:1}))]:[]}}],"ssl_options.ocsp.responder_url":h(e("responderUrl")),"ssl_options.ocsp.issuer_pem":h(e("issuerPem")),...M,max_conn_burst:v(),messages_burst:v(),bytes_burst:v()},E=()=>({certfile:"",cacertfile:"",keyfile:"",verify:SSL_VERIFY_VALUE_MAP.get(!0),fail_if_no_peer_cert:!1,depth:10,password:"",ocsp:{enable_ocsp_stapling:!1,responder_url:"",issuer_pem:"",refresh_interval:"5m",refresh_http_timeout:"15s"}}),y=()=>({nodelay:!1,reuseaddr:!0,send_timeout_close:!0,active_n:100,backlog:1024,buffer:"4KB",send_timeout:"15s",keepalive:"none",nolinger:!1}),b=()=>({active_n:100,buffer:"4KB",recbuf:"2KB",sndbuf:"2KB",reuseaddr:!0}),B=()=>({type:ListenerType.TCP,id:"",name:"",bind:"",acceptors:16,max_connections:102400,max_conn_rate:a?1e3:void 0,mountpoint:"",proxy_protocol:!1,proxy_protocol_timeout:"3s",tcp_options:y(),udp_options:b(),dtls_options:{versions:["dtlsv1.2","dtlsv1"],ciphers:[],...E()},ssl_options:{versions:["tlsv1.3","tlsv1.2","tlsv1.1","tlsv1"],ciphers:[],...E()},websocket:{mqtt_path:""},health_check:{request:"",reply:""}}),U=new RegExp(`^(?<type>${N.join("|")}):(?<name>.+)`),X=n=>{const u=n.match(U);if(!u)return{type:"",name:""};const{name:m,type:_}=u.groups||{};return{name:m,type:_}},ee=n=>{const u=n;return/^\d+$/.test(u.bind)&&(u.bind=parseInt(u.bind)),u},q=n=>s.includes(n),z=n=>r.includes(n),W=n=>p.includes(n),Y=n=>C.includes(n),O=n=>T.includes(n),te=n=>{const{type:u=ListenerType.TCP}=n,m={};return Object.keys(n).forEach(_=>{var D;switch(_){case"proxy_protocol_timeout":case"proxy_protocol":q(u)&&(m[_]=n[_]);break;case"acceptors":u!==ListenerTypeForGateway.UDP&&(m[_]=n[_]);break;case"limiter":m[_]=n[_];break;case"access_rules":m[_]=typeof n[_]=="string"?n[_].split(","):n[_];break;case"websocket":(D=n[_])!=null&&D.supported_subprotocols&&typeof n[_].supported_subprotocols!="string"&&(n[_].supported_subprotocols=n[_].supported_subprotocols.join(", "));break;case"ssl_options":n[_].cacertfile===""&&delete n[_].cacertfile;break;case"health_check":m[_]=n[_];break;default:(typeof n[_]!="object"||n[_]===null)&&(m[_]=n[_])}}),n[u]&&(m[u]={...n[u]}),z(u)&&n.tcp_options&&(m.tcp_options={...n.tcp_options}),W(u)&&n.udp_options&&(m.udp_options={...n.udp_options}),Y(u)&&(u!==ListenerTypeForGateway.DTLS?m.ssl_options={...n.ssl_options}:m.dtls_options={...n.dtls_options}),O(u)&&(m.websocket={...n.websocket}),m},K=(n,u)=>{const{type:m,name:_}=n;return`${u?u+i:""}${m}${i}${_}`},oe=(n,u)=>{var _;const m=lodashExports.cloneDeep(n);return n.name||(m.name=((_=n==null?void 0:n.id)==null?void 0:_.split(i)[2])||""),n.id||(m.id=[u,n.type,n.name].join(i)),m},H=/^:\d+$/,c=n=>H.test(n)?n.replace(":",""):n;function o(n,u){const m=unexposedConfigs[n],_={};function D(F,P,J=""){Object.keys(F).forEach(S=>{const ne=J?`${J}.${S}`:S;typeof F[S]=="object"&&!Array.isArray(F[S])&&F[S]!==null?(P[S]||(P[S]={}),D(F[S],P[S],ne)):Array.isArray(F[S])?(!Array.isArray(P[S])||F[S].length!==P[S].length||!F[S].every((Z,re)=>Z===P[S][re]))&&(_[ne]=P[S]):F[S]!==P[S]&&(_[ne]=P[S])})}return D(m,u),_}const I=/^[a-zA-Z_]+$/,f=/^[\d]+$/,l=n=>I.test(n)||f.test(n)?n:`"${n}"`,Q=n=>{if(bf(n))return"";let u="";const m=(_,D=0)=>{for(const F in _){const P=_[F];if(typeof P=="object"&&!Array.isArray(P))u+=`${"  ".repeat(D)}${F} {
`,m(P,D+1),u+=`${"  ".repeat(D)}}
`;else if(Array.isArray(P)){u+=`${"  ".repeat(D)}${F} = [
`;for(const J of P)u+=`${"  ".repeat(D+1)}${l(J)}
`;u+=`${"  ".repeat(D)}]
`}else u+=`${"  ".repeat(D)}${F} = ${l(P)}
`}};return m(n,1),`{
${u}}`},ae=n=>{try{const u=parseHoconToObject(n);return Promise.resolve(u)}catch(u){return Promise.reject(u)}},j=(n,u)=>{for(const m in u)n[m]===void 0||n[m]===null||n[m]===""||typeof n[m]=="object"&&bf(n[m])?n[m]=u[m]:typeof n[m]=="object"&&typeof u[m]=="object"&&(n[m]=j(n[m],u[m]));return n};return{completeGatewayListenerTypeList:g,listenerTypeList:N,ID_SEPARATOR:i,gatewayTypesWhichCanEnableProxyProtocol:s,gatewayTypesWhichHasTCPConfig:r,gatewayTypesWhichHasUDPConfig:p,gatewayTypesWhichHasSSLConfig:C,listenerFormRules:$,limiterRules:L,maxConnRateRule:G,createRawListener:B,getListenerNameNTypeById:X,createListenerId:K,hasTCPConfig:z,hasUDPConfig:W,hasSSLConfig:Y,hasWSConfig:O,canConfigProxyProtocol:q,normalizeStructure:te,deNormalizeStructure:oe,handleListenerDataWhenItIsIndependent:ee,transPort:c,extractDifferences:o,objectToHocon:Q,hoconToObject:ae,resetCustomConfig:j}},_hoisted_1$2={class:"desc-tips"},_hoisted_2$1={key:0,class:"error-msg"},_sfc_main$2=defineComponent({__name:"CustomConfigs",props:{modelValue:{type:Object,required:!0},type:{type:String,required:!0}},emits:["update:modelValue"],setup(a,{expose:i,emit:g}){const{tl:N}=useI18nTl("Gateway"),s=a,r=g,{objectToHocon:p,hoconToObject:C}=useListenerUtils(),T=ref(""),x=ref(p(s.modelValue));watch(()=>s.type,k=>{h(k)}),watch(()=>s.modelValue,k=>{x.value=p(k)});const e=ref("");function h(k){e.value=p(unexposedConfigs[k])}h(s.type);async function V(){try{const k=await C(x.value);r("update:modelValue",k)}catch(k){const L=k;T.value=L.toString()}}function A(){T.value=""}const v=k=>{k.preventDefault();const L=k.target,{selectionStart:G,selectionEnd:M,value:$}=L,E=2,y=$.slice(0,G),b=$.slice(M),B=y+" ".repeat(E)+b,U=G+E;L.value=B,L.setSelectionRange(U,U)};return i({rawListener:x}),(k,L)=>{const G=resolveComponent("el-input"),M=resolveComponent("el-form-item");return openBlock(),createBlock(M,{class:"custom-configs",label:unref(N)("customConfig")},{default:withCtx(()=>[createBaseVNode("p",_hoisted_1$2,toDisplayString(unref(N)("customConfigDescription")),1),createVNode(G,{type:"textarea",modelValue:unref(x),"onUpdate:modelValue":L[0]||(L[0]=$=>isRef(x)?x.value=$:null),rows:12,placeholder:unref(e),onKeydown:withKeys(v,["tab"]),onBlur:V,onFocus:A},null,8,["modelValue","placeholder"]),unref(T)!==""?(openBlock(),createElementBlock("p",_hoisted_2$1,toDisplayString(unref(T)),1)):createCommentVNode("",!0)]),_:1},8,["label"])}}}),queryListener=()=>axios.get("/listeners"),addListener=(a,i)=>axios.post(`/listeners/${i}`,a),updateListener=(a,i)=>axios.put(`/listeners/${i}`,a),deleteListener=a=>axios.delete(`/listeners/${a}`),handleListener=(a,i)=>axios.post(`/listeners/${a}/${i}`),queryListenerDetail=a=>axios.get(`/listeners/${a}`),useListenerDrawer=(a,i)=>{const g=computed({get:()=>a.modelValue,set:d=>{i("update:modelValue",d)}}),N=computed(()=>!!a.listener&&!a.doNotSubmitToBackend),s=computed(()=>N.value||!!(a.doNotSubmitToBackend&&a.listener)),r=ref({}),p=ref({}),{t:C}=useI18nTl("Gateway"),{completeGatewayListenerTypeList:T,listenerTypeList:x,listenerFormRules:e,limiterRules:h,maxConnRateRule:V,createListenerId:A,createRawListener:v,hasTCPConfig:k,hasUDPConfig:L,hasSSLConfig:G,hasWSConfig:M,canConfigProxyProtocol:$,normalizeStructure:E,handleListenerDataWhenItIsIndependent:y,getListenerNameNTypeById:b,transPort:B,extractDifferences:U,hoconToObject:X,resetCustomConfig:ee}=useListenerUtils(a.gatewayName),q=computed(()=>{if(a.gatewayName){if(a.gatewayName in GATEWAY_DISABLED_LISTENER_TYPE_MAP){const d=GATEWAY_DISABLED_LISTENER_TYPE_MAP[a.gatewayName];return T.filter(w=>!d.includes(w))}return T}return x}),z=ref(v()),W=ref(),Y=ref(),O=ref(!1),te=computed(()=>$(r.value.type)),K=computed(()=>k(r.value.type)),oe=computed(()=>L(r.value.type)),H=computed(()=>r.value.type===ListenerTypeForGateway.DTLS),c=computed(()=>a.gatewayName===GatewayName.CoAP),o=computed(()=>G(r.value.type)||H.value),I=computed(()=>H.value?"dtls_options":"ssl_options"),f=computed(()=>M(r.value.type)),l=computed(()=>{let d=e;return a.gatewayName?d={...d,...V}:d={...d,...h},d}),Q=ref(!1);let ae={},j={};const n=()=>!lodashExports.isEqual(ae,r.value)||!lodashExports.isEqual(j,p.value),u=async()=>{try{return n()&&await ElMessageBox({type:"info",title:C("APIKey.close"),message:C("Base.unloadTip"),showCancelButton:!0,confirmButtonText:C("Base.confirm"),showClose:!1,closeOnClickModal:!1,closeOnPressEscape:!1,closeOnHashChange:!1}),Promise.resolve()}catch{return Promise.reject()}},m=async()=>{if(a.listener)try{Q.value=!0;const d=await queryListenerDetail(a.listener.id),{name:w,type:R}=b(d.id);r.value={...d,name:w,type:R,bind:B(d.bind)};const t=U(R,r.value);p.value={},bf(t)||(p.value=Of(t)),ae=lodashExports.cloneDeep(r.value),j=lodashExports.cloneDeep(p.value)}catch{}finally{Q.value=!1}},_=async()=>{try{return await W.value.validate(),Promise.resolve()}catch{return jumpToErrorFormItem(),Promise.reject()}},D=async()=>{try{return Y.value&&await X(Y.value.rawListener),Promise.resolve()}catch(d){const w=d;return ElMessage.error(w.toString()),Promise.reject(d)}},F=["bytes_rate","bytes_burst","messages_rate","messages_burst","max_conn_rate","max_conn_burst"],P=d=>{var w,R;if(a.gatewayName&&["zone","limiter","current_connections"].forEach(le=>{delete d[le]}),(!c.value||!((w=d.health_check)!=null&&w.request)&&!((R=d.health_check)!=null&&R.reply))&&delete d.health_check,r.value.type===ListenerTypeForGateway.UDP&&(d.acceptors=""),(d.type===ListenerType.WSS||d.type===ListenerType.QUIC)&&delete d.ssl_options.ocsp,!a.gatewayName&&r.value.type!=="quic"){const t=r.value.type,le=ee(p.value,unexposedConfigs[t]);lodashExports.merge(d,le)}return F.forEach(t=>{typeof d[t]=="string"&&d[t]===""&&(d[t]=null)}),d},J=async()=>{await _(),a.gatewayName||await D(),r.value.id=A(r.value,a.gatewayName);const d=P(lodashExports.cloneDeep(r.value));if(a.doNotSubmitToBackend){i("submit",checkNOmitFromObj(d)),g.value=!1;return}try{if(N.value){const t=a.gatewayName?C("Gateway.updateGatewayListenerTip"):C("BasicConfig.updateListenerTip");await ElMessageBox.confirm(t,"",{type:"warning"})}O.value=!0;const w=["certfile","keyfile","cacertfile"].reduce((t,le)=>[...t,`dtls_options.${le}`,`ssl_options.${le}`],[]);let R=E(d);N.value||(R=checkNOmitFromObj(R,w)),a.gatewayName?await ne(R):await Z(R),ElMessage.success(C(`Base.${N.value?"updateSuccess":"createSuccess"}`)),g.value=!1,i("submitted")}catch(w){console.error(w)}finally{O.value=!1}},S=()=>{i("delete",r.value)},ne=async function(d){const w=a.gatewayName,R=lodashExports.omit(lodashExports.cloneDeep(d),["zone"]);try{return N.value?await updateGatewayListener(w,d.id,R):await addGatewayListener(w,R),Promise.resolve()}catch{return Promise.reject()}},Z=async d=>{try{let w=lodashExports.omit(lodashExports.cloneDeep(d),["name"]);return w=y(w),N.value?await updateListener(w,d.id):await addListener(w,d.id),Promise.resolve()}catch{return Promise.reject()}},re=()=>{const{gatewayName:d}=a;if(!d||!(d in GATEWAY_DISABLED_LISTENER_TYPE_MAP))return T[0];const w=GATEWAY_DISABLED_LISTENER_TYPE_MAP[d];return T.filter(R=>!w.includes(R))[0]};return watch(g,async d=>{if(d){if(a.listener){const w=v();w.health_check=emptyObject(w.health_check),r.value=lodashExports.assign(w,lodashExports.cloneDeep(a.listener)),a.gatewayName||m()}else{const w={};a.gatewayName&&(w.type=re()),r.value={...v(),...w},a.gatewayName||delete r.value.max_conn_rate}await nextTick(),W.value.clearValidate()}else r.value=v(),p.value={},Q.value=!1}),{showDialog:g,isLoading:Q,isEdit:N,canBeDeleted:s,listenerRecord:r,listenerCustomConfigs:p,formCom:W,customConfig:Y,listenerTypeOptList:q,defaultListener:z,isSubmitting:O,showProxyProtocolConfig:te,showTCPConfig:K,showUDPConfig:oe,showSSLConfig:o,showWSConfig:f,isDTLS:H,isCoAP:c,SSLConfigKey:I,listenerFormRules:l,confirmClose:u,submit:J,onDelete:S,transPort:B,handleTLSVerifyChange:d=>{const{fail_if_no_peer_cert:w}=r.value[I.value];d==="verify_none"&&w===!0&&(r.value[I.value].fail_if_no_peer_cert=!1)}}},_hoisted_1$1={key:2},_sfc_main$1=defineComponent({__name:"ListenerDrawer",props:{modelValue:{type:Boolean,required:!0},listener:{type:Object},gatewayName:{type:String},doNotSubmitToBackend:{type:Boolean,default:!1}},emits:["update:modelValue","submit","submitted","delete"],setup(a,{emit:i}){const g=a,N=i,{tl:s,t:r}=useI18nTl("Gateway"),{showDialog:p,isEdit:C,canBeDeleted:T,isLoading:x,listenerRecord:e,listenerCustomConfigs:h,formCom:V,customConfig:A,listenerTypeOptList:v,defaultListener:k,isSubmitting:L,showProxyProtocolConfig:G,showTCPConfig:M,showUDPConfig:$,showSSLConfig:E,isDTLS:y,isCoAP:b,SSLConfigKey:B,showWSConfig:U,listenerFormRules:X,submit:ee,confirmClose:q,onDelete:z,handleTLSVerifyChange:W}=useListenerDrawer(g,N),Y=computed(()=>e.value.type===ListenerTypeForGateway.UDP),O=computed(()=>e.value.type===ListenerType.QUIC),te=computed(()=>e.value.type===ListenerType.WSS),K=[ListenerType.WS,ListenerType.WSS,ListenerType.QUIC],oe=async()=>{await q(),p.value=!1},H=async c=>{await q(),c()};return(c,o)=>{const I=resolveComponent("el-input"),f=resolveComponent("el-form-item"),l=resolveComponent("el-col"),Q=resolveComponent("el-option"),ae=resolveComponent("el-select"),j=resolveComponent("el-divider"),n=resolveComponent("el-row"),u=_sfc_main$8,m=_sfc_main$9,_=_sfc_main$5,D=__unplugin_components_3,F=_sfc_main$a,P=_sfc_main$8,J=_sfc_main$b,S=resolveComponent("el-switch"),ne=_sfc_main$c,Z=_sfc_main$d,re=__unplugin_components_9,se=resolveComponent("el-form"),d=resolveComponent("el-button"),w=resolveComponent("el-drawer"),R=resolveDirective("loading");return openBlock(),createBlock(w,{title:unref(s)(g.listener?"editListener":"addListener"),modelValue:unref(p),"onUpdate:modelValue":o[48]||(o[48]=t=>isRef(p)?p.value=t:null),"lock-scroll":!1,"close-on-click-modal":!1,"before-close":H,size:"760","z-index":1999,class:"listener-drawer","destroy-on-close":""},{footer:withCtx(()=>[createVNode(d,{onClick:oe},{default:withCtx(()=>[createTextVNode(toDisplayString(c.$t("Base.cancel")),1)]),_:1}),unref(T)?(openBlock(),createBlock(d,{key:0,type:"danger",disabled:!c.$hasPermission("delete"),plain:"",onClick:unref(z)},{default:withCtx(()=>[createTextVNode(toDisplayString(c.$t("Base.delete")),1)]),_:1},8,["disabled","onClick"])):createCommentVNode("",!0),createVNode(d,{type:"primary",disabled:!c.$hasPermission("post"),onClick:unref(ee),loading:unref(L)},{default:withCtx(()=>[createTextVNode(toDisplayString(g.listener?c.$t("Base.update"):c.$t("Base.add")),1)]),_:1},8,["disabled","onClick","loading"])]),default:withCtx(()=>[withDirectives((openBlock(),createBlock(se,{"label-position":"top","require-asterisk-position":"right",rules:unref(X),model:unref(e),"validate-on-rule-change":!1,ref_key:"formCom",ref:V},{default:withCtx(()=>[createVNode(n,{gutter:20},{default:withCtx(()=>[createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,{label:unref(s)("name"),prop:"name",required:""},{default:withCtx(()=>[createVNode(I,{modelValue:unref(e).name,"onUpdate:modelValue":o[0]||(o[0]=t=>unref(e).name=t),disabled:unref(C)},null,8,["modelValue","disabled"])]),_:1},8,["label"])]),_:1}),createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,{label:unref(s)("lType"),prop:"type",required:""},{default:withCtx(()=>[createVNode(ae,{modelValue:unref(e).type,"onUpdate:modelValue":o[1]||(o[1]=t=>unref(e).type=t),disabled:unref(C)},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(v),t=>(openBlock(),createBlock(Q,{key:t,value:t},null,8,["value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1},8,["label"])]),_:1}),createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,{label:unref(s)("lAddress"),prop:"bind",required:""},{default:withCtx(()=>[createVNode(I,{modelValue:unref(e).bind,"onUpdate:modelValue":o[2]||(o[2]=t=>unref(e).bind=t)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),createVNode(l,{span:24},{default:withCtx(()=>[createVNode(j)]),_:1})]),_:1}),unref(U)&&!a.gatewayName?(openBlock(),createBlock(n,{key:0,gutter:20},{default:withCtx(()=>[createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,{label:"MQTT Path"},{label:withCtx(()=>[createVNode(u,{label:"MQTT Path",desc:c.$t("BasicConfig.mqttPath"),"desc-marked":""},null,8,["desc"])]),default:withCtx(()=>[createVNode(I,{modelValue:unref(e).websocket.mqtt_path,"onUpdate:modelValue":o[3]||(o[3]=t=>unref(e).websocket.mqtt_path=t),placeholder:"/mqtt"},null,8,["modelValue"])]),_:1})]),_:1}),createVNode(l,{span:24},{default:withCtx(()=>[createVNode(j)]),_:1})]),_:1})):unref(U)&&a.gatewayName?(openBlock(),createBlock(n,{key:1,gutter:20},{default:withCtx(()=>[createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,{label:"Path"},{default:withCtx(()=>[createVNode(I,{modelValue:unref(e).websocket.path,"onUpdate:modelValue":o[4]||(o[4]=t=>unref(e).websocket.path=t),placeholder:a.gatewayName===unref(GatewayName).OCPP?"/ocpp":""},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),createVNode(l,{span:24},{default:withCtx(()=>[createVNode(j)]),_:1})]),_:1})):createCommentVNode("",!0),createVNode(n,{gutter:20},{default:withCtx(()=>[createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,{label:unref(s)("maxConn"),prop:"max_connections"},{default:withCtx(()=>[createVNode(m,{class:"in-one-row",modelValue:unref(e).max_connections,"onUpdate:modelValue":o[5]||(o[5]=t=>unref(e).max_connections=t),items:[{type:"number"},{symbols:["INFINITY_VALUE"in c?c.INFINITY_VALUE:unref(INFINITY_VALUE)],type:"enum"}]},null,8,["modelValue","items"])]),_:1},8,["label"])]),_:1}),a.gatewayName?(openBlock(),createBlock(l,{key:0,span:12},{default:withCtx(()=>[createVNode(f,{label:unref(s)("maxConnRate"),prop:"max_conn_rate"},{default:withCtx(()=>[createVNode(_sfc_main$6,{modelValue:unref(e).max_conn_rate,"onUpdate:modelValue":o[6]||(o[6]=t=>unref(e).max_conn_rate=t),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})):createCommentVNode("",!0),unref(G)?(openBlock(),createElementBlock(Fragment,{key:1},[createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,{label:c.$t("BasicConfig.proxyProtocol")},{default:withCtx(()=>[createVNode(_,{modelValue:unref(e).proxy_protocol,"onUpdate:modelValue":o[7]||(o[7]=t=>unref(e).proxy_protocol=t)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,{label:c.$t("BasicConfig.proxyProtocolTimeout")},{default:withCtx(()=>[createVNode(D,{modelValue:unref(e).proxy_protocol_timeout,"onUpdate:modelValue":o[8]||(o[8]=t=>unref(e).proxy_protocol_timeout=t),"number-placeholder":"15","enabled-units":["s"]},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})],64)):createCommentVNode("",!0)]),_:1}),unref(E)?(openBlock(),createElementBlock("div",_hoisted_1$1,[createVNode(n,{gutter:20},{default:withCtx(()=>[createVNode(l,{span:24},{default:withCtx(()=>[createVNode(j)]),_:1}),createVNode(l,{span:24},{default:withCtx(()=>[unref(p)&&!unref(x)?(openBlock(),createBlock(F,{key:0,class:"TLS-config",modelValue:unref(e)[unref(B)],"onUpdate:modelValue":o[9]||(o[9]=t=>unref(e)[unref(B)]=t),"show-sni":!1,"is-edit":unref(C),"base-path":unref(B),"verify-label":unref(r)("Base.tlsVerifyClient"),onVerifyChange:unref(W)},null,8,["modelValue","is-edit","base-path","verify-label","onVerifyChange"])):createCommentVNode("",!0)]),_:1}),!unref(O)&&unref(e)[unref(B)].verify!=="verify_none"?(openBlock(),createBlock(l,{key:0,span:12},{default:withCtx(()=>[createVNode(f,{label:unref(s)("failIfNoPeerCert")},{default:withCtx(()=>[createVNode(_,{modelValue:unref(e)[unref(B)].fail_if_no_peer_cert,"onUpdate:modelValue":o[10]||(o[10]=t=>unref(e)[unref(B)].fail_if_no_peer_cert=t)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})):createCommentVNode("",!0)]),_:1})])):createCommentVNode("",!0),a.gatewayName?createCommentVNode("",!0):(openBlock(),createBlock(n,{key:3,gutter:20},{default:withCtx(()=>[createVNode(l,{span:24},{default:withCtx(()=>[createVNode(j)]),_:1}),createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,null,{label:withCtx(()=>[createVNode(P,{label:unref(s)("showLimiter"),desc:unref(s)("showLimiterDesc"),"desc-marked":""},null,8,["label","desc"])]),_:1})]),_:1}),createVNode(l,{span:12}),K.includes(unref(e).type)?createCommentVNode("",!0):(openBlock(),createBlock(l,{key:0,span:12},{default:withCtx(()=>[createVNode(f,{label:unref(r)("Gateway.maxConnRate"),prop:"max_conn_rate"},{default:withCtx(()=>[createVNode(m,{class:"in-one-row",modelValue:unref(e).max_conn_rate,"onUpdate:modelValue":o[11]||(o[11]=t=>unref(e).max_conn_rate=t),items:[{type:"rate"},{symbols:["INFINITY_VALUE"in c?c.INFINITY_VALUE:unref(INFINITY_VALUE)],type:"enum"}]},null,8,["modelValue","items"])]),_:1},8,["label"])]),_:1})),K.includes(unref(e).type)?createCommentVNode("",!0):(openBlock(),createBlock(l,{key:1,span:12},{default:withCtx(()=>[createVNode(f,{prop:"max_conn_burst"},{label:withCtx(()=>[createVNode(u,{label:unref(s)("maxConnBurst"),desc:unref(s)("maxConnBurstDesc"),"desc-marked":""},null,8,["label","desc"])]),default:withCtx(()=>[createVNode(I,{modelValue:unref(e).max_conn_burst,"onUpdate:modelValue":o[12]||(o[12]=t=>unref(e).max_conn_burst=t)},null,8,["modelValue"])]),_:1})]),_:1})),createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,{label:unref(r)("Gateway.maxMsgPubRate"),prop:"messages_rate"},{default:withCtx(()=>[createVNode(m,{class:"in-one-row",modelValue:unref(e).messages_rate,"onUpdate:modelValue":o[13]||(o[13]=t=>unref(e).messages_rate=t),items:[{type:"rate"},{symbols:["INFINITY_VALUE"in c?c.INFINITY_VALUE:unref(INFINITY_VALUE)],type:"enum"}]},null,8,["modelValue","items"])]),_:1},8,["label"])]),_:1}),createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,{prop:"messages_burst"},{label:withCtx(()=>[createVNode(u,{label:unref(s)("maxMsgPubBurst"),desc:unref(r)("ConfigSchema.messages_burst.desc"),"desc-marked":""},null,8,["label","desc"])]),default:withCtx(()=>[createVNode(I,{modelValue:unref(e).messages_burst,"onUpdate:modelValue":o[14]||(o[14]=t=>unref(e).messages_burst=t)},null,8,["modelValue"])]),_:1})]),_:1}),createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,{label:unref(r)("Gateway.maxMsgPubTraffic"),prop:"bytes_rate"},{default:withCtx(()=>[createVNode(m,{class:"in-one-row",modelValue:unref(e).bytes_rate,"onUpdate:modelValue":o[15]||(o[15]=t=>unref(e).bytes_rate=t),items:[{type:"rate",units:[{label:`MB/${unref(r)("Base.second")}`,value:"MB/s"},{label:`KB/${unref(r)("Base.second")}`,value:"KB/s"}]},{symbols:["INFINITY_VALUE"in c?c.INFINITY_VALUE:unref(INFINITY_VALUE)],type:"enum"}]},null,8,["modelValue","items"])]),_:1},8,["label"])]),_:1}),createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,{prop:"bytes_burst"},{label:withCtx(()=>[createVNode(u,{label:unref(s)("maxMsgPubTrafficBurst"),desc:unref(r)("ConfigSchema.bytes_burst.desc"),"desc-marked":""},null,8,["label","desc"])]),default:withCtx(()=>[createVNode(I,{modelValue:unref(e).bytes_burst,"onUpdate:modelValue":o[16]||(o[16]=t=>unref(e).bytes_burst=t)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})),createVNode(re,null,{default:withCtx(()=>[createBaseVNode("div",null,[createVNode(n,{gutter:20},{default:withCtx(()=>[createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,null,{label:withCtx(()=>[createVNode(u,{label:unref(s)("mountPoint"),desc:unref(s)("mountPointDesc"),"max-height":200,"desc-marked":""},null,8,["label","desc"])]),default:withCtx(()=>[createVNode(I,{modelValue:unref(e).mountpoint,"onUpdate:modelValue":o[17]||(o[17]=t=>unref(e).mountpoint=t)},null,8,["modelValue"])]),_:1})]),_:1}),unref(b)&&unref(e).health_check?(openBlock(),createElementBlock(Fragment,{key:0},[createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,{prop:"health_check.request"},{label:withCtx(()=>[createVNode(u,{label:unref(r)("Gateway.healthCheck"),desc:c.$t("Gateway.healthCheckDesc")},null,8,["label","desc"])]),default:withCtx(()=>[createVNode(I,{modelValue:unref(e).health_check.request,"onUpdate:modelValue":o[18]||(o[18]=t=>unref(e).health_check.request=t)},null,8,["modelValue"])]),_:1})]),_:1}),createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,{label:unref(r)("Gateway.healthCheckResponse"),prop:"health_check.reply"},{label:withCtx(()=>[createVNode(u,{label:unref(r)("Gateway.healthCheckResponse"),desc:c.$t("Gateway.healthCheckResponseDesc")},null,8,["label","desc"])]),default:withCtx(()=>[createVNode(I,{modelValue:unref(e).health_check.reply,"onUpdate:modelValue":o[19]||(o[19]=t=>unref(e).health_check.reply=t)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})],64)):createCommentVNode("",!0),unref(Y)?createCommentVNode("",!0):(openBlock(),createBlock(l,{key:1,span:12},{default:withCtx(()=>[createVNode(f,{label:c.$t("BasicConfig.acceptors"),prop:"acceptors"},{default:withCtx(()=>[createVNode(_sfc_main$6,{modelValue:unref(e).acceptors,"onUpdate:modelValue":o[20]||(o[20]=t=>unref(e).acceptors=t)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})),unref(E)?(openBlock(),createElementBlock(Fragment,{key:2},[createVNode(l,{span:24},{default:withCtx(()=>[createVNode(j)]),_:1}),unref(y)?(openBlock(),createElementBlock(Fragment,{key:0},[createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,{label:unref(s)("dtlsversion")},{default:withCtx(()=>[createVNode(_sfc_main$4,{modelValue:unref(e).dtls_options.versions,"onUpdate:modelValue":o[21]||(o[21]=t=>unref(e).dtls_options.versions=t)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,null,{label:withCtx(()=>[createVNode(P,{label:unref(s)("ciphers"),desc:unref(s)("ciphersDesc"),"desc-marked":""},null,8,["label","desc"])]),default:withCtx(()=>[createVNode(_sfc_main$7,{modelValue:unref(e).dtls_options.ciphers,"onUpdate:modelValue":o[22]||(o[22]=t=>unref(e).dtls_options.ciphers=t)},null,8,["modelValue"])]),_:1})]),_:1})],64)):unref(O)?createCommentVNode("",!0):(openBlock(),createElementBlock(Fragment,{key:1},[createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,{label:unref(s)("sslversion")},{default:withCtx(()=>[createVNode(_sfc_main$3,{modelValue:unref(e).ssl_options.versions,"onUpdate:modelValue":o[23]||(o[23]=t=>unref(e).ssl_options.versions=t)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,null,{label:withCtx(()=>[createVNode(P,{label:unref(s)("ciphers"),desc:unref(s)("ciphersDesc"),"desc-marked":""},null,8,["label","desc"])]),default:withCtx(()=>[createVNode(_sfc_main$7,{modelValue:unref(e).ssl_options.ciphers,"onUpdate:modelValue":o[24]||(o[24]=t=>unref(e).ssl_options.ciphers=t)},null,8,["modelValue"])]),_:1})]),_:1}),createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,{label:unref(s)("SSLdepth")},{default:withCtx(()=>[createVNode(I,{modelValue:unref(e)[unref(B)].depth,"onUpdate:modelValue":o[25]||(o[25]=t=>unref(e)[unref(B)].depth=t),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})],64)),createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,{label:unref(s)("SSLPassword")},{default:withCtx(()=>[createVNode(J,{modelValue:unref(e)[unref(B)].password,"onUpdate:modelValue":o[26]||(o[26]=t=>unref(e)[unref(B)].password=t)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),!a.gatewayName&&!unref(te)&&!unref(O)?(openBlock(),createElementBlock(Fragment,{key:2},[createVNode(l,{span:24},{default:withCtx(()=>[createVNode(f,{label:unref(s)("enableOcspStapling")},{default:withCtx(()=>[createVNode(S,{modelValue:unref(e).ssl_options.ocsp.enable_ocsp_stapling,"onUpdate:modelValue":o[27]||(o[27]=t=>unref(e).ssl_options.ocsp.enable_ocsp_stapling=t)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),unref(e).ssl_options.ocsp.enable_ocsp_stapling?(openBlock(),createElementBlock(Fragment,{key:0},[createVNode(l,{span:24},{default:withCtx(()=>[createVNode(f,{label:unref(s)("responderUrl"),prop:"ssl_options.ocsp.responder_url"},{default:withCtx(()=>[createVNode(I,{modelValue:unref(e).ssl_options.ocsp.responder_url,"onUpdate:modelValue":o[28]||(o[28]=t=>unref(e).ssl_options.ocsp.responder_url=t)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),createVNode(l,{span:24},{default:withCtx(()=>[createVNode(f,{label:unref(s)("issuerPem"),prop:"ssl_options.ocsp.issuer_pem"},{default:withCtx(()=>[createVNode(ne,{modelValue:unref(e).ssl_options.ocsp.issuer_pem,"onUpdate:modelValue":o[29]||(o[29]=t=>unref(e).ssl_options.ocsp.issuer_pem=t),"is-edit":unref(C)},null,8,["modelValue","is-edit"])]),_:1},8,["label"])]),_:1}),createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,{label:unref(s)("refreshInterval")},{default:withCtx(()=>[createVNode(D,{modelValue:unref(e).ssl_options.ocsp.refresh_interval,"onUpdate:modelValue":o[30]||(o[30]=t=>unref(e).ssl_options.ocsp.refresh_interval=t)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,{label:unref(s)("refreshHttpTimeout")},{default:withCtx(()=>[createVNode(D,{modelValue:unref(e).ssl_options.ocsp.refresh_http_timeout,"onUpdate:modelValue":o[31]||(o[31]=t=>unref(e).ssl_options.ocsp.refresh_http_timeout=t)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})],64)):createCommentVNode("",!0),createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,{label:unref(s)("enableCrlCheck")},{default:withCtx(()=>[createVNode(S,{modelValue:unref(e).ssl_options.enable_crl_check,"onUpdate:modelValue":o[32]||(o[32]=t=>unref(e).ssl_options.enable_crl_check=t)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})],64)):createCommentVNode("",!0)],64)):createCommentVNode("",!0),unref(M)?(openBlock(),createElementBlock(Fragment,{key:3},[createVNode(l,{span:24},{default:withCtx(()=>[createVNode(j)]),_:1}),createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,{label:"ActiveN"},{default:withCtx(()=>[createVNode(_sfc_main$6,{modelValue:unref(e).tcp_options.active_n,"onUpdate:modelValue":o[33]||(o[33]=t=>unref(e).tcp_options.active_n=t),modelModifiers:{number:!0},placeholder:String(unref(k).tcp_options.active_n)},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,{label:"Backlog"},{default:withCtx(()=>[createVNode(_sfc_main$6,{modelValue:unref(e).tcp_options.backlog,"onUpdate:modelValue":o[34]||(o[34]=t=>unref(e).tcp_options.backlog=t),modelModifiers:{number:!0},placeholder:String(unref(k).tcp_options.backlog)},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,{label:"Buffer"},{default:withCtx(()=>[createVNode(Z,{modelValue:unref(e).tcp_options.buffer,"onUpdate:modelValue":o[35]||(o[35]=t=>unref(e).tcp_options.buffer=t),"number-placeholder":"4",units:["KB"]},null,8,["modelValue"])]),_:1})]),_:1}),createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,{label:"TCP_NODELAY"},{default:withCtx(()=>[createVNode(_,{modelValue:unref(e).tcp_options.nodelay,"onUpdate:modelValue":o[36]||(o[36]=t=>unref(e).tcp_options.nodelay=t)},null,8,["modelValue"])]),_:1})]),_:1}),createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,{label:"SO_REUSEADDR"},{default:withCtx(()=>[createVNode(_,{modelValue:unref(e).tcp_options.reuseaddr,"onUpdate:modelValue":o[37]||(o[37]=t=>unref(e).tcp_options.reuseaddr=t)},null,8,["modelValue"])]),_:1})]),_:1}),createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,{label:unref(s)("sendTimeout")},{default:withCtx(()=>[createVNode(D,{modelValue:unref(e).tcp_options.send_timeout,"onUpdate:modelValue":o[38]||(o[38]=t=>unref(e).tcp_options.send_timeout=t),"number-placeholder":"15","enabled-units":["s"]},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,{label:unref(s)("sendTimeoutClose")},{default:withCtx(()=>[createVNode(_,{modelValue:unref(e).tcp_options.send_timeout_close,"onUpdate:modelValue":o[39]||(o[39]=t=>unref(e).tcp_options.send_timeout_close=t)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,null,{label:withCtx(()=>[createVNode(u,{label:unref(s)("nolinger"),desc:unref(s)("nolingerDesc"),"desc-marked":""},null,8,["label","desc"])]),default:withCtx(()=>[createVNode(S,{modelValue:unref(e).tcp_options.nolinger,"onUpdate:modelValue":o[40]||(o[40]=t=>unref(e).tcp_options.nolinger=t)},null,8,["modelValue"])]),_:1})]),_:1}),createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,null,{label:withCtx(()=>[createVNode(u,{label:"Keepalive",desc:unref(s)("tcpKeepaliveDesc"),"desc-marked":""},null,8,["desc"])]),default:withCtx(()=>[createVNode(I,{modelValue:unref(e).tcp_options.keepalive,"onUpdate:modelValue":o[41]||(o[41]=t=>unref(e).tcp_options.keepalive=t)},null,8,["modelValue"])]),_:1})]),_:1})],64)):createCommentVNode("",!0),unref($)?(openBlock(),createElementBlock(Fragment,{key:4},[createVNode(l,{span:24},{default:withCtx(()=>[createVNode(j)]),_:1}),createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,{label:"ActiveN"},{default:withCtx(()=>[createVNode(I,{modelValue:unref(e).udp_options.active_n,"onUpdate:modelValue":o[42]||(o[42]=t=>unref(e).udp_options.active_n=t),placeholder:String(unref(k).udp_options.active_n)},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,{label:"Buffer"},{default:withCtx(()=>[createVNode(Z,{modelValue:unref(e).udp_options.buffer,"onUpdate:modelValue":o[43]||(o[43]=t=>unref(e).udp_options.buffer=t),"number-placeholder":"4",units:["KB"]},null,8,["modelValue"])]),_:1})]),_:1}),createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,{label:unref(s)("recBuf")},{default:withCtx(()=>[createVNode(Z,{modelValue:unref(e).udp_options.recbuf,"onUpdate:modelValue":o[44]||(o[44]=t=>unref(e).udp_options.recbuf=t),"number-placeholder":"2",units:["KB"]},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,{label:unref(s)("sendBuf")},{default:withCtx(()=>[createVNode(Z,{modelValue:unref(e).udp_options.sndbuf,"onUpdate:modelValue":o[45]||(o[45]=t=>unref(e).udp_options.sndbuf=t),"number-placeholder":"2",units:["KB"]},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),createVNode(l,{span:12},{default:withCtx(()=>[createVNode(f,{label:"SO_REUSEADDR"},{default:withCtx(()=>[createVNode(_,{modelValue:unref(e).udp_options.reuseaddr,"onUpdate:modelValue":o[46]||(o[46]=t=>unref(e).udp_options.reuseaddr=t)},null,8,["modelValue"])]),_:1})]),_:1})],64)):createCommentVNode("",!0),!a.gatewayName&&!unref(O)?(openBlock(),createElementBlock(Fragment,{key:5},[createVNode(l,{span:24},{default:withCtx(()=>[createVNode(j)]),_:1}),createVNode(l,{span:24},{default:withCtx(()=>[createVNode(_sfc_main$2,{ref_key:"customConfig",ref:A,type:unref(e).type,modelValue:unref(h),"onUpdate:modelValue":o[47]||(o[47]=t=>isRef(h)?h.value=t:null)},null,8,["type","modelValue"])]),_:1})],64)):createCommentVNode("",!0)]),_:1})])]),_:1})]),_:1},8,["rules","model"])),[[R,unref(x)]])]),_:1},8,["title","modelValue"])}}}),_hoisted_1={class:"listener app-wrapper"},_hoisted_2={class:"section-header"},_hoisted_3={class:"table-data-without-break"},_hoisted_4=["onClick"],_hoisted_5={class:"dialog-footer"},_sfc_main=defineComponent({__name:"Listener",setup(a){const{t:i,tl:g}=useI18nTl("Gateway"),N=ref(!1),s=ref(!1),r=ref([]),p=ref(!1),C=ref(!1),T=ref({}),x=ref(""),e=ref(void 0),{getListenerNameNTypeById:h,transPort:V}=useListenerUtils(),A=async()=>{try{N.value=!0;const y=await queryListener();r.value=y.map(b=>{const{name:B,type:U}=h(b.id);return{...b,name:B,type:U}})}catch{}finally{N.value=!1}},v=()=>{p.value=!0,e.value=void 0},k=y=>{e.value=y,p.value=!0},L=async y=>{try{const{enable:b,id:B}=y;b&&await ElMessageBox.confirm(g("disableListenerTip"),{confirmButtonText:i("Base.confirm"),cancelButtonText:i("Base.cancel"),type:"warning"});const U=b?ListenerAction.Stop:ListenerAction.Start;await handleListener(B,U),ElMessage.success(i(`Base.${b?"disabledSuccess":"enableSuccess"}`)),A()}catch{}return!1},G=y=>()=>L(y),M=y=>{C.value=!0,T.value=y,x.value=""},$=async({id:y})=>{s.value=!0;try{await deleteListener(y),p.value=!1,ElMessage.success(i("Base.deleteSuccess")),A(),C.value=!1}catch{}finally{s.value=!1}},E=({current_connections:y,max_connections:b})=>`${y||0}/${b===INFINITY_VALUE?"Infinity":b||0}`;return A(),(y,b)=>{const B=_sfc_main$e,U=resolveComponent("el-table-column"),X=resolveComponent("el-switch"),ee=resolveComponent("el-progress"),q=resolveComponent("el-tooltip"),z=resolveComponent("el-table"),W=_sfc_main$1,Y=resolveComponent("el-input"),O=resolveComponent("el-form-item"),te=resolveComponent("el-form"),K=resolveComponent("el-button"),oe=resolveComponent("el-dialog"),H=resolveDirective("loading");return openBlock(),createElementBlock("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[b[6]||(b[6]=createBaseVNode("div",null,null,-1)),createVNode(B,{onClick:b[0]||(b[0]=c=>v())},{default:withCtx(()=>[createTextVNode(toDisplayString(unref(g)("addListener")),1)]),_:1})]),withDirectives((openBlock(),createBlock(z,{data:unref(r),"row-key":"id"},{default:withCtx(()=>[createVNode(U,{label:y.$t("Base.name"),prop:"name","show-overflow-tooltip":""},{default:withCtx(({row:c})=>[createBaseVNode("p",_hoisted_3,[createBaseVNode("a",{href:"javascript:;",onClick:o=>k(c)},toDisplayString(c.name),9,_hoisted_4)])]),_:1},8,["label"]),createVNode(U,{label:unref(g)("lType"),prop:"type"},null,8,["label"]),createVNode(U,{label:unref(g)("lAddress"),prop:"bind"},{default:withCtx(({row:c})=>[createTextVNode(toDisplayString(unref(V)(c.bind)),1)]),_:1},8,["label"]),createVNode(U,{prop:"enable",label:y.$t("Base.isEnabled")},{default:withCtx(({row:c})=>[createVNode(X,{modelValue:c.enable,"onUpdate:modelValue":o=>c.enable=o,disabled:!y.$hasPermission("put"),"before-change":G(c)},null,8,["modelValue","onUpdate:modelValue","disabled","before-change"])]),_:1},8,["label"]),createVNode(U,{label:unref(g)("connection")},{default:withCtx(({row:c})=>{var o;return[((o=c.status)==null?void 0:o.max_connections)===("INFINITY_VALUE"in y?y.INFINITY_VALUE:unref(INFINITY_VALUE))?(openBlock(),createElementBlock(Fragment,{key:0},[createTextVNode(toDisplayString(E(c.status)),1)],64)):(openBlock(),createBlock(q,{key:1,placement:"top",effect:"dark",content:E(c.status)},{default:withCtx(()=>{var I,f;return[createVNode(ee,{"stroke-width":20,percentage:("calcPercentage"in y?y.calcPercentage:unref(calcPercentage))((I=c.status)==null?void 0:I.current_connections,(f=c.status)==null?void 0:f.max_connections,!1),format:()=>{var l;return(l=c.status)==null?void 0:l.current_connections}},null,8,["percentage","format"])]}),_:2},1032,["content"]))]}),_:1},8,["label"]),createVNode(U,{label:y.$t("BasicConfig.acceptors"),prop:"acceptors"},{default:withCtx(({row:c})=>[createBaseVNode("span",null,toDisplayString(c.acceptors===""?"-":c.acceptors),1)]),_:1},8,["label"])]),_:1},8,["data"])),[[H,unref(N)]]),createVNode(W,{modelValue:unref(p),"onUpdate:modelValue":b[1]||(b[1]=c=>isRef(p)?p.value=c:null),listener:unref(e),onSubmitted:A,onDelete:M},null,8,["modelValue","listener"]),createVNode(oe,{modelValue:unref(C),"onUpdate:modelValue":b[5]||(b[5]=c=>isRef(C)?C.value=c:null),width:450,"append-to-body":"",class:"delete-listener-dialog",title:unref(i)("Base.confirmDelete")},{footer:withCtx(()=>[createBaseVNode("span",_hoisted_5,[createVNode(K,{onClick:b[3]||(b[3]=c=>C.value=!1)},{default:withCtx(()=>[createTextVNode(toDisplayString(y.$t("Base.cancel")),1)]),_:1}),createVNode(K,{type:"danger",plain:"",onClick:b[4]||(b[4]=c=>$(unref(T))),disabled:unref(x)!==unref(T).name||!y.$hasPermission("delete"),loading:unref(s)},{default:withCtx(()=>[createTextVNode(toDisplayString(y.$t("Base.confirm")),1)]),_:1},8,["disabled","loading"])])]),default:withCtx(()=>[createVNode(te,{"label-position":"top"},{default:withCtx(()=>[createVNode(O,{label:y.$t("BasicConfig.confirmDeleteListenerType")},{default:withCtx(()=>[createVNode(Y,{modelValue:unref(x),"onUpdate:modelValue":b[2]||(b[2]=c=>isRef(x)?x.value=c:null)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1},8,["modelValue","title"])])}}});export{_sfc_main as default};
