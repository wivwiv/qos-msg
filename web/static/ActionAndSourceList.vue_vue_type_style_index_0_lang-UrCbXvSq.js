import{_ as Ne}from"./commonPagination.vue_vue_type_style_index_0_lang-DgIFxPZ3.js";import{d as ge,q as fe,g as D,r as b,o as B,m as L,w as n,b as l,n as je,u as e,ax as j,ay as ae,az as w,c as O,F as z,k as oe,W as ce,O as ze,x as se,y as re,K as He,aA as Qe,aB as We,aC as xe,M as ie,j as le,s as Ge,a_ as de,V as Ye,a as T,p as Je,e as A,t as S,aw as me,bn as pe,a5 as Xe,E as Ze,aI as Ke}from"./index-F6_Zcexc.js";import{_ as et}from"./CommonOverflowTooltip.vue_vue_type_style_index_0_lang-Bl9D7zI6.js";import{u as tt,_ as at,a as lt}from"./useDeleteBridge-BoVzcnQO.js";import{u as be,a as nt}from"./useBridgeTypeValue-CwFoz3CA.js";import{h as ot}from"./useRule-BMAMsE-E.js";import{a as st}from"./useActionAndSourceStatus-BuifRkTw.js";import{_ as _e,a as rt}from"./TableItemDropDown.vue_vue_type_script_setup_true_lang-BfLEX2Xg.js";import{a as it}from"./TargetItemStatus.vue_vue_type_style_index_0_lang-CQnxMjT0.js";import{u as ut}from"./usePaging-DzyIDFhR.js";import{a as ct}from"./usePaginationRemember-D5rHcBsI.js";import{u as dt}from"./usePagination-BrPi9USO.js";import{b as mt,c as pt,a as _t,u as gt}from"./useHandleSourceItem-DfyO6jzu.js";import{u as ft}from"./useDataHandler-Dj1fwDX7.js";import{u as bt}from"./useHandleActionItem-mdEFjGCq.js";const ne="not_specific",yt=ge({__name:"ActionAndSourceFilterForm",props:{type:{}},emits:["search"],setup(H,{emit:I}){const p=H,_=I,m=()=>({type:ne,name:void 0,status:void 0,rules:void 0,enable:void 0}),{tl:U,t:k}=fe("RuleEngine"),y=D(!1),d=D(m()),{egressBridgeTypeList:Q}=be(),{sourceServerOptList:i}=ot(),W=[{value:ne,label:k("Base.all")},...p.type==="source"?i:Q],{statusOptList:x}=st(),G=()=>Object.keys(d.value).reduce((r,f)=>{const h=d.value[f];return h!==void 0&&h!==""&&!(f==="type"&&h===ne)?f==="status"?{...r,[f]:new RegExp(`^${ie.escapeRegExp(h)}$`)}:{...r,[f]:h}:r},{}),g=()=>{_("search",G())},P=()=>{d.value=m(),g()};return(v,r)=>{const f=b("el-option"),h=b("el-select"),M=b("el-input"),$=b("el-form-item"),V=b("el-col"),q=Qe,F=We,Y=xe,J=b("el-row"),X=b("el-form");return B(),L(X,{"label-position":"left","label-width":"0px",class:"search-wrapper without-padding-top action-filter-form",onKeyup:He(g,["enter"])},{default:n(()=>[l(J,{gutter:20,class:je({"multiple-rows":e(y)})},{default:n(()=>[l(V,j(ae(e(w))),{default:n(()=>[l($,null,{default:n(()=>[l(M,{modelValue:e(d).name,"onUpdate:modelValue":r[1]||(r[1]=u=>e(d).name=u),placeholder:e(k)("Base.name"),clearable:"",onClear:g},{prepend:n(()=>[l(h,{modelValue:e(d).type,"onUpdate:modelValue":r[0]||(r[0]=u=>e(d).type=u),onChange:g},{default:n(()=>[(B(),O(z,null,oe(W,({value:u,label:R})=>l(f,{key:u,label:R,value:u},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1},8,["modelValue","placeholder"])]),_:1})]),_:1},16),l(V,j(ae(e(w))),{default:n(()=>[l($,null,{default:n(()=>[l(h,{class:"select-topic-type",placeholder:e(k)("Base.status"),modelValue:e(d).status,"onUpdate:modelValue":r[2]||(r[2]=u=>e(d).status=u),clearable:"",onClear:g,onChange:g},{default:n(()=>[(B(!0),O(z,null,oe(e(x),({label:u,value:R})=>(B(),L(f,{key:R,label:u,value:R},null,8,["label","value"]))),128))]),_:1},8,["placeholder","modelValue"])]),_:1})]),_:1},16),l(V,j(ae(e(w))),{default:n(()=>[l($,null,{default:n(()=>[l(h,{class:"select-status",modelValue:e(d).enable,"onUpdate:modelValue":r[3]||(r[3]=u=>e(d).enable=u),clearable:"",onClear:g,onChange:g,placeholder:e(k)("Base.isEnabled")},{default:n(()=>[l(f,{label:e(k)("Base.enabled"),value:!0},null,8,["label"]),l(f,{label:e(k)("Base.disabled"),value:!1},null,8,["label"])]),_:1},8,["modelValue","placeholder"])]),_:1})]),_:1},16),e(y)?(B(),L(V,j(ce({key:0},e(w))),{default:n(()=>[l($,null,{default:n(()=>[l(M,{type:"text",modelValue:e(d).rules,"onUpdate:modelValue":r[4]||(r[4]=u=>e(d).rules=u),clearable:"",placeholder:`${("titleCase"in v?v.titleCase:e(ze))(e(U)("rule"))} ID`,onClear:g},null,8,["modelValue","placeholder"])]),_:1})]),_:1},16)):se("",!0),l(V,ce(e(y)?{span:24}:e(w),{class:"col-oper"}),{default:n(()=>[l(q,{onClick:g}),l(F,{onClick:P}),l(Y,{modelValue:e(y),"onUpdate:modelValue":r[5]||(r[5]=u=>re(y)?y.value=u:null)},null,8,["modelValue"])]),_:1},16)]),_:1},8,["class"])]),_:1})}}}),vt={class:"app-wrapper action-source-list"},ht=["src"],Bt={class:"name-type-block"},Ct={class:"name-data"},kt={class:"type-data"},Vt={class:"view-rules-link"},$t={class:"emq-table-footer"},Nt=ge({__name:"ActionAndSourceList",props:{type:{}},setup(H){const I=H,p=le(()=>I.type==="source"),{t:_,tl:m}=fe("RuleEngine");let U=[];const k=D([]),y=D({}),d=t=>ie.isPlainObject(t)?Object.entries(t).reduce((o,[s,C])=>[...o,{key:s,value:C}],[]):[],Q=le(()=>d(y.value));let i;const{setTotalData:W,getAPageData:x}=ut(),{updateParams:G,checkParamsInQuery:g}=ct(`${I.type}-detail`),{page:P,limit:v,count:r}=dt(),f=le(()=>({page:P.value,limit:v.value,count:r.value})),{getSourceList:h}=_t(),{getActionList:M}=gt(),$=D(!1),V=async()=>{$.value=!0;try{U=await(p.value?h:M)(),W(U),q()}catch(t){console.error(t)}finally{$.value=!1}};V();const q=()=>{const{data:t,meta:o}=x({page:P.value,limit:v.value},Q.value,i);k.value=t,r.value=o.count||0,G({...ie.pick(o,["limit","page"]),...y.value,sortBy:i==null?void 0:i.key,sortType:i==null?void 0:i.type})},F=t=>{P.value=t.page,v.value=t.limit,q()},Y=t=>{y.value=t,F({page:1,limit:v.value})},J=p.value?m("sourceEmptyTip"):m("actionsEmptyTip"),X=t=>{const{prop:o,order:s}=t;i=o?{key:o,type:s==="descending"?"desc":"asc"}:void 0,F({page:1,limit:v.value})};(async()=>{const{pageParams:t,filterParams:o}=g();P.value=t.page||P.value,v.value=t.limit||v.value;const{sortBy:s,sortType:C,...E}=o||{};s&&C&&(i={key:s??(i==null?void 0:i.key)??"",type:C??(i==null?void 0:i.type)??"desc"}),Object.keys(E).length>0&&(y.value=E)})();const R=(t,o)=>({name:`${I.type}-detail`,params:{id:t},query:{tab:o}}),ye=t=>({name:"rule",query:p.value?{source:t}:{action:t}}),{getBridgeIcon:ve}=nt(),{getGeneralTypeLabel:he}=be(),{judgeIsWebhookAction:N}=ft(),{toggleSourceEnable:Be,reconnectSource:Ce}=mt(),{toggleActionEnable:ke,reconnectAction:Ve}=bt(),Z=D(new Map),$e=({id:t})=>{try{const o=p.value?Ce:Ve;Z.value.set(t,!0),o(t)}catch{}finally{Z.value.delete(t)}},Se=async t=>{const{enable:o}=t,s=o?"Base.enableSuccess":"Base.disabledSuccess",C=p.value?Be:ke;try{await C(t.id,o),Xe.success(_(s)),V()}catch(E){console.error(E),t.enable=!t.enable}},Pe=Ge(),Re=t=>{const o=p.value?m("useSourceCreateRule"):m("useActionCreateRule"),s=p.value?{sourceId:t}:{actionId:t};Ze.confirm(o,{confirmButtonText:_("Base.confirm"),cancelButtonText:_("Base.cancel"),type:"success"}).then(()=>{Pe.push({name:"rule-create",query:s})}).catch(()=>({}))},Ee=p.value?pt:tt,{showSecondConfirm:K,usingBridgeRules:Te,currentDeleteBridgeId:Ae,handleDeleteSuc:De,...ee}=Ee(V),{showFallbackConfirm:te,usingAsFallbackAction:Le}=ee,Ie=p.value?ee.handleDeleteSource:ee.handleDeleteBridge,Fe=p.value?de.Ingress:de.Egress;return(t,o)=>{const s=b("el-table-column"),C=b("router-link"),E=b("el-switch"),we=et,Oe=b("el-tag"),ue=Ke,Ue=b("el-table"),Me=Ne,qe=Ye("loading");return B(),O(z,null,[l(yt,{type:t.type,onSearch:Y},null,8,["type"]),T("div",vt,[Je((B(),L(Ue,{data:e(k),"empty-text":e(J),"row-key":"id",onSortChange:X},{default:n(()=>[l(s,{label:e(_)("Base.tableNo"),width:"60"},{default:n(({$index:a})=>[A(S(a+1),1)]),_:1},8,["label"]),l(s,{label:e(m)("name"),"min-width":172,sortable:"custom",prop:"id"},{default:n(({row:a})=>[l(C,{to:R(a.id),class:"first-column-with-icon-type"},{default:n(()=>[a.type?(B(),O("img",{key:0,class:"icon-type",src:e(ve)(a.type)},null,8,ht)):se("",!0),T("div",Bt,[T("span",Ct,S(a.name),1),T("span",kt,S(e(he)(a.type)),1)])]),_:2},1032,["to"])]),_:1},8,["label"]),l(s,{label:e(_)("Base.status"),"min-width":124,sortable:""},{default:n(({row:a})=>[l(it,{type:"action",target:a},null,8,["target"])]),_:1},8,["label"]),l(s,{prop:"enable",label:t.$t("Base.isEnabled"),"min-width":102,sortable:""},{default:n(({row:a})=>[l(_e,{disabled:!e(N)(a),name:a.name,operation:`${e(_)("Base.enable")}${e(m)("or")}${e(_)("Base.disable")}`,targetLabel:e(m)("action")},{default:n(()=>[l(E,{modelValue:a.enable,"onUpdate:modelValue":c=>a.enable=c,disabled:e(N)(a)||!t.$hasPermission("put"),onChange:c=>Se(a)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])]),_:2},1032,["disabled","name","operation","targetLabel"])]),_:1},8,["label"]),l(s,{prop:"description",label:e(_)("BridgeSchema.common.description.label"),"min-width":108},null,8,["label"]),l(s,{sortable:"",prop:"rules.length","min-width":168,label:e(m)("associatedRules"),"sort-method":a=>{var c;return((c=a.rules)==null?void 0:c.length)??0}},{default:n(({row:a})=>[(B(!0),O(z,null,oe(a.rules,c=>(B(),L(C,{to:{name:"rule-detail",params:{id:c}},key:c,target:"_blank",class:"rule-detail-link"},{default:n(()=>[l(Oe,{size:"small",type:"info"},{default:n(()=>[l(we,{content:c},null,8,["content"])]),_:2},1024)]),_:2},1032,["to"]))),128)),T("div",Vt,[l(C,{to:ye(a.id)},{default:n(()=>{var c;return[A(S(`${e(m)("viewRules")} (${((c=a.rules)==null?void 0:c.length)||0})`),1)]}),_:2},1032,["to"])])]),_:1},8,["label","sort-method"]),l(s,{prop:"created_at",label:e(_)("Base.createdAt"),"min-width":162,sortable:""},{default:n(({row:a})=>[A(S(("dateFormat"in t?t.dateFormat:e(me))(a.created_at,"")),1)]),_:1},8,["label"]),l(s,{prop:"last_modified_at",label:e(_)("Base.lastModified"),"min-width":162,sortable:""},{default:n(({row:a})=>[A(S(("dateFormat"in t?t.dateFormat:e(me))(a.last_modified_at,"")),1)]),_:1},8,["label"]),l(s,{label:t.$t("Base.operation"),"min-width":180},{default:n(({row:a})=>[a.enable&&(a.status===e(pe).Disconnected||a.status===e(pe).Inconsistent)?(B(),L(ue,{key:0,disabled:!t.$hasPermission("post"),loading:e(Z).get(a.id)??!1,onClick:c=>$e(a)},{default:n(()=>[A(S(t.$t("RuleEngine.reconnect")),1)]),_:2},1032,["disabled","loading","onClick"])):se("",!0),l(ue,{onClick:c=>t.$router.push(R(a.id,"settings"))},{default:n(()=>[A(S(t.$t("Base.setting")),1)]),_:2},1032,["onClick"]),l(_e,{disabled:!e(N)(a),name:a.name,operation:e(m)("moreOperation"),targetLabel:e(m)("action")},{default:n(()=>[l(rt,{"can-create-rule":"","row-data":a,"can-copy":!1,disabled:e(N)(a),onDelete:c=>e(Ie)(a),onCreateRule:c=>Re(a.id)},null,8,["row-data","disabled","onDelete","onCreateRule"])]),_:2},1032,["disabled","name","operation","targetLabel"])]),_:1},8,["label"])]),_:1},8,["data","empty-text"])),[[qe,e($)]]),T("div",$t,[l(Me,{"meta-data":e(f),onLoadPage:F},null,8,["meta-data"])])]),l(at,{modelValue:e(K),"onUpdate:modelValue":o[0]||(o[0]=a=>re(K)?K.value=a:null),"rule-list":e(Te),id:e(Ae),direction:e(Fe),onSubmitted:e(De)},null,8,["modelValue","rule-list","id","direction","onSubmitted"]),l(lt,{modelValue:e(te),"onUpdate:modelValue":o[1]||(o[1]=a=>re(te)?te.value=a:null),"action-list":e(Le)},null,8,["modelValue","action-list"])],64)}}});export{Nt as _};
