import{d as R,a_ as E,q as F,j as L,g as A,m as S,w as a,u as e,y as T,r as u,o as v,a as s,b as m,e as x,t as b,x as j,c as C,k as U,F as N,M as $,aU as I,a5 as K,E as M}from"./index-gzDiX6cq.js";import{u as q}from"./useHandleActionItem-CLBwxXaF.js";import{b as H,u as P}from"./useHandleSourceItem-C2NmvGoR.js";import{w as z}from"./useActionAndSourceStatus-gzXOZG2c.js";import{u as W}from"./useBridgeTypeValue-DfFvHZxE.js";import{u as G}from"./useDataHandler-DIoGjH2Q.js";const J={class:"el-message-box__container"},O={class:"el-icon el-message-box__status el-message-box-icon--warning"},Q={class:"el-message-box__message"},X={class:"data-list"},Y={class:"dialog-footer"},ue=R({__name:"DeleteBridgeSecondConfirm",props:{modelValue:{type:Boolean,required:!0},direction:{type:Number,default:E.Egress},id:{type:String},ruleList:{type:Array,default:()=>[]}},emits:["update:modelValue","submitted"],setup(g,{emit:_}){const l=g,y=_,{t:B,tl:k}=F("RuleEngine"),o=L({get:()=>l.modelValue,set:c=>{y("update:modelValue",c)}}),w=L(()=>l.direction===E.Egress),{deleteAction:V}=q(),{deleteSource:i}=H(),f=A(!1),D=async()=>{l.id&&(l.direction===E.Ingress?await i(l.id,!0):await V(l.id,!0),y("submitted"),o.value=!1)};return(c,h)=>{const t=u("router-link"),r=u("el-tag"),n=u("el-button"),p=u("el-dialog");return v(),S(p,{modelValue:e(o),"onUpdate:modelValue":h[1]||(h[1]=d=>T(o)?o.value=d:null),width:400,class:"common-dialog delete-second-confirm",title:e(B)("Base.confirmDelete"),"z-index":2e3},{footer:a(()=>[s("span",Y,[m(n,{onClick:h[0]||(h[0]=d=>o.value=!1)},{default:a(()=>[x(b(c.$t("Base.cancel")),1)]),_:1}),e(w)?(v(),S(n,{key:0,type:"danger",disabled:!c.$hasPermission("delete"),plain:"",onClick:D,loading:e(f)},{default:a(()=>[x(b(c.$t("Base.confirm")),1)]),_:1},8,["disabled","loading"])):j("",!0)])]),default:a(()=>[s("div",null,[s("div",J,[s("i",O,[m(e(z))]),s("div",Q,b(e(w)?e(k)("deleteEgressActionSecondConfirm"):e(k)("deleteIngressActionSecondConfirm")),1)]),s("ul",X,[(v(!0),C(N,null,U(g.ruleList,d=>(v(),C("li",{key:d,class:"data-item"},[m(r,{size:"large"},{default:a(()=>[m(t,{to:{name:"rule-detail",params:{id:d},query:{tab:"settings"}},target:"_blank"},{default:a(()=>[x(b(d),1)]),_:2},1032,["to"])]),_:2},1024)]))),128))])])]),_:1},8,["modelValue","title"])}}}),Z={class:"el-message-box__container"},ee={class:"el-icon el-message-box__status el-message-box-icon--warning"},te={class:"el-message-box__message"},se={class:"data-list"},oe={class:"action-type"},ne={class:"dialog-footer"},me=R({__name:"DeleteFallbackActionConfirm",props:{modelValue:{type:Boolean},actionList:{}},emits:["update:modelValue"],setup(g,{emit:_}){const l=g,y=_,{t:B,tl:k}=F("RuleEngine"),o=L({get:()=>l.modelValue,set:i=>{y("update:modelValue",i)}}),{getGeneralTypeLabel:w}=W(),V=i=>({name:"action-detail",params:{id:I(i)},query:{tab:"settings"}});return(i,f)=>{const D=u("i18n-t"),c=u("router-link"),h=u("el-tag"),t=u("el-button"),r=u("el-dialog");return v(),S(r,{modelValue:e(o),"onUpdate:modelValue":f[1]||(f[1]=n=>T(o)?o.value=n:null),width:520,class:"common-dialog delete-second-confirm",title:e(B)("Base.confirmDelete"),"z-index":2e3},{footer:a(()=>[s("span",ne,[m(t,{onClick:f[0]||(f[0]=n=>o.value=!1)},{default:a(()=>[x(b(e(B)("Base.cancel")),1)]),_:1})])]),default:a(()=>[s("div",null,[s("div",Z,[s("i",ee,[m(e(z))]),s("div",te,[m(D,{keypath:"RuleEngine.deleteFallbackActionConfirm",tag:"span"},{fallback:a(()=>[s("b",null,b(e($.toLower)(e(k)("fallbackActions"))),1)]),_:1})])]),s("ul",se,[(v(!0),C(N,null,U(i.actionList,n=>(v(),C("li",{key:("getBridgeKey"in i?i.getBridgeKey:e(I))(n),class:"data-item"},[m(h,{size:"large"},{default:a(()=>[m(c,{to:V(n),target:"_blank"},{default:a(()=>[s("span",null,b(n.name),1),s("span",oe,"("+b(e(w)(n.type))+")",1)]),_:2},1032,["to"])]),_:2},1024)]))),128))])])]),_:1},8,["modelValue","title"])}}}),ge=g=>{const{t:_}=F("RuleEngine"),l=A(!1),y=A([]),B=A(""),k=A(!1),o=A([]),{judgeIsWebhookAction:w}=G(),V=()=>{K.success(_("Base.deleteSuccess")),g&&$.isFunction(g)&&g()},i=async t=>{y.value=t,l.value=!0},{getActionList:f}=P(),D=async t=>{try{let{referenced_as_fallback_action_by:r}=t;if($.isUndefined(r)){const p=(await f()).find(d=>d.id===t.id);r=(p==null?void 0:p.referenced_as_fallback_action_by)??[]}return r}catch(r){return Promise.reject(r)}},{deleteAction:c}=q();return{showSecondConfirm:l,usingBridgeRules:y,currentDeleteBridgeId:B,showFallbackConfirm:k,usingAsFallbackAction:o,handleDeleteSuc:V,handleDeleteBridge:async t=>{var n,p;if(w(t))return;if(o.value=await D(t),(n=o.value)!=null&&n.length){k.value=!0;return}if((p=t.rules)!=null&&p.length){B.value=t.id,i(t.rules);return}const{id:r}=t;await M.confirm(_("Base.confirmDelete"),{confirmButtonText:_("Base.confirm"),cancelButtonText:_("Base.cancel"),confirmButtonClass:"confirm-danger",type:"warning"});try{await c(r),V()}catch{}}}};export{ue as _,me as a,ge as u};
