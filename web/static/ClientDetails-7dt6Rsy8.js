import{_ as lt}from"./InfoTooltip-CPsvXzu1.js";import{_ as ve,a as st}from"./CommonOverflowTooltip.vue_vue_type_style_index_0_lang-Bl9D7zI6.js";import{aD as J,M as te,q as K,aE as ot,a1 as Qe,d as le,r as g,o as r,m as v,w as n,b as t,u as e,aF as Be,e as R,t as $,a as V,c as B,g as T,aG as at,j as P,W as it,y as ne,x as Y,k as ce,aH as ct,F as H,J as rt,aw as Fe,aI as ut,aJ as dt,N as pt,av as Te,V as Ge,p as ee,aK as Pe,z as _t,aL as be,n as mt,i as ft,s as bt,E as Me,a5 as vt,aM as gt}from"./index-F6_Zcexc.js";import{_ as yt}from"./DetailHeader.vue_vue_type_style_index_0_lang-MGYnd5rE.js";import{_ as ht}from"./TextEasyCopy.vue_vue_type_style_index_0_lang-DcuKy8ig.js";import"./http-BI9UuFDl.js";import{a as wt,g as kt,b as Ct,d as Tt,u as St}from"./gateway-IOBtssb4.js";import{_ as Vt,w as $t}from"./CheckIcon.vue_vue_type_style_index_0_lang-DeVbzpy2.js";import{u as It}from"./useCopy-DSWu-SkJ.js";import{u as qt}from"./useDurationStr-B_hM76H_.js";import{_ as Bt}from"./PayloadDialog.vue_vue_type_style_index_0_lang-BZ8ZJih9.js";import{_ as Pt}from"./KeyAndValueEditor.vue_vue_type_style_index_0_lang-D3W6EXAW.js";import{_ as Mt}from"./commonPagination.vue_vue_type_style_index_0_lang-DgIFxPZ3.js";import{u as Et}from"./usePagination-BrPi9USO.js";import{u as Dt}from"./usePaginationRemember-D5rHcBsI.js";import{_ as Lt}from"./useBridgeTypeValue-CwFoz3CA.js";import"./arrow-left-C6KBoFkH.js";import"./check-R5MM5VH5.js";import"./close-C-gDC1-1.js";import"./Monaco.vue_vue_type_style_index_0_lang-m8fKnWUe.js";import"./useRule-BMAMsE-E.js";const Ot=()=>({noLocalOpts:[{value:0,label:"False"},{value:1,label:"True"}],retainAsPublishedOpts:[{value:0,label:"False"},{value:1,label:"True"}],retainHandlingOpts:[0,1,2]});function Rt(s){return J.delete(`/clients/${encodeURIComponent(s)}`)}async function Ut(s){return J.get(`/clients/${encodeURIComponent(s)}`,{errorsHandleCustom:[404]})}function At(s){return J.get(`/clients/${encodeURIComponent(s)}/subscriptions`)}function Qt(s,f){if(f!=null)return J.post(`/clients/${encodeURIComponent(s)}/unsubscribe`,{topic:f})}function Ft(s,f){const u=te.pick(f,["qos","topic","nl","rap","rh"]);return J.post(`/clients/${encodeURIComponent(s)}/subscribe`,u)}function Gt(s,f){return J.get(`/clients/${encodeURIComponent(s)}/mqueue_messages`,{params:f})}function Ht(s,f){return J.get(`/clients/${encodeURIComponent(s)}/inflight_messages`,{params:f})}function zt(s,f){return J.get("/subscribe_logs",{params:{clientid:s,...f},baseURL:"/api/v5.1"})}const He=()=>{const{tl:s}=K("Clients"),f={connection:["node","clientid","username","proto_type","listener","ip_address","keepalive","clean_start","is_bridge","client_attrs","connected_at","disconnected_at"],session:["expiry_interval","created_at","heap_size","subscriptions","mqueue","inflight","awaiting_rel"]},u=h=>String(h).replace(/((_|\.)[a-z])/g,o=>o.substring(1).toUpperCase());return{clientFields:f,snake2pascal:u,getBaseLabel:h=>s(u(h))}},Nt=()=>{const{transSecondNumToSimpleStr:s}=qt(),{tl:f}=K("Clients");return{getSessionInfoItemValue:(d,h)=>{switch(h){case"subscriptions":return d.subscriptions_cnt+"/"+d.subscriptions_max;case"mqueue":return d.durable&&d.mqueue_max===void 0?"-":d.mqueue_len+"/"+d.mqueue_max;case"inflight":return d.inflight_cnt+"/"+d.inflight_max;case"awaiting_rel":return d.awaiting_rel_cnt+"/"+d.awaiting_rel_max;case"created_at":return Qe(d[h]).format("YYYY-MM-DD HH:mm:ss");case"heap_size":return`${d.heap_size} bytes`;case"expiry_interval":return d.expiry_interval===ot?f("neverExpire"):s(d.expiry_interval);default:return d[h]??""}}}},Wt=()=>{const{tl:s}=K("Clients"),f=i=>i&&Qe(i).format("YYYY-MM-DD HH:mm:ss"),u=new Map([["connected",i=>i.connected?s("connected"):s("disconnected")],["connected_at",i=>f(i.connected_at)],["disconnected_at",i=>f(i.disconnected_at)],["ip_address",i=>`${i.ip_address}:${i.port}`]]),{clientFields:d}=He(),h=d.session,{getSessionInfoItemValue:o}=Nt();return{getSimpleClientInfoValue:(i,w)=>u.has(w)?u.get(w)(i):h.includes(w)?o(i,w):i[w]??""}},jt={key:0},Yt={key:1},Kt={key:2,class:"space-between vertical-align-center"},xt={class:"keep-spaces"},Zt={key:3},Jt={class:"keep-spaces"},Ce=le({__name:"ClientInfoItem",props:{client:{},field:{}},setup(s){const{t:f,tl:u}=K("Clients"),d={3:"v3.1",4:"v3.1.1",5:"v5.0"},{copyText:h}=It(),{getSimpleClientInfoValue:o}=Wt();return(p,i)=>{const w=Vt,c=g("el-tag"),U=g("el-button");return p.field==="connected"?(r(),v(c,{key:0,type:"info"},{default:n(()=>[t(w,{status:p.client.connected?e(Be).Check:e(Be).Close,size:"small"},null,8,["status"]),R(" "+$(p.client.connected?e(u)("connected"):e(u)("disconnected")),1)]),_:1})):p.field==="proto_type"?(r(),v(c,{key:1,type:"info"},{default:n(()=>[V("span",null,$(p.client.proto_name),1),i[1]||(i[1]=R(" Â  ")),p.client.proto_name==="MQTT"&&p.client.proto_ver!==void 0?(r(),B("span",jt,$(d[p.client.proto_ver]),1)):(r(),B("span",Yt,$(p.client.proto_ver),1))]),_:1})):p.field=="clientid"?(r(),B("span",Kt,[V("span",xt,$(p.client[p.field]),1),t(U,{class:"btn-copy",size:"small",onClick:i[0]||(i[0]=G=>e(h)(p.client.clientid))},{default:n(()=>[R($(e(f)("Base.copy")),1)]),_:1})])):(r(),B("span",Zt,[V("span",Jt,$(e(o)(p.client,p.field)),1)]))}}}),Xt={class:"dialog-align-footer"},en={inheritAttrs:!1},tn=le({...en,__name:"CreateSubscribe",props:{visible:{type:Boolean,required:!0},clientId:{type:String,default:""},gateway:{type:String,required:!1,default:""},isMQTTVersion5:{type:Boolean,required:!1,default:!1}},emits:["create:subs","update:visible"],setup(s,{emit:f}){const{tl:u}=K("Clients"),d=s,h=f,o=T({clientid:d.clientId,qos:at.QoS0,topic:"",nl:0,rap:0,rh:0}),p={clientid:{required:!0,message:u("pleaseEnter")},topic:{required:!0,message:u("pleaseEnter")},subid:{required:!0,message:u("pleaseEnter")}},i=T(!1),w=T(),c=P(()=>d.visible),{noLocalOpts:U,retainAsPublishedOpts:G,retainHandlingOpts:b}=Ot(),q=()=>{o.value.clientid=d.clientId},M=()=>d.isMQTTVersion5?te.omit(o.value,"clientid"):te.pick(o.value,["qos","topic"]),L=()=>d.clientId||o.value.clientid,x=()=>Ft(L(),M()),m=()=>{const y=te.pick(o.value,["topic","qos"]);return o.value.subid&&d.gateway&&d.gateway==="stomp"&&(y.sub_props={subid:o.value.subid}),wt(d.gateway,L(),y)},O=async()=>{try{await w.value.validate();const y=d.gateway?m:x;i.value=!0,await y(),h("create:subs"),A()}catch{}finally{i.value=!1}},A=()=>{h("update:visible",!1),w.value.resetFields()};return(y,k)=>{const X=g("el-input"),E=g("el-form-item"),I=g("el-option"),Q=g("el-select"),z=g("el-form"),se=g("el-button"),_=g("el-dialog");return r(),v(_,it(y.$attrs,{title:y.$t("Clients.addASubscription"),width:"400px",modelValue:e(c),"onUpdate:modelValue":k[7]||(k[7]=a=>ne(c)?c.value=a:null),onClose:A,onOpen:q}),{footer:n(()=>[V("div",Xt,[t(se,{onClick:A},{default:n(()=>[R($(y.$t("Base.cancel")),1)]),_:1}),t(se,{type:"primary",disabled:!y.$hasPermission("post"),onClick:O,loading:e(i)},{default:n(()=>[R($(y.$t("Base.add")),1)]),_:1},8,["disabled","loading"])])]),default:n(()=>[t(z,{ref_key:"FormCom",ref:w,model:e(o),rules:p,"label-position":"top","require-asterisk-position":"right"},{default:n(()=>[s.clientId?Y("",!0):(r(),v(E,{key:0,prop:"clientid",label:y.$t("Base.clientid")},{default:n(()=>[t(X,{modelValue:e(o).clientid,"onUpdate:modelValue":k[0]||(k[0]=a=>e(o).clientid=a),placeholder:y.$t("Base.clientid")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])),t(E,{prop:"topic",label:y.$t("Base.topic")},{default:n(()=>[t(X,{modelValue:e(o).topic,"onUpdate:modelValue":k[1]||(k[1]=a=>e(o).topic=a),placeholder:"Topic"},null,8,["modelValue"])]),_:1},8,["label"]),s.gateway&&s.gateway==="stomp"?(r(),v(E,{key:1,prop:"subid",label:`${y.$t("Tools.Subscription")} ID`},{default:n(()=>[t(X,{modelValue:e(o).subid,"onUpdate:modelValue":k[2]||(k[2]=a=>e(o).subid=a)},null,8,["modelValue"])]),_:1},8,["label"])):Y("",!0),t(E,{prop:"qos",label:"QoS"},{default:n(()=>[t(Q,{modelValue:e(o).qos,"onUpdate:modelValue":k[3]||(k[3]=a=>e(o).qos=a),modelModifiers:{number:!0}},{default:n(()=>[(r(!0),B(H,null,ce("QoSOptions"in y?y.QoSOptions:e(ct),a=>(r(),v(I,{key:a,value:a},null,8,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s.isMQTTVersion5?(r(),B(H,{key:2},[t(E,{prop:"nl",label:e(u)("noLocal")},{default:n(()=>[t(Q,{modelValue:e(o).nl,"onUpdate:modelValue":k[4]||(k[4]=a=>e(o).nl=a)},{default:n(()=>[(r(!0),B(H,null,ce(e(U),({value:a,label:D})=>(r(),v(I,{label:D,value:a,key:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),t(E,{prop:"rap",label:e(u)("retainAsPublished")},{default:n(()=>[t(Q,{modelValue:e(o).rap,"onUpdate:modelValue":k[5]||(k[5]=a=>e(o).rap=a)},{default:n(()=>[(r(!0),B(H,null,ce(e(G),({value:a,label:D})=>(r(),v(I,{label:D,value:a,key:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),t(E,{prop:"rh",label:e(u)("retainHandling")},{default:n(()=>[t(Q,{modelValue:e(o).rh,"onUpdate:modelValue":k[6]||(k[6]=a=>e(o).rh=a)},{default:n(()=>[(r(!0),B(H,null,ce(e(b),a=>(r(),v(I,{label:a,value:a,key:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])],64)):Y("",!0)]),_:1},8,["model"])]),_:1},16,["title","modelValue"])}}}),nn={class:"dialog-hd"},ln={class:"table-container"};function sn(s){return typeof s=="function"||Object.prototype.toString.call(s)==="[object Object]"&&!dt(s)}const Ee=410,on=50,De=60,an=200,Le=1020,Oe=180,Re=100,Ue=180,Ae=240,cn=le({__name:"MessageListDialog",props:{modelValue:{type:Boolean},clientId:{},type:{}},emits:["update:modelValue"],setup(s,{emit:f}){const u=Ee-on,d=s,h=f,{t:o,tl:p}=K("Clients"),i=P({get:()=>d.modelValue,set:_=>{h("update:modelValue",_)}});rt(i,_=>{_?y():(k(),b.value=[])});const w=P(()=>d.type==="mqueue"),c=P(()=>w.value?p("msgQueueMsgList"):p("inflightMsgList")),U=T(!1),G=T(),b=T([]),q=P(()=>b.value.length),M=T(0),L=P(()=>q.value*De-M.value<=u),x=(Le-Oe-Re-Ue-Ae)/2,m=[{title:p("msgId"),key:"msgid",dataKey:"msgid",width:Ae,cellRenderer:({rowData:_})=>!w.value||_.mqueue_priority===0||te.isUndefined(_.mqueue_priority)?t(ve,{content:_.msgid},null):t(H,null,[t("span",null,[_.msgid]),t(g("el-tag"),{type:"info","disable-transitions":!0},{default:()=>[p("priority"),R(": "),_.mqueue_priority]})])},{title:o("Base.topic"),key:"topic",dataKey:"topic",width:x,cellRenderer:({rowData:_})=>t(ve,{content:_.topic},null)},{title:"QoS",key:"qos",dataKey:"qos",width:Re},{title:o("Base.clientid"),key:"from_clientid",dataKey:"from_clientid",width:x,cellRenderer:({rowData:_})=>t(ve,{content:_.from_clientid},null)},{title:o("Extension.publishTime"),key:"publish_at",dataKey:"publish_at",width:Oe,cellRenderer:({rowData:_})=>_.publish_at&&Fe(_.publish_at)},{title:"Payload",width:Ue,cellRenderer:({rowData:_})=>{let a;return t(ut,{onClick:()=>z(_)},sn(a=o("Extension.openPayload"))?a:{default:()=>[a]})}}];let O="none";const A=(_,a)=>{if(_==="none")return[];const D=[...a],N=D.findIndex(Z=>Z._id===_);return N>-1?D.slice(N):D},y=async()=>{try{U.value=!0;const _=w.value?Gt:Ht,{data:a=[],meta:D}=await _(d.clientId,{limit:an,position:O}),N=a.map(F=>{const{inserted_at:oe,mqueue_priority:ae}=F,ge=w.value?`${oe}_${ae}`:oe;return{...F,_id:ge}});b.value.push(...N);const Z=b.value.length;if(await pt(800),b.value=A(D.start,b.value),b.value.length<Z){const F=b.value.findIndex(oe=>oe.msgid===N[0].msgid);F>-1&&G.value.scrollToRow(F)}O=D.position}catch{}finally{U.value=!1}},k=()=>{O="none"},X=()=>{k(),b.value=[],y()},E=T(!1),I=T(""),Q=T(""),z=({topic:_,payload:a})=>{Q.value=_,I.value=a,E.value=!0},se=te.debounce(async _=>{!te.isUndefined(_==null?void 0:_.scrollTop)&&_.scrollTop>0&&(M.value=_.scrollTop,q.value&&L.value&&y())},300);return(_,a)=>{const D=Te,N=g("el-table-v2"),Z=Bt,ue=g("el-dialog");return r(),v(ue,{modelValue:e(i),"onUpdate:modelValue":a[1]||(a[1]=F=>ne(i)?i.value=F:null),class:"message-list-dialog",width:1060,title:e(c),"destroy-on-close":""},{default:n(()=>[V("div",nn,[t(D,{onClick:X})]),V("div",ln,[t(N,{ref_key:"TableRef",ref:G,columns:m,data:e(b),width:Le,height:Ee,"row-height":De,"scrollbar-always-on":"",onScroll:e(se)},null,8,["data","onScroll"])]),t(Z,{modelValue:e(E),"onUpdate:modelValue":a[0]||(a[0]=F=>ne(E)?E.value=F:null),"raw-payload":e(I),topic:e(Q)},null,8,["modelValue","raw-payload","topic"])]),_:1},8,["modelValue","title"])}}}),rn=le({__name:"ClientAttrsDialog",props:{modelValue:{type:Boolean,required:!0},value:{type:Object}},emits:["update:modelValue","save"],setup(s,{emit:f}){const u=s,d=f,{tl:h}=K("Clients"),o=P({get:()=>u.modelValue,set:p=>{d("update:modelValue",p)}});return(p,i)=>{const w=Pt,c=g("el-dialog");return r(),v(c,{modelValue:e(o),"onUpdate:modelValue":i[0]||(i[0]=U=>ne(o)?o.value=U:null),width:"480px",class:"common-dialog client-attrs-dialog","destroy-on-close":"",title:e(h)("clientAttrs"),"close-on-click-modal":!1},{default:n(()=>[t(w,{readonly:"","model-value":s.value},null,8,["model-value"])]),_:1},8,["modelValue","title"])}}}),un={class:"historical-subscriptions"},dn={class:"section-header"},pn={key:0,class:"emq-table-footer"},_n=le({__name:"HistoricalSubscriptions",props:{clientId:{}},setup(s){const f=s,{t:u}=K("Clients"),d=T([]),h=T(!1),{page:o,limit:p,count:i,pageParams:w}=Et(),c=async()=>{try{h.value=!0;const b={page:o.value,limit:p.value},{meta:q,data:M}=await zt(f.clientId,b);i.value=(q==null?void 0:q.count)??0,d.value=M}catch{}finally{h.value=!1}};c();const U=b=>{o.value=b.page,p.value=b.limit,c()},G=()=>{o.value=1,c()};return(b,q)=>{const M=Te,L=g("el-table-column"),x=g("el-table"),m=Mt,O=Ge("loading");return r(),B("div",un,[V("div",dn,[q[0]||(q[0]=V("div",null,null,-1)),V("div",null,[t(M,{onClick:G})])]),ee((r(),v(x,{data:e(d),style:{"margin-top":"16px"}},{default:n(()=>[t(L,{prop:"id",label:"ID","min-width":"90"},{default:n(({row:A})=>[R($(A.id),1)]),_:1}),t(L,{prop:"topic",label:e(u)("Base.topic"),"min-width":"120"},null,8,["label"]),t(L,{prop:"qos",label:"QoS","min-width":"60"}),t(L,{prop:"event_label",label:e(u)("General.event"),"min-width":"80"},null,8,["label"]),t(L,{prop:"time",label:e(u)("Tools.time"),"min-width":"160"},{default:n(({row:A})=>[R($(("dateFormat"in b?b.dateFormat:e(Fe))(A.time)),1)]),_:1},8,["label"])]),_:1},8,["data"])),[[O,e(h)]]),e(i)&&e(i)>(e(p)>=("DEFAULT_PAGE_SIZE_OPT"in b?b.DEFAULT_PAGE_SIZE_OPT:e(Pe))[0]?("DEFAULT_PAGE_SIZE_OPT"in b?b.DEFAULT_PAGE_SIZE_OPT:e(Pe))[0]:e(p))?(r(),B("div",pn,[t(m,{"meta-data":e(w),onLoadPage:U},null,8,["meta-data"])])):Y("",!0)])}}}),mn={class:"block-header"},fn={class:"vertical-align-center header-content"},bn={class:"actions"},vn={class:"section-header"},gn={class:"stats-tip"},yn={key:1,class:"client-does-not-exist"},hn=le({name:"ClientDetails"}),Gn=le({...hn,props:{gateway:{type:String,required:!1,default:""},clientid:{type:String,required:!1,default:""}},emits:["refreshGateway"],setup(s,{emit:f}){const u=s,d=f,h=P(()=>!!u.gateway),o=T(!1),p=T(!0),i=T(!0),w=T(!0),c=T({}),{clientFields:U,snake2pascal:G,getBaseLabel:b}=He(),q={MQTT:{...U,bytes:["recv_oct","send_oct"],packets:["recv_cnt","send_cnt","recv_pkt","send_pkt"],messages:["recv_msg","recv_msg.qos0","recv_msg.qos1","recv_msg.qos2","recv_msg.dropped","recv_msg.dropped.await_pubrel_timeout","send_msg","send_msg.qos0","send_msg.qos1","send_msg.qos2","send_msg.dropped","send_msg.dropped.expired","send_msg.dropped.queue_full","send_msg.dropped.too_large"]},LWM2M:{connection:["node","endpoint_name","lifetime","clientid","username","proto_type","ip_address","connected_at","disconnected_at"],session:["subscriptions","heap_size","reductions"],bytes:["recv_oct","send_oct"],packets:["recv_cnt","send_cnt","recv_pkt"],messages:["send_lw_pkt"]},OCPP:{connection:["node","clientid","username","proto_type","ip_address","keepalive","connected_at","disconnected_at"],session:["subscriptions","heap_size","reductions"],bytes:["recv_oct","send_oct"],packets:["recv_cnt","send_cnt","recv_pkt","send_pkt"],messages:[]},others:{connection:["node","clientid","username","proto_type","ip_address","keepalive","connected_at","disconnected_at"],session:["subscriptions","heap_size","reductions"],bytes:["recv_oct","send_oct"],packets:["recv_cnt","send_cnt","recv_pkt","send_pkt"],messages:[]}},M=T([]),L=ft(),x=bt(),{tl:m}=K("Clients"),{t:O}=_t(),{getBackRoute:A}=Dt("clients"),y=T(!1),k=T("mqueue"),X=P(()=>L.query.from==="slow-sub"),E=P(()=>{const l=X.value?"slow-sub":"subscription";return A({name:l})}),I=P(()=>L.params.clientId||u.clientid),Q=P(()=>String(c.value.proto_name).toUpperCase()),z=P(()=>{const l=Object.keys(q);return Q.value==="MQISDP"?q.MQTT:Array.prototype.includes.call(l,Q.value)?q[Q.value]:u.gateway===be.OCPP?q.OCPP:q.others}),se=P(()=>c.value.proto_name==="MQTT"&&c.value.proto_ver===5),_=[be.CoAP,be.MQTT_SN,be.STOMP],a=P(()=>!h.value||h.value&&_.includes(u.gateway)),D=async()=>{if(c.value===null)return;let l=m("willDisconnectTheConnection"),S=m("successfulDisconnection");c.value.connected||(l=m("willCleanSession"),S=m("successfulCleanSession")),Me.confirm(l,{confirmButtonText:O("Base.confirm"),cancelButtonText:O("Base.cancel"),confirmButtonClass:"confirm-danger",type:"warning"}).then(()=>u.gateway?N():c.value===null?void 0:Rt(c.value.clientid)).then(()=>{c.value!==null&&(u.gateway||x.push({name:"clients"}),c.value.connected=!1,vt.success(S))}).catch(()=>{})},N=async()=>c.value===null?void 0:await Tt(u.gateway,c.value.clientid)?(d("refreshGateway"),Promise.resolve()):Promise.reject(),Z=async()=>{if(u.gateway)return ue();p.value=!0;const l=await Ut(I.value).catch(S=>{S.response.status===404&&(w.value=!1)});l?(w.value=!0,c.value=l):c.value={},p.value=!1},ue=async()=>{p.value=!0;const l=await kt(u.gateway,I.value).catch(()=>{p.value=!1});l?c.value=l:c.value={},p.value=!1},F=()=>{o.value=!0},oe=()=>{ae()},ae=async()=>{if(u.gateway)return ge();i.value=!0;const l=await At(I.value).catch(()=>{i.value=!1});l?M.value=l:M.value=[],i.value=!1},ge=async()=>{i.value=!0;const l=await Ct(u.gateway,I.value).catch(()=>{i.value=!1});l?M.value=l:M.value=[],i.value=!1},ye=l=>{if(l==="clean_start")return c.value.proto_ver===5?"Clean Start":m("cleanSession");if(u.gateway){if(l==="recv_cnt")return m("recvSocketCnt");if(l==="send_cnt")return m("sendSocketCnt")}else{if(l==="recv_pkt")return m(G(l),{proto:" MQTT "});if(l==="send_pkt")return m(G(l),{proto:" MQTT "})}return b(l)},ze=l=>m(`${l}Desc`),he=l=>l.map(S=>{const W=ye(S),we=c.value[S];return{label:W,value:we}}),Ne=l=>{const S=m("unsubscribeTitle");let W=l.topic;c.value.mountpoint&&(W=W.replace(c.value.mountpoint,"")),Me.confirm(S,{confirmButtonText:O("Base.confirm"),cancelButtonText:O("Base.cancel"),confirmButtonClass:"confirm-danger",type:"warning"}).then(async()=>u.gateway?(l.clientid||(l.clientid=I.value),We(l.clientid,W)):Qt(l.clientid,W)).then(()=>{ae()}).catch(()=>{})},We=async(l,S)=>await St(u.gateway,l,S)?Promise.resolve():Promise.reject(),Se=l=>["mqueue","inflight"].includes(l),je=l=>Se(l)||["reductions"].includes(l),Ye=l=>{k.value=l,y.value=!0},de=T(!1),Ke=()=>{de.value=!0};return Z(),ae(),(l,S)=>{const W=st,we=ht,pe=g("el-tooltip"),xe=yt,Ve=Te,_e=g("el-button"),Ze=gt,Je=ve,j=g("el-table-column"),me=g("el-table"),$e=g("el-tab-pane"),Xe=g("el-tabs"),ke=g("el-descriptions-item"),Ie=g("el-descriptions"),re=g("el-card"),fe=g("el-col"),et=lt,qe=g("el-row"),tt=g("el-icon"),ie=Ge("loading");return r(),B(H,null,[V("div",{class:mt(["client-details app-wrapper",{"in-drawer":!!s.gateway}])},[V("div",mn,[t(xe,{item:{name:e(I),route:e(E),backFunc:s.gateway?()=>{d("refreshGateway")}:void 0}},{content:n(()=>[t(pe,{content:e(I)},{default:n(()=>[V("p",fn,[t(we,{content:e(I)},{default:n(()=>[t(W,null,{default:n(()=>[R($(e(I)),1)]),_:1})]),_:1},8,["content"])])]),_:1},8,["content"])]),_:1},8,["item"]),V("div",bn,[t(pe,{content:l.$t("Base.refresh"),placement:"top"},{default:n(()=>[t(Ve,{class:"icon-button","no-text":"",onClick:Z})]),_:1},8,["content"]),t(pe,{content:e(c).connected?e(m)("kickOut"):e(m)("cleanSession"),placement:"top"},{default:n(()=>[e(w)?(r(),v(_e,{key:0,class:"icon-button",type:"danger",icon:e(Lt),disabled:!l.$hasPermission("delete"),plain:"",onClick:D},null,8,["icon","disabled"])):Y("",!0)]),_:1},8,["content"])])]),e(w)?(r(),B(H,{key:0},[t(Xe,{type:"border-card"},{default:n(()=>[t($e,{label:e(m)("currentSubscription")},{default:n(()=>[V("div",vn,[S[3]||(S[3]=V("div",null,null,-1)),V("div",null,[t(Ve,{onClick:oe}),e(a)?(r(),v(Ze,{key:0,onClick:F},{default:n(()=>[R($(e(m)("addASubscription")),1)]),_:1})):Y("",!0)])]),ee((r(),v(me,{class:"subs",data:e(M),key:"topic"},{default:n(()=>[t(j,{prop:"topic",label:l.$t("Base.topic")},{default:n(({row:C})=>[t(Je,{content:C.topic},null,8,["content"])]),_:1},8,["label"]),t(j,{prop:"qos","min-width":"110px",label:"QoS"}),e(a)?(r(),v(j,{key:0,label:l.$t("Base.operation")},{default:n(({row:C})=>[t(_e,{disabled:!l.$hasPermission("delete"),plain:"",size:"small",onClick:nt=>Ne(C)},{default:n(()=>[R($(l.$t("Clients.unsubscribe")),1)]),_:2},1032,["disabled","onClick"])]),_:1},8,["label"])):Y("",!0)]),_:1},8,["data"])),[[ie,e(i),void 0,{lock:!0}]])]),_:1},8,["label"]),t($e,{label:e(m)("historySubscription")},{default:n(()=>[t(_n,{"client-id":e(I)},null,8,["client-id"])]),_:1},8,["label"])]),_:1}),t(qe,{gutter:26,class:"client-row block"},{default:n(()=>[t(fe,{span:12},{default:n(()=>[ee((r(),v(re,{class:"top-border client-info"},{default:n(()=>[t(Ie,{title:e(m)("connectionInfo"),border:"",column:1,size:"large"},{default:n(()=>[t(ke,{label:e(m)("connectedStatus")},{default:n(()=>[t(Ce,{client:e(c),field:"connected"},null,8,["client"])]),_:1},8,["label"]),(r(!0),B(H,null,ce(e(z).connection,C=>(r(),v(ke,{key:C,label:ye(C)},{default:n(()=>[C!=="client_attrs"?(r(),v(Ce,{key:0,client:e(c),field:C},null,8,["client","field"])):(r(),v(_e,{key:1,type:"primary",size:"small",plain:"",onClick:Ke},{default:n(()=>[R($(e(O)("Base.view")),1)]),_:1}))]),_:2},1032,["label"]))),128))]),_:1},8,["title"])]),_:1})),[[ie,e(p)]])]),_:1}),t(fe,{span:12},{default:n(()=>[ee((r(),v(re,{class:"top-border client-session"},{default:n(()=>[V("span",gn,"("+$(l.$t("Base.current"))+" / "+$(l.$t("Base.max"))+")",1),t(Ie,{title:e(m)("sessionInfo"),border:"",column:1,size:"large"},{default:n(()=>[(r(!0),B(H,null,ce(e(z).session,C=>(r(),v(ke,{key:C,label:ye(C)},{default:n(()=>[V("div",null,[t(Ce,{client:e(c),field:C},null,8,["client","field"]),Se(C)?(r(),v(pe,{key:0,disabled:!e(c).durable,content:e(m)("cannotViewMsg"),"show-after":500,placement:"top"},{default:n(()=>[t(_e,{class:"btn-view-msg",type:"primary",plain:!e(c).durable,disabled:e(c).durable,size:"small",onClick:nt=>Ye(C)},{default:n(()=>[R($(e(m)("viewMsg")),1)]),_:2},1032,["plain","disabled","onClick"])]),_:2},1032,["disabled","content"])):Y("",!0),je(C)?(r(),v(et,{key:1,class:"client-info-tips",content:ze(C)},null,8,["content"])):Y("",!0)])]),_:2},1032,["label"]))),128))]),_:1},8,["title"])]),_:1})),[[ie,e(p)]])]),_:1})]),_:1}),V("h2",null,$(l.$t("components.metrics")),1),t(qe,{class:"block client-metrics",gutter:26},{default:n(()=>[t(fe,{span:12},{default:n(()=>[ee((r(),v(re,{class:"top-border table-card bytes"},{default:n(()=>[t(me,{data:he(e(z).bytes)},{default:n(()=>[t(j,{prop:"label","min-width":"140",label:e(m)("bytes")},null,8,["label"]),t(j,{prop:"value",sortable:"","class-name":"sortable-without-header-text"})]),_:1},8,["data"])]),_:1})),[[ie,e(p)]]),ee((r(),v(re,{class:"top-border table-card packets"},{default:n(()=>[t(me,{data:he(e(z).packets)},{default:n(()=>[t(j,{prop:"label","min-width":"140",label:e(m)("packets")},null,8,["label"]),t(j,{prop:"value",sortable:"","class-name":"sortable-without-header-text"})]),_:1},8,["data"])]),_:1})),[[ie,e(p)]])]),_:1}),t(fe,{span:12},{default:n(()=>[ee((r(),v(re,{class:"top-border table-card client messages"},{default:n(()=>[t(me,{data:he(e(z).messages)},{default:n(()=>[t(j,{prop:"label","min-width":"140",label:e(m)("messages")},null,8,["label"]),t(j,{prop:"value",sortable:"","class-name":"sortable-without-header-text"})]),_:1},8,["data"])]),_:1})),[[ie,e(p)]])]),_:1})]),_:1}),t(tn,{visible:e(o),"onUpdate:visible":S[0]||(S[0]=C=>ne(o)?o.value=C:null),"client-id":e(c).clientid,gateway:s.gateway,"is-MQTT-Version5":e(se),"onCreate:subs":ae},null,8,["visible","client-id","gateway","is-MQTT-Version5"])],64)):(r(),B("div",yn,[t(tt,null,{default:n(()=>[t(e($t))]),_:1}),V("span",null,$(e(m)("clientDoesNotExist")),1)]))],2),t(cn,{modelValue:e(y),"onUpdate:modelValue":S[1]||(S[1]=C=>ne(y)?y.value=C:null),"client-id":e(I),type:e(k)},null,8,["modelValue","client-id","type"]),t(rn,{modelValue:e(de),"onUpdate:modelValue":S[2]||(S[2]=C=>ne(de)?de.value=C:null),value:e(c).client_attrs},null,8,["modelValue","value"])],64)}}});export{Gn as default};
