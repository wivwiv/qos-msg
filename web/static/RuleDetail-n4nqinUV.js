import{_ as pe}from"./DetailHeader.vue_vue_type_style_index_0_lang-jMoftCB_.js";import{d as V,q as P,c as U,b as a,w as o,u as e,r as m,o as w,a as n,t as u,M as T,z as K,aS as W,j as B,m as q,g as b,C as me,y as E,F as de,i as _e,s as fe,V as ve,p as j,e as be,x as ge,a5 as F}from"./index-gzDiX6cq.js";import{q as he,r as ye,b as Re,a as z}from"./useRule-XWlG7MOW.js";import{_ as we}from"./CopySubmitDialog.vue_vue_type_script_setup_true_lang-NVnrbhYd.js";import{a as Ce,u as Se,_ as De}from"./useRuleForm-DJxIDq8q.js";import{_ as $e}from"./DeleteRuleConfirm.vue_vue_type_style_index_0_lang-BolY5L4f.js";import{u as Be,_ as Ve}from"./UsingSchemaBridgeConfig.vue_vue_type_script_setup_true_lang-C7IqXt86.js";import{_ as ke}from"./InfoTooltip-DsMY02kq.js";import{_ as Me}from"./TargetItemStatus.vue_vue_type_style_index_0_lang-Bi-597rW.js";import{u as Ie}from"./usePaginationRemember-n4ryuqdx.js";import{u as Ee}from"./useDataNotSaveConfirm-HuE7DjIs.js";import{u as Te}from"./useDataHandler-DIoGjH2Q.js";import{_ as Ue}from"./useBridgeTypeValue-DfFvHZxE.js";import"./arrow-left-CB0GLQev.js";import"./http-BlFWNHJL.js";import"./CreateRuleWithConnector.vue_vue_type_style_index_0_lang-DzkuCXLT.js";import"./success-filled-CFwVfEFi.js";import"./useHandleActionItem-CLBwxXaF.js";import"./Monaco.vue_vue_type_style_index_0_lang-D8U6C2xl.js";import"./SourceDetail-BinG0Xfs.js";import"./useDeleteBridge-CmOHUvjU.js";import"./useHandleSourceItem-C2NmvGoR.js";import"./useActionAndSourceStatus-gzXOZG2c.js";import"./useCheckBeforeSaveAsCopy-6rpqkkHP.js";import"./useFormRules-BXbR-dxB.js";import"./useOperationConfirm-SEd6OnAP.js";import"./CodeView.vue_vue_type_style_index_0_lang-DGZ1vVQX.js";import"./useCopy-zlCfhwDY.js";import"./copy-document-BB3y9vIn.js";import"./diagnose-DSIpHM3s.js";import"./useSyncPolling-15pkvvIZ.js";import"./pie-BnP3p4-0.js";import"./circle-close-filled-C93ARdYO.js";import"./useDocLink-DK-uFujS.js";import"./SchemaForm-B5Ct9r7g.js";import"./CertFileInput.vue_vue_type_script_setup_true_lang-DHqscjx4.js";import"./FormItemLabel.vue_vue_type_style_index_0_lang-C2ue8b3P.js";import"./MarkdownContent.vue_vue_type_style_index_0_lang-CvIt_HhB.js";import"./arrow-right-K2qPT6rh.js";import"./check-AciMBS21.js";import"./CommonOverflowTooltip.vue_vue_type_style_index_0_lang-Du1TBZn7.js";import"./KeyAndValueEditor.vue_vue_type_style_index_0_lang--Tqi0AAK.js";import"./setting-Bk0ROr2k.js";import"./compareVersions-DqEOhma6.js";import"./CheckIcon.vue_vue_type_style_index_0_lang-CwdT__iB.js";import"./close-DHQqAhpS.js";import"./TextEasyCopy.vue_vue_type_style_index_0_lang-WBOKfnFy.js";import"./more-filled-DdhB6Svi.js";const qe={class:"resource-item-overview"},Ne=V({name:"RuleItemOverview"}),Le=V({...Ne,props:{ruleId:{type:String,required:!0}},setup(g){const t=g,{ruleTypeMetricsMap:d,actionTypeMetricsMap:c,textMap:R,rateData:s}=Be(),{tl:l}=P("RuleEngine"),h=async()=>{try{return t.ruleId?he(t.ruleId):void 0}catch{}},p=()=>{if(t.ruleId)return ye(t.ruleId)};return(r,C)=>{const _=m("el-table-column"),y=ke,S=m("el-table"),k=Ve;return w(),U("div",qe,[a(k,{totals:{rule:"matched",action:"actions.total"},title:("lowerCase"in r?r.lowerCase:e(T.lowerCase))(e(l)("rule")),"request-metrics":h,"request-reset":p,"type-metrics-maps":[{name:"rule",data:e(d),children:[{name:"action",data:e(c)}]}],"text-map":e(R),"rate-metrics":e(s),"show-rate":"","node-status-desc":e(l)("nodeStatusRuleDesc")},{table:o(({data:D})=>[a(S,{data:D.node_metrics},{default:o(()=>[a(_,{prop:"node",label:e(l)("name")},null,8,["label"]),a(_,{prop:"metrics.matched"},{header:o(()=>[n("span",null,u(e(l)("ruleMatched")),1),a(y,{content:e(l)("sqlMatchedDesc")},null,8,["content"])]),_:1}),a(_,{prop:"metrics.passed"},{header:o(()=>[n("span",null,u(e(l)("passed")),1),a(y,{content:e(l)("passedDesc")},null,8,["content"])]),_:1}),a(_,{prop:"metrics['failed.exception']"},{header:o(()=>[n("span",null,u(r.$t("Base.failed")),1),a(y,{content:e(l)("failedExceptionDesc")},null,8,["content"])]),_:1}),a(_,{prop:"metrics['failed.no_result']"},{header:o(()=>[n("span",null,u(e(l)("failedNoResult")),1),a(y,{content:e(l)("failedNoResultDesc")},null,8,["content"])]),_:1}),a(_,{prop:"metrics['matched.rate']"},{header:o(()=>[n("p",null,u(r.$t("Base.rate")),1),n("p",null,"("+u(r.$t("RuleEngine.rateUnit",0))+")",1)]),_:1}),a(_,{prop:"metrics['matched.rate.last5m']"},{header:o(()=>[n("p",null,u(r.$t("Base.rateLast5M")),1),n("p",null,"("+u(r.$t("RuleEngine.rateUnit",0))+")",1)]),_:1}),a(_,{prop:"metrics['matched.rate.max']"},{header:o(()=>[n("p",null,u(r.$t("Base.rateMax")),1),n("p",null,"("+u(r.$t("RuleEngine.rateUnit",0))+")",1)]),_:1})]),_:2},1032,["data"])]),_:1},8,["title","type-metrics-maps","text-map","rate-metrics","node-status-desc"])])}}}),Ae=()=>{const{t:g}=K();return{getStatusLabel:c=>g(c?"Base.enable":"Base.disable"),getStatusClass:c=>c?W.Success:W.Danger}},Oe=V({name:"RuleItemStatus"}),We=V({...Oe,props:{rule:{type:Object},isTag:{type:Boolean,default:!1}},setup(g){const t=g,{getStatusLabel:d,getStatusClass:c}=Ae(),R=B(()=>{const{rule:s}=t;return{details:s!=null&&s.node_status&&Array.isArray(s==null?void 0:s.node_status)?s==null?void 0:s.node_status.map(({node:h,enable:p})=>({node:h,statusLabel:d(p),statusClass:c(p)})):[],statusLabel:d(s==null?void 0:s.enable),statusClass:c(s==null?void 0:s.enable)}});return(s,l)=>{const h=Me;return w(),q(h,{"status-data":e(R),"is-tag":g.isTag},null,8,["status-data","is-tag"])}}}),je={class:"rule-detail"},Fe={class:"detail-top"},ze={class:"vertical-align-center"},Pe={class:"block-title"},Ke={class:"app-wrapper"},jt=V({__name:"RuleDetail",setup(g){const t=b({});let d;const c=_e(),R=fe(),{t:s}=K(),l=c.params.id,h=b(0),p=b(!1),r=b(!1),C=b("overview"),{isTesting:_,updateSavedData:y}=Ce(t),S=b(),k=B(()=>c.query.tab);k.value&&(C.value=k.value);const{tl:D}=P("RuleEngine"),{getBackRoute:x}=Ie("rule");Ee(()=>!T.isEqual(d,t.value));const G=async()=>{p.value=!0;try{t.value=await Re(l),d=T.cloneDeep(t.value),y(d),++h.value}catch(i){console.error(i)}finally{p.value=!1}},H=async()=>{p.value=!0,t.value.enable=!t.value.enable;try{await z(l,{enable:!t.value.enable}),F.success(s(t.value.enable?"Base.disabledSuccess":"Base.enableSuccess")),t.value.enable=!t.value.enable}catch(i){console.error(i)}finally{p.value=!1}},{judgeIsWebhookRule:J}=Te(),$=B(()=>J(t.value)),Q=B(()=>({})),M=b(!1),N=b(void 0),X=async()=>{$.value||(N.value=t.value,M.value=!0)},Y=()=>R.push({name:"rule"}),{getRuleDataForUpdate:Z}=Se(),ee=async()=>{await S.value.validate(),r.value=!0;try{await z(l,Z(t.value)),F.success(s("Base.updateSuccess")),d=t.value,_.value?y(t.value):R.push({name:"rule"})}catch(i){console.error(i)}finally{r.value=!1}},I=b(!1),te=B(()=>({type:"rule",obj:t.value})),ae=async()=>{await S.value.validate(),I.value=!0};return me(()=>{G()}),(i,f)=>{const se=m("el-switch"),L=m("el-tooltip"),oe=m("el-button"),le=pe,A=m("el-tab-pane"),ne=m("router-link"),re=m("i18n-t"),ue=m("el-alert"),ie=m("el-card"),ce=m("el-tabs"),O=ve("loading");return w(),U(de,null,[n("div",je,[n("div",Fe,[a(le,{item:{name:e(t).id,route:e(x)({name:"rule"})}},{content:o(()=>[n("div",ze,[n("p",Pe,u(e(t).id),1),a(We,{rule:e(t),"is-tag":""},null,8,["rule"])])]),extra:o(()=>[a(L,{content:e(t).enable?i.$t("Base.disable"):i.$t("Base.enable"),placement:"top"},{default:o(()=>[a(se,{class:"enable-btn",disabled:!i.$hasPermission("put")||e($),modelValue:e(t).enable,"onUpdate:modelValue":f[0]||(f[0]=v=>e(t).enable=v),onChange:H},null,8,["disabled","modelValue"])]),_:1},8,["content"]),a(L,{content:i.$t("Base.delete"),placement:"top"},{default:o(()=>[a(oe,{class:"icon-button",disabled:!i.$hasPermission("delete")||e($),type:"danger",icon:e(Ue),onClick:X,plain:""},null,8,["disabled","icon"])]),_:1},8,["content"])]),_:1},8,["item"])]),a(ce,{class:"detail-tabs",modelValue:e(C),"onUpdate:modelValue":f[2]||(f[2]=v=>E(C)?C.value=v:null)},{default:o(()=>[n("div",Ke,[a(A,{label:e(D)("overview"),name:"overview",lazy:""},{default:o(()=>[j((w(),U("div",null,[a(Le,{"rule-id":e(l)},null,8,["rule-id"])])),[[O,e(p)]])]),_:1},8,["label","name"]),a(A,{label:e(s)("Base.setting"),name:"settings",lazy:""},{default:o(()=>[e($)?(w(),q(ue,{key:0,class:"webhook-tip-alert","show-icon":"",type:"info",closable:!1},{default:o(()=>[a(re,{keypath:"RuleEngine.handleWebhookAssociatedTip",tag:"p"},{target:o(()=>[n("span",null,u(e(D)("rule")),1)]),operation:o(()=>[n("span",null,u(("lowerCase"in i?i.lowerCase:e(T.lowerCase))(e(s)("Base.edit"))),1)]),page:o(()=>[a(ne,{to:e(Q)},{default:o(()=>[be("Webhook "+u(e(D)("page")),1)]),_:1},8,["to"])]),_:1})]),_:1})):ge("",!0),j((w(),q(ie,{class:"detail-card overview-visible app-card"},{default:o(()=>[a(De,{ref_key:"formCom",ref:S,modelValue:e(t),"onUpdate:modelValue":f[1]||(f[1]=v=>E(t)?t.value=v:null),"is-edit":"","submit-loading":e(r),disabled:e($),onSave:ee,onSaveAsCopy:ae},null,8,["modelValue","submit-loading","disabled"])]),_:1})),[[O,e(p)]])]),_:1},8,["label","name"])])]),_:1},8,["modelValue"]),a(we,{target:e(te),modelValue:e(I),"onUpdate:modelValue":f[3]||(f[3]=v=>E(I)?I.value=v:null)},null,8,["target","modelValue"])]),a($e,{modelValue:e(M),"onUpdate:modelValue":f[4]||(f[4]=v=>E(M)?M.value=v:null),rule:e(N),onSubmitted:Y},null,8,["modelValue","rule"])],64)}}});export{jt as default};
