import{_ as P}from"./Monaco.vue_vue_type_style_index_0_lang-C5FqW0sc.js";import{_ as k}from"./DetailHeader.vue_vue_type_style_index_0_lang-B2doPzV1.js";import{g as H,i as S,b as A}from"./diagnose-CTW0WGD4.js";import{d as F,z as M,g as s,C as G,J as R,i as z,a5 as U,f as Y,c as b,b as i,p as J,w as g,a as O,t as B,r as _,V as W,o as y,F as X,k as Z,e as j,l as q,m as K}from"./index-Dp_94g6t.js";import"./arrow-left-B1ek5uAF.js";import"./http-DdqGSA6b.js";let v=0,V=0;const Q=5*1024*1024,D=50*1024,x=F({setup(){const{t:o}=M(),n=z(),N=s(),w=s(300),L=s(""),c=s(!1),m=s([]),r=s(""),d=n.params.id,u=s(""),f=s(!1),T=()=>{var a,p;const e=(((p=(a=N.value)==null?void 0:a.getBoundingClientRect())==null?void 0:p.top)||250)+30,l=window.innerHeight;w.value=l-e},h=e=>e.sort((l,a)=>a.mtime-l.mtime),C=async()=>{try{const e=await A(d);m.value=h(e),r.value=m.value[0].node}catch(e){console.error(e)}},t=async(e=!1)=>{c.value=!0,v=0,V=0,L.value="",u.value="",e||await C(),await I(d),c.value=!1},$=async e=>{e.scrollTop+w.value>=e.scrollHeight&&e.scrollTopChanged&&e.scrollTop>=V&&(v<=Q?(V=e.scrollTop,c.value=!0,u.value=o("LogTrace.loadNextPage"),await I(d),c.value=!1):U.warning(o("LogTrace.tooLargeLog")))},I=async e=>{const l={position:v,bytes:D,node:r.value};try{const a=await H(e,l);if((a==null?void 0:a.items)!==void 0){const{meta:p}=a;L.value+=a.items,v=(p==null?void 0:p.position)??v+D}}catch{}},E=async()=>{try{f.value=!0,await S(d,r.value)}catch{}finally{f.value=!1}};return G(()=>{T(),t()}),R(()=>r.value,(e,l)=>{e!==l&&l&&t(!0)}),{tl:e=>o("LogTrace."+e),monacoContainer:N,initialHeight:w,download:E,logContent:L,scrollLoadFunc:$,nodeOpts:m,selectedNode:r,viewDetail:t,viewNodeLoading:c,isDownloading:f,nextPageLoading:u,viewLogName:d}}}),ee={class:"log-trace-detail app-wrapper"},oe=["element-loading-text"],te={class:"default-node-tip tip"};function ae(o,n,N,w,L,c){const m=k,r=_("el-option"),d=_("el-select"),u=_("el-col"),f=_("el-button"),T=_("el-row"),h=P,C=W("loading");return y(),b("div",ee,[i(m,{item:{name:o.viewLogName,path:"/log-trace"}},null,8,["item"]),J((y(),b("div",{"element-loading-text":o.nextPageLoading},[i(T,{gutter:30},{default:g(()=>[i(u,{span:6},{default:g(()=>[i(d,{modelValue:o.selectedNode,"onUpdate:modelValue":n[0]||(n[0]=t=>o.selectedNode=t)},{default:g(()=>[(y(!0),b(X,null,Z(o.nodeOpts,t=>(y(),K(r,{value:t.node,key:t.node},null,8,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),i(u,{span:4},{default:g(()=>[i(f,{class:"dialog-primary-btn",type:"primary",onClick:n[1]||(n[1]=t=>o.download()),loading:o.isDownloading,disabled:o.viewNodeLoading},{default:g(()=>[j(B(o.$t("Base.download")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1}),O("p",te,B(o.tl("defaultNodeTip")),1),i(T,null,{default:g(()=>[O("div",{style:q({height:o.initialHeight+"px"}),class:"viewer-container",ref:"monacoContainer"},[i(h,{id:"log-trace",modelValue:o.logContent,"onUpdate:modelValue":n[2]||(n[2]=t=>o.logContent=t),"scroll-loading":!0,"scroll-func":o.scrollLoadFunc,lang:"powershell",disabled:!0},null,8,["modelValue","scroll-func"])],4)]),_:1})],8,oe)),[[C,o.viewNodeLoading]])])}const ce=Y(x,[["render",ae],["__scopeId","data-v-3b0719cb"]]);export{ce as default};
