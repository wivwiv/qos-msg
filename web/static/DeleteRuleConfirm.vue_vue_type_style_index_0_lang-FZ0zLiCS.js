import{d as Y,e as G,f as K,u as Q}from"./useRule-BMAMsE-E.js";import{d as W,q as Z,j as g,J as ee,g as i,m as C,aX as te,u as a,w as m,y as I,r as w,V as se,o as L,a as p,b as S,e as b,t as v,p as oe,c as ae,x as le,aT as ne,aY as re,a5 as V,M as ie}from"./index-F6_Zcexc.js";import{b as ce,u as ue,a as de}from"./useHandleSourceItem-DfyO6jzu.js";import{u as me}from"./useHandleActionItem-mdEFjGCq.js";import{w as pe}from"./useActionAndSourceStatus-BuifRkTw.js";const fe={class:"el-message-box__container"},ge={class:"el-icon el-message-box__status el-message-box-icon--warning"},ve={class:"el-message-box__message"},_e={class:"checkbox-wrapper"},he={class:"dialog-footer"},Ve=W({__name:"DeleteRuleConfirm",props:{modelValue:{type:Boolean},rule:{}},emits:["update:modelValue","submitted"],setup(T,{emit:D}){const c=T,R=D,{t:_,tl:h}=Z("RuleEngine"),r=g({get:()=>c.modelValue,set:e=>{R("update:modelValue",e)}});ee(r,e=>{e&&(u.value=!0,$())});const x=i([]),{getActionList:F}=ue(),N=async()=>{try{x.value=await F()}catch{}},A=i([]),{getEventList:O}=Y();(async()=>A.value=await O())();const y=i([]),{getSourceList:P}=de(),U=async()=>{try{y.value=await P()}catch{}},f=i(!1),$=async()=>{try{f.value=!0,await Promise.all([N(),U()])}catch{}finally{f.value=!1}},{findInputTypeNTarget:j}=G(),{judgeOutputType:H}=Q(),E=g(()=>{var d;return(((d=c.rule)==null?void 0:d.actions)||[]).filter(s=>H(s)===ne.DataBridge).reduce((s,l)=>{const n=x.value.find(o=>o.id===l);return n&&s.push(n),s},[])}),k=g(()=>{var s;return(((s=c.rule)==null?void 0:s.from)||[]).filter(l=>{const{type:n}=j(l,A.value,y.value);return n===re.Bridge}).reduce((l,n)=>{const o=y.value.find(X=>X.idForRuleFrom===n);return o&&l.push(o),l},[])}),B=g(()=>{const e=[...k.value,...E.value];return e.length>0&&e.every(t=>t.rules.length===1)}),u=i(!0),{deleteAction:M}=me(),{deleteSource:q}=ce(),z=i(!1),J=async()=>{if(c.rule){if(await K(c.rule.id),B.value&&u.value){try{await Promise.all(E.value.map(({id:e})=>M(e)))}catch{V.error(_("RuleEngine.deleteError",{target:ie.lowerCase(h("action"))}))}try{await Promise.all(k.value.map(({id:e})=>q(e)))}catch{V.error(_("RuleEngine.deleteError",{target:"source"}))}}V.success(_("Base.deleteSuccess")),R("submitted"),r.value=!1}};return(e,t)=>{const d=w("el-checkbox"),s=w("el-button"),l=w("el-dialog"),n=se("loading");return L(),C(l,{modelValue:a(r),"onUpdate:modelValue":t[2]||(t[2]=o=>I(r)?r.value=o:null),class:"common-dialog delete-second-confirm",width:400,"z-index":2e3},te({default:m(()=>[oe((L(),ae("div",null,[p("div",fe,[p("i",ge,[S(a(pe))]),p("div",ve,v(a(h)("deleteRuleConfirm")),1)]),p("div",_e,[a(B)?(L(),C(d,{key:0,modelValue:a(u),"onUpdate:modelValue":t[0]||(t[0]=o=>I(u)?u.value=o:null)},{default:m(()=>[b(v(a(h)("deleteActionAndSourceSameTime")),1)]),_:1},8,["modelValue"])):le("",!0)])])),[[n,a(f)]])]),_:2},[a(f)?void 0:{name:"footer",fn:m(()=>[p("span",he,[S(s,{onClick:t[1]||(t[1]=o=>r.value=!1)},{default:m(()=>[b(v(e.$t("Base.cancel")),1)]),_:1}),S(s,{type:"danger",plain:"",onClick:J,loading:a(z)},{default:m(()=>[b(v(e.$t("Base.confirm")),1)]),_:1},8,["loading"])])]),key:"0"}]),1032,["modelValue"])}}});export{Ve as _};
