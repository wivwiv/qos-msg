import{_ as ke}from"./DetailHeader.vue_vue_type_style_index_0_lang-jMoftCB_.js";import{j as i,d as Ie,g as B,q as Ve,J as De,C as Te,c as U,a as b,u as e,m as d,w as n,x as v,b as l,n as V,y as q,M as D,aZ as X,a5 as j,E as ee,r as m,i as Re,s as Ee,V as $e,o as r,t as T,e as z,p as te,l as Pe,R as Me,W as Fe,a_ as Ne,bo as xe,f as Ue}from"./index-gzDiX6cq.js";import{e as qe,s as je,f as ze}from"./UsingSchemaBridgeConfig.vue_vue_type_script_setup_true_lang-C7IqXt86.js";import{_ as Le}from"./useDeleteBridge-CmOHUvjU.js";import{a as Oe}from"./TargetItemStatus.vue_vue_type_style_index_0_lang-Bi-597rW.js";import{u as Ae}from"./usePaginationRemember-n4ryuqdx.js";import{u as We,a as Ge,_ as He}from"./useBridgeTypeValue-DfFvHZxE.js";import{b as Je,c as Ye}from"./useHandleSourceItem-C2NmvGoR.js";import{u as Ze}from"./useCheckBeforeSaveAsCopy-6rpqkkHP.js";const Ke=p=>{const R=new Map([]),y=i(()=>p.value?R.get(p.value)||qe:null),S=new Map([]),E=i(()=>S.get(p.value)||{isSource:!0});return{formCom:y,formComProps:E}},Qe={class:"bridge-detail"},Xe={class:"detail-top"},et={class:"vertical-align-center"},tt=["src"],at={class:"block-title"},ot={key:0,class:"btn-area"},st=Ie({__name:"SourceDetail",props:{sourceId:{type:String,default:""},disabled:{type:Boolean,default:!1},hideName:{type:Boolean,default:!1}},setup(p,{expose:R}){const y=Re(),S=Ee(),{getBackRoute:E}=Ae("source"),L=i(()=>E({name:"source"}));let $;const a=B({}),c=B(!1),C=B(!1),h=B("overview"),O=p,w=B(),A=i(()=>y.query.tab);A.value&&(h.value=A.value);const{getGeneralTypeLabel:ae}=We(),{getBridgeIcon:oe}=Ge(),{tl:g,t:f}=Ve("RuleEngine"),s=i(()=>["rule-detail","rule-create"].includes(y.name));s.value&&O.sourceId&&(h.value="settings");const _=i(()=>s.value?O.sourceId:y.params.id);De(_,t=>{t&&s.value&&k()});const P=i(()=>_.value.slice(0,_.value.indexOf(":"))),{formCom:se,formComProps:ne}=Ke(P),W=i(()=>!xe.includes(P.value)),le=i(()=>c.value&&!W.value),{getSourceDetail:re,updateSource:ie,toggleSourceEnable:ce,isTesting:M,testConnectivity:ue}=Je(),k=async()=>{c.value=!0;try{a.value=await re(_.value),$=D.cloneDeep(a.value)}catch(t){console.error(t)}finally{c.value=!1}},de=t=>{$=D.cloneDeep(t)},G=()=>{W.value&&(a.value=w.value.getFormRecord())},H=()=>(G(),a.value),{pwdErrorWhenCoping:J}=Ze(),Y=async()=>{try{await X(w.value),M.value=!0;const t=await H();await ue(D.omit(t,"id")),j.success(g("connectionSuccessful"))}catch{}finally{M.value=!1}},Z=async()=>{try{if(await X(w.value),G(),s.value&&D.isEqual(a.value,$))return Promise.resolve(a.value.id);await ee.confirm(g("updateSourceTip"),{confirmButtonText:f("Base.confirm"),cancelButtonText:f("Base.cancel"),type:"warning"}),C.value=!0;const t=await H(),o=await ie(t);return s.value||(j.success(f("Base.updateSuccess")),S.push({name:"source"})),C.value=!1,Promise.resolve(o.id)}catch(t){return C.value=!1,Promise.reject(t)}},me=async()=>{c.value=!0;const{enable:t}=a.value,o=t?"Base.enableSuccess":"Base.disabledSuccess";try{await ce(a.value.id,t),j.success(f(o)),k()}catch(N){console.error(N)}finally{c.value=!1}},pe=()=>{ee.confirm(g("useSourceCreateRule"),{confirmButtonText:f("Base.confirm"),cancelButtonText:f("Base.cancel"),type:"success"}).then(()=>{S.push({name:"rule-create",query:{sourceId:a.value.id}})}).catch(()=>({}))},fe=()=>{S.push({name:"source"})},{showSecondConfirm:F,usingBridgeRules:ve,currentDeleteBridgeId:ge,handleDeleteSuc:_e,handleDeleteSource:be}=Ye(fe),ye=async()=>{_.value&&be(a.value)};return Te(()=>{k()}),R({updateSourceInfo:Z,testConnection:Y}),(t,o)=>{const N=m("el-tag"),Se=m("el-switch"),x=m("el-tooltip"),I=m("el-button"),he=ke,K=m("el-tab-pane"),Be=m("el-alert"),Ce=m("el-card"),we=m("el-tabs"),Q=$e("loading");return r(),U("div",Qe,[b("div",Xe,[e(s)?v("",!0):(r(),d(he,{key:0,item:{name:e(a).name,route:e(L)}},{content:n(()=>[b("div",et,[b("img",{src:e(oe)(e(a).type)},null,8,tt),b("p",at,T(e(a).name),1),l(Oe,{type:"action",target:e(a),"is-tag":""},null,8,["target"]),l(N,{type:"info",class:"section-status"},{default:n(()=>[z(T(e(ae)(e(a).type)),1)]),_:1})])]),extra:n(()=>[l(x,{content:e(a).enable?t.$t("Base.disable"):t.$t("Base.enable"),placement:"top"},{default:n(()=>[l(Se,{class:"enable-btn",modelValue:e(a).enable,"onUpdate:modelValue":o[0]||(o[0]=u=>e(a).enable=u),disabled:!t.$hasPermission("put"),onChange:me},null,8,["modelValue","disabled"])]),_:1},8,["content"]),l(x,{content:e(g)("createRule"),placement:"top"},{default:n(()=>[l(I,{class:"icon-button",type:"primary",icon:e(je),disabled:!t.$hasPermission("post"),plain:"",onClick:pe},null,8,["icon","disabled"])]),_:1},8,["content"]),l(x,{content:t.$t("Base.delete"),placement:"top"},{default:n(()=>[l(I,{class:"icon-button",disabled:!t.$hasPermission("delete"),type:"danger",icon:e(He),onClick:ye,plain:""},null,8,["disabled","icon"])]),_:1},8,["content"])]),_:1},8,["item"]))]),l(we,{class:V(["detail-tabs",{"hide-tabs":e(s)}]),modelValue:e(h),"onUpdate:modelValue":o[3]||(o[3]=u=>q(h)?h.value=u:null)},{default:n(()=>[b("div",{class:V({"app-wrapper":!e(s),"detail-main":!0})},[e(s)?v("",!0):(r(),d(K,{key:0,label:e(g)("overview"),name:"overview",lazy:""},{default:n(()=>[te((r(),U("div",{class:V(["overview-container",{"is-loading":e(c)}])},[e(c)?v("",!0):(r(),d(ze,{key:0,"is-source":"","bridge-id":e(_),"bridge-msg":e(a),onReconnect:k},null,8,["bridge-id","bridge-msg"]))],2)),[[Q,e(c)]])]),_:1},8,["label","name"])),l(K,{label:e(f)("Base.setting"),name:"settings"},{default:n(()=>[e(J)?(r(),d(Be,{key:0,title:e(J),type:"error"},null,8,["title"])):v("",!0),te((r(),d(Ce,{class:V(["app-card",e(s)&&"app-inline-card"]),shadow:e(s)?"never":void 0},{default:n(()=>[b("div",{class:"setting-area",style:Pe({width:e(s)?"100%":"75%"})},[(r(),d(Me(e(se)),Fe({ref_key:"FormComEl",ref:w,modelValue:e(a),"onUpdate:modelValue":o[1]||(o[1]=u=>q(a)?a.value=u:null),edit:"",type:e(P),disabled:p.disabled,"hide-name":p.hideName},e(ne),{onInit:de}),null,16,["modelValue","type","disabled","hide-name"]))],4),e(s)?v("",!0):(r(),U("div",ot,[e(a).type?(r(),d(I,{key:0,type:"primary",disabled:!t.$hasPermission("put"),plain:"",loading:e(M),onClick:Y},{default:n(()=>[z(T(e(g)("testTheConnection")),1)]),_:1},8,["disabled","loading"])):v("",!0),e(a).type?(r(),d(I,{key:1,type:"primary",disabled:!t.$hasPermission("put"),loading:e(C),onClick:o[2]||(o[2]=u=>Z())},{default:n(()=>[z(T(t.$t("Base.update")),1)]),_:1},8,["disabled","loading"])):v("",!0)]))]),_:1},8,["class","shadow"])),[[Q,e(le)]])]),_:1},8,["label","name"])],2)]),_:1},8,["class","modelValue"]),l(Le,{modelValue:e(F),"onUpdate:modelValue":o[4]||(o[4]=u=>q(F)?F.value=u:null),"rule-list":e(ve),id:e(ge),direction:e(Ne).Ingress,onSubmitted:e(_e)},null,8,["modelValue","rule-list","id","direction","onSubmitted"])])}}}),nt=Ue(st,[["__scopeId","data-v-c0113b66"]]),vt=Object.freeze(Object.defineProperty({__proto__:null,default:nt},Symbol.toStringTag,{value:"Module"}));export{nt as S,vt as a,Ke as u};
